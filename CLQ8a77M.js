import {
  ip as Or,
  ap as p,
  a9 as E,
  iq as Sn,
  cH as y,
  b3 as Se,
  ir as ge,
  is as ve,
  it as Xr,
  iu as xe,
  hh as ue,
  iv as Ln,
  b6 as v,
  iw as yt,
  gV as kt,
  gB as Yr,
  ix as Jr,
  am as M,
  iy as $r,
  iz as Zr,
  iA as eo,
  iB as zt,
  iC as tt,
  iD as ae,
  iE as yi,
  gm as J,
  hi as He,
  eb as le,
  cw as B,
  iF as W,
  iG as Xe,
  bM as Ti,
  b5 as x,
  iH as Si,
  iI as to,
  iJ as Li,
  iK as Ei,
  iL as io,
  iM as qe,
  iN as Mr,
  iO as Ni,
  iP as ki,
  iQ as Br,
  iR as wt,
  iS as wi,
  e1 as no,
  iT as Di,
  iU as Oi,
  iV as En,
  iW as Nn,
  iX as Mi,
  iY as ni,
  iZ as Bi,
  i_ as ro,
  i$ as Ri,
  j0 as ct,
  j1 as kn,
  gy as wn,
  j2 as Ai,
  j3 as Dn,
  j4 as On,
  j5 as oo,
  j6 as ao,
  j7 as xi,
  j8 as Ii,
  j9 as Pi,
  ja as Hi,
  jb as qi,
  jc as Fi,
  jd as ji,
  je as zi,
  jf as _i,
  jg as Ui,
  jh as Qi,
  ji as Wi,
  jj as Vi,
  jk as so,
  jl as lo,
  jm as ho,
  jn as Rr,
  gt as ee,
  jo as Mn,
  jp as _t,
  jq as po,
  bs as D,
  jr as Fe,
  js as me,
  jt as Ki,
  ju as it,
  jv as Gi,
  jw as Me,
  jx as Xi,
  dz as co,
  jy as vn,
  jz as se,
  jA as Be,
  jB as uo,
  jC as fo,
  jD as Yi,
  jE as mo,
  jF as go,
  jG as vo,
  jH as Dt,
  jI as bo,
  jJ as Co,
  jK as yo,
  jL as Lt,
  jM as To,
  aZ as _,
  cy as dt,
  jN as Ie,
  jO as nt,
  jP as Pt,
  jQ as Bn,
  jR as Rn,
  jS as Ut,
  jT as Ji,
  jU as Qt,
  jV as $i,
  jW as ri,
  jX as oi,
  jY as ai,
  jZ as si,
  j_ as Wt,
  j$ as Ye,
  k0 as li,
  k1 as Le,
  k2 as Ot,
  gx as Vt,
  gs as he,
  gr as rt,
  k3 as pe,
  k4 as Zi,
  gz as te,
  k5 as Ar,
  k6 as xr,
  k7 as Ir,
  k8 as So,
  k9 as Pr,
  ka as ye,
  kb as bt,
  kc as Re,
  kd as An,
  ke as hi,
  kf as Et,
  eY as Lo,
  kg as Eo,
  kh as No,
  ki as ot,
  kj as xn,
  kk as In,
  kl as Pn,
  km as Hr,
  kn as qr,
  f2 as Hn,
  ko as de,
  kp as Fr,
  gD as ko,
  gK as wo,
  gH as Do,
  gI as Oo,
  gJ as Mo,
  gF as Bo,
  gG as Ro,
  kq as Ao,
  gn as pi,
  kr as Rt,
  ks as xo,
  kt as Io,
  ku as en,
  kv as Po,
  gX as jr,
  kw as tn,
  kx as Ht,
  ky as ze,
  kz as Ge,
  kA as Ho,
  kB as qn,
  kC as Fn,
  kD as ie,
  kE as pt,
  kF as Oe,
  kG as jn,
  kH as qo,
  kI as Ct,
  kJ as Y,
  kK as ne,
  kL as Kt,
  kM as at,
  kN as st,
  kO as oe,
  kP as At,
  kQ as zn,
  kR as qt,
  kS as Ft,
  kT as Tt,
  kU as ci,
  kV as Fo,
  kW as jo,
  kX as zr,
  kY as _r,
  kZ as zo,
  an as ut,
  k_ as bn,
  k$ as ft,
  l0 as Cn,
  l1 as Ur,
  l2 as Ve,
  l3 as _o,
  l4 as Uo,
  l5 as Qo,
  l6 as Gt,
  l7 as Wo,
  l8 as _n,
  l9 as Je,
  la as Xt,
  lb as nn,
  lc as Un,
  ld as Qn,
  gv as Wn,
  gu as Vn,
  le as rn,
  lf as Kn,
  lg as Gn,
  lh as Te,
  li as Vo,
  lj as Ko,
  gC as on,
  c0 as lt,
  lk as Go,
  ll as Qr,
  lm as Xn,
  ln as Xo,
  gp as Yo,
  lo as Wr,
  lp as Jo,
  lq as Nt,
  lr as $o,
  ls as Yn,
  lt as Jn,
  lu as fe,
  lv as ke,
  lw as Zo,
  lx as ea,
  ly as ta,
  lz as Ae,
  lA as ia,
  lB as $n,
  lC as na,
  lD as ra,
  lE as oa,
  lF as aa,
  lG as sa,
  lH as la,
  lI as jt,
  lJ as ha,
  lK as Ze,
  lL as pa,
  lM as ca,
  lN as da,
  lO as ua,
  lP as fa,
  lQ as ma,
  lR as ga,
  lS as va,
  lT as di,
  lU as Yt,
  lV as an,
  lW as ba,
  lX as Ca,
  lY as ui,
  lZ as Ke,
  l_ as Zn,
  l$ as sn,
  m0 as fi,
  m1 as er,
  m2 as tr,
  m3 as ir,
  m4 as xt,
  m5 as It,
  m6 as et,
  m7 as ln,
  m8 as hn,
  m9 as mt,
  ma as nr,
  mb as ya,
  mc as rr,
  md as or,
  me as ar,
  mf as je,
  mg as Jt,
  mh as pn,
  mi as cn,
  mj as $t,
  mk as Zt,
  ml as Ta,
  mm as Sa,
  mn as La,
  mo as St,
  mp as Ea,
  mq as Na,
  mr as ka,
  ms as wa,
  mt as Da,
  mu as Oa,
  mv as Ma,
  mw as Ba,
  mx as sr,
  my as lr,
  mz as Ra,
  mA as hr,
  mB as Qe,
  mC as We,
  mD as pr,
  mE as dn,
  mF as cr,
  mG as mi,
  mH as dr,
  mI as gi,
  mJ as vi,
  mK as ur,
  mL as un,
  mM as fn,
  mN as fr,
  mO as mr,
  mP as Aa,
  gW as gr,
  mQ as xa,
  mR as mn,
  gS as Ia,
  mS as vr,
  mT as Pa,
  mU as br,
  mV as Cr,
  mW as yr,
  mX as Tr,
  mY as Ha,
  mZ as Sr,
  m_ as qa,
  m$ as Fa,
  n0 as ja,
  n1 as za,
  n2 as _a,
  n3 as Ua,
  n4 as Qa,
  n5 as Lr,
  n6 as Wa,
  n7 as Va,
  n8 as Ka,
  n9 as Ga,
  na as Xa,
  nb as Ya,
  nc as Ja,
  nd as $a,
  ne as Za,
  nf as es,
  ng as Er,
} from '../assets/app-BjImoLrr.js';
var Vr = (function () {
  function s(e) {
    this.parent = e;
  }
  s.prototype.renderPanel = function () {
    var e = this.parent;
    var t = this.parent.createElement('div', {
      className: 'e-rte-content',
      id: this.parent.getID() + 'rte-view',
    });
    var i = Or(this.parent.value, this.parent);
    this.editableElement = this.parent.createElement('div', {
      className: 'e-content',
      id: this.parent.getID() + '_rte-edit-view',
      attrs: {
        contenteditable: 'true',
        'aria-label': 'Rich Text Editor',
        role: 'textbox',
        lang: this.parent.locale.slice(0, 2),
        dir: this.parent.enableRtl ? 'rtl' : 'ltr',
      },
    });
    if (!p(this.parent.fontFamily.default)) {
      this.editableElement.style.fontFamily = this.parent.fontFamily.default;
    }
    if (!p(this.parent.fontSize.default)) {
      this.editableElement.style.fontSize = this.parent.fontSize.default;
    }
    this.editableElement.innerHTML = i;
    t.appendChild(this.editableElement);
    this.setPanel(t);
    this.parent.rootContainer.appendChild(t);
  };
  s.prototype.getPanel = function () {
    return this.contentPanel;
  };
  s.prototype.getEditPanel = function () {
    return this.editableElement;
  };
  s.prototype.getText = function () {
    var e = this.getEditPanel().innerText;
    return this.getEditPanel().innerText ===
      `
`
      ? ''
      : this.getEditPanel().innerText;
  };
  s.prototype.setPanel = function (e) {
    this.contentPanel = e;
  };
  s.prototype.getDocument = function () {
    return this.getEditPanel().ownerDocument;
  };
  return s;
})();
var Kr = (function () {
  function s(e, t) {
    this.BLOCK_TAGS = [
      'p',
      'h1',
      'h2',
      'h3',
      'h4',
      'h5',
      'h6',
      'blockquote',
      'li',
      'pre',
      'td',
      'th',
      'div',
      'hr',
      'section',
      'figure',
    ];
    this.BASIC_FORMATS = ['p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'blockquote', 'pre'];
    this.root = e;
    this.currentDocument = t;
  }
  s.prototype.getBlockNodes = function () {
    var e = [];
    if (p(this.root.querySelector('.e-cell-select'))) return e;
    var t = this.root.querySelector('.e-cell-select').closest('table');
    var i = t.querySelectorAll('.e-cell-select');
    if (p(i) || i.length < 2) return e;
    for (var n = 0; n < i.length; n++) this.addBlockNodes(i[n], e);
    this.wrapParagraphNodes(e);
    return e;
  };
  s.prototype.addBlockNodes = function (e, t) {
    var i = e.childNodes;
    if (e.childNodes.length === 0) {
      t.push(e);
      return;
    }
    for (var n = 0; n < e.childNodes.length; n++) {
      var r = e.childNodes[n];
      if (!(t.indexOf(e.childNodes[n].parentElement) >= 0)) {
        if (
          e.childNodes[n].parentElement &&
          (e.childNodes[n].parentElement.nodeName === 'TD' || e.childNodes[n].parentElement.nodeName === 'TH') &&
          e.childNodes[n].parentElement.childNodes.length === 1
        ) {
          if (!(e.childNodes[n].nodeName === 'BR')) {
            e.childNodes[n].nodeType;
            Node.TEXT_NODE;
          }
        }
        t.push(e.childNodes[n].parentElement);
      }
    }
  };
  s.prototype.getTextNodes = function () {
    var e = [];
    if (p(this.root.querySelector('.e-cell-select'))) return e;
    var t = this.root.querySelector('.e-cell-select').closest('table');
    var i = t.querySelectorAll('.e-cell-select');
    if (p(i) || i.length < 2) return e;
    for (var n = 0; n < i.length; n++) this.addTextNodes(i[n], e);
    return e;
  };
  s.prototype.addTextNodes = function (e, t) {
    var i = e.childNodes;
    if (e.childNodes.length === 0 && (e.nodeName === 'TD' || e.nodeName === 'TH')) {
      var n = this.currentDocument.createTextNode('\u200B');
      e.appendChild(n);
      t.push(n);
      return;
    } else if (
      e.childNodes.length === 1 &&
      (e.nodeName === 'TD' || e.nodeName === 'TH') &&
      e.childNodes[0].nodeName === 'BR'
    ) {
      var n = this.currentDocument.createTextNode('\u200B');
      e.insertBefore(n, e.childNodes[0]);
      t.push(n);
      return;
    }
    for (var r = 0; r < e.childNodes.length; r++) {
      var o = e.childNodes[r];
      e.childNodes[r].nodeType === Node.TEXT_NODE
        ? t.push(e.childNodes[r])
        : e.childNodes[r].nodeType === Node.ELEMENT_NODE && this.addTextNodes(e.childNodes[r], t);
    }
  };
  s.prototype.wrapParagraphNodes = function (e) {
    for (var t = Array.from(e), i = 0; i < t.length; i++) {
      var n = t[i];
      if (t[i].nodeName === 'TD' || t[i].nodeName === 'TH')
        if (
          t[i].childNodes.length === 1 &&
          (t[i].childNodes[0].nodeName === 'BR' || t[i].childNodes[0].nodeType === Node.TEXT_NODE)
        ) {
          var r = t[i].childNodes[0];
          var o = E('p');
          t[i].childNodes[0].parentElement.insertBefore(o, t[i].childNodes[0]);
          o.appendChild(t[i].childNodes[0]);
          var a = e.indexOf(t[i]);
          e[a] = o;
        } else {
          var l = e.indexOf(t[i]);
          this.wrapInlineNodes(t[i], e, l);
        }
    }
    for (var i = 0; i < e.length; i++) {
      var h = e[i];
      if (e[i].nodeName === 'LI' && e[i].childNodes.length === 1) {
        var c = e[i].childNodes[0];
        if (
          e[i].childNodes[0].nodeType === Node.ELEMENT_NODE &&
          this.BASIC_FORMATS.indexOf(e[i].childNodes[0].nodeName.toLocaleLowerCase()) >= 0 &&
          e[i].childNodes[0].textContent === e[i].textContent
        ) {
          e[i] = e[i].childNodes[0];
        }
      }
    }
  };
  s.prototype.wrapInlineNodes = function (e, t, i) {
    var n = e.childNodes[0];
    var r = E('p');
    var o = [];
    if (p(n)) {
      e.appendChild(r);
      o.push(r);
      Sn(t, o, i);
      return;
    }
    for (; n; )
      if (n.nodeName === 'BR') {
        n.parentNode.insertBefore(r, n);
        r.appendChild(n);
        if (r.childNodes.length > 0 && o.indexOf(r) < 0) {
          o.push(r);
        }
        n = r.nextSibling;
        r = E('p');
      } else if (this.BLOCK_TAGS.indexOf(n.nodeName.toLocaleLowerCase()) >= 0) {
        o.push(n);
        if (r.childNodes.length > 0) {
          r = n;
          n = r.nextSibling;
        } else {
          if (n && n.nodeName === 'LI' && n.querySelectorAll('li').length > 0)
            for (var a = n.querySelectorAll('li'), l = 0; l < a.length; l++) o.push(a[l]);
          n.nodeName === 'LI' && p(n.nextSibling) ? (n = n.parentElement.nextSibling) : (n = n.nextSibling);
        }
      } else if (n.nodeType === Node.TEXT_NODE) {
        if (n.textContent.trim() === '' && n.textContent.indexOf('\u200B') < 0) {
          var h = n.nextSibling;
          y(n);
          n = n.nextSibling;
          continue;
        }
        n.parentNode.insertBefore(r, n);
        var c = n;
        r.appendChild(n);
        if (r.childNodes.length > 0 && o.indexOf(r) < 0) {
          o.push(r);
        }
        n = r.nextSibling;
      } else if (n.nodeName === 'TABLE' || n.nodeName === 'UL' || n.nodeName === 'OL')
        if (n.nodeName === 'TABLE') {
          for (var d = [], u = n.querySelectorAll('td, th'), l = 0; l < u.length; l++) this.addBlockNodes(u[l], d);
          this.wrapParagraphNodes(d);
          for (var l = 0; l < d.length; l++) o.push(d[l]);
          n = n.nextSibling;
        } else n = n.firstElementChild;
      else if (this.BLOCK_TAGS.indexOf(n.nodeName.toLocaleLowerCase()) < 0) {
        n.parentNode.insertBefore(r, n);
        r.appendChild(n);
        if (r.childNodes.length > 0 && o.indexOf(r) < 0) {
          o.push(r);
        }
        n = r.nextSibling;
      }
    Sn(t, o, i);
  };
  return s;
})();
var q = {
  startSelection: 'e-editor-select-start',
  endSelection: 'e-editor-select-end',
};
var ei = (function () {
  function s(e, t) {
    this.parent = e;
    this.nodeSelection = new Se(e);
    this.currentDocument = t;
    this.tableSelection = new Kr(e, t);
  }
  s.prototype.contents = function (e) {
    return e && e.tagName !== 'IFRAME' ? Array.prototype.slice.call(e.childNodes || []) : [];
  };
  s.prototype.isBlockNode = function (e) {
    return !!e && e.nodeType === Node.ELEMENT_NODE && ge.indexOf(e.tagName.toLowerCase()) >= 0;
  };
  s.prototype.isLink = function (e) {
    return !!e && e.nodeType === Node.ELEMENT_NODE && e.tagName.toLowerCase() === 'a';
  };
  s.prototype.blockParentNode = function (e) {
    for (; e && e.parentNode !== this.parent && (!e.parentNode || !this.hasClass(e.parentNode, 'e-node-inner')); null) {
      e = e.parentNode;
      if (this.isBlockNode(e)) return e;
    }
    return e;
  };
  s.prototype.rawAttributes = function (e) {
    var t = {};
    var i = e.attributes;
    if (e.attributes.length > 0)
      for (var n = 0; n < e.attributes.length; n++) {
        var r = e.attributes[n];
        t[e.attributes[n].nodeName] = e.attributes[n].value;
      }
    return t;
  };
  s.prototype.attributes = function (e) {
    if (!e) return '';
    for (var t = '', i = this.rawAttributes(e), n = Object.keys(i).sort(), r = 0; r < n.length; r++) {
      var o = n[r];
      var a = i['' + n[r]];
      a.indexOf("'") < 0 && a.indexOf('"') >= 0
        ? (t += ' ' + n[r] + "='" + a + "'")
        : (a.indexOf('"') >= 0 && a.indexOf("'") >= 0 && (a = a.replace(/"/g, '&quot;')),
          (t += ' ' + n[r] + '="' + a + '"'));
    }
    return t;
  };
  s.prototype.clearAttributes = function (e) {
    for (var t = e.attributes, i = t.length - 1; i >= 0; i--) {
      var n = t[i];
      e.removeAttribute(t[i].nodeName);
    }
  };
  s.prototype.openTagString = function (e) {
    return '<' + e.tagName.toLowerCase() + this.attributes(e) + '>';
  };
  s.prototype.closeTagString = function (e) {
    return '</' + e.tagName.toLowerCase() + '>';
  };
  s.prototype.createTagString = function (e, t, i) {
    return '<' + e.toLowerCase() + this.attributes(t) + '>' + i + '</' + e.toLowerCase() + '>';
  };
  s.prototype.isList = function (e) {
    return !!e && ['UL', 'OL'].indexOf(e.tagName) >= 0;
  };
  s.prototype.isElement = function (e) {
    return e === this.parent;
  };
  s.prototype.isEditable = function (e) {
    return (
      (!e.getAttribute || e.getAttribute('contenteditable') === 'true') && ['STYLE', 'SCRIPT'].indexOf(e.tagName) < 0
    );
  };
  s.prototype.hasClass = function (e, t) {
    return e && e.classList && e.classList.contains(t);
  };
  s.prototype.replaceWith = function (e, t) {
    var i = e.parentNode;
    if (e.parentNode !== null) {
      e.parentNode.insertBefore(this.parseHTMLFragment(t), e);
    }
    y(e);
  };
  s.prototype.parseHTMLFragment = function (e) {
    var t = E('template');
    t.innerHTML = e;
    return t.content instanceof DocumentFragment ? t.content : document.createRange().createContextualFragment(e);
  };
  s.prototype.wrap = function (e, t) {
    e.parentNode.insertBefore(t, e);
    t = e.previousSibling;
    t.appendChild(e);
    return t;
  };
  s.prototype.insertAfter = function (e, t) {
    t.parentNode.insertBefore(e, t.nextSibling);
  };
  s.prototype.wrapInner = function (e, t) {
    for (
      e.appendChild(t),
        t = e.querySelector('.e-rte-wrap-inner'),
        t.classList.remove('e-rte-wrap-inner'),
        t.classList.length === 0 && t.removeAttribute('class');
      e.firstChild !== t;

    )
      t.appendChild(e.firstChild);
    return t;
  };
  s.prototype.unWrap = function (e) {
    var t = e && e.parentNode;
    if (!t) return [];
    for (var i = []; e.firstChild && e.textContent !== ' '; ) {
      i.push(e.firstChild);
      t.insertBefore(e.firstChild, e);
    }
    i = i.length > 0 ? i : [e.parentNode];
    t.removeChild(e);
    return i;
  };
  s.prototype.getSelectedNode = function (e, t) {
    e.nodeType === Node.ELEMENT_NODE &&
    e.childNodes.length > 0 &&
    e.childNodes[t - 1] &&
    e.childNodes[t - 1].nodeType === Node.ELEMENT_NODE &&
    (e.childNodes[t - 1].classList.contains('e-editor-select-start') ||
      e.childNodes[t - 1].classList.contains('e-editor-select-end'))
      ? (e = e.childNodes[t - 1])
      : e.nodeType === Node.ELEMENT_NODE && e.childNodes.length > 0 && e.childNodes[t] && (e = e.childNodes[t]);
    if (e.nodeType === Node.TEXT_NODE) {
      e = e.parentNode;
    }
    return e;
  };
  s.prototype.nodeFinds = function (e, t) {
    for (var i = [], n = 0; n < t.length; n++)
      if (e.contains(t[n]) && e !== t[n]) {
        i.push(t[n]);
      }
    return i;
  };
  s.prototype.isEditorArea = function () {
    var e = this.getRangePoint(0);
    var t;
    for (t = e.commonAncestorContainer; t && !this.isElement(t); null) t = t.parentNode;
    return !!this.isElement(t);
  };
  s.prototype.getRangePoint = function (e) {
    var t = this.getSelection();
    var i = [];
    if (t && t.getRangeAt && t.rangeCount) {
      i = [];
      for (var n = 0; n < t.rangeCount; n++) i.push(t.getRangeAt(n));
    } else i = [this.currentDocument.createRange()];
    return typeof e < 'u' ? i[e] : i;
  };
  s.prototype.getSelection = function () {
    return this.nodeSelection.get(this.currentDocument);
  };
  s.prototype.getPreviousNode = function (e) {
    for (
      e = e.previousElementSibling;
      e &&
      e.textContent ===
        `
`;
      null
    )
      e = e.previousElementSibling;
    return e;
  };
  s.prototype.encode = function (e) {
    var t = document.createElement('div');
    t.innerText = e;
    return t.innerHTML.replace(
      /<br\s*[\/]?>/gi,
      `
`,
    );
  };
  s.prototype.saveMarker = function (e) {
    var t = this.parent.querySelector('.e-editor-select-start');
    var i = this.parent.querySelector('.e-editor-select-end');
    var n;
    var r;
    if (this.hasClass(t, 'e-editor-select-start') && t.classList.length > 1) {
      var o = this.createTagString(ve, t, this.encode(t.textContent));
      this.replaceWith(t, o);
      t = this.parent.querySelector('.e-editor-select-start');
      t.classList.remove('e-editor-select-start');
      n = t.childNodes[0];
    } else n = this.unWrap(t)[0];
    if (this.hasClass(i, 'e-editor-select-end') && i.classList.length > 1) {
      var o = this.createTagString(ve, i, this.encode(i.textContent));
      this.replaceWith(i, o);
      i = this.parent.querySelector('.e-editor-select-end');
      i.classList.remove('e-editor-select-end');
      r = i.childNodes[0];
    } else r = i ? this.unWrap(i)[0] : n;
    e.startContainer = e.getNodeArray(n, true);
    e.endContainer = e.getNodeArray(r, false);
    return e;
  };
  s.prototype.marker = function (e, t) {
    return '<span class="' + e + '">' + t + '</span>';
  };
  s.prototype.setMarker = function (e) {
    var t = e.range;
    var i = e.range.startContainer.childNodes;
    var n =
      e.range.startContainer.childNodes.length > 1 &&
      e.range.startContainer.childNodes[0].nodeName === 'TABLE' &&
      e.range.startOffset === 0;
    var r =
      e.range.startContainer.childNodes.length > 1 &&
      e.range.startContainer.childNodes[0].nodeName === 'IMAGE' &&
      e.range.endOffset === 1 &&
      e.range.endContainer.nodeName === '#text' &&
      e.range.endContainer.textContent.length === 0;
    var o =
      (n
        ? Xr(e.range.startContainer.childNodes[e.range.startOffset + 1])
        : e.range.startContainer.childNodes[e.range.startOffset > 0 ? e.range.startOffset - 1 : e.range.startOffset]) ||
      e.range.startContainer;
    var a =
      e.range.endContainer.childNodes[
        e.range.endOffset > 0 ? (r ? e.range.endOffset : e.range.endOffset - 1) : e.range.endOffset
      ] || e.range.endContainer;
    if (o.nodeType === Node.ELEMENT_NODE && a.nodeType === Node.ELEMENT_NODE && (o.contains(a) || a.contains(o))) {
      var l = o.contains(a) ? o : a;
      var h = l.nodeType !== Node.TEXT_NODE;
      if (h) {
        for (var c = [], d = [], u = l; l.contains(u); null) {
          c.indexOf(u) < 0 && u.childNodes && u.childNodes.length
            ? (c.push(u), (u = u.childNodes[0]))
            : u.nextSibling
              ? (u = u.nextSibling)
              : u.parentNode && ((u = u.parentNode), c.push(u));
          if (
            d.indexOf(u) < 0 &&
            (u.nodeType === Node.TEXT_NODE ||
              (xe.indexOf(u.parentNode.tagName.toLocaleLowerCase()) >= 0 &&
                (u.tagName === 'BR' || u.tagName === 'IMG')))
          ) {
            d.push(u);
          }
        }
        if (d.length) {
          o = o.contains(a) ? d[0] : o;
          a = d[d.length - 1];
        }
      }
    }
    if (o !== a) {
      if (
        o.nodeType !== Node.TEXT_NODE &&
        ((o.tagName === 'BR' && xe.indexOf(o.parentNode.tagName.toLocaleLowerCase()) >= 0) || o.tagName === 'IMG')
      ) {
        this.replaceWith(o, this.marker('e-editor-select-start', this.encode(o.textContent)));
        var f = e.range.startContainer.querySelector('.e-editor-select-start');
        f.appendChild(o);
      } else if (o.nodeType !== 3 && o.nodeName !== '#text' && o.nodeName !== 'BR') {
        var m = this.marker('e-editor-select-start', '');
        ue([this.parseHTMLFragment(m)], o);
      } else this.replaceWith(o, this.marker('e-editor-select-start', this.encode(o.textContent)));
      if (
        a.nodeType !== Node.TEXT_NODE &&
        a.tagName === 'BR' &&
        xe.indexOf(a.parentNode.tagName.toLocaleLowerCase()) >= 0
      ) {
        this.replaceWith(a, this.marker('e-editor-select-end', this.encode(a.textContent)));
        var g = e.range.endContainer.querySelector('.e-editor-select-end');
        g.appendChild(a);
      } else this.ensureSelfClosingTag(a, 'e-editor-select-end', e.range);
    } else this.ensureSelfClosingTag(o, 'e-editor-select-start', e.range);
  };
  s.prototype.ensureSelfClosingTag = function (e, t, i) {
    var n = false;
    if (e.nodeType === 3) this.replaceWith(e, this.marker(t, this.encode(e.textContent)));
    else if (e.tagName === 'BR') {
      this.replaceWith(e, this.marker(t, this.encode(e.textContent)));
      var r = i.startContainer.querySelector('.' + t);
      if (r) {
        r.parentElement.appendChild(e);
      }
    } else {
      var o = p(e.parentElement) ? '' : e.parentElement.tagName.toLocaleLowerCase();
      if (e.tagName === 'IMG' && o !== 'p' && o !== 'div') {
        var a = document.createElement('p');
        e.parentElement.insertBefore(a, e);
        a.appendChild(e);
        e = a.children[0];
      }
      if (e.tagName === 'TABLE') {
        n = true;
        if (e.textContent === '') {
          var l = e.querySelectorAll('td');
          e = l[l.length - 1];
          e = p(e.childNodes[0]) ? e : e.childNodes[0];
        } else {
          for (var h = e.lastChild; h.nodeType !== 3 && h.nodeName !== '#text' && h.nodeName !== 'BR'; )
            h = h.lastChild;
          e = h;
        }
      }
      for (var c = 0; c < Ln.length; c++) e = e.tagName === Ln[c] && !n ? e.parentNode : e;
      if (e.nodeType === 3 && e.nodeName === '#text') this.replaceWith(e, this.marker(t, this.encode(e.textContent)));
      else if (e.nodeName === 'BR') {
        this.replaceWith(e, this.marker('e-editor-select-end', this.encode(e.textContent)));
        var d = i.endContainer.querySelector('.e-editor-select-end');
        d.appendChild(e);
      } else if (e.nodeName !== 'HR') {
        var u = this.marker(t, '');
        ue([this.parseHTMLFragment(u)], e);
      }
    }
  };
  s.prototype.createTempNode = function (e) {
    var t = e.textContent;
    if (e.tagName === 'BR') {
      var i = '<' + ve + '></' + ve + '>';
      var n = e.parentNode;
      if (xe.indexOf(e.parentNode.tagName.toLocaleLowerCase()) >= 0) {
        e = this.wrap(e, this.parseHTMLFragment(i));
      }
    } else if (
      (e.nodeType !== Node.TEXT_NODE &&
        (e.classList.contains('e-editor-select-start') || e.classList.contains('e-editor-select-end'))) ||
      e.textContent.replace(/\n/g, '').replace(/(^ *)|( *$)/g, '').length > 0 ||
      (e.textContent.length &&
        e.textContent.indexOf(`
`) < 0 &&
        e.textContent !== ' ')
    ) {
      var i = '<' + ve + '></' + ve + '>';
      if (e.parentNode && !this.isBlockNode(e.parentNode))
        for (var r = this.getImmediateBlockNode(e), o = 0, a = Array.from(r.childNodes); o < a.length; o++) {
          var l = a[o];
          if (a[o] && a[o].contains(e)) {
            e = a[o];
            break;
          }
        }
      var h = e;
      e = this.wrap(e, this.parseHTMLFragment(i));
      var c =
        e.nodeType === Node.ELEMENT_NODE &&
        e.firstChild &&
        e.firstChild.nodeName === 'BR' &&
        (e.classList.contains('e-editor-select-start') || e.classList.contains('e-editor-select-end'));
      if (!c && e.nextElementSibling && e.nextElementSibling.tagName === 'BR') {
        e.appendChild(e.nextElementSibling);
      }
    }
    return e;
  };
  s.prototype.getImageTagInSelection = function () {
    var e = this.getSelection();
    return this.isEditorArea() && e.rangeCount ? e.focusNode.querySelectorAll('img') : null;
  };
  s.prototype.gatherElementsAround = function (e, t) {
    var i = E(t);
    var n = e.previousSibling;
    var r = e.parentElement;
    e.parentElement.className === 'e-editor-select-start'
      ? e.parentElement.parentNode.insertBefore(i, e.parentElement)
      : e.parentElement && e.parentElement.insertBefore(i, e);
    for (var o = 0; n !== null && n.nodeName !== 'BR' && !this.isBlockNode(n); ) {
      var a = n.previousSibling;
      if (n.nodeType === 3 || n.nodeType === 1) {
        o === 0 ? i.appendChild(n) : i.insertBefore(n, i.firstChild);
      }
      n = n.previousSibling;
      o++;
    }
    for (
      i.appendChild(e), n = i.nextSibling ? i.nextSibling : i.parentElement.nextSibling;
      n !== null && n.nodeName !== 'BR' && !this.isBlockNode(n);

    ) {
      var l = n.nextSibling ? n.nextSibling : n.parentElement.nextSibling;
      if (n.nodeType === 3 || n.nodeType === 1) {
        i.appendChild(n);
      }
      n = l;
    }
    return i;
  };
  s.prototype.convertToBlockNodes = function (e, t) {
    if (e.length > 1)
      for (var i = 0, n = e[0]; !p(n); ) {
        if (n.nodeName === 'BR') {
          var r = n.nextSibling;
          y(n);
          n = n.nextSibling;
        }
        if (!p(n)) {
          t
            ? (e[i] = n.nodeName === 'LI' || this.isBlockNode(n) ? n : this.gatherElementsAround(n, t ? 'p' : 'div'))
            : (e[i] = this.isBlockNode(e[i]) ? e[i] : this.gatherElementsAround(n, t ? 'p' : 'div'));
          var o = e[i].nodeName === 'LI' ? e[i].parentElement : e[i];
          var a = o.nodeName === '#text' ? o.parentElement : o;
          n = !p(a.querySelector('.e-editor-select-end')) || !p(v(n, '.e-editor-select-end')) ? null : o.nextSibling;
          if (n === null && !p(o.nextSibling) && o.nextSibling.nodeName === 'BR') {
            y(o.nextSibling);
          }
        }
        i++;
      }
    else if (!this.isBlockNode(e[0])) {
      e[0] = this.gatherElementsAround(e[0], t ? 'p' : 'div');
      if (!p(e[0].nextSibling) && e[0].nextSibling.nodeName === 'BR') {
        e[0].textContent === '' ? e[0].appendChild(e[0].nextSibling) : y(e[0].nextSibling);
      }
    }
    return e;
  };
  s.prototype.blockNodes = function (e) {
    var t = [];
    var i = this.getSelection();
    var n = this.tableSelection.getBlockNodes();
    if (n.length > 0) return n;
    if (this.isEditorArea() && i.rangeCount)
      for (
        var r = this.getRangePoint(),
          o = function (u) {
            var f = void 0;
            var m = r[u];
            var g = a.getSelectedNode(r[u].startContainer, r[u].startOffset);
            var b = a.getSelectedNode(r[u].endContainer, r[u].endOffset);
            if (a.isBlockNode(g) && t.indexOf(g) < 0) {
              t.push(g);
            }
            f = a.blockParentNode(g);
            var C = a.blockParentNode(b);
            if (f && t.indexOf(f) < 0)
              if (!p(e) && e) {
                var N = ['TD', 'TH'];
                var w = [r[u].commonAncestorContainer, f, C];
                if (
                  w.some(function (A) {
                    return N.indexOf(A.nodeName) !== -1;
                  })
                ) {
                  var T = a.getPreBlockNodeCollection(r[u]);
                  T.length > 1
                    ? a.wrapWithBlockNode(T, t)
                    : T.length > 0 &&
                      ((g !== b && g.nodeName !== 'BR') ||
                        (g === b &&
                          g.nodeName === 'SPAN' &&
                          (g.classList.contains('e-editor-select-start') ||
                            g.classList.contains('e-editor-select-end')))) &&
                      t.push(a.createTempNode(g));
                } else t.push(f);
              } else if (
                xe.indexOf(f.tagName.toLocaleLowerCase()) >= 0 &&
                (g.tagName === 'BR' ||
                  g.nodeType === Node.TEXT_NODE ||
                  g.classList.contains('e-editor-select-start') ||
                  g.classList.contains('e-editor-select-end'))
              ) {
                var S = g.previousSibling && g.previousSibling.nodeType === Node.TEXT_NODE ? g.previousSibling : g;
                !g.nextSibling && !g.previousSibling && g.tagName === 'BR' ? t.push(S) : t.push(a.createTempNode(S));
              } else t.push(f);
            for (var O = [], L = g; L !== b && L !== a.parent; null) {
              O.indexOf(L) < 0 && L.childNodes && L.childNodes.length
                ? (O.push(L), (L = L.childNodes[0]))
                : L &&
                    L.nodeType !== 8 &&
                    (L.tagName === 'BR' ||
                      (L.nodeType === Node.TEXT_NODE && L.textContent.trim() !== '') ||
                      (L.nodeType !== Node.TEXT_NODE &&
                        (L.classList.contains('e-editor-select-start') ||
                          L.classList.contains('e-editor-select-end')))) &&
                    xe.indexOf(L.parentNode.tagName.toLocaleLowerCase()) >= 0
                  ? (L = a.createTempNode(L))
                  : L.nextSibling &&
                      L.nextSibling.nodeType !== 8 &&
                      (L.nextSibling.tagName === 'BR' ||
                        L.nextSibling.nodeType === Node.TEXT_NODE ||
                        L.nextSibling.classList.contains('e-editor-select-start') ||
                        L.nextSibling.classList.contains('e-editor-select-end')) &&
                      xe.indexOf(L.nextSibling.parentNode.tagName.toLocaleLowerCase()) >= 0
                    ? (L = a.createTempNode(L.nextSibling))
                    : L.nextSibling
                      ? (L = L.nextSibling)
                      : L.parentNode && ((L = L.parentNode), O.push(L));
              if (
                t.indexOf(L) < 0 &&
                L.nodeType === Node.ELEMENT_NODE &&
                xe.indexOf(L.parentNode.tagName.toLocaleLowerCase()) >= 0 &&
                (L.classList.contains('e-editor-select-start') || L.classList.contains('e-editor-select-end'))
              ) {
                t.push(a.createTempNode(L));
              }
              if (
                a.isBlockNode(L) &&
                a.ignoreTableTag(L) &&
                O.indexOf(L) < 0 &&
                t.indexOf(L) < 0 &&
                (L !== b || r[u].endOffset > 0)
              ) {
                t.push(L);
              }
              if (L.nodeName === 'IMG' && L.parentElement.contentEditable === 'true') {
                t.push(L);
              }
            }
            f = a.blockParentNode(b);
            if (
              f &&
              a.ignoreTableTag(f) &&
              t.indexOf(f) < 0 &&
              !p(f.previousElementSibling) &&
              f.previousElementSibling.tagName !== 'IMG'
            ) {
              t.push(f);
            }
          },
          a = this,
          l = 0;
        l < r.length;
        l++
      )
        o(l);
    for (var h = t.length - 1; h > 0; h--) {
      var c = this.nodeFinds(t[h], t);
      if (c.length) {
        var d = t[h].querySelectorAll('ul, ol');
        if (t[h].tagName === 'LI' && d.length > 0) continue;
        t.splice(h, 1);
      }
    }
    return t;
  };
  s.prototype.ignoreTableTag = function (e) {
    return !(yt.indexOf(e.tagName.toLocaleLowerCase()) >= 0);
  };
  s.prototype.getPreBlockNodeCollection = function (e) {
    var t = this.getSelectedNode(e.startContainer, e.startOffset);
    var i = this.getSelectedNode(e.endContainer, e.endOffset);
    var n = [];
    var r = t.closest('td, th');
    if (p(r)) return n;
    for (
      var o = Array.from(r.childNodes),
        a = true,
        l = this.getClosestInlineParent(t, r, true),
        h = this.getClosestInlineParent(i, r, false),
        c = 0;
      c < o.length;
      c++
    ) {
      var d = o[c];
      l === h && o[c] === l
        ? (n.push(o[c]), (a = true))
        : o[c] === l
          ? (a = false)
          : o[c] === h && (n.push(o[c]), (a = true));
      if (!a) {
        n.push(o[c]);
      }
    }
    return n;
  };
  s.prototype.getClosestInlineParent = function (e, t, i) {
    if (e.nodeType === Node.TEXT_NODE || this.isBlockNode(e)) return e;
    for (var n = e, r = false; n; ) {
      var o = n;
      if (r) {
        if (this.isBlockNode(n)) return n;
        if (i && n.previousSibling) {
          if (this.isBlockNode(n.previousSibling) || n.previousSibling.nodeName === 'BR') return n;
          n = n.previousSibling;
        } else if (!i && n.nextSibling) {
          if (this.isBlockNode(n.nextSibling) || n.nextSibling.nodeName === 'BR') return n;
          n = n.nextSibling;
        } else return n;
      } else {
        n = n.parentElement;
        if (n === t) {
          n = n;
          r = true;
        }
      }
    }
    return null;
  };
  s.prototype.wrapWithBlockNode = function (e, t) {
    for (var i = E('p'), n = 0; n < e.length; n++) {
      var r = e[n];
      if (e[n].nodeName === 'BR') {
        e[n].parentNode.insertBefore(i, e[n]);
        i.appendChild(e[n]);
        if (i.childNodes.length > 0) {
          t.push(i);
        }
        i = E('p');
      } else {
        if (this.isBlockNode(e[n])) t.push(e[n]);
        else {
          if (e[n].nodeName === '#text' && e[n].textContent.trim() === '') continue;
          if (i.childElementCount === 0) {
            e[n].parentNode.insertBefore(i, e[n]);
          }
          i.appendChild(e[n]);
        }
        if (
          n === e.length - 1 &&
          i.nextElementSibling &&
          i.querySelectorAll('br').length === 0 &&
          i.nextElementSibling.nodeName === 'BR'
        ) {
          i.appendChild(i.nextElementSibling);
        }
      }
    }
    if (i.childNodes.length > 0 && t.indexOf(i) < 0) {
      t.push(i);
    }
  };
  s.prototype.getImmediateBlockNode = function (e) {
    for (; e && ge.indexOf(e.nodeName.toLocaleLowerCase()) < 0; ) e = e.parentNode;
    return e;
  };
  return s;
})();
var V = (function () {
  function s() {}
  s.WrapBefore = function (e, t, i) {
    t.innerText = e.textContent;
    i ? this.AppendBefore(t, e, true) : this.AppendBefore(t, e);
    if (e.parentNode) {
      e.parentNode.removeChild(e);
    }
    return t.childNodes[0];
  };
  s.Wrap = function (e, t) {
    this.AppendBefore(t, e);
    t.appendChild(e);
    return e;
  };
  s.unwrap = function (e) {
    var t = e.parentNode;
    var i = e.ownerDocument.defaultView.getSelection();
    var n = null;
    var r = 0;
    var o = null;
    var a = 0;
    var l;
    if (i && i.rangeCount) {
      l = i.getRangeAt(0);
      n = l.startContainer;
      r = l.startOffset;
      o = l.endContainer;
      a = l.endOffset;
    }
    for (var h = []; e.firstChild; null) h.push(e.parentNode.insertBefore(e.firstChild, e));
    e.parentNode.removeChild(e);
    if (i && n && o && h.length > 0) {
      if (n === e) {
        n = h[Math.min(r, h.length - 1)];
        r = 0;
      }
      if (o === e) {
        o = h[Math.min(a, h.length - 1)];
        a = 0;
      }
      i.removeAllRanges();
      l.setStart(n, r);
      l.setEnd(o, a);
      i.addRange(l);
    }
    return h;
  };
  s.AppendBefore = function (e, t, i) {
    return t.parentNode ? (i ? t.parentNode.insertBefore(e, t.nextSibling) : t.parentNode.insertBefore(e, t)) : t;
  };
  return s;
})();
var gt = (function () {
  function s() {
    this.enterAction = 'P';
    this.position = -1;
    this.nodeSelection = new Se();
  }
  s.prototype.GetSpliceNode = function (e, t) {
    t = this.SplitNode(e, t, true);
    t = this.SplitNode(e, t, false);
    return t;
  };
  s.prototype.SplitNode = function (e, t, i) {
    if (t) {
      var n = e.cloneRange();
      var r = t.parentNode;
      var o = this.nodeSelection.getIndex(t);
      n.collapse(i);
      i ? n.setStartBefore(t) : n.setEndAfter(t);
      var a = n.extractContents();
      if (i) {
        t = t.parentNode.childNodes[o];
        a = this.spliceEmptyNode(a, false);
        if (a && a.childNodes.length > 0) {
          var l = !!(
            a.childNodes.length === 1 &&
            a.childNodes[0].nodeName !== 'IMG' &&
            !(a.querySelectorAll('img').length > 0) &&
            this.isRteElm(a) &&
            a.textContent.trim() === '' &&
            a.textContent.charCodeAt(0) !== 32 &&
            a.textContent.charCodeAt(0) !== 160
          );
          if (!l)
            if (t) V.AppendBefore(a, t);
            else {
              t.parentNode.appendChild(a);
              var h = document.createElement('div');
              h.innerHTML = '&#65279;&#65279;';
              t = h.firstChild;
              t.parentNode.appendChild(t);
            }
        }
      } else {
        t = t.parentNode.childNodes.length > 1 ? t.parentNode.childNodes[o] : t.parentNode.childNodes[0];
        a = this.spliceEmptyNode(a, true);
        if (a && a.childNodes.length > 0) {
          var l = !!(
            a.childNodes.length === 1 &&
            a.childNodes[0].nodeName !== 'IMG' &&
            this.isRteElm(a) &&
            a.textContent.trim() === '' &&
            a.textContent.charCodeAt(0) !== 32 &&
            a.textContent.charCodeAt(0) !== 160
          );
          if (!l)
            if (t) V.AppendBefore(a, t, true);
            else if (t.parentNode.childNodes.length > 1 && t.parentNode.childNodes.length !== o) {
              t = t.parentNode.childNodes[t.parentNode.childNodes.length - 1];
              V.AppendBefore(a, t, true);
              t = t.nextSibling;
            } else {
              t.parentNode.appendChild(a);
              var h = document.createElement('div');
              h.innerHTML = '&#65279;&#65279;';
              t.parentNode.insertBefore(h.firstChild, t.parentNode.firstChild);
              t = t.parentNode.firstChild;
            }
        }
      }
      return t;
    } else return null;
  };
  s.prototype.isRteElm = function (e) {
    var t = true;
    if (e.childNodes.length === 1 && e.childNodes[0].nodeName !== 'IMG')
      for (var i = e.childNodes[0], n = 0; !p(i.childNodes) && n < i.childNodes.length; n++)
        if (
          i.childNodes[n].nodeName === 'IMG' ||
          (i.childNodes[n].nodeName === 'SPAN' &&
            (i.childNodes[n].classList.contains('e-video-wrap') ||
              i.childNodes[n].classList.contains('e-embed-video-wrap') ||
              i.childNodes[n].classList.contains('e-audio-wrap'))) ||
          i.childNodes[n].nodeName === 'TABLE' ||
          i.childNodes[n].nodeName === 'HR'
        ) {
          t = false;
        } else t = true;
    return t;
  };
  s.prototype.spliceEmptyNode = function (e, t) {
    var i;
    (e.childNodes.length === 1 && e.childNodes[0].nodeName === '#text' && e.childNodes[0].textContent === '') ||
    e.textContent === ''
      ? (i = -1)
      : (i = e.childNodes.length - 1);
    i > -1 && !t
      ? this.spliceEmptyNode(e.childNodes[i], t)
      : i > -1
        ? this.spliceEmptyNode(e.childNodes[0], t)
        : e.nodeType !== 3 &&
          e.nodeType !== 11 &&
          e.nodeName !== 'IMG' &&
          !(e.querySelectorAll('img').length > 0) &&
          !e.classList.contains('e-video-wrap') &&
          !e.classList.contains('e-audio-wrap') &&
          e.parentNode.removeChild(e);
    return e;
  };
  s.prototype.GetCursorStart = function (e, t, i) {
    e = i ? e : e.reverse();
    for (var n = e[0], r = 0; r < e.length && (i ? e[r] < t : e[r] >= t); r++) n = e[r];
    return n;
  };
  s.prototype.GetCursorRange = function (e, t, i) {
    var n = e.createRange();
    var r = [];
    r.push(0);
    for (var o = this.TrimLineBreak(i.data), a = o.indexOf(' ', 0); a !== -1; ) {
      if (r.indexOf(a) < 0) {
        r.push(a);
      }
      if (new RegExp('\\s').test(o[a - 1]) && r.indexOf(a - 1) < 0) {
        r.push(a - 1);
      }
      if (new RegExp('\\s').test(o[a + 1])) {
        r.push(a + 1);
      }
      a = o.indexOf(' ', a + 1);
    }
    r.push(o.length);
    if (
      r.indexOf(t.startOffset) >= 0 ||
      (r.indexOf(t.startOffset - 1) >= 0 &&
        (t.startOffset !== 1 || (t.startOffset === 1 && new RegExp('\\s').test(o[0])))) ||
      (r[r.length - 1] - 1 === t.startOffset && t.endOffset !== o.length - 1 && !new RegExp('\\s').test(o[0]))
    ) {
      n = t;
      this.position = 1;
    } else {
      var l = this.GetCursorStart(r, t.startOffset, true);
      if (l !== 0 && o[l] && o[l] === ' ') {
        l = l + 1;
      }
      this.position = t.startOffset - l;
      n.setStart(t.startContainer, l);
      n.setEnd(t.startContainer, this.GetCursorStart(r, t.startOffset, false));
    }
    return n;
  };
  s.prototype.GetCursorNode = function (e, t, i) {
    return this.GetSpliceNode(this.GetCursorRange(e, t, i), i);
  };
  s.prototype.TrimLineBreak = function (e) {
    return e.replace(/(\r\n\t|\n|\r\t)/gm, ' ');
  };
  return s;
})();
var Pe = (function () {
  function s() {}
  s.Insert = function (e, t, i, n, r, o) {
    var a = this.prepareInsertNode(t, n, i);
    var l = p(i) ? 0 : i.scrollHeight;
    var h = new Se(i);
    var c = new gt();
    var d = h.getRange(e);
    d = this.adjustSelectionRange(h, e, i, d);
    var u = this.isCursorAtStartPoint(d);
    var f = d.collapsed;
    var m = this.getNodeCollection(d, h, a);
    var g = a.nodeName.toLowerCase() === 'table';
    var b = this.findRelevantParentNode(m, g, d, i);
    if (b && b.nodeName === 'BR') {
      b = b.parentNode;
    }
    if (b && b.nodeName === 'LI' && g) {
      this.handleTableInListItem(d, a, b, m, h, c, i);
      return;
    }
    var C =
      a.nodeName !== '#text' &&
      !p(a.children[0]) &&
      !p(a.children[0].tagName) &&
      a.children[0].tagName === 'IMG' &&
      a.children.length === 1;
    var N = u && d.startContainer.textContent === '' && d.startContainer.nodeName !== 'BR' && r !== 'BR';
    if (N && C) {
      d.startContainer.innerHTML = '';
    }
    var w = n || (!p(a) && !p(a.classList) && a.classList.contains('pasteContent'));
    var T = e.querySelectorAll('td.e-cell-select, th.e-cell-select');
    if (T && T.length > 1) {
      this.clearTargetCells(T);
    }
    if (w) {
      if (o && o.tableObj && o.tableObj.tablePastingObj) {
        var S = o.tableObj.tablePastingObj;
        var O = o.tableObj.tablePastingObj.getValidTableFromPaste(a);
        var L = T && T.length > 0;
        if (L && O) {
          o.tableObj.tablePastingObj.handleTablePaste(O, T);
          return;
        }
      }
      this.pasteInsertHTML(m, a, d, h, c, e, d.collapsed, b, i, r);
      return;
    }
    this.shouldInsertOutsideRange(i, d, d.collapsed, b, a)
      ? this.handleContentInsertionOutsideRange(e, i, d, h, c, d.collapsed, b, a, m, t, u, r)
      : this.handleContentInsertionInsideRange(e, d, h, b, a, u);
    if (this.shouldScrollToCursor(i, l, a)) {
      kt(e, i);
    }
  };
  s.clearTargetCells = function (e) {
    for (var t = 0; t < e.length; t++) e[t].innerHTML = '<br>';
  };
  s.prepareInsertNode = function (e, t, i) {
    if (typeof e == 'string') {
      e = Yr(e, i);
      var n = E('div');
      n.innerHTML = e.replace(/&(times|divide|ne)(;?)/g, '&amp;$1$2');
      return t ? n : n.firstChild;
    } else {
      var r = !p(e) && !p(e.classList) && e.classList.contains('pasteContent');
      if (t && !r) {
        var n = E('div');
        n.appendChild(e);
        return n;
      } else return e;
    }
  };
  s.adjustSelectionRange = function (e, t, i, n) {
    var r = n.startContainer === n.endContainer && n.startOffset === 0 && n.startOffset === n.endOffset;
    if (r) {
      n = this.adjustEmptyEditorSelection(e, t, i, n);
      n = this.adjustSelectionToFirstTextNode(e, t, i, n);
      n = this.adjustBrElementSelection(e, t, n);
    }
    return n;
  };
  s.adjustEmptyEditorSelection = function (e, t, i, n) {
    return n.startContainer === i &&
      i.textContent.length === 0 &&
      (i.children[0].tagName === 'P' || i.children[0].tagName === 'DIV' || i.children[0].tagName === 'BR')
      ? (e.setSelectionText(t, n.startContainer.children[0], n.startContainer.children[0], 0, 0), e.getRange(t))
      : n;
  };
  s.adjustSelectionToFirstTextNode = function (e, t, i, n) {
    if (n.startContainer === i && i.textContent.trim().length > 0 && i.childNodes[0].tagName !== 'TABLE') {
      var r = this.findFirstTextNode(n.startContainer);
      if (!p(r)) {
        e.setSelectionText(t, r, r, 0, 0);
        return e.getRange(t);
      }
    }
    return n;
  };
  s.adjustBrElementSelection = function (e, t, i) {
    if (i.startContainer.nodeName === 'BR') {
      var n = Array.prototype.slice.call(i.startContainer.parentElement.childNodes).indexOf(i.startContainer);
      e.setSelectionText(t, i.startContainer.parentElement, i.startContainer.parentElement, n, n);
      return e.getRange(t);
    }
    return i;
  };
  s.handleTableInListItem = function (e, t, i, n, r, o, a) {
    if (n.length === 0) {
      var l = r.processedTableImageCursor(e);
      if (l.startName === 'TABLE' || l.endName === 'TABLE') {
        var h = l.start ? l.startNode : l.endNode;
        n.push(h);
      }
    }
    var c = this.findClosestRelevantElement(n[n.length - 1].parentNode, a);
    this.insertTableInList(e, t, i, n[0], o, c);
  };
  s.isCursorAtStartPoint = function (e) {
    return e.startOffset === 0 && e.startOffset === e.endOffset && e.startContainer === e.endContainer;
  };
  s.findRelevantParentNode = function (e, t, i, n) {
    return t
      ? !p(e[0]) && !p(e[0].parentNode)
        ? this.findClosestRelevantElement(e[0].parentNode, n)
        : i.startContainer
      : e[0];
  };
  s.shouldInsertOutsideRange = function (e, t, i, n, r) {
    return (
      e !== t.startContainer &&
      ((!i && !(n.nodeType === Node.ELEMENT_NODE && yt.indexOf(n.tagName.toLocaleLowerCase()) !== -1)) ||
        (r.nodeName.toLowerCase() === 'table' && n && yt.indexOf(n.tagName.toLocaleLowerCase()) === -1))
    );
  };
  s.handleContentInsertionOutsideRange = function (e, t, i, n, r, o, a, l, h, c, d, u) {
    var f = r.GetSpliceNode(i, a);
    var m = f.previousSibling;
    var g = f.parentNode;
    if (h.length === 1) {
      n.setSelectionContents(e, f);
      i = n.getRange(e);
    } else if (f.parentNode && f.parentNode.nodeName !== 'LI') {
      var b = r.GetSpliceNode(i, h[h.length - 1].parentElement);
      b = p(b) ? f : b;
      n.setSelectionText(e, f, b, 0, b.nodeType === 3 ? b.textContent.length : b.childNodes.length);
      i = n.getRange(e);
    }
    this.extractOrCleanupContent(i, f.parentNode);
    if (c.tagName === 'TABLE') {
      this.cleanupForTableInsertion(i, t);
    }
    this.removeOriginalNodes(h);
    this.insertNodeAtLocation(e, f.previousSibling, f.parentNode, t, l, f, c, d, i, u);
    this.removeEmptyElements(t);
    this.setSelectionAfterInsertion(l, n, e);
  };
  s.extractOrCleanupContent = function (e, t) {
    e.startContainer.parentElement.closest('ol,ul') !== null && e.endContainer.parentElement.closest('ol,ul') !== null
      ? Jr(e, t)
      : e.extractContents();
  };
  s.cleanupForTableInsertion = function (e, t) {
    var i = v(e.startContainer, 'blockquote');
    if (!p(i) && i.childNodes.length > 0)
      for (var n = i.childNodes.length - 1; n >= 0; n--) {
        var r = i.childNodes[n];
        if (!p(i.childNodes[n]) && i.childNodes[n].innerText.trim() === '') {
          y(i.childNodes[n]);
        }
      }
    this.removeEmptyElements(t, false, i);
  };
  s.removeOriginalNodes = function (e) {
    for (var t = 0; t < e.length; t++)
      if (e[t].nodeType !== 3 && e[t].parentNode != null) {
        if (e[t].nodeName === 'IMG') continue;
        e[t].parentNode.removeChild(e[t]);
      }
  };
  s.insertNodeAtLocation = function (e, t, i, n, r, o, a, l, h, c) {
    !p(t) && !p(t.parentNode)
      ? e.contains(t)
        ? V.AppendBefore(r, t, true)
        : h.insertNode(r)
      : ((i = this.findAppropriateParentNode(i, n)), this.insertNodeBasedOnContext(i, n, r, a, l, h, o, c));
  };
  s.findAppropriateParentNode = function (e, t) {
    for (var i = null; e !== t && e.firstChild && e.textContent.trim() === '' && e.nodeName !== 'LI'; ) {
      var n = e.parentNode;
      i = e;
      e = e.parentNode;
    }
    return i !== null ? i : e;
  };
  s.insertNodeBasedOnContext = function (e, t, i, n, r, o, a, l) {
    if (e.firstChild && (e !== t || (i.nodeName === 'TABLE' && r && e === o.startContainer && e === o.endContainer)))
      if (e.textContent.trim() === '' && e !== t && e.nodeName === 'LI') e.appendChild(i);
      else if (e.textContent.trim() === '' && e !== t) {
        if (e.parentNode && e.parentNode === t && !this.isBlockElement(i) && !(l && l.toUpperCase() === 'BR')) {
          var h = l && l.toUpperCase() === 'DIV' ? E('div') : E('p');
          h.appendChild(i);
          V.AppendBefore(h, e, false);
        } else V.AppendBefore(i, e, false);
        y(e);
      } else V.AppendBefore(i, e.firstChild, false);
    else p(a.previousSibling) && n.tagName === 'TABLE' ? e.prepend(i) : e.appendChild(i);
  };
  s.setSelectionAfterInsertion = function (e, t, i) {
    e.nodeName === 'IMG'
      ? this.imageFocus(e, t, i)
      : e.nodeType !== 3
        ? t.setSelectionText(i, e, e, 0, e.childNodes.length)
        : t.setSelectionText(i, e, e, 0, e.textContent.length);
  };
  s.handleContentInsertionInsideRange = function (e, t, i, n, r, o) {
    var a = p(n) ? null : v(n, 'li');
    this.shouldInsertInTableCell(n, a, o)
      ? (t.extractContents(), a.appendChild(r), this.removeEmptyNextLI(a))
      : this.insertWithRangeHandling(e, t, r, o);
    this.setCursorAfterInsertion(e, r, i);
  };
  s.shouldInsertInTableCell = function (e, t, i) {
    return !p(e) && (e.nodeName === 'TD' || e.nodeName === 'TH') && !p(t) && !i;
  };
  s.insertWithRangeHandling = function (e, t, i, n) {
    t.deleteContents();
    if (n && t.startContainer.textContent === '' && t.startContainer.nodeName !== 'BR') {
      t.startContainer.innerHTML = '';
    }
    if (M.isIE) {
      var r = e.createDocumentFragment();
      r.appendChild(i);
      t.insertNode(r);
    } else this.isHrElement(t) ? this.insertAfterHrElement(t, i) : this.insertBasedOnStartContainer(t, i);
  };
  s.isHrElement = function (e) {
    return (
      e.startContainer.nodeType === 1 &&
      e.startContainer.nodeName.toLowerCase() === 'hr' &&
      e.endContainer.nodeName.toLowerCase() === 'hr'
    );
  };
  s.insertAfterHrElement = function (e, t) {
    var i = e.startContainer.nextElementSibling;
    if (e.startContainer.nextElementSibling) {
      if (e.startContainer.nextElementSibling.querySelector('br')) {
        y(e.startContainer.nextElementSibling.querySelector('br'));
      }
      e.startContainer.nextElementSibling.appendChild(t);
    }
  };
  s.insertBasedOnStartContainer = function (e, t) {
    e.startContainer.nodeName === 'BR'
      ? e.startContainer.parentElement.insertBefore(t, e.startContainer)
      : e.insertNode(t);
  };
  s.setCursorAfterInsertion = function (e, t, i) {
    t.nodeType !== 3 && t.childNodes.length > 0
      ? i.setSelectionText(e, t, t, 1, 1)
      : t.nodeName === 'IMG'
        ? this.imageFocus(t, i, e)
        : t.nodeType !== 3
          ? i.setSelectionContents(e, t)
          : i.setSelectionText(e, t, t, t.textContent.length, t.textContent.length);
  };
  s.shouldScrollToCursor = function (e, t, i) {
    return !p(e) && t < e.scrollHeight && i.nodeType === 1 && (i.nodeName === 'IMG' || !p(i.querySelector('img')));
  };
  s.removeEmptyNextLI = function (e) {
    for (var t = v(e, 'ul,ol'); t && t.parentElement && t.parentElement.nodeName === 'LI'; )
      t = v(t.parentElement, 'ul,ol');
    if (t) {
      var i = t.querySelectorAll('li');
      var n = function (r) {
        return r.textContent.trim() === '' && !r.querySelector('audio,video,img,table,br');
      };
      i.forEach(function (r) {
        if (n(r)) {
          y(r);
        }
      });
    }
  };
  s.findFirstTextNode = function (e) {
    if (e.nodeType === Node.TEXT_NODE) return e;
    for (var t = 0; t < e.childNodes.length; t++) {
      var i = this.findFirstTextNode(e.childNodes[t]);
      if (!p(i)) return i;
    }
    return null;
  };
  s.pasteInsertHTML = function (e, t, i, n, r, o, a, l, h, c) {
    var d = this.getImmediateBlockNode(e[e.length - 1], h);
    if (d && d.textContent.length === 0) {
      var u = d.querySelector('br:last-of-type');
      if (u) {
        u.classList.add('rte-temp-br');
      }
    }
    var f = i.startOffset === i.endOffset && i.startContainer === i.endContainer;
    i = this.adjustRangeForEmptyEditor(e, i, n, o, h, f);
    var m = this.setupRangeForPaste(e, t, i, n, r, o, a, l, h);
    i = m.range;
    var g = this.containsBlockElements(t);
    var b = g
      ? this.handleBlockNodeContent(e, t, i, r, h, c, a)
      : this.handleInlineContent(e, t, i, n, o, h, f, m.sibNode, m.lasNode, m.isSingleNode);
    var C = this.processSpecialNodes(b, t, c);
    this.positionCursorAfterPaste(C, t, n, o, h, c);
    this.alignCheck(h);
    this.listCleanUp(n, o);
    this.removeEmptyBrFromParagraph(h);
  };
  s.removeEmptyBrFromParagraph = function (e) {
    var t = e.querySelector('br.rte-temp-br');
    if (t) {
      t.remove();
    }
  };
  s.adjustRangeForEmptyEditor = function (e, t, i, n, r, o) {
    if (
      o &&
      t.startContainer === r &&
      r.textContent === '' &&
      t.startOffset === 0 &&
      t.endOffset === 0 &&
      r.childNodes[0].tagName !== 'TABLE'
    ) {
      var a = this.getImmediateBlockNode(e[e.length - 1], r);
      i.setSelectionText(n, a, a, 0, 0);
      return i.getRange(n);
    }
    return t;
  };
  s.setupRangeForPaste = function (e, t, i, n, r, o, a, l, h) {
    var c;
    var d;
    var u;
    var f = false;
    if (
      h !== i.startContainer &&
      ((!a && !(l.nodeType === Node.ELEMENT_NODE && yt.indexOf(l.tagName.toLocaleLowerCase()) !== -1)) ||
        (t.nodeName.toLowerCase() === 'table' && l && yt.indexOf(l.tagName.toLocaleLowerCase()) === -1)) &&
      t.firstChild.nodeName !== 'HR' &&
      ((c = r.GetSpliceNode(i, l)), !p(c))
    ) {
      d = p(c.previousSibling) ? c.parentNode.previousSibling : c.previousSibling;
      if (e.length === 1) {
        n.setSelectionContents(o, c);
        i = n.getRange(o);
        f = true;
      } else {
        var m = e[e.length - 1].textContent ? e[e.length - 1].textContent : '';
        u = r.GetSpliceNode(i, e[e.length - 1].parentElement);
        if (u && u.nodeName === 'LI' && u.nextSibling && u.nextSibling.nodeName === 'LI') {
          this.isAnotherLiFromEndLi = m !== u.textContent;
        }
        u = p(u) ? c : u;
        n.setSelectionText(o, c, u, 0, u.nodeType === 3 ? u.textContent.length : u.childNodes.length);
        i = n.getRange(o);
        f = false;
      }
    }
    this.removingComments(t);
    return {
      preNode: c,
      sibNode: d,
      lasNode: u,
      isSingleNode: f,
      range: i,
    };
  };
  s.containsBlockElements = function (e) {
    for (var t = e.childNodes, i = 0; i < t.length; i++) if (ge.indexOf(t[i].nodeName.toLowerCase()) >= 0) return true;
    return false;
  };
  s.handleInlineContent = function (e, t, i, n, r, o, a, l, h, c) {
    var d = document.createDocumentFragment();
    return a
      ? this.handleCursorInlineContent(e, t, i, n, r, o, d)
      : this.handleRegularInlineContent(t, i, d, o, l, h, c);
  };
  s.handleRegularInlineContent = function (e, t, i, n, r, o, a) {
    for (var l; e.firstChild; ) {
      l = e.firstChild;
      i.appendChild(e.firstChild);
    }
    if (a) {
      t.deleteContents();
      this.removeEmptyElements(n, true);
      t.insertNode(i);
    } else {
      var h = n === t.startContainer ? t.startContainer : t.startContainer.parentNode;
      var c = Array.prototype.indexOf.call(
        h.childNodes,
        M.userAgent.indexOf('Firefox') !== -1 && n === t.startContainer
          ? t.startContainer.firstChild
          : t.startContainer,
      );
      t.deleteContents();
      if (c !== -1) {
        t.setStart(h, c);
        t.setEnd(h, c);
      }
      if (!p(o) && o !== n) {
        y(o);
        this.removeEmptyElements(n, true);
      }
      p(r) ? t.insertNode(i) : r.parentNode === n ? r.appendChild(i) : r.parentNode.appendChild(i);
    }
    return l;
  };
  s.handleCursorInlineContent = function (e, t, i, n, r, o, a) {
    var l;
    var h = this.getImmediateBlockNode(i.startContainer, o);
    var c = E('span', { className: 'tempSpan' });
    for (
      this.shouldInsertInAnchor(i)
        ? this.insertInAnchor(i, c, o)
        : this.isMentionChip(e)
          ? i.startContainer.parentElement.insertAdjacentElement('afterend', c)
          : i.startOffset !== 0 &&
              i.endOffset !== 0 &&
              i.startOffset === i.endOffset &&
              !t.querySelector('a') &&
              i.endOffset === i.startContainer.textContent.length
            ? h.appendChild(c)
            : i.insertNode(c);
      t.firstChild;

    ) {
      l = t.firstChild;
      a.appendChild(t.firstChild);
    }
    return this.insertFragmentOrReplaceNode(c, a, i, n, document, l);
  };
  s.shouldInsertInAnchor = function (e) {
    var t = v(e.startContainer.parentElement, 'a');
    return e.startContainer.nodeType === 3 && !p(t) && !p(v(t, 'span'));
  };
  s.insertInAnchor = function (e, t, i) {
    var n = this.getImmediateBlockNode(e.startContainer, i);
    if (n.querySelectorAll('br').length > 0) {
      y(n.querySelector('br'));
    }
    var r = v(v(e.startContainer.parentElement, 'a'), 'span');
    r.appendChild(t);
  };
  s.isMentionChip = function (e) {
    return (
      e[0] &&
      e[0].nodeName === '#text' &&
      e[0].nodeValue.includes('\u200B') &&
      !p(e[0].parentElement) &&
      !p(e[0].parentElement.previousElementSibling) &&
      e[0].parentElement.previousElementSibling.classList.contains('e-mention-chip')
    );
  };
  s.insertFragmentOrReplaceNode = function (e, t, i, n, r, o) {
    var a = this.getClosestMatchingElement(e.parentNode, t);
    return t.childNodes.length === 1 && t.firstChild && a
      ? this.replaceWithMatchedContent(e, a, t, i, n, r, o)
      : (e.parentNode.replaceChild(t, e), o);
  };
  s.replaceWithMatchedContent = function (e, t, i, n, r, o, a) {
    var l = document.createElement('div');
    var h = i.firstChild.textContent || '';
    l.innerHTML = i.firstChild.innerHTML || '';
    var c = l.firstChild;
    var d = a;
    if (
      l.firstChild &&
      (t.replaceChild(l.firstChild, e),
      t.parentNode && l.firstChild.nodeType === Node.TEXT_NODE && this.shouldNormalizeTextNodes(l.firstChild))
    ) {
      t.parentNode.normalize();
      var u = n.startOffset + h.length;
      r.setCursorPoint(o, t.firstChild, u);
      d = null;
    }
    l.remove();
    return d;
  };
  s.shouldNormalizeTextNodes = function (e) {
    return (
      (e.previousSibling && e.previousSibling.nodeType === Node.TEXT_NODE) ||
      (e.nextSibling && e.nextSibling.nodeType === Node.TEXT_NODE)
    );
  };
  s.handleBlockNodeContent = function (e, t, i, n, r, o, a) {
    var l = this.findParentPreElement(i, r);
    return !p(t) && !p(l) && l.nodeName === 'PRE'
      ? (i.insertNode(t), t.lastChild)
      : this.processBlockContent(e, t, i, n, r, o, a);
  };
  s.findParentPreElement = function (e, t) {
    for (var i = e.startContainer; !p(i) && i.nodeName !== 'PRE' && i !== t; ) i = i.parentElement;
    return i;
  };
  s.processInlineNodesBetweenBlocks = function (e, t) {
    for (
      var i = document.createDocumentFragment(),
        n = false,
        r = null,
        o = null,
        a = E('div', { id: 'pasteContent_rte' });
      e.firstChild;

    ) {
      var l = e.firstChild;
      if (e.firstChild.nodeName === '#text' && e.firstChild.textContent.trim() === '') {
        y(e.firstChild);
        continue;
      }
      o = e.firstChild;
      var h = this.isBlockElement(e.firstChild);
      n
        ? h
          ? ((r = null), i.appendChild(e.firstChild))
          : (r || ((r = t === 'DIV' ? E('div') : E('p')), i.appendChild(r)), r.appendChild(e.firstChild))
        : h
          ? ((n = true), i.appendChild(e.firstChild))
          : (a.appendChild(e.firstChild), i.appendChild(a));
    }
    return {
      fragment: i,
      lastNode: o,
    };
  };
  s.isBlockElement = function (e) {
    if (e.nodeType !== Node.ELEMENT_NODE) return false;
    for (var t = ge, i = e.nodeName.toLowerCase(), n = 0; n < t.length; n++) if (t[n] === i) return true;
    return false;
  };
  s.processBlockContent = function (e, t, i, n, r, o, a) {
    var l = null;
    var h = this.processInlineNodesBetweenBlocks(t, o);
    l = this.insertTempNode(i, h.fragment, e, n, r);
    if (!this.contentsDeleted) {
      this.cleanupBeforeBlockInsertion(i, r, a);
    }
    var c = r.querySelector('#pasteContent_rte');
    if (!p(c)) {
      this.processFirstInlineNodeSet(c, o);
    }
    return l;
  };
  s.cleanupBeforeBlockInsertion = function (e, t, i) {
    if (
      !i &&
      e.startContainer.parentElement.textContent.length === 0 &&
      e.startContainer.nodeName === 'BR' &&
      e.startContainer.parentElement.nodeName === 'P'
    ) {
      t.removeChild(e.startContainer.parentElement);
    }
    e.deleteContents();
    this.removeEmptyElements(t);
  };
  s.processFirstInlineNodeSet = function (e, t) {
    for (var i; e.firstChild && ((i = e.firstChild), this.isInlineElement(i)); ) i = this.handleFirstBlockChild(e, t);
    y(e);
    return i;
  };
  s.handleFirstBlockChild = function (e, t) {
    var i = e.firstChild;
    if (p(e.previousElementSibling)) {
      var n = t === 'DIV' ? E('div') : E('p');
      e.parentElement.insertBefore(n, e);
    }
    e.previousElementSibling.nodeName === 'BR'
      ? e.parentElement.insertBefore(e.firstChild, e)
      : e.previousElementSibling.appendChild(e.firstChild);
    return e.firstChild;
  };
  s.isInlineElement = function (e) {
    return e.nodeName === '#text' || this.inlineNode.indexOf(e.nodeName.toLowerCase()) >= 0;
  };
  s.processSpecialNodes = function (e, t, i) {
    return e
      ? e instanceof Element && e.nodeName === 'GOOGLE-SHEETS-HTML-ORIGIN'
        ? this.processGoogleSheetsTable(e)
        : e.nodeName === 'TABLE'
          ? this.addParagraphAfterTable(e, i)
          : e
      : null;
  };
  s.processGoogleSheetsTable = function (e) {
    var t = e.querySelector('table');
    var i = t.querySelector('colgroup');
    if (i)
      for (var n = 0; n < t.rows.length; n++)
        for (var r = 0; r < t.rows[n].cells.length; r++) {
          var o = i.querySelectorAll('col')[r];
          if (i.querySelectorAll('col')[r] && i.querySelectorAll('col')[r].hasAttribute('width')) {
            var a = i.querySelectorAll('col')[r].getAttribute('width');
            t.rows[n].cells[r].style.width = a + 'px';
          }
        }
    return e;
  };
  s.addParagraphAfterTable = function (e, t) {
    var i = E(t === 'DIV' ? 'div' : 'p');
    i.appendChild(E('br'));
    e.parentElement.insertBefore(i, e.nextSibling);
    return i;
  };
  s.positionCursorAfterPaste = function (e, t, i, n, r, o) {
    if (e) {
      e.nodeName === '#text'
        ? this.placeCursorEnd(e, t, i, n, r)
        : e.nodeName === 'HR'
          ? this.handleHRElementCursor(e, i, n, o)
          : r.contains(e) && p(r.querySelector('.paste-cursor'))
            ? this.cursorPos(e, t, i, n, r)
            : this.handleListElementCursor(t, r, i, n);
    }
  };
  s.handleListElementCursor = function (e, t, i, n) {
    var r = t.querySelector('.paste-cursor');
    if (!p(r)) {
      i.setCursorPoint(n, r, 0);
      r.remove();
    } else {
      var o = t.querySelectorAll('.pasteContent_RTE');
      if (o.length > 0) {
        var a = o[o.length - 1];
        this.cursorPos(o[o.length - 1], e, i, n, t);
      }
    }
  };
  s.handleHRElementCursor = function (e, t, i, n) {
    for (var r = e.nextSibling; r && r.nodeName === '#text' && r.textContent.trim() === ''; ) r = r.nextSibling;
    var o = E(n === 'DIV' ? 'div' : 'p');
    o.appendChild(E('br'));
    var a = e.parentNode;
    if (r && (r.nodeName === 'HR' || r.nodeName === 'TABLE')) {
      a.insertBefore(o, r);
      e = o;
    } else if (a && a.nodeName === 'LI') {
      for (var l = e.nextSibling; l && l.nodeType === Node.TEXT_NODE && l.textContent.trim() === ''; )
        l = l.nextSibling;
      for (; !l && a; ) {
        if (a && (a.nodeName === 'OL' || a.nodeName === 'UL' || a.nodeName === 'LI' || a.nodeName === 'BLOCKQUOTE'))
          for (l = a.nextSibling; l && l.nodeType === Node.TEXT_NODE && l.textContent.trim() === ''; )
            l = l.nextSibling;
        a = a.parentNode;
      }
      if (p(l)) {
        e.parentNode.appendChild(o);
      }
      e = l || o;
    } else if (r) {
      var h = r.firstChild;
      if (
        r.firstChild &&
        r.firstChild.nodeName !== '#text' &&
        r.firstChild.hasAttribute('class') &&
        r.firstChild.classList.contains('rte-temp-br')
      ) {
        r.firstChild.removeAttribute('class');
      }
      e = r;
    } else {
      a.appendChild(o);
      a.insertBefore(e, o);
      e = o;
    }
    t.setSelectionText(i, e, e, 0, 0);
    return e;
  };
  s.compareParentElements = function (e, t) {
    return !e || !t || e.tagName !== t.tagName
      ? false
      : this.getFilteredAttributes(e) === this.getFilteredAttributes(t);
  };
  s.getFilteredAttributes = function (e) {
    return Array.from(e.attributes)
      .map(function (t) {
        if (t.name === 'class') {
          var i = t.value
            .split(' ')
            .filter(function (n) {
              return n !== 'pasteContent_RTE';
            })
            .join(' ');
          return i ? "class='" + i + "'" : '';
        }
        return t.name + "='" + t.value + "'";
      })
      .filter(function (t) {
        return t.length > 0;
      })
      .sort()
      .join(' ');
  };
  s.getClosestMatchingElement = function (e, t) {
    for (var i = e; i; ) {
      var n = this.findMatchingChild(t, i);
      if (n) return i;
      i = i.parentElement;
    }
    return null;
  };
  s.findMatchingChild = function (e, t) {
    for (var i = 0, n = Array.from(e.children); i < n.length; i++) {
      var r = n[i];
      if (this.compareParentElements(n[i], t)) return n[i];
      var o = this.findMatchingChild(n[i], t);
      if (o) return o;
    }
    return null;
  };
  s.listCleanUp = function (e, t) {
    var i = e.getRange(t);
    var n = i.startContainer;
    var r = i.startOffset;
    var o = i.startContainer.parentElement;
    var a = i.endContainer.parentElement;
    if (!p(i.startContainer.parentElement) && !p(i.endContainer.parentElement)) {
      var l = i.startContainer.parentElement.closest('ol, ul');
      var h = i.endContainer.parentElement.closest('ol, ul');
      if (!p(l) && !p(h)) {
        var c = this.cleanUpListItems(l);
        var d = this.cleanUpListContainer(l);
        if (c || d) {
          i.setStart(i.startContainer, i.startOffset);
          i.setEnd(i.startContainer, i.startOffset);
        }
      }
    }
  };
  s.cleanUpListItems = function (e) {
    var t = this;
    var i = false;
    var n;
    if (!p(e.closest('ol, ul'))) {
      n = e.closest('ol, ul').querySelectorAll('li');
    }
    if (p(n) || n.length === 0) return false;
    var r = null;
    n.forEach(function (a) {
      var l = a.parentElement;
      if (
        !p(a.parentElement) &&
        a.parentElement.nodeName !== 'OL' &&
        a.parentElement.nodeName !== 'UL' &&
        (p(r) && (r = a.parentElement.closest('li')), !p(r))
      ) {
        var h = a.nextSibling;
        if (!p(a.nextSibling) && a.nextSibling.nodeName !== 'LI') {
          for (
            var c = Array.prototype.indexOf.call(a.parentElement.childNodes, a.nextSibling),
              d = a.parentElement.cloneNode(false),
              u = a.parentElement.childNodes.length,
              f = c;
            f < u;
            f++
          )
            d.appendChild(a.parentElement.childNodes[c]);
          if (d.childNodes.length > 0) {
            var m = document.createElement('li');
            m.appendChild(d);
            r.insertAdjacentElement('afterend', m);
          } else d.remove();
        }
        var g = a.parentElement.closest('ol, ul');
        r.insertAdjacentElement('afterend', a);
        r = r.nextSibling;
        if (!p(g)) {
          t.removeEmptyElements(g);
        }
        i = true;
      }
    });
    var o = this.cleanUpFlattenListContainer(e);
    i = o || i;
    return i;
  };
  s.cleanUpFlattenListContainer = function (e) {
    var t = false;
    var i;
    if (!p(e.closest('ol, ul'))) {
      i = e.closest('ol, ul').querySelectorAll('li');
    }
    return p(i) || i.length === 0
      ? false
      : (i.forEach(function (n) {
          if (!p(n.firstChild) && (n.firstChild.nodeName === 'OL' || n.firstChild.nodeName === 'UL')) {
            n.style.listStyleType = 'none';
          }
          var r = Array.from(n.children).find(function (o) {
            return (
              o.tagName === 'LI' &&
              o.parentElement &&
              o.parentElement.tagName !== 'OL' &&
              o.parentElement.tagName !== 'UL'
            );
          });
          if (!p(r) && !p(n.parentNode)) {
            n.parentNode.replaceChild(r, n);
            if (p(r.textContent) || r.textContent.trim() === '') {
              r.remove();
            }
            t = true;
          }
        }),
        t);
  };
  s.cleanUpListContainer = function (e) {
    var t = false;
    var i = [];
    var n = [];
    if (!p(e)) {
      e.childNodes.forEach(function (r) {
        if (r.nodeName.toLocaleUpperCase() !== 'LI') {
          i.push(r);
        }
        if ((r.nodeName.toLocaleUpperCase() === 'LI' || e.lastChild === r) && i.length > 0) {
          n.push({ elements: i.slice() });
          i = [];
        }
      });
      n.forEach(function (r) {
        var o = r.elements;
        var a = document.createElement('li');
        o[0].parentNode.replaceChild(a, o[0]);
        o.forEach(function (l) {
          return a.appendChild(l);
        });
        if (a.textContent && a.textContent.trim() === '' && !a.querySelector('img')) {
          e.removeChild(a);
        }
        t = true;
      });
    }
    return t;
  };
  s.placeCursorEnd = function (e, t, i, n, r) {
    for (; !p(e) && e.nodeName !== '#text' && e.nodeName !== 'IMG' && e.nodeName !== 'BR' && e.nodeName !== 'HR'; ) {
      if (!p(e.lastChild) && e.lastChild.nodeName === 'P' && e.lastChild.innerHTML === '') {
        var o = E('br');
        e.lastChild.appendChild(o);
      }
      e = e.lastChild;
    }
    e = p(e) ? t : e;
    e.nodeName === 'IMG'
      ? this.imageFocus(e, i, n)
      : i.setSelectionText(n, e, e, e.textContent.length, e.textContent.length);
    this.removeEmptyElements(r);
  };
  s.getNodeCollection = function (e, t, i) {
    var n = [];
    e.startOffset === e.endOffset &&
    e.startContainer === e.endContainer &&
    e.startContainer.nodeName !== 'BR' &&
    e.startContainer.childNodes.length > 0 &&
    (e.startContainer.nodeName === 'TD' ||
      (e.startContainer.nodeType !== 3 && i.classList && i.classList.contains('pasteContent')))
      ? n.push(e.startContainer.childNodes[e.endOffset])
      : (n = t.getInsertNodeCollection(e));
    return n;
  };
  s.insertTempNode = function (e, t, i, n, r) {
    var o = t.lastChild;
    return this.shouldInsertAfterTable(e, r)
      ? (this.insertNodeAfterTable(e.startContainer, t, e.endOffset - 1), o)
      : this.shouldInsertBeforeTable(e, r)
        ? (this.insertNodeBeforeTable(e.startContainer, t, e.startOffset), o)
        : this.shouldAppendAfterTableAtCursor(e, r)
          ? (e.startContainer.appendChild(t), o)
          : ((o = this.handleStandardNodeInsertion(e, t, i, n, r)), o);
  };
  s.shouldInsertAfterTable = function (e, t) {
    var i = e.startContainer.nodeType === Node.TEXT_NODE ? e.startContainer.parentNode : e.startContainer;
    return (
      (i === t || i.closest('table')) &&
      !p(i.childNodes[e.endOffset - 1]) &&
      i.childNodes[e.endOffset - 1].nodeName === 'TABLE'
    );
  };
  s.insertNodeAfterTable = function (e, t, i) {
    p(e.childNodes[i].nextSibling) ? e.appendChild(t) : e.insertBefore(t, e.childNodes[i].nextSibling);
  };
  s.shouldInsertBeforeTable = function (e, t) {
    return (
      e.startContainer === t &&
      !p(e.startContainer.childNodes[e.startOffset]) &&
      e.startContainer.childNodes[e.startOffset].nodeName === 'TABLE'
    );
  };
  s.insertNodeBeforeTable = function (e, t, i) {
    i >= 0 && i < e.childNodes.length ? e.insertBefore(t, e.childNodes[i]) : e.appendChild(t);
  };
  s.shouldAppendAfterTableAtCursor = function (e, t) {
    return (
      e.startContainer === t &&
      !p(e.startContainer.childNodes[e.endOffset]) &&
      e.startContainer.childNodes[e.endOffset].nodeName === 'TABLE'
    );
  };
  s.handleStandardNodeInsertion = function (e, t, i, n, r) {
    var o = this.findBlockNodeForInsertion(e, i, r);
    this.processListItemsInNode(o, t, r);
    var a = t.lastChild;
    if (this.isTableCellNode(o)) {
      this.insertInTableCell(e, t, o, n);
      return t.lastChild;
    }
    if (this.isHorizontalRuleInEmptyBlock(t.lastChild, e)) {
      var l = e.startContainer.parentNode;
      e.startContainer.parentNode.replaceChild(t, e.startContainer);
      return t.lastChild;
    }
    if (this.isMediaElement(o)) {
      o = e.startContainer;
    }
    this.handleRegularInsertion(e, t, o, n, r);
    return t.lastChild;
  };
  s.findBlockNodeForInsertion = function (e, t, i) {
    var n = this.getImmediateBlockNode(t[t.length - 1], i);
    if ((p(n) || p(n.parentElement)) && e.endContainer.nodeType !== 3) {
      n = e.endContainer;
      e.setEnd(n, e.endContainer.textContent.length);
    }
    if (
      n &&
      (n.nodeName === 'BODY' ||
        (n.nodeName === 'DIV' && e.startContainer === e.endContainer && e.startContainer.nodeType === 1))
    ) {
      n = e.startContainer;
    }
    return n;
  };
  s.processListItemsInNode = function (e, t, i) {
    if (this.shouldProcessListItems(e, t, i))
      for (
        var n, r = t;
        !p(r.firstElementChild) &&
        r.firstElementChild.lastElementChild &&
        r.firstElementChild.lastElementChild.tagName === 'LI';

      ) {
        n = r.firstElementChild.lastElementChild;
        this.removeChecklistStyle(e, n);
        this.removeListItemMargins(n);
        r.firstElementChild.insertAdjacentElement('afterend', n);
      }
  };
  s.removeChecklistStyle = function (e, t) {
    if (
      e.nodeName === 'LI' &&
      e.parentElement &&
      (e.parentElement.nodeName === 'UL' || e.parentElement.nodeName === 'OL')
    ) {
      t.style.removeProperty('list-style');
      t.style.removeProperty('position');
      if (t.getAttribute('style') === '') {
        t.removeAttribute('style');
      }
    }
  };
  s.shouldProcessListItems = function (e, t, i) {
    return (
      e &&
      e.nodeName !== '#text' &&
      e.closest('LI') &&
      i.contains(e.closest('LI')) &&
      e.nodeName !== 'TD' &&
      e.nodeName !== 'TH' &&
      e.nodeName !== 'TR' &&
      t &&
      t.firstElementChild &&
      (t.firstElementChild.tagName === 'OL' || t.firstElementChild.tagName === 'UL')
    );
  };
  s.removeListItemMargins = function (e) {
    e.style.removeProperty('margin-left');
    e.style.removeProperty('margin-top');
    e.style.removeProperty('margin-bottom');
    if (e.getAttribute('style') === '') {
      e.removeAttribute('style');
    }
  };
  s.isTableCellNode = function (e) {
    if (!e) return false;
    var t = e.nodeName;
    return e.nodeName === 'TD' || e.nodeName === 'TH' || e.nodeName === 'TR' || e.nodeName === 'TABLE';
  };
  s.insertInTableCell = function (e, t, i, n) {
    var r = e.startContainer;
    if ((r.nodeName === 'TD' || r.nodeName === 'TH') && r.childNodes.length === 1 && r.firstChild.nodeName === 'BR') {
      r.replaceChild(t, r.firstChild);
      this.contentsDeleted = true;
      return;
    }
    for (; !p(r) && r.parentElement !== i; ) r = r.parentElement;
    e.deleteContents();
    var o = n.GetSpliceNode(e, r);
    o ? o.parentNode.replaceChild(t, o) : e.insertNode(t);
    this.contentsDeleted = true;
  };
  s.handleRegularInsertion = function (e, t, i, n, r) {
    var o = new Se(r);
    var a = this.getNodeCollection(e, o, t);
    var l = a[a.length - 1];
    var h;
    if (this.isEmptySpecialNode(a[a.length - 1])) {
      h = a[a.length - 1];
      if (this.handleEmptySpecialNodeInsertion(e, t, a[a.length - 1])) return;
    } else if (this.isTextOrBrInListItem(a[a.length - 1], i, r)) {
      h = a[a.length - 1];
      if (this.handleTextInListItem(e, t, a[a.length - 1], i, n, r)) return;
    } else h = this.getSplitElementForInsertion(e, n, i);
    h && h.nodeType === Node.ELEMENT_NODE && e.toString() === '' && h.querySelector('img, video, audio') !== null
      ? h.parentNode.insertBefore(t, h)
      : h.parentNode.replaceChild(t, h);
  };
  s.isEmptySpecialNode = function (e) {
    return (
      !!e &&
      (e.nodeName === 'BR' ||
        e.nodeName === 'HR' ||
        (e.nodeName === '#text' && !p(e.parentElement) && e.parentElement.nodeName === 'LI')) &&
      !p(e.parentElement) &&
      e.parentElement.textContent.trim().length === 0
    );
  };
  s.handleEmptySpecialNodeInsertion = function (e, t, i) {
    if (i.parentElement.nodeName === 'LI' && !p(i.nextSibling) && i.nextSibling.nodeName === 'BR') {
      y(i.nextSibling);
    }
    if ((i.parentElement.nodeName === 'LI' || i.parentElement.closest('li')) && i.parentElement.textContent === '') {
      this.removeListfromPaste(e);
      if (i.parentElement.childNodes.length === 1 && i.nodeName === 'BR') {
        y(i);
      }
      var n = Array.from(t.childNodes).filter(function (o) {
        return !(o.nodeName === 'LI' || o.nodeName === 'UL' || o.nodeName === 'OL');
      });
      var r = this.extractChildNodes(t);
      n.length > 0 && r.length > 1 ? this.insertBlockNodesInLI(r, e) : e.insertNode(t);
      this.contentsDeleted = true;
      return true;
    }
    return false;
  };
  s.extractChildNodes = function (e) {
    for (var t = [], i = 0; i < e.childNodes.length; i++) t.push(e.childNodes.item(i));
    return t;
  };
  s.insertBlockNodesInLI = function (e, t) {
    e = this.processInsertNodes(e);
    for (var i = document.createDocumentFragment(), n = 0, r = e; n < r.length; n++) {
      var o = r[n];
      var a = E('li');
      a.appendChild(r[n].cloneNode(true));
      i.appendChild(a);
    }
    this.unwrapInlineWrappers(i);
    t.insertNode(i);
  };
  s.processInsertNodes = function (e) {
    for (var t = [], i = [], n = 0, r = e; n < r.length; n++) {
      var o = r[n];
      var a = r[n].nodeType === Node.ELEMENT_NODE && ge.indexOf(r[n].nodeName.toLowerCase()) !== -1;
      a ? (i.length > 0 && (t.push(this.wrapInlineElementsInSpan(i)), (i = [])), t.push(r[n])) : i.push(r[n]);
    }
    if (i.length > 0) {
      t.push(this.wrapInlineElementsInSpan(i));
    }
    return t;
  };
  s.wrapInlineElementsInSpan = function (e) {
    var t = E('span');
    t.className = 'inline-wrapper';
    e.forEach(function (i) {
      return t.appendChild(i);
    });
    return t;
  };
  s.unwrapInlineWrappers = function (e) {
    var t = e.querySelectorAll('.inline-wrapper');
    t.forEach(function (i) {
      var n = i.parentNode;
      if (i.parentNode) {
        for (; i.firstChild; ) i.parentNode.insertBefore(i.firstChild, i);
        i.parentNode.removeChild(i);
      }
    });
  };
  s.removeEmptyAfterStartLI = function (e, t) {
    var i = this;
    this.clearIfCompletelyEmpty(e);
    var n = this.getRootList(e, t);
    if (n) {
      var r = n.querySelectorAll('li');
      r.forEach(function (o) {
        if (i.isRemovableEmptyListItem(o, e)) {
          y(o);
        }
      });
    }
  };
  s.clearIfCompletelyEmpty = function (e) {
    if (e.textContent.length === 0 && !e.querySelector('audio,video,img,table,br,hr')) {
      e.innerHTML = '';
    }
  };
  s.getRootList = function (e, t) {
    for (var i = v(e, 'ul,ol'); i && i.parentElement && t.contains(i.parentElement); ) {
      var n = v(i.parentElement, 'ul,ol');
      if (t.contains(n)) i = n;
      else return i;
    }
    return i || null;
  };
  s.isRemovableEmptyListItem = function (e, t) {
    return e !== t && e.textContent.trim() === '' && !e.querySelector('audio,video,img,table,br,hr');
  };
  s.isTextOrBrInListItem = function (e, t, i) {
    return (
      e &&
      (e.nodeName === '#text' || e.nodeName === 'BR' || e.nodeName === 'HR') &&
      !p(e.parentElement) &&
      (e.parentElement.nodeName === 'LI' || e.parentElement.closest('LI') || (t === i && e.parentElement === t)) &&
      e.parentElement.textContent.trim().length > 0
    );
  };
  s.handleTextInListItem = function (e, t, i, n, r, o) {
    if (i.parentElement.nodeName === 'LI' && !p(i.nextSibling) && i.nextSibling.nodeName === 'BR') {
      y(i.nextSibling);
    }
    var a = Array.from(t.childNodes).filter(function (N) {
      return !(N.nodeName === 'LI' || N.nodeName === 'UL' || N.nodeName === 'OL');
    });
    var l = i.parentElement;
    var h = null;
    var c = e.collapsed;
    var d = e.collapsed ? i.parentElement.closest('LI') : null;
    var u = null;
    var f = null;
    if (!e.collapsed) {
      var m = e.startContainer;
      var g = e.startOffset;
      h = e.cloneRange();
      u = this.findLiFromContainer(h.startContainer);
      f = this.findLiFromContainer(h.endContainer);
      this.removeListfromPaste(e);
      if (u && a.length > 0) {
        this.removeEmptyAfterStartLI(u, o);
      }
      e.setStart(e.startContainer, e.startOffset);
      e.setEnd(e.startContainer, e.startOffset);
    }
    var b = this.getImmediateBlockNode(i, t);
    if (t.firstChild.nodeName === 'HR') {
      var C = null;
      u ? (C = v(u, 'li')) : (C = v(n, 'li'));
      n = C || n;
      this.insertBlockElementInList(e, t, n, r);
    } else
      e.collapsed && d && a.length > 0
        ? this.pasteLI(t, d, i.parentElement, b, e, r)
        : !e.collapsed && u && f && a.length > 0
          ? this.nonCollapsedInsertion(t, h, r, f)
          : e.insertNode(t);
    this.contentsDeleted = true;
    return true;
  };
  s.findLiFromContainer = function (e) {
    if (e.nodeName === 'LI') return e;
    var t = e.nodeType === Node.TEXT_NODE ? e.parentNode : e;
    t = t.nodeName === 'LI' ? t : t.closest('LI');
    return t;
  };
  s.nonCollapsedInsertion = function (e, t, i, n) {
    var r = this.extractChildNodes(e);
    r = this.processInsertNodes(r);
    var o = t.startContainer;
    var a = t.endContainer;
    var l = t.endContainer.nodeName === 'UL' || t.endContainer.nodeName === 'OL';
    var h = this.getClosestLi(t.startContainer);
    var c = this.getPreviousLi(h);
    var d = this.getNextLi(h);
    var u = h.parentNode;
    if (d && h.parentNode === t.endContainer && l && n.textContent === '') {
      d = null;
    }
    t.startContainer === t.endContainer ||
    ((!d || (h.contains(t.endContainer) && !l)) && !this.isAnotherLiFromEndLi) ||
    (this.isAnotherLiFromEndLi && h.parentNode !== t.endContainer && t.endContainer.nodeName !== 'A')
      ? this.handleSingleLiInsertion(h, c, d, r, t.startContainer, t, i, h.parentNode)
      : this.handleMultiLiInsertion(h, r, t.startContainer, t.endContainer, h.parentNode);
    this.unwrapInlineWrappers(h.parentNode);
  };
  s.getClosestLi = function (e) {
    for (var t = e.nodeType === Node.TEXT_NODE ? e.parentNode : e; t && t.nodeName !== 'LI'; ) t = t.parentNode;
    return t;
  };
  s.getPreviousLi = function (e) {
    var t = e.previousSibling;
    return e.previousSibling && e.previousSibling.nodeName === 'LI' ? e.previousSibling : null;
  };
  s.getNextLi = function (e) {
    var t = e.nextSibling;
    return e.nextSibling && e.nextSibling.nodeName === 'LI' ? e.nextSibling : null;
  };
  s.appendListItems = function (e, t, i, n) {
    for (var r = null, o = i; o < n; o++) {
      var a = document.createElement('li');
      a.appendChild(t[o]);
      e.appendChild(a);
      r = a;
    }
    return r;
  };
  s.moveSiblingsToLiAndInsert = function (e, t, i, n, r) {
    for (var o = []; e; ) {
      o.push(e);
      e = e.nextSibling;
    }
    for (var a = 0; a < o.length; a++)
      if (n.contains(o[a])) {
        n.removeChild(o[a]);
      }
    for (var a = 0; a < o.length; a++) t.appendChild(o[a]);
    n.nextSibling ? r.insertBefore(i, n.nextSibling) : n.appendChild(i);
  };
  s.handleSingleLiInsertion = function (e, t, i, n, r, o, a, l) {
    var h = document.createDocumentFragment();
    this.extractNestedListsIntoNewListItem(e);
    var c = null;
    var d = null;
    var u = e.hasChildNodes() && (e.lastChild.nodeType === Node.TEXT_NODE || e.textContent === '') ? e : e.lastChild;
    if (r && r.textContent && r.textContent.length > 0) {
      c = a.GetSpliceNode(o, r);
      u = c.previousSibling !== t ? c.previousSibling : null;
      d = c.nextSibling !== i ? c.nextSibling : null;
    }
    var f = n[0];
    var m = n.length === 1;
    if (m) {
      d
        ? (this.addCursorMarker(d), this.moveAllChildren(d, n[0]), d.parentNode.removeChild(d))
        : this.addCursorMarker(n[0], true);
    }
    if (u && u !== t && u.textContent && u.textContent.length > 0) this.moveAllChildren(n[0], u);
    else if (m && e.textContent === '') e.appendChild(n[0]);
    else {
      var g = E('li');
      g.appendChild(n[0]);
      h.appendChild(g);
    }
    var b = this.appendListItems(h, n, 1, n.length);
    if (b && d) {
      this.addCursorMarker(d);
      d.nodeName === 'A' ? b.lastChild.appendChild(d) : this.mergeLastNodeContent(d, b);
    }
    var C = d && (d.nodeName === 'LI' || !d.nextSibling);
    C
      ? (l.insertBefore(h, e.nextSibling),
        d && d.parentNode && d.textContent.length === 0 && d.parentNode.removeChild(d))
      : b && this.moveSiblingsToLiAndInsert(d, b, h, e, l);
    if (c && c.parentNode && c.textContent === '') {
      c.parentNode.removeChild(c);
    }
    if (e && e.parentNode && e.textContent === '') {
      e.parentNode.removeChild(e);
    }
  };
  s.handleMultiLiInsertion = function (e, t, i, n, r) {
    var o = document.createDocumentFragment();
    this.extractNestedListsIntoNewListItem(e);
    var a = e.nextSibling;
    if (e.nextSibling) {
      this.extractNestedListsIntoNewListItem(e.nextSibling);
    }
    i = i.nodeType === Node.TEXT_NODE ? i.parentNode : i;
    if (n.textContent === '' && n.nextSibling) {
      n = n.nextSibling;
    }
    if (!e.nextSibling.contains(n) || n.nodeName === 'UL' || n.nodeName === 'OL') {
      n = e.nextSibling;
    }
    var l = t[0];
    var h = t[t.length - 1];
    n.nodeType === Node.TEXT_NODE && t.length > 1
      ? t[t.length - 1].appendChild(n)
      : t.length > 1 &&
        (this.addCursorMarker(n),
        this.moveAllChildren(n, t[t.length - 1]),
        e.nextSibling.insertBefore(t[t.length - 1], e.nextSibling.firstChild));
    if (t.length === 1) {
      this.addCursorMarker(n);
      this.moveAllChildren(n, t[0]);
      if (e.nextSibling && e.nextSibling.parentNode) {
        e.nextSibling.parentNode.removeChild(e.nextSibling);
      }
    }
    var c = null;
    if (i.textContent.length > 0 && e.textContent.length > 0) {
      this.moveAllChildren(t[0], i);
      if (i.nodeName === 'A') {
        i = i.parentNode.lastChild;
      }
    } else {
      var d = E('li');
      d.appendChild(t[0]);
      o.appendChild(d);
      if (t.length === 1) {
        c = d;
      }
    }
    if (p(c)) {
      c = this.appendListItems(o, t, 1, t.length - 1);
    }
    p(i.nextSibling)
      ? r.insertBefore(o, e.nextSibling)
      : c && this.moveSiblingsToLiAndInsert(i.nextSibling, c, o, e, r);
    if (e.textContent === '' && e.parentNode) {
      e.parentNode.removeChild(e);
    }
  };
  s.pasteLI = function (e, t, i, n, r, o) {
    var a = this.extractChildNodes(e);
    a = this.processInsertNodes(a);
    var l = this.getBlockNodeLength(n);
    var h = t.parentNode;
    var c = true;
    var d = false;
    if (t.contains(i) && i.previousSibling) {
      c = false;
    }
    if (
      t.contains(i) &&
      (p(i.nextSibling) || (i.nextSibling && ['LI', 'UL', 'OL'].indexOf(i.nextSibling.nodeName) !== -1)) &&
      r.startOffset === i.textContent.length
    ) {
      for (var u = i.previousSibling, f = r.startOffset; u && u.nodeName !== 'LI'; ) {
        f += u.textContent.length;
        u = u.previousSibling;
      }
      d = f === l;
    }
    var m = r.startOffset === 0 && c;
    var g = r.startOffset === l || d;
    m
      ? this.handlePasteAtStart(a, t, i, t.parentNode)
      : g
        ? this.handlePasteAtEnd(a, t, i, t.parentNode)
        : this.handlePasteInMiddle(a, t, i, r, t.parentNode, o);
    this.unwrapInlineWrappers(t.parentNode);
  };
  s.handlePasteAtStart = function (e, t, i, n) {
    var r = e[e.length - 1];
    this.addCursorMarker(i);
    this.moveAllChildren(i, e[e.length - 1]);
    t.insertBefore(e[e.length - 1], t.firstChild);
    var o = this.createLiFragment(e, 0, e.length - 1);
    n.insertBefore(o, t);
  };
  s.handlePasteAtEnd = function (e, t, i, n) {
    var r = e[0];
    var o = this.hasNestedListInsideLi(i);
    if (i.nodeName === 'LI' && o) {
      var a = this.collectAndRemoveFollowingNodes(t, o);
      this.moveAllChildren(e[0], i);
      a.forEach(function (c) {
        return i.appendChild(c);
      });
    } else this.moveAllChildren(e[0], i);
    var l = this.createLiFragment(e, 1, e.length);
    var h = l.lastChild;
    if (p(o) && (p(i.nextSibling) || i.nodeName === 'LI')) n.insertBefore(l, t.nextSibling);
    else if (l.lastChild) {
      var a = this.collectAndRemoveFollowingNodes(t, o || i.nextSibling);
      a.forEach(function (d) {
        return l.lastChild.appendChild(d);
      });
      this.insertFragmentAfterLi(l, t, n);
    }
  };
  s.handlePasteInMiddle = function (e, t, i, n, r, o) {
    var a = o.GetSpliceNode(n, i);
    var l = a.previousSibling;
    var h = a.nextSibling;
    var c = e[0];
    if (e.length === 1) {
      this.addCursorMarker(a.nextSibling);
      this.moveAllChildren(a.nextSibling, e[0]);
    }
    this.moveAllChildren(e[0], a.previousSibling);
    var d = this.createLiFragment(e, 1, e.length);
    var u = d.lastChild;
    if (d.lastChild) {
      this.addCursorMarker(a.nextSibling);
      a.nextSibling.nodeName === 'A'
        ? d.lastChild.lastChild.appendChild(a.nextSibling)
        : this.mergeLastNodeContent(a.nextSibling, d.lastChild);
    }
    var f = this.hasNestedListInsideLi(t);
    if ((a.nextSibling && p(a.nextSibling.nextSibling) && d.lastChild && p(f)) || a.nextSibling.nodeName === 'LI') {
      r.insertBefore(d, t.nextSibling);
      if (a.nextSibling.textContent.length === 0) {
        a.nextSibling.parentNode.removeChild(a.nextSibling);
      }
    } else if (d.lastChild) {
      var m = this.collectAndRemoveFollowingNodes(t, f || a.nextSibling);
      m.forEach(function (g) {
        return d.lastChild.appendChild(g);
      });
      this.insertFragmentAfterLi(d, t, r);
    }
    a.parentNode.removeChild(a);
  };
  s.hasNestedListInsideLi = function (e) {
    if (e.nodeName === 'LI')
      for (var t = 0, i = Array.from(e.children); t < i.length; t++) {
        var n = i[t];
        if (i[t].tagName === 'UL' || i[t].tagName === 'OL') return i[t];
      }
    var r = e.closest('LI');
    if (!r) return null;
    for (var o = 0, a = Array.from(r.children); o < a.length; o++) {
      var n = a[o];
      if (a[o].tagName === 'UL' || a[o].tagName === 'OL') return a[o];
    }
    return null;
  };
  s.getBlockNodeLength = function (e) {
    if (e.nodeName === 'LI') {
      for (var t = 0, i = 0, n = Array.from(e.childNodes); i < n.length; i++) {
        var r = n[i];
        if (n[i].nodeType === Node.ELEMENT_NODE && ['UL', 'OL'].indexOf(n[i].tagName) !== -1) break;
        t += n[i].textContent ? n[i].textContent.length : 0;
      }
      return t;
    }
    return e.textContent ? e.textContent.length : 0;
  };
  s.addCursorMarker = function (e, t) {
    var i = E('span');
    i.className = 'paste-cursor';
    t ? e.appendChild(i) : e.insertBefore(i, e.firstChild);
  };
  s.extractNestedListsIntoNewListItem = function (e) {
    for (var t = Array.from(e.childNodes), i = [], n = 0, r = t; n < r.length; n++) {
      var o = r[n];
      if (r[n].nodeType === Node.ELEMENT_NODE && (r[n].tagName === 'UL' || r[n].tagName === 'OL')) {
        i.push(r[n]);
      }
    }
    if (i.length > 0) {
      for (var a = E('li'), l = 0, h = i; l < h.length; l++) {
        var c = h[l];
        a.appendChild(h[l]);
      }
      var d = e.parentNode;
      if (e.parentNode) {
        var u = e.nextSibling;
        e.nextSibling ? e.parentNode.insertBefore(a, e.nextSibling) : e.parentNode.appendChild(a);
      }
    }
  };
  s.createLiFragment = function (e, t, i) {
    for (var n = document.createDocumentFragment(), r = t; r < i; r++) {
      var o = E('li');
      o.appendChild(e[r]);
      n.appendChild(o);
    }
    return n;
  };
  s.collectAndRemoveFollowingNodes = function (e, t) {
    for (var i = [], n = t; n; ) {
      var r = n.nextSibling;
      i.push(n);
      e.removeChild(n);
      n = n.nextSibling;
    }
    return i;
  };
  s.insertFragmentAfterLi = function (e, t, i) {
    t.nextSibling ? i.insertBefore(e, t.nextSibling) : t.appendChild(e);
  };
  s.moveAllChildren = function (e, t) {
    for (var i = t.nodeName === 'A', n = e.nodeName === 'A'; e.firstChild && !n; ) {
      var r = e.firstChild;
      if (e.firstChild.nodeName === 'UL' || e.firstChild.nodeName === 'OL') return;
      i ? (t.parentNode.insertBefore(e.firstChild, t.nextSibling), (t = t.nextSibling)) : t.appendChild(e.firstChild);
    }
    if (n) {
      t.appendChild(e);
    }
  };
  s.mergeLastNodeContent = function (e, t) {
    for (; e && e.firstChild; ) {
      var i = e.firstChild;
      if (e.firstChild) {
        var n = ge.indexOf(e.firstChild.nodeName.toLowerCase()) >= 0;
        n
          ? e.firstChild.nodeName === 'UL' || e.firstChild.nodeName === 'OL'
            ? t.appendChild(e.firstChild)
            : (this.moveAllChildren(e.firstChild, t.lastChild), e.removeChild(e.firstChild))
          : t.lastChild.appendChild(e.firstChild);
      }
    }
  };
  s.getSplitElementForInsertion = function (e, t, i) {
    var n = e.collapsed;
    var r = e.startOffset === 0;
    var o =
      e.startContainer.nodeType === Node.TEXT_NODE
        ? e.startOffset === e.startContainer.textContent.length
        : e.startOffset === e.startContainer.childNodes.length;
    return i && i.nodeName === 'P' && (r || o || !e.collapsed) && i.textContent.trim() === ''
      ? t.SplitNode(e, i, true)
      : t.GetSpliceNode(e, i);
  };
  s.cursorPos = function (e, t, i, n, r) {
    e.classList.add('lastNode');
    r.innerHTML = $r(r.innerHTML);
    e = r.querySelector('.lastNode');
    if (!p(e)) {
      this.placeCursorEnd(e, t, i, n, r);
      e.classList.remove('lastNode');
      if (e.classList.length === 0) {
        e.removeAttribute('class');
      }
    }
  };
  s.imageFocus = function (e, t, i) {
    var n = document.createTextNode('\xA0');
    if (e.parentNode && e.parentNode.nodeName === 'A') {
      var r = e.parentNode;
      var o = e.parentNode.parentNode;
      e.parentNode.parentNode.insertBefore(n, e.parentNode.nextSibling);
      e.parentNode.parentNode.insertBefore(e, n);
    } else e.parentNode.insertBefore(n, e.nextSibling);
    t.setSelectionText(i, e.nextSibling, e.nextSibling, 0, 0);
  };
  s.getImmediateBlockNode = function (e, t) {
    for (; e && ge.indexOf(e.nodeName.toLocaleLowerCase()) < 0; ) e = e.parentNode;
    return e;
  };
  s.removingComments = function (e) {
    var t = e.innerHTML;
    t = t.replace(/<!--[\s\S]*?-->/g, '');
    e.innerHTML = t;
  };
  s.findDetachEmptyElem = function (e, t) {
    if (t === void 0) {
      t = false;
    }
    var i;
    if (p(e.parentElement)) i = null;
    else {
      var n =
        e.parentElement.textContent.length > 0 &&
        e.parentElement.textContent.match(/\u00a0/g) &&
        e.parentElement.textContent.match(/\u00a0/g).length > 0;
      !n &&
      e.parentElement.textContent.trim() === '' &&
      e.parentElement.contentEditable !== 'true' &&
      p(e.parentElement.querySelector('img')) &&
      e.parentElement.nodeName !== 'TD' &&
      e.parentElement.nodeName !== 'TH' &&
      p(e.parentElement.querySelector('table td, table th'))
        ? (i =
            t && ge.indexOf(e.parentElement.tagName.toLowerCase()) !== -1
              ? e
              : this.findDetachEmptyElem(e.parentElement, t))
        : (i = t && ge.indexOf(e.tagName.toLowerCase()) !== -1 ? null : e);
    }
    return i;
  };
  s.removeEmptyElements = function (e, t, i) {
    if (t === void 0) {
      t = false;
    }
    if (i === void 0) {
      i = null;
    }
    for (
      var n = e.querySelectorAll(':empty'),
        r = Array.from(n).filter(function (u) {
          var f = u.tagName.toLowerCase();
          var m = ['td', 'tr', 'th', 'textarea', 'input', 'img', 'video', 'audio', 'br', 'hr', 'iframe'];
          return !u.closest('svg') && !u.closest('canvas') && !(m.indexOf(f) > -1);
        }),
        o = 0;
      o < r.length;
      o++
    ) {
      var a = true;
      var l = r[o];
      if (r[o].tagName === 'DIV') {
        a = r[o].style.borderBottom === 'none' || r[o].style.borderBottom === '';
      }
      if (r[o].nodeName === 'COL') {
        if (!r[o].style.width) {
          var h = r[o].parentElement;
          y(r[o].parentElement);
        }
        continue;
      }
      var c = !p(i) && r[o] === i;
      if (Zr.indexOf(r[o].tagName.toLowerCase()) < 0 && a && !c) {
        var d = this.findDetachEmptyElem(r[o], t);
        if (!p(d) && !(d.nodeType === Node.ELEMENT_NODE && d.nodeName.toUpperCase() === 'TEXTAREA')) {
          y(d);
        }
      }
    }
  };
  s.findClosestRelevantElement = function (e, t) {
    for (var i = e, n = ['table', 'li'], r = 0, o = n; r < o.length; r++) {
      var a = o[r];
      var l = v(i, o[r]);
      if (l) return l;
    }
    for (; i && i.nodeType === Node.ELEMENT_NODE; ) {
      var h = i.parentNode;
      if (i.parentNode === t) return i;
      var c =
        !p(i.parentNode.tagName) &&
        (this.isTagInList(i.parentNode.tagName, xe) || this.isTagInList(i.parentNode.tagName, eo));
      if (c) return i;
      i = i.parentNode;
    }
    return null;
  };
  s.isTagInList = function (e, t) {
    return t.indexOf(e.toLowerCase()) !== -1;
  };
  s.insertTableInList = function (e, t, i, n, r, o) {
    var a = v(i, 'ul,ol');
    var l = a ? a.querySelectorAll('li').length : 0;
    var h = r.SplitNode(e, i, true);
    var c = h.previousElementSibling;
    var d = o ? v(o, 'li') : null;
    var u = d ? d.innerHTML : null;
    var f =
      h.previousElementSibling &&
      v(h.previousElementSibling, 'ol,ul') &&
      v(h.previousElementSibling, 'ol,ul').querySelectorAll('li').length > l;
    if (f) {
      h.previousElementSibling.appendChild(t);
      e.deleteContents();
      if (h.childNodes.length > 0) {
        this.moveChildNodes(h, h.previousElementSibling);
      }
      var m = i !== o && u && u !== d.innerHTML;
      if (m) {
        this.moveChildNodes(d, h.previousElementSibling);
      }
    } else {
      e.deleteContents();
      h.insertBefore(t, h.firstChild);
      if (i !== o) {
        this.moveChildNodes(o, i);
      }
    }
    this.removeEmptyNextLI(v(t, 'li'));
    t.classList.add('ignore-table');
  };
  s.moveChildNodes = function (e, t) {
    for (; !p(e) && !p(e.firstChild); ) t.appendChild(e.firstChild);
  };
  s.alignCheck = function (e) {
    for (var t = e.querySelectorAll('span[style*="text-align"]'), i = 0; i < t.length; i++) {
      var n = t[i];
      if (t[i]) {
        var r = this.getImmediateBlockNode(t[i], null);
        if (r) {
          for (var o = '', a = 0; a < t.length; a++) {
            var l = t[a];
            if (r.contains(t[a])) {
              o += t[a].textContent;
            }
          }
          if (r.textContent.trim() === o.trim()) {
            r.style.textAlign = t[i].style.textAlign;
          }
        }
      }
    }
  };
  s.removeListfromPaste = function (e) {
    e.deleteContents();
    var t = e.startContainer;
    if (
      !p(e.startContainer) &&
      e.startContainer.nodeName === 'LI' &&
      !p(e.startContainer.parentElement) &&
      (e.startContainer.parentElement.nodeName === 'OL' || e.startContainer.parentElement.nodeName === 'UL') &&
      e.startContainer.textContent.trim() === ''
    ) {
      e.startContainer.parentElement.querySelectorAll('li').forEach(function (i) {
        if (i.textContent.trim() === '' && i !== e.startContainer) {
          i.remove();
        }
      });
    }
  };
  s.isHorizontalRuleInEmptyBlock = function (e, t) {
    if (e.nodeName !== 'HR') return false;
    var i = t.startContainer;
    return (
      t.startContainer.nodeType === Node.ELEMENT_NODE &&
      (t.startContainer.nodeName === 'P' || t.startContainer.nodeName === 'DIV') &&
      t.startContainer.childNodes.length === 1 &&
      t.startContainer.firstChild &&
      t.startContainer.firstChild.nodeName === 'BR'
    );
  };
  s.isMediaElement = function (e) {
    return e ? e.nodeName === 'VIDEO' || e.nodeName === 'AUDIO' : false;
  };
  s.insertBlockElementInList = function (e, t, i, n) {
    var r = v(i, 'ul,ol');
    var o = r ? r.querySelectorAll('li').length : 0;
    var a = n.SplitNode(e, i, true);
    var l = a.previousElementSibling;
    a.previousElementSibling && r && r.querySelectorAll('li').length > o
      ? (a.previousElementSibling.appendChild(t.firstChild),
        a.childNodes.length > 0 && this.moveChildNodes(a, a.previousElementSibling))
      : a.firstChild && a.firstChild.nodeName === 'HR'
        ? a.insertBefore(t.firstChild, a.firstChild.nextSibling)
        : a.insertBefore(t.firstChild, a.firstChild);
    if (a.textContent.trim() === '' && a.childNodes.length < 1) {
      y(a);
    }
  };
  s.inlineNode = [
    'a',
    'abbr',
    'acronym',
    'audio',
    'b',
    'bdi',
    'bdo',
    'big',
    'br',
    'button',
    'canvas',
    'cite',
    'code',
    'data',
    'datalist',
    'del',
    'dfn',
    'em',
    'embed',
    'font',
    'i',
    'iframe',
    'img',
    'input',
    'ins',
    'kbd',
    'label',
    'map',
    'mark',
    'meter',
    'noscript',
    'object',
    'output',
    'picture',
    'progress',
    'q',
    'ruby',
    's',
    'samp',
    'script',
    'select',
    'slot',
    'small',
    'span',
    'strong',
    'sub',
    'sup',
    'svg',
    'template',
    'textarea',
    'time',
    'title',
    'u',
    'tt',
    'var',
    'video',
    'wbr',
  ];
  s.contentsDeleted = false;
  s.isAnotherLiFromEndLi = false;
  return s;
})();
var Mt = (function () {
  function s(e) {
    this.directRangeElems = ['IMG', 'TABLE', 'AUDIO', 'VIDEO', 'HR'];
    this.BLOCK_TAGS = [
      'address',
      'article',
      'aside',
      'audio',
      'blockquote',
      'canvas',
      'details',
      'dd',
      'div',
      'dl',
      'dt',
      'fieldset',
      'figcaption',
      'figure',
      'footer',
      'form',
      'h1',
      'h2',
      'h3',
      'h4',
      'h5',
      'h6',
      'header',
      'hgroup',
      'hr',
      'li',
      'main',
      'nav',
      'noscript',
      'output',
      'p',
      'pre',
      'section',
      'td',
      'tfoot',
      'th',
      'video',
      'body',
    ];
    this.editableElement = e;
    this.currentDocument = e.ownerDocument;
  }
  s.prototype.getBlockNode = function () {
    var e = this;
    var t = [];
    var i = this.currentDocument.getSelection();
    var n = i.getRangeAt(0);
    var r =
      n.startContainer === this.editableElement &&
      n.startContainer === n.endContainer &&
      n.startContainer.nodeName !== '#text';
    if (r) {
      if (n.startOffset === n.endOffset) {
        var o =
          this.editableElement.childNodes[n.startOffset] &&
          this.directRangeElems.indexOf(this.editableElement.childNodes[n.startOffset].nodeName) > -1;
        if (o) {
          t.push(this.editableElement.childNodes[n.startOffset]);
        }
      } else {
        var a = n.endOffset === n.startOffset + 1;
        if (a) {
          t.push(this.editableElement.childNodes[n.startOffset]);
        }
      }
      if (t.length > 0) return t;
    } else {
      var l = n.startContainer.nodeType === Node.TEXT_NODE ? n.startContainer.parentElement : n.startContainer;
      var h = n.endContainer.nodeType === Node.TEXT_NODE ? n.endContainer.parentElement : n.endContainer;
      var c = this.isBlockNode(h) ? h : this.getParentBlockNode(h);
      var d = this.currentDocument.createTreeWalker(this.editableElement, NodeFilter.SHOW_ELEMENT, {
        acceptNode: function (u) {
          return n.intersectsNode(u)
            ? e.isBlockNode(u)
              ? NodeFilter.FILTER_ACCEPT
              : NodeFilter.FILTER_SKIP
            : NodeFilter.FILTER_REJECT;
        },
      });
      for (d.currentNode = l; d.currentNode; ) {
        this.isBlockNode(d.currentNode) ? (this.addToBlockCollection(t, d, n), d.nextNode()) : d.previousNode();
        if (d.currentNode === h || d.currentNode === c) {
          this.addToBlockCollection(t, d, n);
          break;
        }
      }
    }
    return t;
  };
  s.prototype.addToBlockCollection = function (e, t, i) {
    var n = t.currentNode;
    if (t.currentNode && e.indexOf(t.currentNode) === -1)
      if (t.currentNode.nodeName === 'LI') {
        var r = !t.currentNode.parentNode.closest('li');
        if (r) e.push(t.currentNode);
        else {
          var o = i.commonAncestorContainer;
          var a = t.currentNode.parentElement.closest('li');
          var l = t.currentNode.nodeName === 'LI' && !!a;
          var h =
            i.commonAncestorContainer.nodeType === 3
              ? i.commonAncestorContainer.parentElement
              : i.commonAncestorContainer;
          var c = !!h.closest('ul,ol');
          if (l && c) e.push(t.currentNode);
          else return;
        }
      } else e.push(t.currentNode);
  };
  s.prototype.getTextNodes = function (e) {
    for (
      var t = [],
        i = this.currentDocument.getSelection(),
        n = i.getRangeAt(0),
        r = this.currentDocument.createTreeWalker(e, NodeFilter.SHOW_TEXT, {
          acceptNode: function (a) {
            return n.intersectsNode(a) ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_REJECT;
          },
        }),
        o = r.nextNode();
      o;

    ) {
      t.push(o);
      o = r.nextNode();
    }
    return t;
  };
  s.prototype.isBlockNode = function (e) {
    return !!e && e.nodeType === Node.ELEMENT_NODE && this.BLOCK_TAGS.indexOf(e.tagName.toLowerCase()) >= 0;
  };
  s.prototype.getLastTextNode = function (e) {
    for (
      var t = this.currentDocument.createTreeWalker(e, NodeFilter.SHOW_TEXT, null), i = null, n = t.nextNode();
      n;

    ) {
      i = n;
      n = t.nextNode();
    }
    return i;
  };
  s.prototype.getFirstTextNode = function (e) {
    var t = this.currentDocument.createTreeWalker(e, NodeFilter.SHOW_TEXT, null);
    var i = t.nextNode();
    return i;
  };
  s.prototype.getParentBlockNode = function (e) {
    var t = this;
    var i = this.currentDocument.createTreeWalker(this.editableElement, NodeFilter.SHOW_ELEMENT, {
      acceptNode: function (r) {
        return t.isBlockNode(r) ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_SKIP;
      },
    });
    i.currentNode = e;
    var n = i.parentNode();
    return n;
  };
  s.prototype.getTopMostNode = function (e) {
    if (this.isBlockNode(e.parentNode)) return e;
    for (var t = e.parentNode; t; )
      if (!this.isBlockNode(t.parentNode) && e.textContent === t.textContent) t = t.parentNode;
      else return t;
    return t;
  };
  s.prototype.findParentLiElementUntilEditable = function (e) {
    for (var t = e; t && t !== this.editableElement; ) {
      if (t.nodeType === Node.ELEMENT_NODE) {
        var i = t;
        if (t.tagName === 'LI') return t;
      }
      t = t.parentNode;
    }
    return null;
  };
  s.prototype.getSelectedLiElements = function () {
    var e = this.currentDocument.getSelection();
    var t = e.getRangeAt(0);
    var i = function (l, h) {
      var c = l.cloneRange();
      c.selectNodeContents(h);
      return l.compareBoundaryPoints(Range.END_TO_START, c) < 0 && l.compareBoundaryPoints(Range.START_TO_END, c) > 0;
    };
    var n = this.currentDocument.createTreeWalker(t.commonAncestorContainer, NodeFilter.SHOW_ALL, {
      acceptNode: function (l) {
        return i(t, l) ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_REJECT;
      },
    });
    var r = new Set();
    var o = this.findParentLiElementUntilEditable(n.currentNode);
    for (o && r.add(o); n.nextNode(); ) {
      var a = this.findParentLiElementUntilEditable(n.currentNode);
      if (a) {
        r.add(a);
      }
    }
    return Array.from(r);
  };
  s.prototype.getLiElementsInRange = function () {
    for (
      var e = [],
        t = this.getSelectedLiElements(),
        i = function (o) {
          var a = n.findParentLiElementUntilEditable(t[o]);
          if (a && a.querySelectorAll('li').length > 0) {
            var l = n.currentDocument.getSelection();
            var h = l.getRangeAt(0);
            var c = a.querySelectorAll('li');
            c.forEach(function (d) {
              if (h.intersectsNode(d) && e.indexOf(d) === -1) {
                e.push(d);
              }
            });
          }
          if (!p(a) && e.indexOf(a) === -1) {
            e.push(a);
          }
        },
        n = this,
        r = 0;
      r < t.length;
      r++
    )
      i(r);
    return e;
  };
  return s;
})();
var ts = (function () {
  function s(e) {
    this.listTabIndentation = false;
    this.parent = e;
    this.domNode = this.parent.domNode;
    this.addEventListener();
  }
  s.prototype.addEventListener = function () {
    this.parent.observer.on(zt, this.applyListsHandler, this);
    this.parent.observer.on(tt, this.onKeyUp, this);
    this.parent.observer.on(ae, this.keyDownHandler, this);
    this.parent.observer.on(yi, this.spaceKeyAction, this);
    this.parent.observer.on(J, this.destroy, this);
  };
  s.prototype.removeEventListener = function () {
    this.parent.observer.off(zt, this.applyListsHandler);
    this.parent.observer.off(tt, this.onKeyUp);
    this.parent.observer.off(ae, this.keyDownHandler);
    this.parent.observer.off(yi, this.spaceKeyAction);
    this.parent.observer.off(J, this.destroy);
  };
  s.prototype.testList = function (e) {
    var t = [/^[\d]+[.]+$/, /^(?=[MDCLXVI])M*(C[MD]|D?C{0,3})(X[CL]|L?X{0,3})(I[XV]|V?I{0,3})[.]$/gi, /^[a-zA-Z][.]+$/];
    var i = p(e) ? null : e.innerText.trim().split('.')[0] + '.';
    if (!p(i)) {
      for (var n = 0; n < t.length; n++) if (t[n].test(i)) return true;
    }
    return false;
  };
  s.prototype.testCurrentList = function (e) {
    var t = [/^[1]+[.]+$/, /^[i]+[.]+$/, /^[a]+[.]+$/];
    if (!p(e.startContainer.textContent.slice(0, e.startOffset))) {
      for (
        var i = e.startContainer.textContent
            .replace(/\u200B/g, '')
            .slice(0, e.startOffset)
            .trim(),
          n = 0;
        n < t.length;
        n++
      )
        if (t[n].test(i) && i.length === 2) return true;
    }
    return false;
  };
  s.prototype.createAutoList = function (e, t) {
    var i = {
      BR: {
        BR: true,
        P: true,
        DIV: true,
      },
      P: {
        BR: false,
        P: true,
        DIV: true,
      },
      DIV: {
        BR: false,
        P: true,
        DIV: true,
      },
    };
    return i[e] && i[e][t] !== void 0 ? i[e][t] : false;
  };
  s.prototype.isInsideSameListType = function (e, t) {
    if (!e) return false;
    var i = e.closest('li');
    if (!i) return false;
    var n = i.closest('ul, ol');
    return n ? (n.tagName === 'OL' && t) || (n.tagName === 'UL' && !t) : false;
  };
  s.prototype.spaceList = function (e) {
    var t = this.parent.nodeSelection.getRange(this.parent.currentDocument);
    this.saveSelection = this.parent.nodeSelection.save(t, this.parent.currentDocument);
    var i = this.parent.domNode.getSelectedNode(t.startContainer, t.startOffset);
    this.parent.domNode.getSelectedNode(t.endContainer, t.endOffset);
    var n = i.previousElementSibling;
    var r = i.nextElementSibling;
    var o = p(i.previousElementSibling) ? null : i.previousElementSibling.innerText.trim().substring(0, 1);
    var a = p(i.nextElementSibling) ? null : i.nextElementSibling.innerText.trim().substring(0, 1);
    var l = this.testCurrentList(t);
    var h = this.testList(i.previousElementSibling);
    var c = this.testList(i.nextElementSibling);
    var d = this.isInsideSameListType(i, l);
    var u = t.startContainer.previousElementSibling && t.startContainer.previousElementSibling.tagName === 'BR';
    if (!d && !h && !c && o !== '*' && a !== '*' && (this.createAutoList(e.enterKey, e.shiftEnterKey) || !u)) {
      var f = E('br');
      l
        ? ((t.startContainer.textContent = t.startContainer.textContent.slice(
            t.startOffset,
            t.startContainer.textContent.length,
          )),
          t.startContainer.nodeName === '#text' &&
            t.startContainer.textContent.length === 0 &&
            this.parent.domNode.insertAfter(f, t.startContainer),
          this.applyListsHandler({
            subCommand: 'OL',
            callBack: e.callBack,
            enterAction: e.enterKey,
          }),
          e.event.preventDefault())
        : (t.startContainer.textContent
            .replace(/\u200B/g, '')
            .slice(0, t.startOffset)
            .trim() === '*' ||
            t.startContainer.textContent
              .replace(/\u200B/g, '')
              .slice(0, t.startOffset)
              .trim() === '-') &&
          ((t.startContainer.textContent = t.startContainer.textContent.slice(
            t.startOffset,
            t.startContainer.textContent.length,
          )),
          t.startContainer.nodeName === '#text' &&
            t.startContainer.textContent.length === 0 &&
            this.parent.domNode.insertAfter(f, t.startContainer),
          this.applyListsHandler({
            subCommand: 'UL',
            callBack: e.callBack,
            enterAction: e.enterKey,
          }),
          e.event.preventDefault());
    }
  };
  s.prototype.isCtrlEnterInChecklist = function (e) {
    var t = false;
    if (e.event && (e.event.ctrlKey || e.event.metaKey) && e.event.key === 'Enter')
      for (var i = new Mt(this.parent.editableElement), n = i.getLiElementsInRange(), r = 0; r < n.length; r++)
        if (
          n[r].nodeName === 'LI' &&
          n[r].parentElement.nodeName === 'UL' &&
          !n[r].classList.contains('e-rte-checklist-hidden') &&
          n[r].parentElement.classList.contains('e-rte-checklist')
        ) {
          t = true;
          n[r].classList.contains('e-rte-checklist-checked')
            ? n[r].classList.remove('e-rte-checklist-checked')
            : n[r].classList.add('e-rte-checklist-checked');
        }
    if (t) {
      if (e.callBack) {
        e.callBack({
          requestType: this.currentAction,
          editorMode: 'HTML',
          range: this.parent.nodeSelection.getRange(this.parent.currentDocument),
          elements: this.parent.domNode.blockNodes(),
          event: e.event,
        });
      }
      t = false;
    }
  };
  s.prototype.enterList = function (e) {
    var t = this.parent.nodeSelection.getRange(this.parent.currentDocument);
    var i = t.startContainer.nodeName === 'LI' ? t.startContainer : t.startContainer.parentElement.closest('LI');
    var n = t.endContainer.nodeName === 'LI' ? t.endContainer : t.endContainer.parentElement.closest('LI');
    this.isCtrlEnterInChecklist(e);
    var r = false;
    if (!p(i)) {
      var o = i.querySelectorAll('.e-video-clickelem');
      var a = o.length > 0 && o[0].childNodes[0].nodeName === 'IFRAME';
      r =
        i.querySelectorAll('IMG').length > 0 ||
        i.querySelectorAll('AUDIO').length > 0 ||
        i.querySelectorAll('VIDEO').length > 0 ||
        a;
    }
    var l;
    var h;
    if (i) {
      l = i.parentElement;
      if (l) {
        h = l.parentElement;
      }
    }
    var c = p(i) ? null : i.querySelector('TABLE');
    if (!p(i) && !p(n) && i === n && i.tagName === 'LI' && i.textContent.trim() === '' && !r && p(c)) {
      if (i.innerHTML.indexOf('&nbsp;') >= 0) return;
      if (i.textContent.charCodeAt(0) === 65279) {
        i.textContent = '';
      }
      if (p(h.closest('UL')) && p(h.closest('OL'))) {
        if (!p(i.nextElementSibling)) {
          var d = this.parent.domNode.blockParentNode(i);
          this.parent.nodeCutter.GetSpliceNode(t, d);
        }
        var u = void 0;
        e.enterAction === 'DIV'
          ? ((u = E('div')), (u.innerHTML = '<br>'))
          : e.enterAction === 'P'
            ? ((u = E('p')), (u.innerHTML = '<br>'))
            : (u = E('br'));
        var f = this.domNode.getImmediateBlockNode(t.startContainer);
        var m = this.applyFormattingFromRange(u, t, f, e.enterAction);
        var g = m.formattedElement;
        var b = m.cursorTarget;
        u = m.formattedElement;
        if (!p(h) && h.nodeName === 'BLOCKQUOTE') {
          this.parent.observer.notify('blockquote_list_handled', {});
        }
        this.parent.domNode.insertAfter(u, l);
        e.event.preventDefault();
        this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, m.cursorTarget, 0);
        l.textContent === '' && l.querySelectorAll('audio,video,table').length === 0 ? y(l) : y(i);
      }
      if (
        !p(h) &&
        (!p(h.closest('UL')) || !p(h.closest('OL'))) &&
        h.nodeName === 'LI' &&
        h.style.listStyleType === 'none' &&
        h.textContent === '' &&
        i.textContent === '' &&
        i === l.firstElementChild &&
        p(i.nextSibling)
      ) {
        y(l);
        h.style.removeProperty('list-style-type');
        e.event.preventDefault();
      }
    }
    var C = t.startContainer.nodeName === '#text' ? t.startContainer.parentElement : t.startContainer;
    var N = this.isNodeInListNotTable(C);
    if (
      !p(i) &&
      !p(n) &&
      i === n &&
      i.tagName === 'LI' &&
      i.textContent.length !== 0 &&
      N &&
      e.event &&
      !e.event.shiftKey &&
      !(e.event.ctrlKey || e.event.metaKey)
    ) {
      this.splitListAtCursor(t, i, l);
      e.event.preventDefault();
      return;
    }
    this.handleNestedEnterKeyForLists(e, h, i, l);
  };
  s.prototype.splitListAtCursor = function (e, t, i) {
    var n = this.parent.editableElement.ownerDocument.createRange();
    var r = ['AREA', 'BASE', 'BR', 'COL', 'EMBED', 'HR', 'IMG', 'INPUT', 'LINK', 'META', 'SOURCE', 'TRACK', 'WBR'];
    var o = e.startContainer;
    var a = e.startOffset;
    var l;
    if (e.startContainer === e.endContainer && e.startOffset === e.endOffset) {
      n.setStart(e.startContainer, e.startOffset);
      n.setEndAfter(t);
      this.parent.nodeSelection.setRange(this.parent.currentDocument, n);
      var h = this.parent.nodeSelection.getRange(this.parent.editableElement.ownerDocument);
      l = h.cloneContents();
      this.cleanupListElements(l, r);
      n.deleteContents();
    } else {
      e.deleteContents();
      n.setStart(e.startContainer, e.startOffset);
      n.setEndAfter(t);
      this.parent.nodeSelection.setRange(this.parent.currentDocument, n);
      var h = this.parent.nodeSelection.getRange(this.parent.editableElement.ownerDocument);
      l = h.cloneContents();
      this.cleanupListElements(l, r);
      n.deleteContents();
    }
    if (t.querySelectorAll('*:empty').length > 0)
      for (var c = t.querySelectorAll('*:empty'), d = 0; d < c.length; d++)
        if (r.indexOf(c[d].nodeName) === -1) {
          y(c[d]);
        }
    if (t.innerHTML === '') {
      t.innerHTML = '<br>';
    }
    var u = this.parent.nodeSelection.findFirstContentNode(l);
    t.nextElementSibling ? i.insertBefore(l, t.nextElementSibling) : i.appendChild(l);
    if (u.node.nodeName === 'BR') {
      var f = this.parent.editableElement.ownerDocument.createRange();
      f.setStartBefore(u.node);
      f.setEndBefore(u.node);
      this.parent.nodeSelection.setRange(this.parent.currentDocument, f);
    } else this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, u.node, 0);
  };
  s.prototype.cleanupListElements = function (e, t) {
    for (var i = e.firstElementChild, n = i.querySelectorAll('*:empty'), r = 0; r < n.length - 1; r++)
      if (t.indexOf(n[r].nodeName) === -1) {
        y(n[r]);
      }
    this.ensureListItemContent(e);
  };
  s.prototype.ensureListItemContent = function (e) {
    for (var t = e.querySelectorAll('li'), i = 0; i < t.length; i++) {
      var n = t[i];
      var r =
        t[i].childNodes.length > 0 &&
        ((t[i].firstChild && (t[i].firstChild.nodeName === 'UL' || t[i].firstChild.nodeName === 'OL')) ||
          (t[i].firstElementChild &&
            (t[i].firstElementChild.nodeName === 'UL' || t[i].firstElementChild.nodeName === 'OL')));
      if (r || t[i].innerHTML === '') {
        var o = document.createElement('br');
        t[i].firstChild ? t[i].insertBefore(o, t[i].firstChild) : t[i].appendChild(o);
      } else {
        var a = t[i].querySelector('*:empty');
        if (a) {
          a.appendChild(document.createElement('br'));
        }
      }
    }
  };
  s.prototype.isNodeInListNotTable = function (e) {
    for (var t = e; t && t !== this.parent.editableElement; ) {
      if (t.nodeName === 'TABLE') return false;
      if (t.nodeName === 'UL' || t.nodeName === 'OL') return true;
      t = t.parentNode;
    }
    return false;
  };
  s.prototype.applyFormattingFromRange = function (e, t, i, n) {
    var r = e;
    var o = [];
    if (i) {
      for (
        var a = t.startContainer,
          l = ['div', 'p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'li', 'ul', 'ol', 'table', 'tr', 'td', 'th'];
        a && a !== i;

      ) {
        var h = a.nodeName.toLowerCase();
        if (l.indexOf(h) === -1 && a.nodeType === Node.ELEMENT_NODE) {
          o.push({
            tag: h,
            element: a,
          });
        }
        a = a.parentNode;
      }
      if (o.length > 0) {
        e = n === 'BR' ? E('DIV') : e;
        e.innerHTML = '';
        var c = e;
        o.reverse().forEach(function (u) {
          var f = E(u.tag);
          Array.from(u.element.attributes).forEach(function (m) {
            f.setAttribute(m.name, m.value);
          });
          c.appendChild(f);
          c = f;
        });
        var d = E('br');
        c.appendChild(d);
        r = c;
      }
    }
    return {
      formattedElement: n === 'BR' && o.length > 0 ? e.firstChild : e,
      cursorTarget: r,
    };
  };
  s.prototype.handleNestedEnterKeyForLists = function (e, t, i, n) {
    var r = false;
    if (!p(i) && i.querySelectorAll('audio,video,table,img,HR').length > 0) {
      r = true;
    }
    if (
      !p(t) &&
      (!p(t.closest('UL')) || !p(t.closest('OL')) || n.nodeName === 'UL' || n.nodeName === 'OL') &&
      (t.nodeName === 'LI' || i.nodeName === 'LI') &&
      (t.style.listStyleType === 'none' || t.style.listStyleType === '') &&
      t.textContent !== '' &&
      !p(i.lastElementChild) &&
      i.lastElementChild.textContent !== '' &&
      i.firstElementChild &&
      i.firstElementChild.textContent === '' &&
      !r &&
      (i === n.firstElementChild || i.nodeName === 'LI')
    ) {
      var o = this.parent.nodeSelection.getRange(this.parent.currentDocument);
      this.saveSelection = this.parent.nodeSelection.save(o, this.parent.currentDocument);
      this.domNode.setMarker(this.saveSelection);
      e.event.preventDefault();
      var a = [];
      i === n.firstElementChild ? a.push(n.firstElementChild) : i.nodeName === 'LI' && a.push(i);
      this.revertList(a, e);
      this.revertClean();
      this.saveSelection = this.domNode.saveMarker(this.saveSelection);
      this.saveSelection.restore();
    }
  };
  s.prototype.backspaceList = function (e) {
    var t = this.parent.nodeSelection.getRange(this.parent.currentDocument);
    var i = this.parent.domNode.getSelectedNode(t.startContainer, t.startOffset);
    var n = this.parent.domNode.getSelectedNode(t.endContainer, t.endOffset);
    i = i.nodeName === 'BR' ? i.parentElement : i;
    n = n.nodeName === 'BR' ? n.parentElement : n;
    if (!p(i) && i.closest('li')) {
      var r = this.getListCursorInfo(t);
      var o = i.previousElementSibling === null;
      var a = ['StartParent'];
      var l = ['SingleFull', 'MultipleFull'];
      var h = this.parent.domNode.blockNodes();
      var c = this.isAllListNodesSelected(i.closest('li').parentElement);
      var d =
        r.position === 'StartNested' &&
        i &&
        i.parentElement &&
        i.parentElement.closest('li') &&
        i.parentElement.closest('li').getAttribute('style') &&
        i.parentElement.closest('li').getAttribute('style').indexOf('list-style-type: none;') !== -1;
      if (o && (a.indexOf(r.position) > -1 || d)) {
        e.event.preventDefault();
        var u = this.parent.nodeSelection.save(t, this.parent.currentDocument);
        this.domNode.setMarker(u);
        for (var f = 0; f < h.length; f++)
          if (h.length > 0 && h[f].tagName !== 'LI' && h[f].parentNode.tagName === 'LI') {
            h[f] = h[f].parentNode;
          }
        this.revertList([h[0]], e);
        this.revertClean();
        u = this.domNode.saveMarker(u);
        u.restore();
        return;
      } else if (l.indexOf(r.selectionState) > -1 && c) {
        e.event.preventDefault();
        h[0].innerHTML = '';
        t.deleteContents();
        if (h.length > 1) {
          for (var f = 0; f < h.length; f++)
            if (f !== 0) {
              var m = h[f];
              y(h[f]);
            }
        }
        this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, h[0], 0);
        return;
      }
    }
    if (
      i === n &&
      !p(v(i, 'li')) &&
      ((i.textContent.trim() === '' && i.textContent.charCodeAt(0) === 65279) ||
        (i.textContent.length === 1 && i.textContent.charCodeAt(0) === 8203))
    ) {
      i.textContent = '';
    }
    if (i === n && i.tagName === 'LI' && i.textContent.length === 0 && p(i.previousElementSibling)) {
      i.removeAttribute('style');
    }
    if (i === n && i.textContent === '' && !this.hasMediaElement(i)) {
      if (i.parentElement.tagName === 'LI' && n.parentElement.tagName === 'LI') y(i);
      else if (i.closest('ul') || i.closest('ol')) {
        var g = p(i.closest('ul')) ? i.closest('ol') : i.closest('ul');
        if (
          g.firstElementChild === i &&
          !p(g.children[1]) &&
          (g.children[1].tagName === 'OL' || g.children[1].tagName === 'UL')
        )
          if (g.tagName === g.children[1].tagName) {
            for (; g.children[1].lastChild; ) this.parent.domNode.insertAfter(g.children[1].lastChild, g.children[1]);
            y(g.children[1]);
          } else g.parentElement.insertBefore(g.children[1], g);
      }
    } else if (
      !p(i.firstChild) &&
      i.firstChild.nodeName === 'BR' &&
      !p(i.childNodes[1]) &&
      (i.childNodes[1].nodeName === 'UL' || i.childNodes[1].nodeName === 'OL')
    ) {
      var g = p(i.closest('ul')) ? i.closest('ol') : i.closest('ul');
      if (g.tagName === i.childNodes[1].nodeName) {
        for (; i.childNodes[1].lastChild; ) this.parent.domNode.insertAfter(i.children[1].lastChild, i);
        y(i.childNodes[1]);
      } else g.parentElement.insertBefore(i.children[1], g);
    }
    if (i === n && i.tagName === 'LI' && this.isAtListStart(i, t) && !p(i.closest('ul, ol'))) {
      var b = i.closest('ul, ol');
      var C = b.parentElement;
      var N = i.previousElementSibling;
      var w = i.querySelector('ol, ul');
      if (
        ((!p(b.parentElement) && b.parentElement.tagName === 'LI' && !p(b.previousSibling)) ||
          (!p(i.previousElementSibling) && i.previousElementSibling.nodeName === 'LI')) &&
        !p(w) &&
        (p(i.previousElementSibling) || !p(i.previousElementSibling))
      ) {
        e.event.preventDefault();
        this.handleNestedListRearrangement(i, b, b.parentElement, i.previousElementSibling, w);
      }
    }
    this.removeList(t, e);
    this.firstListBackSpace(t, e);
  };
  s.prototype.hasMediaElement = function (e) {
    if (!e) return false;
    var t = e.querySelectorAll('.e-video-clickelem');
    var i = t.length > 0 && t[0].childNodes[0].nodeName === 'IFRAME';
    return !!(
      e.querySelectorAll('audio,video,table,img,hr').length > 0 ||
      ['AUDIO', 'VIDEO', 'TABLE', 'IMG', 'HR'].indexOf(e.tagName) !== -1 ||
      i
    );
  };
  s.prototype.handleNestedListRearrangement = function (e, t, i, n, r) {
    for (
      var o = this.parent.nodeSelection.findLastTextPosition(p(n) ? t.previousSibling : n),
        a = Array.from(e.childNodes),
        l = 0;
      l < a.length;
      l++
    ) {
      var h = a[l];
      if (a[l] === r && r)
        for (; r.firstChild; ) {
          t.insertBefore(r.firstChild, e);
          var c = e.querySelector('OL:empty,UL:empty');
          if (c) {
            e.remove();
          }
        }
      else p(n) ? i.insertBefore(a[l], t) : o.node.parentElement.closest('li').appendChild(a[l]);
    }
    this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, o.node, o.offset);
  };
  s.prototype.findPreviousElementForCursor = function (e) {
    var t = null;
    e.previousElementSibling
      ? (t = e.previousElementSibling)
      : e.parentElement && e.parentElement !== this.parent.editableElement && (t = e.parentElement);
    return t;
  };
  s.prototype.handleCursorPositioningAfterListRemoval = function (e) {
    if (e && this.parent.userAgentData.isSafari()) {
      var t = this.parent.nodeSelection.findLastTextPosition(e);
      t
        ? this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, t.node, t.offset)
        : this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, e, e.childNodes.length);
    }
  };
  s.prototype.removeList = function (e, t) {
    var i = this;
    var n = this.parent.domNode.getSelectedNode(e.startContainer, e.startOffset);
    var r =
      !p(e.endContainer.parentElement.closest('li')) &&
      e.endContainer.parentElement.closest('li').childElementCount > 1 &&
      e.endContainer.nodeName === '#text'
        ? e.endContainer
        : this.parent.domNode.getSelectedNode(e.endContainer, e.endOffset);
    var o =
      e.startContainer.nodeName === '#text'
        ? e.startContainer.parentElement.closest('li')
        : e.startContainer.closest('li');
    var a =
      e.endContainer.nodeName === '#text' ? e.endContainer.parentElement.closest('li') : e.endContainer.closest('li');
    var l = '';
    if (!p(o) && !p(o.firstChild)) {
      o.childNodes.forEach(function (b) {
        l = l + b.textContent;
      });
    }
    n = n.nodeName === 'BR' ? n.parentElement : n;
    r = r.nodeName === 'BR' ? r.parentElement : r;
    n = n.nodeName !== 'LI' && !p(n.closest('LI')) ? n.closest('LI') : n;
    r = r.nodeName !== 'LI' && r.nodeName !== '#text' && !p(r.closest('LI')) ? r.closest('LI') : r;
    var h = !p(a) && p(a.nextElementSibling);
    if (
      ((e.commonAncestorContainer.nodeName === 'OL' ||
        e.commonAncestorContainer.nodeName === 'UL' ||
        e.commonAncestorContainer.nodeName === 'LI') &&
        p(r.nextElementSibling) &&
        r.textContent.length === e.endOffset &&
        h &&
        p(n.previousElementSibling) &&
        e.startOffset === 0) ||
      (M.userAgent.indexOf('Firefox') !== -1 &&
        e.startContainer === e.endContainer &&
        e.startContainer === this.parent.editableElement &&
        e.startOffset === 0 &&
        e.endOffset === 1)
    ) {
      var c;
      M.userAgent.indexOf('Firefox') !== -1
        ? ((c = this.findPreviousElementForCursor(e.commonAncestorContainer.childNodes[0])),
          y(e.commonAncestorContainer.childNodes[0]))
        : e.commonAncestorContainer.nodeName === 'LI'
          ? ((c = this.findPreviousElementForCursor(e.commonAncestorContainer.parentElement)),
            y(e.commonAncestorContainer.parentElement))
          : ((c = this.findPreviousElementForCursor(e.commonAncestorContainer)), y(e.commonAncestorContainer));
      t.event.preventDefault();
      this.handleCursorPositioningAfterListRemoval(c);
      o =
        e.startContainer.nodeName === '#text'
          ? e.startContainer.parentElement.closest('li')
          : e.startContainer.closest('li');
    }
    var d;
    if (
      (!p(a) && e.commonAncestorContainer === this.parent.editableElement) ||
      (!p(o) &&
        (!e.collapsed || (o.textContent.trim() === '' && p(o.previousElementSibling) && p(o.nextElementSibling))) &&
        o.textContent === l)
    ) {
      e.deleteContents();
      for (
        var u = this.parent.editableElement.querySelectorAll('li'),
          f = function (b) {
            if (!p(u[b].childNodes)) {
              u[b].childNodes.forEach(function (C) {
                if (C.nodeName === 'A' && C.textContent === '') {
                  u[b].removeChild(C);
                }
              });
            }
            if (
              (!u[b].firstChild || (u[b].textContent.trim() === '' && !m.hasMediaElement(u[b]))) &&
              (u[b] === n || u[b] === r || u[b] === a)
            ) {
              d = m.findPreviousElementForCursor(u[b]);
              u[b].parentNode.removeChild(u[b]);
            }
          },
          m = this,
          g = 0;
        g < u.length;
        g++
      )
        f(g);
      this.parent.editableElement.querySelectorAll('ol').forEach(function (b) {
        if (!b.firstChild || (b.textContent.trim() === '' && !i.hasMediaElement(b))) {
          d = i.findPreviousElementForCursor(b);
          b.parentNode.removeChild(b);
        }
      });
      this.parent.editableElement.querySelectorAll('ul').forEach(function (b) {
        if (!b.firstChild || (b.textContent.trim() === '' && !i.hasMediaElement(b))) {
          d = i.findPreviousElementForCursor(b);
          b.parentNode.removeChild(b);
        }
      });
      t.event.preventDefault();
      this.handleCursorPositioningAfterListRemoval(d);
    }
  };
  s.prototype.onKeyUp = function (e) {
    if (!p(this.commonLIParent) && !p(this.commonLIParent.querySelector('.removeList'))) {
      for (var t = this.commonLIParent.querySelector('.removeList'); !p(t.firstChild); )
        this.parent.domNode.insertAfter(t.firstChild, t);
      y(t);
    }
    if (e.event.keyCode === 13)
      for (var i = this.parent.editableElement.querySelectorAll('UL, OL'), n = 0; n < i.length; n++)
        if (
          !p(i[n]) &&
          !p(i[n].parentElement) &&
          !p(i[n].previousElementSibling) &&
          (i[n].parentElement.nodeName === 'UL' || i[n].parentElement.nodeName === 'OL')
        ) {
          i[n].previousElementSibling.appendChild(i[n]);
        }
  };
  s.prototype.firstListBackSpace = function (e, t) {
    var i = this.parent.domNode.getSelectedNode(e.startContainer, e.startOffset);
    var n = i.closest('LI');
    if (
      !(!p(n) && !this.isAtListStart(n, e)) &&
      (p(i.closest('OL'))
        ? p(i.closest('UL')) || (this.commonLIParent = i.closest('UL'))
        : (this.commonLIParent = i.closest('OL')),
      !p(n) &&
        e.startOffset === 0 &&
        e.endOffset === 0 &&
        p(i.previousSibling) &&
        !p(this.commonLIParent) &&
        p(this.commonLIParent.previousSibling) &&
        p(this.commonLIParent.parentElement.closest('OL')) &&
        p(this.commonLIParent.parentElement.closest('UL')) &&
        p(this.commonLIParent.parentElement.closest('LI')))
    ) {
      var r = E('P');
      r.innerHTML = '&#8203;';
      i.classList.add('removeList');
      this.commonLIParent.parentElement.insertBefore(r, this.commonLIParent);
    }
  };
  s.prototype.isAtListStart = function (e, t) {
    if (e.nodeName !== 'LI') return false;
    var i = e;
    var n = this.getFirstTextNode(e);
    return n === t.startContainer && t.startOffset === 0;
  };
  s.prototype.getFirstTextNode = function (e) {
    if (e.nodeType === Node.TEXT_NODE) return e;
    for (var t = 0; t < e.childNodes.length; t++) {
      var i = this.getFirstTextNode(e.childNodes[t]);
      if (i) return i;
    }
    return null;
  };
  s.prototype.keyDownHandler = function (e) {
    if (e.event.which === 13) {
      this.enterList(e);
    }
    if (e.event.which === 32) {
      this.spaceList(e);
    }
    if (e.event.which === 8) {
      this.backspaceList(e);
    }
    if (e.event.which === 46 && e.event.action === 'delete') {
      var t = this.parent.nodeSelection.getRange(this.parent.currentDocument);
      var i = t.commonAncestorContainer;
      var n = t.startContainer;
      var r = t.endContainer;
      var o = t.startContainer.nodeType === 3 ? this.domNode.blockParentNode(t.startContainer) : t.startContainer;
      var a = t.endContainer.nodeType === 3 ? this.domNode.blockParentNode(t.endContainer) : t.endContainer;
      if (
        (t.commonAncestorContainer.nodeName === 'UL' || t.commonAncestorContainer.nodeName === 'OL') &&
        o !== a &&
        (!p(v(o, 'ul')) || !p(v(o, 'ol'))) &&
        (!p(v(a, 'ul')) || !p(v(a, 'ol'))) &&
        t.commonAncestorContainer.lastElementChild === v(a, 'li') &&
        t.commonAncestorContainer.lastChild !== a &&
        !t.collapsed &&
        this.areAllListItemsSelected(t.commonAncestorContainer, t)
      ) {
        y(t.commonAncestorContainer);
      }
      this.removeList(t, e);
    }
    if (e.event.which === 9) {
      var t = this.parent.nodeSelection.getRange(this.parent.currentDocument);
      if (!(e.event.action && e.event.action === 'indent')) {
        this.saveSelection = this.parent.nodeSelection.save(t, this.parent.currentDocument);
      }
      if (e.enableTabKey) {
        this.handleListIndentation();
      }
      var l = void 0;
      var o = this.parent.domNode.getSelectedNode(t.startContainer, t.startOffset);
      var a = this.parent.domNode.getSelectedNode(t.endContainer, t.endOffset);
      if (
        o === a &&
        (o.nodeName === 'BR' || o.nodeName === '#text') &&
        xe.indexOf(o.parentNode.tagName.toLocaleLowerCase()) >= 0
      )
        return;
      if (!(e.event.action && e.event.action === 'indent') && !this.listTabIndentation) {
        this.domNode.setMarker(this.saveSelection);
      }
      l = this.domNode.blockNodes();
      for (var h = [], c = true, d = 0; d < l.length; d++)
        l[d].parentNode.tagName === 'LI'
          ? h.push(l[d].parentNode)
          : !v(l[d], 'OL') && !v(l[d], 'UL') && v(l[d], 'LI')
            ? h.push(v(l[d], 'LI'))
            : l[d].tagName === 'LI' &&
              l[d].childNodes[0].tagName !== 'P' &&
              l[d].childNodes[0].tagName !== 'OL' &&
              l[d].childNodes[0].tagName !== 'UL' &&
              h.push(l[d]);
      h.length > 1 || h.length === 1
        ? (e.event.preventDefault(),
          e.event.stopPropagation(),
          (this.currentAction = this.getAction(h[0])),
          e.event.shiftKey && (!e.enableTabKey || (e.enableTabKey && !this.listTabIndentation))
            ? (this.revertList(h, e), this.revertClean())
            : (!e.enableTabKey || (e.enableTabKey && !this.listTabIndentation)) && (c = this.nestedList(h)),
          c && (this.cleanNode(), this.parent.editableElement.focus({ preventScroll: true })),
          !(e.event.action && e.event.action === 'indent') &&
            !this.listTabIndentation &&
            ((this.saveSelection = this.domNode.saveMarker(this.saveSelection)),
            this.saveSelection.restore(),
            e.callBack &&
              e.callBack({
                requestType: this.currentAction,
                editorMode: 'HTML',
                range: this.parent.nodeSelection.getRange(this.parent.currentDocument),
                elements: this.parent.domNode.blockNodes(),
                event: e.event,
              })))
        : !(e.event.action && e.event.action === 'indent') &&
          !this.listTabIndentation &&
          (e.event && e.event.shiftKey && e.event.key === 'Tab' && (e.event.action = 'tab'),
          (this.saveSelection = this.domNode.saveMarker(this.saveSelection)),
          this.saveSelection.restore());
      this.listTabIndentation = false;
    } else
      switch (e.event.action) {
        case 'ordered-list':
          {
            this.applyListsHandler({
              subCommand: 'OL',
              callBack: e.callBack,
            });
            e.event.preventDefault();
          }
          break;
        case 'unordered-list':
          {
            this.applyListsHandler({
              subCommand: 'UL',
              callBack: e.callBack,
            });
            e.event.preventDefault();
          }
          break;
        case 'checklist':
          {
            this.applyListsHandler({
              subCommand: 'Checklist',
              callBack: e.callBack,
            });
            e.event.preventDefault();
          }
          break;
      }
  };
  s.prototype.handleListIndentation = function () {
    var e = this.parent.nodeSelection.getRange(this.parent.currentDocument);
    var t = this.saveSelection.getParentNodeCollection(e);
    if ((t[0].nodeName === 'LI' || v(t[0], 'li')) && !this.isCursorAtStartOfLI(e)) {
      var i = t[t.length - 1];
      var n = t[0];
      var r = e.startContainer;
      if (i && t[0]) {
        e.deleteContents();
        if (i !== t[0]) {
          for (var o = r; o.parentElement; ) {
            if (this.parent.domNode.isBlockNode(o.parentElement)) {
              o = o.parentElement;
              break;
            }
            o = o.parentElement;
          }
          var a = void 0;
          var l = '&nbsp;&nbsp;&nbsp;&nbsp;<span class="rte-tab-space"></span>';
          this.parent.domNode.isBlockNode(i.lastChild)
            ? ((r.nodeValue += '\xA0\xA0\xA0\xA0'), (a = r.nodeValue.length))
            : (i.innerHTML += '&nbsp;&nbsp;&nbsp;&nbsp;<span class="rte-tab-space"></span>');
          var h = t[0].firstChild;
          if (t[0].firstChild && this.parent.domNode.isBlockNode(t[0].firstChild)) {
            for (; t[0].firstChild.firstChild; ) o.appendChild(t[0].firstChild.firstChild);
            t[0].firstChild.remove();
          }
          for (; t[0].firstChild; )
            this.parent.domNode.isBlockNode(t[0].firstChild)
              ? this.parent.domNode.insertAfter(t[0].firstChild, o)
              : i.appendChild(t[0].firstChild);
          t[0].remove();
          var c = i.querySelector('.rte-tab-space');
          c && c.previousSibling
            ? (this.saveSelection.setCursorPoint(
                this.parent.currentDocument,
                c.previousSibling,
                c.previousSibling.textContent.length,
              ),
              c.parentNode.removeChild(c))
            : this.saveSelection.setCursorPoint(this.parent.currentDocument, r, a);
        } else Pe.Insert(this.parent.currentDocument, '&nbsp;&nbsp;&nbsp;&nbsp;', this.parent.editableElement);
        this.listTabIndentation = true;
      }
    }
  };
  s.prototype.isCursorAtStartOfLI = function (e) {
    for (var t = e.startContainer; t && t.nodeName !== 'LI'; ) t = t.parentNode;
    if (!t) return false;
    var i = e.cloneRange();
    i.selectNodeContents(t);
    i.setEnd(e.startContainer, e.startOffset);
    return i.toString().trim() === '';
  };
  s.prototype.spaceKeyAction = function (e) {
    if (e.event.which === 32) {
      this.spaceList(e);
    }
  };
  s.prototype.getAction = function (e) {
    var t = e.parentNode;
    return e.parentNode.nodeName === 'OL' ? 'OL' : 'UL';
  };
  s.prototype.revertClean = function () {
    for (var e = this.parent.editableElement.querySelectorAll('ul, ol'), t = 0; t < e.length; t++) {
      var i = e[t].querySelectorAll('ul, ol');
      if (i.length > 0)
        for (var n = 0; n < i.length; n++) {
          var r = i[n].previousSibling;
          if (i[n].previousSibling && i[n].previousSibling.tagName === 'LI') {
            i[n].previousSibling.appendChild(i[n]);
          }
        }
    }
  };
  s.prototype.noPreviousElement = function (e) {
    var t;
    var i;
    var n = e.querySelectorAll('ol, ul');
    var r = e.querySelectorAll('li');
    var o = this.domNode.contents(r[0])[0];
    r.length > 0 &&
    (n.length <= 1 || n[0].childNodes.length > 1) &&
    (this.domNode.contents(r[0])[0].nodeName === 'OL' || this.domNode.contents(r[0])[0].nodeName === 'UL')
      ? (t = r[0])
      : (i = n[0]);
    if (t)
      for (var a = this.domNode.contents(e)[0]; a && !this.domNode.isList(a); null) {
        var l = a.nextSibling;
        He([a], t);
        le(e, { 'list-style-type': 'none' });
        var h = e.parentNode && e.parentNode.classList.contains('e-rte-checklist');
        if (h) {
          B([e], ['e-rte-checklist-hidden']);
        }
        le(t, { 'list-style-type': '' });
        a = a.nextSibling;
      }
    else if (i) {
      var c = E('li');
      He([c], i);
      for (var a = this.domNode.contents(e)[0]; a && !this.domNode.isList(a); null) {
        var l = a.nextSibling;
        c.appendChild(a);
        a = a.nextSibling;
      }
      var h = e.parentNode && e.parentNode.classList.contains('e-rte-checklist');
      He([i], e.parentNode);
      y(e);
      var d = E('li', { styles: 'list-style-type: none;' });
      if (h) {
        B([d], ['e-rte-checklist-hidden']);
      }
      He([d], i.parentNode);
      ue([i], d);
    } else {
      var d = E('li', { styles: 'list-style-type: none;' });
      He([d], e.parentNode);
      var c = E(e.parentNode.tagName);
      if (e.parentNode.classList.contains('e-rte-checklist')) {
        B([c], ['e-rte-checklist']);
        B([d], ['e-rte-checklist-hidden']);
      }
      He([c], d);
      ue([e], c);
    }
  };
  s.prototype.nestedList = function (e) {
    for (
      var t = false,
        i = function (o) {
          var a = n.domNode.getPreviousNode(e[o]);
          if (a) {
            t = true;
            var l = void 0;
            var h = void 0;
            var c = e[o].querySelectorAll('ol, ul');
            var d = e[o].querySelectorAll('li');
            var u = n.domNode.contents(d[0])[0];
            d.length > 0 &&
            (c.length <= 1 || c[0].childNodes.length > 1) &&
            (n.domNode.contents(d[0])[0].nodeName === 'OL' || n.domNode.contents(d[0])[0].nodeName === 'UL')
              ? (h = d[0])
              : (l = c[0]);
            if (l) {
              var f = E('li');
              He([f], l);
              for (var m = n.domNode.contents(e[o])[0]; m && !n.domNode.isList(m); null) {
                var g = m.nextSibling;
                f.appendChild(m);
                m = m.nextSibling;
              }
              if (a.parentNode && a.parentNode.classList.contains('e-rte-checklist')) {
                B([l], ['e-rte-checklist']);
              }
              ue([l], a);
              y(e[o]);
            } else if (h) {
              if (a.tagName === 'LI') {
                for (var m = n.domNode.contents(e[o])[0]; m && !n.domNode.isList(m); null) {
                  var g = m.nextSibling;
                  He([m], h);
                  le(e[o], { 'list-style-type': 'none' });
                  le(h, { 'list-style-type': '' });
                  m = m.nextSibling;
                }
                ue([h.parentNode], a);
                y(e[o]);
              }
            } else if (a.tagName === 'LI') {
              var f = E(e[o].parentNode.tagName);
              if (e[o].parentNode.classList.contains('e-rte-checklist')) {
                B([f], ['e-rte-checklist']);
              }
              f.style.listStyleType = e[o].parentNode.style.listStyleType;
              var b = a.getAttribute('style');
              var C = getComputedStyle(e[o]);
              var N = e[o].style;
              if (b) {
                var w = b.split(';').filter(Boolean);
                w.forEach(function (O) {
                  var L = O.split(':').map(function (H) {
                    return H.trim();
                  });
                  var A = L[0];
                  var k = L[1];
                  if (L[0] && L[1] && L[0] !== 'list-style-type') {
                    var P = C.getPropertyValue(L[0]).trim();
                    var I = e[o].style.getPropertyValue(L[0]).trim();
                    if (P !== L[1] && !I) {
                      e[o].style.setProperty(L[0], P);
                    }
                  }
                });
              }
              ue([f], a);
              ue([e[o]], f);
            } else if (a.tagName === 'OL' || a.tagName === 'UL') {
              ue([e[o]], a);
            }
          } else {
            var T = e[o];
            t = true;
            n.noPreviousElement(e[o]);
          }
        },
        n = this,
        r = 0;
      r < e.length;
      r++
    )
      i(r);
    return t;
  };
  s.prototype.isCursorBeforeTable = function (e) {
    return (
      e.startOffset === e.endOffset &&
      e.startContainer.childNodes.length > 0 &&
      !p(e.startContainer.childNodes[e.startOffset]) &&
      e.startContainer.childNodes[e.startOffset].nodeName === 'TABLE'
    );
  };
  s.prototype.isCursorAtEndOfTable = function (e) {
    return (
      e.startOffset === e.endOffset &&
      e.startContainer.childNodes.length > 0 &&
      !p(e.startContainer.childNodes[e.startOffset - 1]) &&
      e.startContainer.childNodes[e.startOffset - 1].nodeName === 'TABLE'
    );
  };
  s.prototype.isListItemWithTableChild = function (e) {
    return e.nodeName === 'LI' && !p(e.firstChild) && e.firstChild.nodeName === 'TABLE';
  };
  s.prototype.handleChecklistToggle = function (e) {
    var t = e.event.target;
    if (e.event.target.tagName === 'LI' || !p(v(e.event.target, '.e-rte-checklist'))) {
      e.event.preventDefault();
      e.event.stopPropagation();
      e.event.target.classList.contains('e-rte-checklist-checked')
        ? e.event.target.classList.remove('e-rte-checklist-checked')
        : e.event.target.classList.add('e-rte-checklist-checked');
    }
  };
  s.prototype.applyListsHandler = function (e) {
    var t = this.parent.nodeSelection.getRange(this.parent.currentDocument);
    var i = e.subCommand === 'Checklist' && e.item && e.item.action === 'toggleChecklist';
    if (i) this.handleChecklistToggle(e);
    else {
      var n = t.startContainer.nodeName === 'HR' ? t.startContainer : t.startContainer.childNodes[t.startOffset];
      var r = n && n.nodeName === 'HR' ? n.nextElementSibling : null;
      var o = t.startContainer === t.endContainer && t.startOffset === t.endOffset;
      if (
        M.userAgent.indexOf('Firefox') !== -1 &&
        t.startContainer === t.endContainer &&
        t.startContainer === this.parent.editableElement
      ) {
        for (
          var a = t.startContainer.childNodes,
            l = a[t.startOffset > 0 ? t.startOffset - 1 : t.startOffset] || t.startContainer,
            h = t.endContainer.childNodes[t.endOffset > 0 ? t.endOffset - 1 : t.endOffset] || t.endContainer,
            c =
              h.lastChild.nodeName === 'BR'
                ? p(h.lastChild.previousSibling)
                  ? h
                  : h.lastChild.previousSibling
                : h.lastChild;
          !p(c) && c.nodeName !== '#text' && c.nodeName !== 'IMG' && c.nodeName !== 'BR' && c.nodeName !== 'HR';

        )
          c = c.lastChild;
        this.parent.nodeSelection.setSelectionText(this.parent.currentDocument, l, c, 0, c.textContent.length);
        t = this.parent.nodeSelection.getRange(this.parent.currentDocument);
      }
      if (
        t.startContainer === t.endContainer &&
        t.startContainer === this.parent.editableElement &&
        t.startOffset === t.endOffset &&
        t.startOffset === 0 &&
        this.parent.editableElement.textContent.length === 0 &&
        this.parent.editableElement.childNodes[0].nodeName !== 'TABLE' &&
        this.parent.editableElement.childNodes[0].nodeName !== 'IMG'
      ) {
        var d = t.startContainer.childNodes[0];
        this.parent.nodeSelection.setSelectionText(
          this.parent.currentDocument,
          t.startContainer.childNodes[0],
          t.startContainer.childNodes[0],
          0,
          0,
        );
        t = this.parent.nodeSelection.getRange(this.parent.currentDocument);
      }
      this.saveSelection = this.parent.nodeSelection.save(t, this.parent.currentDocument);
      this.currentAction = e.subCommand;
      this.currentAction = e.subCommand =
        this.currentAction === 'NumberFormatList'
          ? 'OL'
          : this.currentAction === 'BulletFormatList'
            ? 'UL'
            : this.currentAction;
      this.domNode.setMarker(this.saveSelection);
      var u = this.domNode.blockNodes(true);
      if (e.enterAction === 'BR') {
        this.isCursorBeforeTable(t)
          ? (u = [t.startContainer.childNodes[t.startOffset]])
          : this.isCursorAtEndOfTable(t)
            ? (u = [t.startContainer.childNodes[t.startOffset - 1]])
            : u.length === 1 && this.isListItemWithTableChild(u[0])
              ? (u[0] = u[0].firstChild)
              : (this.setSelectionBRConfig(),
                this.parent.domNode.convertToBlockNodes(this.parent.domNode.blockNodes(), true),
                this.setSelectionBRConfig(),
                (u = this.parent.domNode.blockNodes()));
      }
      for (var f = 0; f < u.length; f++) {
        if (u[f].tagName === 'TABLE' && !t.collapsed) {
          u.splice(f, 1);
        }
        if (u.length > 0 && u[f].tagName !== 'LI' && u[f].parentNode.tagName === 'LI') {
          u[f] = u[f].parentNode;
        }
      }
      this.applyLists(u, this.currentAction, e.selector, e.item, e, o);
      if (r && t.startContainer === t.endContainer && t.startOffset === t.endOffset) {
        this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, r, 0);
      }
    }
    if (e.callBack) {
      e.callBack({
        requestType: this.currentAction,
        event: e.event,
        editorMode: 'HTML',
        range: this.parent.nodeSelection.getRange(this.parent.currentDocument),
        elements: this.parent.domNode.blockNodes(),
      });
    }
  };
  s.prototype.setSelectionBRConfig = function () {
    var e = this.parent.editableElement.querySelector('.e-editor-select-start');
    var t = this.parent.editableElement.querySelector('.e-editor-select-end');
    p(t)
      ? this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, e, 0)
      : this.parent.nodeSelection.setSelectionText(this.parent.currentDocument, e, t, 0, 0);
  };
  s.prototype.applyLists = function (e, t, i, n, r, o) {
    if (t === 'Checklist') {
      t = 'UL';
    }
    if (this.isRevert(e, t, n, r.subCommand) && p(n)) {
      this.revertList(e, r);
      this.removeEmptyListElements();
    } else {
      this.checkLists(e, t, n, o, r.subCommand);
      var a = '';
      if (e[0].style.marginLeft !== '') {
        a = ' style = "margin-left: ' + e[0].style.marginLeft + ';"';
      }
      for (var l = 0; l < e.length; l++) {
        if (!p(n) && !p(n.listStyle) && r.subCommand !== 'Checklist')
          if (n.listStyle === 'listImage') le(e[l], { 'list-style-image': n.listImage });
          else {
            le(e[l], { 'list-style-image': 'none' });
            var h = this.formatListStyle(n.listStyle);
            le(e[l], { 'list-style-type': h });
          }
        e[l].style.removeProperty('margin-left');
        var c =
          e[l].tagName === 'IMG' || e[l].classList.contains('e-editor-select-start')
            ? ''
            : this.domNode.attributes(e[l]);
        if (
          e[l].getAttribute('contenteditable') === 'true' &&
          e[l].childNodes.length === 1 &&
          e[l].childNodes[0].nodeName === 'TABLE'
        ) {
          var d = document.createElement(t);
          d.innerHTML = '<li><br/></li>';
          e[l].appendChild(d);
        } else if (e[l].tagName !== 'LI' && p(n) && e[l].nodeName === 'BLOCKQUOTE') {
          var u = '<' + t + a + '>';
          var f = '</' + t + '>';
          var m = 'li' + c;
          var g = e[l].innerHTML;
          var b = this.domNode.createTagString(m, null, e[l].innerHTML);
          var C = u + b + f;
          if (r.subCommand === 'Checklist') {
            C = this.addCheckListClass(C);
          }
          e[l].innerHTML = C;
        } else if (e[l].tagName !== 'LI' && p(n)) {
          var u = '<' + t + a + '>';
          var f = '</' + t + '>';
          var m = 'li' + c;
          var g = void 0;
          e[l].tagName.toLowerCase() === ve || e[l].tagName === 'DIV' ? (g = e[l].innerHTML) : (g = e[l].outerHTML);
          if (
            e[l].tagName === 'HR' &&
            e[l].firstElementChild &&
            e[l].firstElementChild.tagName === 'SPAN' &&
            e[l].firstElementChild.hasAttribute('class') &&
            e[l].firstElementChild.className === 'e-editor-select-start'
          ) {
            g = e[l].firstElementChild.outerHTML + e[l].outerHTML;
          }
          var b = this.domNode.createTagString(m, null, g);
          b = this.setStyle(b);
          var C = u + b + f;
          if (r.subCommand === 'Checklist') {
            C = this.addCheckListClass(C);
          }
          this.domNode.replaceWith(e[l], C);
        } else if (!p(n) && e[l].tagName !== 'LI') {
          var N = e[l].tagName === 'IMG' ? '' : this.domNode.attributes(e[l]);
          var u = '<' + t + N + '>';
          var f = '</' + t + '>';
          var m = 'li';
          var g = void 0;
          e[l].tagName.toLowerCase() === ve || e[l].tagName === 'DIV' ? (g = e[l].innerHTML) : (g = e[l].outerHTML);
          var b = this.domNode.createTagString('li', null, g);
          var C = u + b + f;
          if (r.subCommand === 'Checklist') {
            C = this.addCheckListClass(C);
          }
          this.domNode.replaceWith(e[l], C);
        }
      }
    }
    this.cleanNode();
    if (r.enterAction === 'BR') {
      var w = document.querySelectorAll('span#removeSpan');
      w.forEach(function (T) {
        for (var S = document.createDocumentFragment(); T.firstChild; ) S.appendChild(T.firstChild);
        T.parentNode.replaceChild(S, T);
      });
    }
    this.parent.editableElement.focus({ preventScroll: true });
    if (W()) {
      Xe(this.parent.editableElement, i);
    }
    this.saveSelection = this.domNode.saveMarker(this.saveSelection);
    this.saveSelection.restore();
  };
  s.prototype.addCheckListClass = function (e) {
    var t = E('div');
    t.innerHTML = e;
    var i = t.firstElementChild;
    this.applyCheckListClasses(t.firstElementChild);
    return t.innerHTML;
  };
  s.prototype.applyCheckListClasses = function (e) {
    B([e], 'e-rte-checklist');
  };
  s.prototype.setStyle = function (e) {
    var t = document.createElement('div');
    t.innerHTML = e.trim();
    var i = t.querySelector('li');
    var n = i;
    if (i && i.childNodes.length === 1) {
      for (
        var r = function () {
          var o = i.firstChild;
          if (
            i.firstChild &&
            (i.firstChild.style.cssText ||
              i.firstChild.tagName.toUpperCase() === 'B' ||
              i.firstChild.tagName.toUpperCase() === 'STRONG' ||
              i.firstChild.tagName.toUpperCase() === 'I' ||
              i.firstChild.tagName.toUpperCase() === 'EM')
          ) {
            var a = ['font-size', 'font-family', 'color', 'font-weight'];
            var l = i.firstChild.style.cssText
              .split(';')
              .map(function (h) {
                return h.trim();
              })
              .filter(function (h) {
                var c = p(h.split(':')[0]) ? '' : h.split(':')[0].trim();
                return c && a.indexOf(c) !== -1;
              })
              .join(';');
            l
              ? (i.style.cssText += (i.style.cssText ? ';' : '') + l)
              : i.firstChild.tagName.toUpperCase() === 'B' || i.firstChild.tagName.toUpperCase() === 'STRONG'
                ? ((l = 'font-weight: bold;'), (i.style.cssText += (i.style.cssText ? ';' : '') + l))
                : (i.firstChild.tagName.toUpperCase() === 'I' || i.firstChild.tagName.toUpperCase() === 'EM') &&
                  ((l = 'font-style: italic;'), (i.style.cssText += (i.style.cssText ? ';' : '') + l));
          }
          i = i.firstChild;
        };
        i && i.children.length === 1 && i.firstChild && i.firstChild.nodeType !== Node.TEXT_NODE;

      )
        r();
      e = t.innerHTML;
    }
    return e;
  };
  s.prototype.removeEmptyListElements = function () {
    for (var e = this.parent.editableElement.querySelectorAll('ol, ul'), t = 0; t < e.length; t++)
      if (e[t].textContent.trim() === '') {
        y(e[t]);
      }
  };
  s.prototype.isRevert = function (e, t, i, n) {
    for (var r = true, o = 0; o < e.length; o++) {
      if (e[o].tagName !== 'LI') return false;
      if (
        e[o].parentNode.tagName !== t ||
        (p(i) && e[o].parentNode.style.listStyleType !== '') ||
        (e[o].parentNode.tagName === 'UL' && e[o].parentNode.classList.contains('e-rte-checklist') && n !== 'Checklist')
      ) {
        r = false;
      }
      if (e[o].parentNode.tagName === t && e[o].parentNode.style.listStyleType !== '') {
        r = true;
      }
      if (
        e[o].parentNode.tagName === 'UL' &&
        !e[o].parentNode.classList.contains('e-rte-checklist') &&
        n === 'Checklist'
      ) {
        r = false;
      }
    }
    return r;
  };
  s.prototype.checkLists = function (e, t, i, n, r) {
    for (var o = [], a = 0; a < e.length; a++) {
      var l = e[a].parentNode;
      if (
        (e[a].tagName === 'LI' && e[a].parentNode.tagName !== t && o.indexOf(e[a].parentNode) < 0) ||
        (e[a].tagName === 'LI' && e[a].parentNode.tagName === t && o.indexOf(e[a].parentNode) < 0 && i !== null) ||
        (e[a].tagName === 'LI' &&
          e[a].parentNode.tagName === t &&
          r === 'Checklist' &&
          o.indexOf(e[a].parentNode) < 0) ||
        (e[a].tagName === 'LI' &&
          e[a].parentNode.tagName === t &&
          r !== 'Checklist' &&
          o.indexOf(e[a].parentNode) < 0 &&
          e[a].parentNode.classList.contains('e-rte-checklist'))
      ) {
        o.push(e[a].parentNode);
      }
      if (
        p(i) &&
        (e[a].parentNode.tagName === t ||
          ((e[a].parentNode.tagName === 'UL' || e[a].parentNode.tagName === 'OL') &&
            e[a].parentNode.hasAttribute('style'))) &&
        e[a].parentNode.hasAttribute('style')
      ) {
        e[a].parentNode.removeAttribute('style');
      }
    }
    this.convertListType(e, t, o, n, i, r);
  };
  s.prototype.convertListType = function (e, t, i, n, r, o) {
    var a = this;
    t = o === 'Checklist' ? 'Checklist' : t;
    for (
      var l = Array.from(
          new Set(
            e
              .map(function (u) {
                return u.parentNode;
              })
              .filter(function (u) {
                return u.tagName === 'OL' || u.tagName === 'UL';
              }),
          ),
        ).reverse(),
        h = function (u) {
          var f = l[u];
          if (!n && (l[u].tagName === 'UL' || l[u].tagName === 'OL')) {
            var m = c.parent.currentDocument.createDocumentFragment();
            var g = l[u].tagName;
            var b = l[u].classList.contains('e-rte-checklist');
            var C = t === 'Checklist';
            var N = c.parent.currentDocument.createElement(C ? 'ul' : t.toLowerCase());
            if (C) {
              c.applyCheckListClasses(N);
            }
            var w = Array.from(l[u].children).filter(function (I) {
              return I.tagName === 'LI';
            });
            w.forEach(function (I) {
              if (e.indexOf(I) !== -1)
                if (g === (C ? 'ul' : t.toLowerCase()) && b === C) {
                  var H = I.cloneNode(true);
                  N.appendChild(H);
                } else {
                  var U = C ? 'UL' : t;
                  N = a.parent.currentDocument.createElement(U.toLowerCase());
                  if (g === t && !(l[u].classList.contains('e-rte-checklist') && t === 'UL')) {
                    a.transferAttributes(l[u], N);
                  }
                  if (C) {
                    a.applyCheckListClasses(N);
                  }
                  g = C ? 'ul' : t.toLowerCase();
                  b = C;
                  m.appendChild(N);
                  var H = I.cloneNode(true);
                  a.applyListItemStyle(N, r);
                  N.appendChild(H);
                }
              else {
                if (g !== l[u].tagName.toLowerCase() || b !== l[u].classList.contains('e-rte-checklist')) {
                  g = l[u].tagName.toLowerCase();
                  b = l[u].classList.contains('e-rte-checklist');
                  N = a.parent.currentDocument.createElement(g);
                  if (b) {
                    a.applyCheckListClasses(N);
                  }
                  a.transferAttributes(l[u], N);
                  m.appendChild(N);
                }
                N.appendChild(I.cloneNode(true));
              }
            });
            l[u].parentNode.replaceChild(m, l[u]);
          } else if (n)
            for (var T = i.length - 1; T >= 0; T--) {
              var S = i[T];
              var O = t === 'Checklist' ? 'ul' : t;
              var L =
                '<' +
                O.toLowerCase() +
                ' ' +
                c.domNode.attributes(i[T]) +
                '>' +
                i[T].innerHTML +
                '</' +
                O.toLowerCase() +
                '>';
              var A = document.createElement('div');
              A.innerHTML = L;
              c.applyListItemStyle(A.firstChild, r);
              if (o === 'Checklist') A.innerHTML = c.addCheckListClass(A.innerHTML);
              else {
                for (var k = A.querySelectorAll('li'), P = 0; P < k.length; P++) c.revertChecklistItem(k[P]);
                if (A.firstElementChild && A.firstElementChild.classList.contains('e-rte-checklist')) {
                  A.firstElementChild.classList.remove('e-rte-checklist');
                  if (A.firstElementChild.classList.length === 0) {
                    A.firstElementChild.removeAttribute('class');
                  }
                }
              }
              c.domNode.replaceWith(i[T], A.innerHTML);
            }
        },
        c = this,
        d = 0;
      d < l.length;
      d++
    )
      h(d);
  };
  s.prototype.applyListItemStyle = function (e, t) {
    if (!p(t) && !p(t.listStyle))
      if (t.listStyle === 'listImage') le(e, { 'list-style-image': t.listImage });
      else {
        le(e, { 'list-style-image': 'none' });
        var i = this.formatListStyle(t.listStyle);
        le(e, { 'list-style-type': i });
      }
  };
  s.prototype.transferAttributes = function (e, t) {
    for (var i = 0; i < e.attributes.length; i++) {
      var n = e.attributes[i];
      t.setAttribute(e.attributes[i].name, e.attributes[i].value);
    }
  };
  s.prototype.cleanNode = function () {
    for (var e = this.parent.editableElement.querySelectorAll('ol + ol, ul + ul'), t, i, n = 0; n < e.length; n++) {
      for (
        var r = e[n], o = true, a = r;
        a.parentElement &&
        !(
          a.parentElement &&
          a.parentElement.tagName !== 'LI' &&
          a.parentElement.tagName !== 'OL' &&
          a.parentElement.tagName !== 'UL'
        );

      )
        a = a.parentElement;
      if (
        o &&
        (e[n].parentElement.parentElement.nodeName === 'OL' || e[n].parentElement.parentElement.nodeName === 'UL')
      ) {
        o = false;
        var l = e[n].parentElement.parentElement;
        t = e[n].parentElement.parentElement.style.listStyleType;
        i = r.previousElementSibling;
      }
      if (
        this.domNode.isList(r.previousElementSibling) &&
        this.domNode.openTagString(r) === this.domNode.openTagString(r.previousElementSibling)
      ) {
        for (var h = this.domNode.contents(r), c = 0; c < h.length; c++) r.previousElementSibling.appendChild(h[c]);
        r.parentNode.removeChild(r);
      } else if (!p(r.getAttribute('level')))
        if (r.tagName === r.previousElementSibling.tagName) {
          r.previousElementSibling.lastChild.append(r);
        } else if (
          this.domNode.isList(r.previousElementSibling) &&
          a.contains(r.previousElementSibling) &&
          (r.tagName === 'OL' || r.tagName === 'UL') &&
          (r.previousElementSibling.nodeName === 'OL' || r.previousElementSibling.nodeName === 'UL') &&
          r.previousElementSibling.classList.contains('e-rte-checklist') &&
          r.classList.contains('e-rte-checklist') &&
          !(r.previousElementSibling.classList.contains('e-rte-checklist') && r.classList.contains('e-rte-checklist'))
        ) {
          for (var h = this.domNode.contents(r), c = 0; c < h.length; c++) r.previousElementSibling.appendChild(h[c]);
          r.parentNode.removeChild(r);
        }
    }
    if (i) {
      i.style.listStyleType = t;
      var d = this.parent.nodeSelection.getRange(this.parent.currentDocument);
      var u = [];
      d.commonAncestorContainer.nodeName === 'UL' || d.commonAncestorContainer.nodeName === 'OL'
        ? (d.commonAncestorContainer instanceof Element && u.push(d.commonAncestorContainer),
          (u = u.concat(Array.from(d.commonAncestorContainer.querySelectorAll('ol, ul')))))
        : (u = Array.from(d.commonAncestorContainer.querySelectorAll('ol, ul')));
      for (var f = 0; f < u.length; f++)
        for (var m = void 0, g = u[f]; g; ) {
          if (g.nodeName === 'OL' || g.nodeName === 'OL') {
            g.style.listStyleType !== '' && g.style.listStyleType !== 'none' && g.nodeName !== 'LI'
              ? (m = g.style.listStyleType)
              : !p(m) &&
                (g.style.listStyleType === '' || g.style.listStyleType === 'none') &&
                g.nodeName !== 'LI' &&
                (g.nodeName === 'UL' || g.nodeName === 'OL') &&
                (g.style.listStyleType = m);
          }
          g = g.querySelector('UL,OL');
        }
    }
  };
  s.prototype.findUnSelected = function (e, t) {
    e = e.slice().reverse();
    if (e.length > 0) {
      var i = [];
      var n = [];
      var r = t[t.length - 1];
      var o = [];
      var a = [];
      o = t[t.length - 1].childNodes;
      for (var l = 0; l < o.length; l++)
        if (o[l].tagName === 'OL' || o[l].tagName === 'UL') {
          var h = o[l].querySelectorAll('li');
          if (h.length > 0) for (var c = 0; c < h.length; c++) a.push(h[c]);
        }
      for (var d = 0; d < a.length; d++) {
        for (var u = 0, f = 0; f < e.length; f++)
          if (!a[d].contains(e[f])) {
            u = u + 1;
          }
        if (u === e.length) {
          n.push(a[d]);
        }
      }
      if (n.length > 0)
        for (var m = 0; m < n.length; m++)
          if (this.domNode.contents(n[m])[0].nodeName !== 'OL' && this.domNode.contents(n[m])[0].nodeName !== 'UL') {
            i.push(n[m]);
          }
      if (i.length > 0) {
        this.nestedList(i);
      }
    }
  };
  s.prototype.revertChecklistItem = function (e) {
    if (e && e.parentElement && e.parentElement.classList.contains('e-rte-checklist')) {
      e.parentElement.classList.remove('e-rte-checklist');
    }
  };
  s.prototype.revertList = function (e, t) {
    for (var i = [], n = e.length - 1; n >= 0; n--)
      for (var r = n - 1; r >= 0; r--)
        if (e[r].contains(e[n]) || e[r] === e[n]) {
          i.push(e[n]);
          e.splice(n, 1);
          break;
        }
    this.findUnSelected(i, e);
    for (var o = [], n = 0; n < e.length; n++) {
      var a = e[n];
      if (
        this.domNode.contents(e[n])[0].nodeType === 3 &&
        this.domNode.contents(e[n])[0].textContent.trim().length === 0
      ) {
        y(this.domNode.contents(e[n])[0]);
      }
      var l = e[n].parentNode;
      var h = e[n].getAttribute('class');
      if (i.length === 0) {
        var c = e[n].querySelectorAll('ul, ol');
        var d = c[0];
        if (c[0]) {
          var u = c[0].querySelectorAll('li');
          if (u) {
            var f = E(c[0].tagName);
            ue([f], c[0].parentNode);
            var m = E('li', { styles: 'list-style-type: none;' });
            ue([m], f);
            ue([c[0]], m);
          }
        }
      }
      e[n].parentNode.insertBefore(this.closeTag(l.tagName), e[n]);
      if (l.parentNode.tagName === 'LI' || l.parentNode.tagName === 'OL' || l.parentNode.tagName === 'UL')
        e[n].parentNode.insertBefore(this.closeTag('LI'), e[n]);
      else {
        var g = this.getClosestListParentMargin(e[n]);
        if (e[n].querySelectorAll(ge.join(', ')).length === 0) {
          var b = p(h) ? ' class="e-rte-wrap-inner"' : ' class="' + h + ' e-rte-wrap-inner"';
          var C = l;
          if (e.length === l.querySelectorAll('li').length) {
            if (!p(l.style.listStyleType)) {
              l.style.removeProperty('list-style-type');
            }
            if (!p(l.style.listStyleImage)) {
              l.style.removeProperty('list-style-image');
            }
            if (l.style.length === 0) {
              l.removeAttribute('style');
            }
          }
          var N = p(t.enterAction) ? ve : t.enterAction;
          if (e[n].style.color) {
            e[n].style.removeProperty('color');
          }
          var w = '<' + N + b + this.domNode.attributes(e[n]) + '></' + N + '>';
          var T = document.createElement('div');
          T.innerHTML = w;
          if (g !== '') {
            T.firstElementChild.style.marginLeft = g;
          }
          if (t.enterAction !== 'BR') this.domNode.wrapInner(e[n], this.domNode.parseHTMLFragment(T.innerHTML));
          else if (e[n].textContent !== '') {
            var S = '<span class=e-rte-wrap-inner id=removeSpan></span>';
            var O = document.createElement('br');
            this.domNode.wrapInner(
              e[n],
              this.domNode.parseHTMLFragment('<span class=e-rte-wrap-inner id=removeSpan></span>'),
            );
            e[n].appendChild(O);
          }
        } else if (this.domNode.contents(e[n])[0].nodeType === 3) {
          var L = this.domNode.createTagString(
            ve,
            l,
            this.parent.domNode.encode(this.domNode.contents(e[n])[0].textContent),
          );
          this.domNode.replaceWith(this.domNode.contents(e[n])[0], L);
        } else if (
          this.domNode.contents(e[n])[0].classList.contains('e-editor-select-start') ||
          this.domNode.contents(e[n])[0].classList.contains('e-editor-select-end')
        ) {
          var L = this.domNode.createTagString(ve, l, '<br>' + this.domNode.contents(e[n])[0].outerHTML);
          this.domNode.contents(e[n])[1] && this.domNode.contents(e[n])[1].tagName === 'BR'
            ? (this.domNode.contents(e[n])[1].remove(),
              (L = this.domNode.createTagString(ve, l, '<br>' + this.domNode.contents(e[n])[0].outerHTML)))
            : (L = this.domNode.createTagString(ve, l, this.domNode.contents(e[n])[0].outerHTML));
          this.domNode.replaceWith(this.domNode.contents(e[n])[0], L);
        } else {
          var A = e[n].firstChild;
          if (e[n].firstChild) {
            var k = e[n].parentElement.attributes;
            if (e[n].parentElement.attributes.length > 0)
              for (var P = 0; P < e[n].parentElement.attributes.length; P++) {
                var I = e[n].parentElement.attributes[P];
                var H = function (ce) {
                  return ce
                    ? ce
                        .split(';')
                        .filter(function (F) {
                          return !/list-style-(image|type):/.test(F.trim());
                        })
                        .join(';')
                        .trim()
                    : '';
                };
                var U = H(e[n].firstChild.getAttribute(e[n].parentElement.attributes[P].nodeName));
                var Q = H(e[n].parentElement.getAttribute(e[n].parentElement.attributes[P].nodeName));
                U && U !== Q
                  ? e[n].firstChild.setAttribute(e[n].parentElement.attributes[P].nodeName, U ? Q + ' ' + U : Q)
                  : e[n].firstChild.setAttribute(e[n].parentElement.attributes[P].nodeName, Q);
                if (e[n].firstChild.style.length === 0) {
                  e[n].firstChild.removeAttribute('style');
                }
              }
          }
          h = e[n].firstChild.getAttribute('class');
          if (h && e[n].firstChild.getAttribute('class') && h !== e[n].firstChild.getAttribute('class')) {
            Ti(e[n].firstChild, { class: h + ' ' + e[n].firstChild.getAttribute('class') });
          }
        }
        ue([this.openTag('LI')], e[n]);
        He([this.closeTag('LI')], e[n]);
      }
      this.domNode.insertAfter(this.openTag(l.tagName), e[n]);
      if (l.parentNode.tagName === 'LI') {
        l = l.parentNode.parentNode;
      }
      if (o.indexOf(l) < 0) {
        o.push(l);
      }
    }
    for (var n = 0; n < o.length; n++) {
      var K = o[n];
      var Z = o[n].innerHTML;
      var G = /<span class="e-rte-list-close-([a-z]*)"><\/span>/g;
      var j = /<span class="e-rte-list-open-([a-z]*)"><\/span>/g;
      Z = Z.replace(G, '</$1>');
      Z = Z.replace(j, '<$1 ' + this.domNode.attributes(o[n]) + '>');
      this.domNode.replaceWith(o[n], this.domNode.openTagString(o[n]) + Z.trim() + this.domNode.closeTagString(o[n]));
    }
    for (var $ = this.parent.editableElement.querySelectorAll('ul:empty, ol:empty'), n = 0; n < $.length; n++) y($[n]);
    for (var R = this.parent.editableElement.querySelectorAll('li:empty'), n = 0; n < R.length; n++) y(R[n]);
    this.revertCheckListClasses();
  };
  s.prototype.revertCheckListClasses = function () {
    var e = this.parent.editableElement;
    var t = this.parent.editableElement.querySelectorAll('.e-rte-checklist');
    t.forEach(function (n) {
      if (n.nodeName !== 'UL' && n.classList.contains('e-rte-checklist')) {
        x([n], ['e-rte-checklist']);
        if (n.getAttribute('class') === '') {
          n.removeAttribute('class');
        }
      }
    });
    var i = this.parent.editableElement.querySelectorAll('.e-rte-checklist-checked');
    i.forEach(function (n) {
      if (n.nodeName !== 'LI') {
        x([n], ['e-rte-checklist-checked']);
        if (n.getAttribute('class') === '') {
          n.removeAttribute('class');
        }
      }
    });
  };
  s.prototype.getClosestListParentMargin = function (e) {
    for (var t = e; t && t !== this.parent.editableElement; ) {
      if (t.nodeName === 'UL' || t.nodeName === 'OL') return t.style.marginLeft;
      t = t.parentElement;
    }
    return '';
  };
  s.prototype.openTag = function (e) {
    return this.domNode.parseHTMLFragment('<span class="e-rte-list-open-' + e.toLowerCase() + '"></span>');
  };
  s.prototype.closeTag = function (e) {
    return this.domNode.parseHTMLFragment('<span class="e-rte-list-close-' + e.toLowerCase() + '"></span>');
  };
  s.prototype.destroy = function () {
    this.removeEventListener();
    if (this.domNode) {
      this.domNode = null;
    }
  };
  s.prototype.areAllListItemsSelected = function (e, t) {
    for (var i = e.querySelectorAll('li'), n = 0; n < i.length; n++) {
      var r = i[n];
      var o = this.parent.currentDocument.createRange();
      o.selectNodeContents(i[n]);
      if (!t.intersectsNode(i[n])) return false;
    }
    return true;
  };
  s.prototype.getListCursorInfo = function (e) {
    var t;
    var i;
    var n = new Mt(this.parent.editableElement);
    var r = e.startContainer.nodeType === Node.TEXT_NODE ? n.getTopMostNode(e.startContainer) : e.startContainer;
    var o = e.endContainer.nodeType === Node.TEXT_NODE ? n.getTopMostNode(e.endContainer) : e.endContainer;
    var a = !e.collapsed;
    var l = r.nodeType === Node.TEXT_NODE ? r.parentElement.closest('li') : r.closest('li');
    var h = o.nodeType === Node.TEXT_NODE ? o.parentElement.closest('li') : o.closest('li');
    var c = l && l.closest('ol, ul') ? this.checkIsNestedList(l.closest('ol, ul')) : false;
    var d = h && h.closest('ol, ul') ? this.checkIsNestedList(h.closest('ol, ul')) : false;
    var u = this.parent.domNode.blockNodes();
    var f = u.length;
    var m = this.getListSelectionType(c ? 'Nested' : 'Parent', d ? 'Nested' : 'Parent');
    a
      ? (u.length === 1
          ? (i = e.startOffset === 0 && e.endOffset === l.textContent.length ? 'SingleFull' : 'SinglePartial')
          : (i =
              e.startOffset === 0 && e.endOffset === u[u.length - 1].textContent.length
                ? 'MultipleFull'
                : 'MultiplePartial'),
        (t = 'None'))
      : (e.startOffset === 0 && r.previousSibling === null
          ? (t = c ? 'StartNested' : 'StartParent')
          : e.startOffset === l.textContent.length && r.nextSibling === null
            ? (t = c ? 'EndNested' : 'EndParent')
            : (t = c ? 'MiddleNested' : 'MiddleParent'),
        (i = 'None'));
    return {
      position: t,
      selectionState: i,
      itemType: m,
    };
  };
  s.prototype.checkIsNestedList = function (e) {
    var t = e.parentElement === this.parent.editableElement;
    return t ? false : !!e.closest('li');
  };
  s.prototype.getListSelectionType = function (e, t) {
    return e === 'Nested' && t === 'Nested' ? 'Nested' : e === 'Parent' && t === 'Parent' ? 'Parent' : 'Mixed';
  };
  s.prototype.isAllListNodesSelected = function (e) {
    for (
      var t = this.parent.currentDocument.getSelection(), i = false, n = e.querySelectorAll('li'), r = 0;
      r < n.length;
      r++
    )
      if (t.containsNode(n[r], false)) i = true;
      else {
        i = false;
        break;
      }
    return i;
  };
  s.prototype.formatListStyle = function (e) {
    var t = /^(lower|upper)(greek|alpha|roman)$/i;
    return t.test(e)
      ? e
          .replace(t, function (i, n, r) {
            return n + '-' + r;
          })
          .toLowerCase()
      : e.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();
  };
  return s;
})();
var is = (function () {
  function s(e) {
    this.blockquotePrevent = false;
    this.parent = e;
    this.addEventListener();
  }
  s.prototype.addEventListener = function () {
    this.parent.observer.on(Si, this.applyFormats, this);
    this.parent.observer.on(tt, this.onKeyUp, this);
    this.parent.observer.on(ae, this.onKeyDown, this);
    this.parent.observer.on(to, this.blockQuotesHandled, this);
    this.parent.observer.on(J, this.destroy, this);
  };
  s.prototype.removeEventListener = function () {
    this.parent.observer.off(Si, this.applyFormats);
    this.parent.observer.off(tt, this.onKeyUp);
    this.parent.observer.off(ae, this.onKeyDown);
    this.parent.observer.off(J, this.destroy);
  };
  s.prototype.getParentNode = function (e) {
    for (
      var t = e, i = ['DIV', 'SECTION', 'ARTICLE', 'ASIDE', 'FOOTER', 'HEADER', 'NAV', 'MAIN'];
      e.parentNode && e.parentNode !== this.parent.editableElement;
      null
    )
      e = e.parentNode;
    if (i.indexOf(e.nodeName.toUpperCase()) !== -1)
      for (e = t; i.indexOf(e.nodeName.toUpperCase()) === -1 && i.indexOf(e.parentNode.nodeName.toUpperCase()) === -1; )
        e = e.parentNode;
    return e;
  };
  s.prototype.blockQuotesHandled = function () {
    this.blockquotePrevent = true;
  };
  s.prototype.onKeyUp = function (e) {
    var t = this.parent.nodeSelection.getRange(this.parent.currentDocument);
    var i = t.endContainer;
    var n = t.endContainer.lastChild;
    if (e.event.which === 13 && t.startContainer === t.endContainer && t.endContainer.nodeType !== 3) {
      var r = E('p');
      r.innerHTML = '<br>';
      if (
        !p(t.endContainer.lastChild) &&
        t.endContainer.lastChild &&
        t.endContainer.lastChild.nodeName === 'BR' &&
        t.endContainer.lastChild.previousSibling &&
        t.endContainer.lastChild.previousSibling.nodeName === 'TABLE'
      ) {
        t.endContainer.replaceChild(r, t.endContainer.lastChild);
        this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, r, 0);
      } else {
        var o = this.parent.nodeSelection.getSelectionNodeCollectionBr(t)[0];
        if (
          !p(this.parent.nodeSelection.getSelectionNodeCollectionBr(t)[0]) &&
          this.parent.nodeSelection.getSelectionNodeCollectionBr(t)[0].nodeName === 'BR' &&
          this.parent.nodeSelection.getSelectionNodeCollectionBr(t)[0].previousSibling &&
          this.parent.nodeSelection.getSelectionNodeCollectionBr(t)[0].previousSibling.nodeName === 'TABLE'
        ) {
          t.endContainer.replaceChild(r, this.parent.nodeSelection.getSelectionNodeCollectionBr(t)[0]);
          this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, r, 0);
        }
      }
    }
    if (
      e.enterAction !== 'BR' &&
      !p(t.startContainer) &&
      !p(t.startContainer.parentElement) &&
      t.startContainer === t.endContainer &&
      t.startContainer.nodeName === '#text' &&
      t.startContainer.parentElement.classList.contains('e-content') &&
      t.startContainer.parentElement.isContentEditable
    ) {
      var r = E(e.enterAction);
      t.startContainer.parentElement.insertBefore(r, t.startContainer);
      r.appendChild(t.startContainer);
      this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, r, 1);
    }
  };
  s.prototype.getBlockParent = function (e, t) {
    for (var i = e; e !== t; ) {
      i = e;
      e = e.parentElement;
    }
    return i;
  };
  s.prototype.onKeyDown = function (e) {
    if (e.event.which === 13 && !this.blockquotePrevent) {
      var t = this.parent.nodeSelection.getRange(this.parent.currentDocument);
      var i =
        t.startContainer.textContent.length === 0 || t.startContainer.nodeName === 'PRE'
          ? t.startContainer
          : t.startContainer.parentElement;
      var n =
        t.endContainer.textContent.length === 0 || t.endContainer.nodeName === 'PRE'
          ? t.endContainer
          : t.endContainer.parentElement;
      var r = v(i, 'pre');
      var o = v(n, 'pre');
      var a = v(i, 'blockquote');
      var l = v(n, 'blockquote');
      var h = !p(r) && !p(r.parentElement) && r.parentElement.tagName === 'LI';
      if (h) return;
      if ((p(r) && !p(o)) || (!p(r) && p(o))) {
        e.event.preventDefault();
        this.deleteContent(t);
        this.removeCodeContent(t);
        t = this.parent.nodeSelection.getRange(this.parent.currentDocument);
        this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, n, 0);
      }
      if (e.event.which === 13 && ((!p(a) && !p(l)) || (!p(a) && p(l)))) {
        var c = this.getBlockParent(t.startContainer, a);
        if (
          (c.textContent.charCodeAt(0) === 8203 && c.textContent.length === 1) ||
          (c.textContent.length === 0 &&
            c.querySelectorAll('img').length === 0 &&
            c.querySelectorAll('table').length === 0)
        ) {
          e.event.preventDefault();
          if (p(c.nextElementSibling))
            this.paraFocus(c.parentElement === this.parent.editableElement ? c : c.parentElement);
          else {
            var d = new gt();
            d.SplitNode(t, c.parentElement, false).cloneNode(true);
            this.paraFocus(c.parentElement === this.parent.editableElement ? c : c.parentElement);
          }
        }
      }
      if (e.event.which === 13 && !p(r) && !p(o)) {
        e.event.preventDefault();
        this.deleteContent(t);
        this.removeCodeContent(t);
        t = this.parent.nodeSelection.getRange(this.parent.currentDocument);
        var u = t.startContainer.childNodes[t.endOffset];
        var f = t.startContainer.childNodes[t.endOffset - 1];
        var c = t.startContainer;
        if (
          !p(t.startContainer.childNodes[t.endOffset]) &&
          !p(t.startContainer.childNodes[t.endOffset - 1]) &&
          p(t.startContainer.childNodes[t.endOffset].nextSibling) &&
          t.startContainer.childNodes[t.endOffset].nodeName === 'BR' &&
          t.startContainer.childNodes[t.endOffset - 1].nodeName === 'BR'
        )
          this.paraFocus(t.startContainer, e.enterAction);
        else if ((c.textContent.charCodeAt(0) === 8203 && c.textContent.length === 1) || c.textContent.length === 0) {
          for (; c.parentElement.nodeName !== 'PRE' && (c.textContent.length === 1 || c.textContent.length === 0); )
            c = c.parentElement;
          !p(c.previousSibling) && c.previousSibling.nodeName === 'BR' && p(c.nextSibling)
            ? this.paraFocus(c.parentElement)
            : this.isNotEndCursor(r, t);
        } else this.isNotEndCursor(r, t);
      }
    }
    this.blockquotePrevent = false;
  };
  s.prototype.removeCodeContent = function (e) {
    var t = new RegExp('\uFEFF', 'g');
    if (!p(e.endContainer.textContent.match(t))) {
      var i = e.endContainer.textContent.charCodeAt(e.endOffset - 1) === 65279 ? e.endOffset - 2 : e.endOffset;
      e.endContainer.textContent = e.endContainer.textContent.replace(t, '');
      e.endContainer.textContent === ''
        ? this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, e.endContainer.parentElement, 0)
        : this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, e.endContainer, i);
    }
  };
  s.prototype.deleteContent = function (e) {
    if (e.startContainer !== e.endContainer || e.startOffset !== e.endOffset) {
      e.deleteContents();
    }
  };
  s.prototype.paraFocus = function (e, t) {
    var i;
    t === 'DIV'
      ? ((i = E('div')), (i.innerHTML = '<br>'))
      : t === 'BR'
        ? (i = E('br'))
        : ((i = E('p')), (i.innerHTML = '<br>'));
    this.parent.domNode.insertAfter(i, e);
    this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, i, 0);
    y(e.lastChild);
  };
  s.prototype.isNotEndCursor = function (e, t) {
    var i = new gt();
    var n =
      t.startOffset === e.lastChild.textContent.length && e.lastChild.textContent === t.startContainer.textContent;
    if (
      e.textContent.indexOf(t.startContainer.textContent) === 0 &&
      ((t.startOffset === 0 && t.endOffset === 0) || t.startContainer.nodeName === 'PRE')
    ) {
      this.insertMarker(e, t);
      var r = E('br');
      e.childNodes[t.endOffset].parentElement.insertBefore(r, e.childNodes[t.endOffset]);
    } else {
      var o = i.SplitNode(t, e, true);
      this.insertMarker(e, t);
      var a = e.previousElementSibling;
      if (e.previousElementSibling.tagName === 'PRE') {
        e.previousElementSibling.insertAdjacentHTML('beforeend', '<br>' + o.innerHTML);
        y(e);
      }
    }
    this.setCursorPosition(n, e);
  };
  s.prototype.setCursorPosition = function (e, t) {
    var i = false;
    var n = this.parent.editableElement.querySelector('.tempSpan');
    var r = n.parentElement;
    n.parentNode.textContent === ''
      ? (i = true)
      : this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, n, 0);
    if (e)
      if (i)
        n.parentElement === t
          ? (this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, n, 0), y(n))
          : this.focusSelectionParent(n, n.parentElement);
      else {
        var o = E('br');
        this.parent.domNode.insertAfter(o, n);
        this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, n, 0);
        y(n);
      }
    else i ? this.focusSelectionParent(n, n.parentElement) : y(n);
  };
  s.prototype.focusSelectionParent = function (e, t) {
    y(e);
    t.innerHTML = '\u200B';
    this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, t, 0);
  };
  s.prototype.insertMarker = function (e, t) {
    var i = E('span', { className: 'tempSpan' });
    t.startContainer.nodeName === 'PRE'
      ? e.childNodes[t.endOffset].parentElement.insertBefore(i, e.childNodes[t.endOffset])
      : t.startContainer.parentElement.insertBefore(i, t.startContainer);
  };
  s.prototype.applyFormats = function (e) {
    var t = this.parent.nodeSelection.getRange(this.parent.currentDocument);
    var i = this.parent.nodeSelection.processedTableImageCursor(t);
    if (
      (i.start || i.end) &&
      e.subCommand.toLowerCase() !== 'blockquote' &&
      (i.startName === 'TABLE' || i.endName === 'TABLE')
    ) {
      var n = i.start ? i.startNode : i.endNode;
      this.applyTableSidesFormat(e, i.start, n);
      return;
    }
    var r = false;
    if (
      this.parent.editableElement === t.endContainer &&
      !p(this.parent.editableElement.children[t.endOffset - 1]) &&
      this.parent.editableElement.children[t.endOffset - 1].tagName === 'TABLE' &&
      !t.collapsed
    ) {
      r = true;
    }
    var o = this.parent.nodeSelection.save(t, this.parent.currentDocument);
    this.parent.domNode.setMarker(o);
    var a = this.parent.domNode.blockNodes(true);
    if (e.enterAction === 'BR') {
      this.setSelectionBRConfig();
      var l = this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument);
      var h = this.parent.nodeSelection.getSelectionNodes(l);
      var c = [];
      if (h.length === 0) {
        h.push(a[0]);
      }
      for (var d = 0; d < h.length; d++) {
        for (var u = h[d], f = void 0; !this.parent.domNode.isBlockNode(u) && u !== this.parent.editableElement; ) {
          f = u;
          u = u.parentElement;
        }
        if (this.parent.domNode.isBlockNode(u) && u === this.parent.editableElement) {
          c.push(f);
        }
      }
      for (var d = 0; d < c.length; d++)
        if (!this.parent.domNode.isBlockNode(c[d])) {
          for (var u = c[d], m = u; u === this.parent.editableElement; ) {
            m = u;
            u = u.parentElement;
          }
          var g = void 0;
          this.parent.domNode.isBlockNode(m.parentElement) && m.parentElement === this.parent.editableElement
            ? ((g = E('div')),
              m.parentElement.insertBefore(g, m),
              g.appendChild(m),
              m.textContent.length === 0 && m.appendChild(E('br')))
            : (g = m);
          for (var b = g.previousSibling; !p(b) && b.nodeName !== 'BR' && !this.parent.domNode.isBlockNode(b); ) {
            g.firstChild.parentElement.insertBefore(b, g.firstChild);
            b = g.previousSibling;
          }
          if (!p(b) && b.nodeName === 'BR') {
            y(b);
          }
          for (var C = g.nextSibling; !p(C) && C.nodeName !== 'BR' && !this.parent.domNode.isBlockNode(C); ) {
            g.appendChild(C);
            C = g.nextSibling;
          }
          if (!p(C) && C.nodeName === 'BR') {
            y(C);
          }
        }
      this.setSelectionBRConfig();
      a = this.parent.domNode.blockNodes();
    }
    for (var N = false, w = false, d = 0; d < a.length; d++)
      if (p(v(a[0], 'blockquote')) || p(v(a[a.length - 1], 'blockquote'))) {
        w = true;
      }
    for (var T = false, d = 0; d < a.length; d++) {
      var S = void 0;
      var O = void 0;
      if (a[d].nodeName !== 'HR') {
        if (e.subCommand.toLowerCase() === 'blockquote') {
          S = this.getParentNode(a[d]);
          e.enterAction === 'BR'
            ? (O = S.innerHTML)
            : !p(v(a[d], 'table')) && this.parent.editableElement.contains(v(a[d], 'table'))
              ? (O = p(v(a[d], 'blockquote')) ? a[d].outerHTML : v(a[d], 'blockquote').outerHTML)
              : (O = S.outerHTML);
        } else {
          var L = a[d];
          a[d] &&
          a[d].tagName === 'PRE' &&
          a[d].firstChild &&
          a[d].firstChild.nodeName === 'CODE' &&
          a[d].hasAttribute('data-language')
            ? ((S = a[d]), (O = S.querySelector('code').innerHTML))
            : ((S = a[d]), (O = S.innerHTML));
        }
        var A =
          S.tagName === 'PRE' && S.firstChild && S.firstChild.nodeName === 'CODE' && S.hasAttribute('data-language');
        if (
          !(
            !A &&
            ((e.subCommand.toLowerCase() === 'blockquote' &&
              e.subCommand.toLowerCase() === S.tagName.toLowerCase() &&
              w) ||
              (e.subCommand.toLowerCase() === S.tagName.toLowerCase() &&
                ((e.subCommand.toLowerCase() !== 'pre' && e.subCommand.toLowerCase() !== 'blockquote') ||
                  (!p(e.exeValue) && e.exeValue.name === 'dropDownSelect'))) ||
              p(S.parentNode) ||
              (S.tagName === 'TABLE' && e.subCommand.toLowerCase() === 'pre'))
          )
        ) {
          this.cleanFormats(S, e.subCommand);
          var k = e.subCommand.toLowerCase() === 'pre' && S.tagName.toLowerCase() === 'pre' && !A ? 'p' : e.subCommand;
          var P =
            e.subCommand.toLowerCase() === S.tagName.toLowerCase() &&
            e.subCommand.toLowerCase() === 'blockquote' &&
            !p(v(a[d], 'li'));
          var I = S.tagName === 'TABLE' ? (p(v(a[d], 'blockquote')) ? S : v(a[d], 'blockquote')) : S;
          T = e.subCommand.toLowerCase() === I.tagName.toLowerCase() && e.subCommand.toLowerCase() === 'blockquote';
          var H = void 0;
          var U = this.getNode(a[d]);
          var Q = this.getNode(a[a.length - 1]);
          var K = void 0;
          !p(v(a[d], 'table')) && (!p(v(a[d], 'td')) || !p(v(a[d], 'th')))
            ? (K = this.hasOnlyBlockquotes(v(a[d], 'td') || v(a[d], 'th')))
            : (K = T && S.firstChild === U && S.lastChild === Q);
          K
            ? (H = O.replace(/<blockquote[^>]*>|<\/blockquote>/g, ''))
            : P
              ? ((N = true),
                d === 0 && this.createBlockquoteSpan('e-rte-blockquote-close', U, 'before'),
                d === a.length - 1 && this.createBlockquoteSpan('e-rte-blockquote-open', Q, 'after'))
              : T && v(a[0], 'blockquote') && v(a[a.length - 1], 'blockquote')
                ? ((N = true),
                  d === 0 && this.createBlockquoteSpan('e-rte-blockquote-close', a[d], 'before'),
                  d === a.length - 1 && this.createBlockquoteSpan('e-rte-blockquote-open', a[d], 'after'))
                : S &&
                    S.tagName === 'PRE' &&
                    S.firstChild &&
                    S.firstChild.nodeName === 'CODE' &&
                    S.hasAttribute('data-language')
                  ? (H = this.parent.domNode.createTagString(k, null, O.replace(/>\s+</g, '><')))
                  : (H = this.parent.domNode.createTagString(
                      k,
                      e.subCommand.toLowerCase() === 'blockquote' ? null : S,
                      O.replace(/>\s+</g, '><'),
                    ));
          if (S.tagName === 'LI') {
            for (var Z = S.firstChild, G = [], j = false, $ = 0, R = Array.from(S.childNodes); $ < R.length; $++) {
              var z = R[$];
              var ce = R[$].nodeName.toLowerCase();
              ce === 'ul' || ce === 'ol' ? (j = true) : G.push(R[$]);
            }
            if (j) {
              for (var F = document.createElement('div'), re = 0, _e = G; re < _e.length; re++) {
                var z = _e[re];
                F.appendChild(_e[re].cloneNode(true));
                if (Z !== _e[re]) {
                  S.removeChild(_e[re]);
                }
              }
              if (a[d + 1] && a[d + 1].textContent === F.textContent) {
                F = a[d + 1];
              }
              H = this.parent.domNode.createTagString(
                k,
                e.subCommand.toLowerCase() === 'blockquote' ? null : F,
                F.innerHTML.replace(/>\s+</g, '><'),
              );
              var $e = document.createElement('div');
              $e.innerHTML = H;
              S.replaceChild($e.firstChild, Z);
            } else {
              S.innerHTML = '';
              S.insertAdjacentHTML('beforeend', H);
            }
          } else if (!N) {
            var vt =
              !p(v(a[d], 'table')) && this.parent.editableElement.contains(v(a[d], 'table'))
                ? p(v(a[d], 'blockquote'))
                  ? a[d]
                  : v(a[d], 'blockquote')
                : S;
            this.parent.domNode.replaceWith(vt, H);
          }
        }
      }
    }
    if (N)
      for (
        var be = this.parent.editableElement.querySelectorAll('.e-rte-blockquote-open, .e-rte-blockquote-close'), d = 0;
        d < be.length;
        d++
      ) {
        var Ee = be[d].parentElement;
        var Ce = be[d].parentElement.innerHTML;
        Ce = Ce.replace(/<span class="e-rte-blockquote-open"><\/span>/g, '<blockquote>');
        Ce = Ce.replace(/<span class="e-rte-blockquote-close"><\/span>/g, '</blockquote>');
        if (be[0].parentElement === be[1].parentElement) {
          this.parent.domNode.replaceWith(
            be[d].parentElement,
            this.parent.domNode.openTagString(be[d].parentElement) +
              Ce.trim() +
              this.parent.domNode.closeTagString(be[d].parentElement),
          );
          break;
        } else
          d === be.length - 1 && !p(be[d]) && !p(be[d - 1]) && be[d].parentElement !== be[d - 1].parentElement
            ? this.parent.domNode.replaceWith(be[d].parentElement, Ce.trim())
            : this.parent.domNode.replaceWith(
                be[d].parentElement,
                this.parent.domNode.openTagString(be[d].parentElement) +
                  Ce.trim() +
                  this.parent.domNode.closeTagString(be[d].parentElement),
              );
      }
    this.preFormatMerge();
    this.blockquotesFormatMerge(e.enterAction);
    var Ue = this.parent.editableElement.querySelector('.e-editor-select-start');
    var Ne = this.parent.editableElement.querySelector('.e-editor-select-end');
    if (!p(Ue) && !p(Ne)) {
      Ue = Ue.lastChild;
      Ne = Ne.lastChild;
    }
    o = this.parent.domNode.saveMarker(o);
    if (W()) {
      Xe(this.parent.editableElement, e.selector);
    }
    if (r) this.parent.nodeSelection.setSelectionText(this.parent.currentDocument, Ue, Ne, 0, Ne.textContent.length);
    else if (i.start && e.subCommand.toLowerCase() === 'blockquote') {
      var Bt = o.range.startContainer.childNodes[T ? o.range.startOffset - 1 : o.range.startOffset];
      if (T) {
        var ii = o.range.startContainer.childNodes[T ? o.range.startOffset - 1 : o.range.startOffset].parentElement;
        var Tn = Array.prototype.indexOf.call(
          o.range.startContainer.childNodes[T ? o.range.startOffset - 1 : o.range.startOffset].parentElement.childNodes,
          o.range.startContainer.childNodes[T ? o.range.startOffset - 1 : o.range.startOffset],
        );
        this.parent.nodeSelection.setSelectionText(
          this.parent.currentDocument,
          o.range.startContainer.childNodes[T ? o.range.startOffset - 1 : o.range.startOffset].parentElement,
          o.range.startContainer.childNodes[T ? o.range.startOffset - 1 : o.range.startOffset].parentElement,
          Tn,
          Tn,
        );
      } else
        this.parent.nodeSelection.setSelectionText(
          this.parent.currentDocument,
          o.range.startContainer.childNodes[T ? o.range.startOffset - 1 : o.range.startOffset],
          o.range.startContainer.childNodes[T ? o.range.startOffset - 1 : o.range.startOffset],
          0,
          0,
        );
    } else o.restore();
    if (e.callBack) {
      e.callBack({
        requestType: e.subCommand,
        editorMode: 'HTML',
        event: e.event,
        range: this.parent.nodeSelection.getRange(this.parent.currentDocument),
        elements: this.parent.domNode.blockNodes(),
      });
    }
  };
  s.prototype.hasOnlyBlockquotes = function (e) {
    for (var t = false, i = 0; i < e.childNodes.length; i++) {
      var n = e.childNodes[i];
      if (e.childNodes[i].nodeType === Node.TEXT_NODE) {
        var r = e.childNodes[i].textContent.replace(/[\u200B\u200C\u200D]/g, '').trim();
        if (r !== '') return false;
      } else if (e.childNodes[i].nodeType === Node.ELEMENT_NODE)
        if (e.childNodes[i].tagName === 'BLOCKQUOTE') t = true;
        else return false;
    }
    return t;
  };
  s.prototype.getNode = function (e) {
    if (e.nodeName === 'BLOCKQUOTE') {
      e = e.firstChild;
      return e;
    }
    for (; e.parentNode && e.parentNode.nodeName !== 'BLOCKQUOTE'; null) e = e.parentNode;
    return e;
  };
  s.prototype.createBlockquoteSpan = function (e, t, i) {
    var n = E('span');
    n.classList.add(e);
    i === 'before' ? t.parentNode.insertBefore(n, t) : this.parent.domNode.insertAfter(n, t);
    return n;
  };
  s.prototype.setSelectionBRConfig = function () {
    var e = this.parent.editableElement.querySelector('.e-editor-select-start');
    var t = this.parent.editableElement.querySelector('.e-editor-select-end');
    p(t)
      ? this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, e, 0)
      : this.parent.nodeSelection.setSelectionText(this.parent.currentDocument, e, t, 0, 0);
  };
  s.prototype.preFormatMerge = function () {
    var e = this.parent.editableElement.querySelectorAll('PRE:not([data-language])');
    if (!p(e))
      for (var t = 0; t < e.length; t++) {
        var i = e[t].previousElementSibling;
        if (!p(e[t].previousElementSibling) && e[t].previousElementSibling.tagName === 'PRE') {
          e[t].previousElementSibling.insertAdjacentHTML('beforeend', '<br>' + e[t].innerHTML);
          y(e[t]);
        }
      }
  };
  s.prototype.blockquotesFormatMerge = function (e) {
    var t = this.parent.editableElement.querySelectorAll('BLOCKQUOTE');
    if (!p(t))
      for (var i = 0; i < t.length; i++) {
        if (t[i].innerHTML.trim() === '') {
          y(t[i]);
        }
        var n = t[i].previousElementSibling;
        if (!p(t[i].previousElementSibling) && t[i].previousElementSibling.tagName === 'BLOCKQUOTE') {
          t[i].previousElementSibling.insertAdjacentHTML('beforeend', (e === 'BR' ? '<br>' : '') + t[i].innerHTML);
          y(t[i]);
        }
      }
  };
  s.prototype.cleanFormats = function (e, t) {
    var i = ['display', 'font-size', 'margin-top', 'margin-bottom', 'margin-left', 'margin-right', 'font-weight'];
    t = t.toLowerCase();
    for (var n = 0; n < i.length && t !== 'p' && t !== 'blockquote' && t !== 'pre'; n++) e.style.removeProperty(i[n]);
  };
  s.prototype.applyTableSidesFormat = function (e, t, i) {
    var n = E(e.subCommand);
    if (e.enterAction !== 'BR') {
      n.appendChild(E('br'));
    }
    i.insertAdjacentElement(t ? 'beforebegin' : 'afterend', n);
    this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, n, 0);
    if (e.callBack) {
      e.callBack({
        requestType: e.subCommand,
        editorMode: 'HTML',
        event: e.event,
        range: this.parent.nodeSelection.getRange(this.parent.currentDocument),
        elements: this.parent.domNode.blockNodes(),
      });
    }
  };
  s.prototype.destroy = function () {
    this.removeEventListener();
  };
  return s;
})();
var ns = (function () {
  function s(e) {
    this.alignments = {
      JustifyLeft: 'left',
      JustifyCenter: 'center',
      JustifyRight: 'right',
      JustifyFull: 'justify',
    };
    this.parent = e;
    this.addEventListener();
  }
  s.prototype.addEventListener = function () {
    this.parent.observer.on(Li, this.applyAlignment, this);
    this.parent.observer.on(ae, this.onKeyDown, this);
    this.parent.observer.on(J, this.destroy, this);
  };
  s.prototype.removeEventListener = function () {
    this.parent.observer.off(Li, this.applyAlignment);
    this.parent.observer.off(ae, this.onKeyDown);
    this.parent.observer.off(J, this.destroy);
  };
  s.prototype.onKeyDown = function (e) {
    switch (e.event.action) {
      case 'justify-center':
        {
          this.applyAlignment({
            subCommand: 'JustifyCenter',
            callBack: e.callBack,
          });
          e.event.preventDefault();
        }
        break;
      case 'justify-full':
        {
          this.applyAlignment({
            subCommand: 'JustifyFull',
            callBack: e.callBack,
          });
          e.event.preventDefault();
        }
        break;
      case 'justify-left':
        {
          this.applyAlignment({
            subCommand: 'JustifyLeft',
            callBack: e.callBack,
          });
          e.event.preventDefault();
        }
        break;
      case 'justify-right':
        {
          this.applyAlignment({
            subCommand: 'JustifyRight',
            callBack: e.callBack,
          });
          e.event.preventDefault();
        }
        break;
    }
  };
  s.prototype.getTableNode = function (e) {
    var t = e.startContainer.nodeType === Node.ELEMENT_NODE ? e.startContainer : e.startContainer.parentNode;
    var i = v(t, 'td,th');
    return [i];
  };
  s.prototype.applyAlignment = function (e) {
    var t = e.value === 'Table';
    var i = this.parent.nodeSelection.getRange(this.parent.currentDocument);
    var n = this.parent.nodeSelection.save(i, this.parent.currentDocument);
    if (t) {
      var c = this.parent.editableElement.querySelectorAll('.e-cell-select');
      if (c.length > 0) for (var o = 0; o < c.length; o++) le(c[o], { 'text-align': this.alignments[e.subCommand] });
      else le(this.getTableNode(i)[0], { 'text-align': this.alignments[e.subCommand] });
    } else {
      this.parent.domNode.setMarker(n);
      var r = this.parent.domNode.blockNodes();
      if (e.enterAction === 'BR') {
        r = this.parent.domNode.convertToBlockNodes(r, false);
      }
      for (var o = 0; o < r.length; o++) {
        var a = r[o];
        le(r[o], { 'text-align': this.alignments[e.subCommand] });
      }
      for (var l = this.parent.domNode.getImageTagInSelection(), o = 0; o < l.length; o++) {
        var h = [];
        h.push(l[o]);
        this.parent.imgObj.imageCommand({
          item: { selectNode: h },
          subCommand: e.subCommand,
          value: e.subCommand,
          callBack: e.callBack,
          selector: e.selector,
        });
      }
      this.parent.editableElement.focus({ preventScroll: true });
      n = this.parent.domNode.saveMarker(n);
      if (W()) {
        Xe(this.parent.editableElement, e.selector);
      }
      n.restore();
    }
    if (e.callBack) {
      e.callBack({
        requestType: e.subCommand,
        editorMode: 'HTML',
        event: e.event,
        range: this.parent.nodeSelection.getRange(this.parent.currentDocument),
        elements: t ? this.getTableNode(i) : this.parent.domNode.blockNodes(),
      });
    }
  };
  s.prototype.destroy = function () {
    this.removeEventListener();
  };
  return s;
})();
var rs = (function () {
  function s(e) {
    this.indentValue = 20;
    this.parent = e;
    this.addEventListener();
  }
  s.prototype.addEventListener = function () {
    this.parent.observer.on(Ei, this.applyIndents, this);
    this.parent.observer.on(ae, this.onKeyDown, this);
    this.parent.observer.on(J, this.destroy, this);
  };
  s.prototype.removeEventListener = function () {
    this.parent.observer.off(Ei, this.applyIndents);
    this.parent.observer.off(ae, this.onKeyDown);
    this.parent.observer.off(J, this.destroy);
  };
  s.prototype.onKeyDown = function (e) {
    switch (e.event.action) {
      case 'indents':
        {
          this.applyIndents({
            subCommand: 'Indent',
            callBack: e.callBack,
          });
          e.event.preventDefault();
        }
        break;
      case 'outdents':
        {
          this.applyIndents({
            subCommand: 'Outdent',
            callBack: e.callBack,
          });
          e.event.preventDefault();
        }
        break;
    }
  };
  s.prototype.applyIndents = function (e) {
    var t = this.parent.editableElement;
    var i = this.parent.editableElement.classList.contains('e-rtl');
    var n = this.parent.nodeSelection.getRange(this.parent.currentDocument);
    if (!p(this.parent.codeBlockObj)) {
      var r = this.parent.codeBlockObj.isSelectionWithinCodeBlock(n, n.startContainer, n.endContainer);
      if (r) {
        this.parent.observer.notify(io, {
          e,
          event: e.event,
          subCommand: e.subCommand,
          callBack: e.callBack,
        });
        return;
      }
    }
    var o = this.parent.nodeSelection.save(n, this.parent.currentDocument);
    this.parent.domNode.setMarker(o);
    var a = this.parent.domNode.blockNodes();
    if (e.enterAction === 'BR') {
      a = this.parent.domNode.convertToBlockNodes(a, false);
    }
    for (var l = a.slice(), h = [], c = 0; c < l.length; c++)
      l[c].tagName !== 'LI' && l[c].parentNode.tagName === 'LI'
        ? (a.splice(a.indexOf(l[c]), 1), h.push(l[c].parentNode))
        : l[c].tagName === 'LI' && (a.splice(a.indexOf(l[c]), 1), h.push(l[c]));
    if (h.length > 0) {
      this.parent.observer.notify(ae, {
        event: {
          preventDefault: function () {},
          stopPropagation: function () {},
          shiftKey: e.subCommand !== 'Indent',
          which: 9,
          action: 'indent',
        },
      });
    }
    for (var c = 0; c < a.length; c++) {
      var d = a[c];
      var u = i ? a[c].style.marginRight : a[c].style.marginLeft;
      var f = void 0;
      if (a[c].tagName !== 'HR') {
        e.subCommand === 'Indent'
          ? ((f = u === '' ? this.indentValue + 'px' : parseInt(u, null) + this.indentValue + 'px'),
            i ? (a[c].style.marginRight = f) : (a[c].style.marginLeft = f))
          : ((f =
              u === '' || u === '0px' || u === '0in'
                ? ''
                : parseInt(u, null) - this.indentValue < 0
                  ? '0px'
                  : parseInt(u, null) - this.indentValue + 'px'),
            i ? (a[c].style.marginRight = f) : (a[c].style.marginLeft = f));
      }
    }
    this.parent.editableElement.focus({ preventScroll: true });
    if (W()) {
      Xe(this.parent.editableElement, e.selector);
    }
    if (a.length === 0 || (a[0] && a[0].nodeName !== 'TABLE')) {
      o = this.parent.domNode.saveMarker(o);
      o.restore();
    }
    if (e.callBack) {
      e.callBack({
        requestType: e.subCommand,
        editorMode: 'HTML',
        event: e.event,
        range: this.parent.nodeSelection.getRange(this.parent.currentDocument),
        elements: this.parent.domNode.blockNodes(),
      });
    }
  };
  s.prototype.destroy = function () {
    this.removeEventListener();
  };
  return s;
})();
var Nr = (function () {
  function s() {}
  s.applyFormat = function (e, t, i, n, r, o, a, l) {
    this.enterAction = n;
    var h = [
      'bold',
      'italic',
      'underline',
      'strikethrough',
      'superscript',
      'subscript',
      'uppercase',
      'lowercase',
      'fontcolor',
      'fontname',
      'fontsize',
      'backgroundcolor',
      'inlinecode',
    ];
    if (h.indexOf(t) > -1 || o === 'formatPainter') {
      if (t === 'backgroundcolor' && o === '') {
        o = 'transparent';
      }
      var c = new Se(i);
      var d = new ei(i, e);
      var u = new gt();
      var f = new qe();
      var m = c.getRange(e);
      if (
        m.collapsed &&
        m.startContainer === m.endContainer &&
        m.startContainer === c.editableElement &&
        !p(m.startContainer.firstChild)
      ) {
        var g = e.createRange();
        m.setStart(m.startContainer.firstChild, 0);
        m.collapse(true);
        c.setRange(e, g);
      }
      var b = 0;
      var C = m.startContainer.parentElement;
      if (
        m.collapsed &&
        !p(m.startContainer.parentElement) &&
        m.startContainer.parentElement.tagName === 'A' &&
        (m.startOffset === m.startContainer.parentElement.textContent.length || m.startOffset === 0)
      ) {
        var N = document.createTextNode('');
        m.startOffset === 0
          ? m.startContainer.parentElement.parentNode.insertBefore(N, m.startContainer.parentElement)
          : p(m.startContainer.parentElement.nextSibling)
            ? m.startContainer.parentElement.parentNode.appendChild(N)
            : m.startContainer.parentElement.parentElement.insertBefore(N, m.startContainer.parentElement.nextSibling);
        var w = e.createRange();
        m.setStart(N, 0);
        m.setEnd(N, 0);
        m.collapse(true);
        c.setRange(e, w);
      }
      if (
        M.userAgent.indexOf('Firefox') !== -1 &&
        m.startContainer === m.endContainer &&
        !p(i) &&
        m.startContainer === i
      ) {
        for (
          var T = m.startContainer.childNodes,
            S = T[m.startOffset > 0 ? m.startOffset - 1 : m.startOffset] || m.startContainer,
            O = m.endContainer.childNodes[m.endOffset > 0 ? m.endOffset - 1 : m.endOffset] || m.endContainer,
            L =
              O.lastChild.nodeName === 'BR'
                ? p(O.lastChild.previousSibling)
                  ? O
                  : O.lastChild.previousSibling
                : O.firstChild;
          !p(L) && L.nodeName !== '#text' && L.nodeName !== 'IMG' && L.nodeName !== 'BR' && L.nodeName !== 'HR';

        )
          L = L.lastChild;
        c.setSelectionText(e, S, L, 0, 0);
        m = c.getRange(e);
      }
      var A = c.save(m, e);
      var k = void 0;
      var P = false;
      if (i && r && i.nodeName !== '#text') {
        k = r.getTextNodes();
      }
      k && k.length > 0
        ? (P = true)
        : (k = m.collapsed ? c.getSelectionNodeCollection(m) : c.getSelectionNodeCollectionBr(m));
      var I = false;
      var H = false;
      var U = false;
      var Q = false;
      var K = ['fontcolor', 'fontname', 'fontsize', 'backgroundcolor'].indexOf(t) > -1;
      var Z = false;
      var G = void 0;
      if (s.userAgentData.isSafari() && k.length > 0) {
        G = s.isMentionStartOrEnd(i, k[0], k[k.length - 1]);
        Z = G !== 'None';
      }
      if (!P && m.collapsed) {
        var j = f.getFormattedNode(m.startContainer, t, i);
        var $ = p(j)
          ? null
          : j.getAttribute('style') === null
            ? j.nodeName
            : j.nodeName + "[style='" + j.getAttribute('style') + "']";
        if (k.length > 0) {
          I = true;
          m = u.GetCursorRange(e, m, k[0]);
        } else if (
          m.startContainer.nodeType === 3 &&
          ((m.startContainer.parentElement.childElementCount > 0 &&
            m.startOffset > 0 &&
            m.startContainer.parentElement.firstElementChild.tagName.toLowerCase() !== 'br') ||
            (!p(j) &&
              j === m.startContainer.parentElement.closest($) &&
              m.startContainer.parentElement.closest($).textContent.replace(new RegExp('\u200B', 'g'), '').trim()
                .length !== 0))
        ) {
          I = true;
          m = u.GetCursorRange(e, m, m.startContainer);
          k.push(m.startContainer);
        } else {
          var R = this.insertCursorNode(e, c, m, f, u, t, o, i);
          c.endContainer = c.startContainer = c.getNodeArray(R, true);
          var z = R.nodeName === 'BR' && R.parentNode.childNodes;
          !p(z) && z.length === 1 && z[0].nodeName === 'BR' && k.length === 0
            ? (c.setSelectionText(e, m.startContainer, m.endContainer, 0, 0), (Q = true))
            : (c.endOffset = c.startOffset = 1);
          if (R.nodeName === 'BR' && R.parentNode.textContent.length === 0) {
            Q = true;
          }
        }
      }
      U = P ? false : m.collapsed;
      for (var ce = false, F = 0; F < k.length; F++) {
        var re = f.getFormattedNode(k[F], t, i);
        if (re === null) {
          t === 'subscript'
            ? ((re = f.getFormattedNode(k[F], 'superscript', i)), (ce = re !== null))
            : t === 'superscript' && ((re = f.getFormattedNode(k[F], 'subscript', i)), (ce = re !== null));
        }
        if (F === 0 && re === null) {
          H = true;
        }
        if (re !== null && (!H || K)) {
          k[F] = this.removeFormat(k, F, re, U, P, H, K, m, u, t, o, c, i, d);
        }
        if (re === null) {
          k[F] = this.insertFormat(e, k, F, re, U, P, H, K, m, u, t, o, l, d, i);
          b++;
        }
        if (k.length === b) {
          this.isWrapped = true;
        }
        if (!(P || Z)) {
          c = this.applySelection(k, c, u, F, I);
        }
      }
      if (W()) {
        Xe(i, a);
      }
      if (!Q && !P) {
        A.restore();
      }
      if (ce) {
        this.applyFormat(e, t, i, n, r);
      }
    }
  };
  s.insertCursorNode = function (e, t, i, n, r, o, a, l) {
    var h = t.getNodeCollection(i);
    var c = new ei(l, e);
    var d =
      h.length > 0
        ? h.length > 1 && i.startContainer === i.endContainer
          ? this.getCursorFormat(n, h, o, l)
          : a === '' &&
              o === 'fontsize' &&
              n.getFormattedNode(h[0], o, l) == null &&
              h[0].parentElement.nodeName === 'SPAN'
            ? h[0].parentElement
            : n.getFormattedNode(h[0], o, l)
        : null;
    var u = null;
    if (d) {
      u = h[0];
      if (d.firstChild.textContent.charCodeAt(0) === 8203 && d.firstChild.nodeType === 3) {
        var f = new RegExp('\u200B', 'g');
        var m = void 0;
        if (u.nodeName !== '#text')
          for (var g = 0; g < h.length; g++)
            if (h[g].nodeType === Node.TEXT_NODE) {
              u = h[g];
            }
        d.firstChild === u
          ? ((u.textContent =
              d.parentElement &&
              (c.isBlockNode(d.parentElement) && d.parentElement.textContent.length <= 1
                ? d.parentElement.childElementCount > 1
                : d.childElementCount === 0) &&
              (d.parentElement.textContent.length > 1 ||
                (d.parentElement.firstChild && d.parentElement.firstChild.nodeType === 1))
                ? u.textContent
                : u.textContent.replace(f, '')),
            (m = u))
          : ((d.firstChild.textContent = d.firstChild.textContent.replace(f, '')), (m = d.firstChild));
        var b = void 0;
        if (m.textContent.length === 0) {
          if (!p(m.previousSibling)) {
            u = m.previousSibling;
            b = m.textContent.length - 1;
            t.setCursorPoint(e, m, b);
          } else if (!p(m.parentElement) && m.parentElement.textContent.length === 0) {
            var C = document.createElement('BR');
            m.parentElement.appendChild(C);
            y(m);
            u = C;
            t.setCursorPoint(e, u.parentElement, 0);
          }
        }
      }
      ['fontcolor', 'fontname', 'fontsize', 'backgroundcolor'].indexOf(o) > -1
        ? (o === 'fontcolor'
            ? (d.style.color = a)
            : o === 'fontname'
              ? (d.style.fontFamily = a)
              : o === 'fontsize'
                ? (d.style.fontSize = a)
                : (d.style.backgroundColor = a),
          (u = d))
        : (V.unwrap(d), t.setCursorPoint(e, u, 0));
    } else {
      if (
        h.length > 1 &&
        i.startOffset > 0 &&
        h[0].firstElementChild &&
        h[0].firstElementChild.tagName.toLowerCase() === 'br'
      ) {
        h[0].innerHTML = '';
      }
      if (
        h.length === 1 &&
        i.startOffset === 0 &&
        (h[0].nodeName === 'BR' || (!p(h[0].nextSibling) && h[0].nextSibling.nodeName === 'BR'))
      ) {
        y(h[0].nodeName === '#text' ? h[0].nextSibling : h[0]);
      }
      if (
        !p(h[0] && h[0].parentElement) &&
        qe.inlineTags.indexOf(h[0].parentElement.tagName.toLowerCase()) !== -1 &&
        h[0].textContent.includes('\u200B')
      ) {
        var N = this.GetFormatNode(o, a);
        var w = h[0];
        if (o === 'fontsize')
          for (var T = h[0]; T; ) {
            var S = T.parentElement.textContent.trim() === h[0].textContent.trim();
            var O = T.parentElement;
            if (
              !c.isBlockNode(T.parentElement) &&
              S &&
              !(T.parentElement.nodeName === 'SPAN' && T.parentElement.classList.contains('e-img-inner'))
            )
              T = T.parentElement;
            else break;
            h[0] = T;
          }
        this.applyStyles(h, 0, N);
        return h[0];
      }
      u = this.getInsertNode(e, i, o, a).firstChild;
    }
    return u;
  };
  s.getCursorFormat = function (e, t, i, n) {
    for (var r, o = 0; o < t.length; o++) r = t[o].lastElementChild ? t[o].lastElementChild : t[o];
    return i === 'fontsize' && e.getFormattedNode(r, i, n) == null && r.parentElement.nodeName === 'SPAN'
      ? r.parentElement
      : e.getFormattedNode(r, i, n);
  };
  s.removeFormat = function (e, t, i, n, r, o, a, l, h, c, d, u, f, m) {
    var g = null;
    var b =
      l.startContainer.nodeName === '#text'
        ? l.startContainer.textContent.substring(l.startOffset, l.startContainer.textContent.length)
        : l.startContainer.textContent;
    var C = e[t].textContent;
    var N = e[0].parentElement.nodeName === e[0].parentElement.parentElement.nodeName;
    if (
      l.startContainer === l.endContainer &&
      l.startOffset === 0 &&
      l.endOffset === l.startContainer.length &&
      (l.startContainer.textContent === i.textContent || N)
    ) {
      if (a && !e[t].contains(i) && e[t].nodeType === 3 && e[t].textContent !== i.textContent) {
        for (
          var A = e[t].textContent === e[t].wholeText, k = e[t], P = this.GetFormatNode(c, d);
          k && k.textContent === k.parentElement.textContent;

        )
          k = k.parentElement;
        if (A && i.textContent !== k.textContent) {
          var I = [];
          var H = this.getPriorityFormatNode(k, f);
          if (H && H.textContent === k.textContent) {
            k = H;
          }
          I.push(k);
          this.applyStyles(I, 0, P);
          return e[t];
        }
      }
    } else {
      var w = [];
      var T = e[t];
      var S = T;
      do {
        w.push(u.getIndex(T));
        T = T.parentNode;
      } while (T && T !== i);
      if (e[t].nodeName !== 'BR') {
        if (T.nodeName === '#text' && T.textContent.includes('\u200B')) {
          T.remove();
        }
        if (!r) {
          T = g = n && i.textContent.length - 1 === l.startOffset ? h.SplitNode(l, i, true) : h.GetSpliceNode(l, i);
        }
      }
      if (n) {
        for (var L = g; L.firstChild !== null && L.firstChild.nodeType !== 3; null) L = L.firstChild;
        L.innerHTML = '&#8203;';
        e[t] = L.firstChild;
      } else {
        for (; T && T.childNodes.length > 0 && w.length - 1 >= 0 && T.childNodes.length > w[w.length - 1]; )
          if (T.childNodes.length > 1 && w.length > 1) {
            T = T.childNodes[w[w.length - 2]];
            break;
          } else {
            T = T.childNodes[w[w.length - 1]];
            w.pop();
          }
        if (e[t].nodeName !== 'BR') {
          for (; T.nodeType === 1 && T.childNodes.length > 0; ) T = T.childNodes[0];
          if (T.nodeType === 3 && !(n && T.nodeValue === '')) e[t] = T;
          else {
            var O = document.createElement('div');
            O.innerHTML = '&#8203;';
            T.nodeType !== 3
              ? (T.insertBefore(O.firstChild, T.firstChild), (e[t] = T.firstChild))
              : (T.parentNode.insertBefore(O.firstChild, T), (e[t] = T.previousSibling), T.parentNode.removeChild(T));
          }
        }
      }
    }
    var U;
    if (c === 'backgroundcolor') {
      U = i.style.fontSize;
    }
    var Q;
    if (c === 'fontsize') {
      var K = v(e[t].parentElement, 'span[style*=background-color]');
      if (!p(K)) {
        Q = K.style.backgroundColor;
      }
    }
    var Z = i.getAttribute('style');
    var G = i.tagName;
    var j;
    if (i.tagName === 'A' && c === 'underline') {
      i.style.textDecoration = 'none';
      j = [i];
    } else if (qe.inlineTags.indexOf(i.tagName.toLowerCase()) !== -1 && a && i.tagName.toLocaleLowerCase() !== 'span') {
      var $ = i.style;
      $.color && c === 'fontcolor'
        ? i.nodeName === 'A'
          ? ($.color = d)
          : ($.color = '')
        : $.backgroundColor && c === 'backgroundcolor'
          ? ($.backgroundColor = '')
          : $.fontSize && c === 'fontsize'
            ? ($.fontSize = '')
            : $.fontFamily && c === 'fontname' && ($.fontFamily = '');
      if (i.getAttribute('style') === '') {
        i.removeAttribute('style');
      }
      j = [i];
    } else {
      j = V.unwrap(i);
      if (t === 0) {
        this.isUnwrapped = true;
      }
      var R = e[t].parentElement;
      if (!p(R) && R.tagName.toLowerCase() !== 'li') {
        R = v(R, 'li');
      }
      !p(R) &&
      R.tagName.toLowerCase() === 'li' &&
      (R.textContent.trim() === e[t].textContent.trim() ||
        (R.innerText.split(`
`).length === e.length &&
          R.innerText.split(`
`)[0] === e[t].textContent.trim()))
        ? c === 'bold'
          ? (R.style.fontWeight = '')
          : c === 'italic'
            ? (R.style.fontStyle = '')
            : c === 'fontsize' && (R.style.fontSize = '')
        : !p(R) &&
          R.tagName.toLowerCase() === 'li' &&
          R.textContent.trim() !== e[t].textContent.trim() &&
          (c === 'bold' ? (R.style.fontWeight = '') : c === 'italic' && (R.style.fontStyle = ''),
          s.conCatenateTextNode(R, c, '', 'normal', d));
    }
    if (j[0] && !a)
      for (var k = j[t] ? j[t] : j[0], z = k; k && k.parentElement && k.parentElement !== f; k = k) {
        var ce = void 0;
        i.nodeName === 'SPAN'
          ? (ce =
              k.parentElement.tagName.toLocaleLowerCase() === i.tagName.toLocaleLowerCase() &&
              k.parentElement.getAttribute('style') === Z)
          : (ce = k.parentElement.tagName.toLocaleLowerCase() === i.tagName.toLocaleLowerCase());
        if (k.parentElement && ce && k.parentElement.childElementCount > 0) {
          if (
            z.parentElement &&
            z.parentElement.tagName.toLocaleLowerCase() === i.tagName.toLocaleLowerCase() &&
            l.startContainer === l.endContainer &&
            z.nodeType !== 1 &&
            !p(z.textContent) &&
            z.parentElement.childElementCount > 1
          ) {
            l.setStart(z, 0);
            l.setEnd(z, z.textContent.length);
            h.SplitNode(l, z.parentElement, false);
          }
          if (
            k.parentElement.tagName.toLocaleLowerCase() === 'span' &&
            i.style.textDecoration === 'underline' &&
            k.parentElement.style.textDecoration !== 'underline'
          ) {
            k = k.parentElement;
            continue;
          }
          V.unwrap(k.parentElement);
          k = !p(k.parentElement) && !m.isBlockNode(k.parentElement) ? z : k.parentElement;
        } else k = k.parentElement;
      }
    if (j.length > 0 && a) {
      for (var F = 0; F < j.length; F++)
        if (
          j[F].nodeType !== 3 ||
          (j[F].textContent && (j[F].textContent.trim().length > 0 || j[F].textContent.includes('\xA0')))
        ) {
          if (d !== '' || (c === 'fontcolor' && d === '')) {
            j[F] = V.Wrap(j[F], this.GetFormatNode(c, d, i.tagName, Z));
          }
          var R = e[t].parentElement;
          if (!p(R) && R.tagName.toLowerCase() !== 'li') {
            R = v(R, 'li');
          }
          if (
            !p(R) &&
            R.tagName.toLowerCase() === 'li' &&
            R.textContent.trim() === e[t].textContent.trim() &&
            c === 'fontname'
          ) {
            R.style.fontFamily = d;
          }
          if (
            !p(R) &&
            R.tagName.toLowerCase() === 'li' &&
            R.textContent.trim() !== e[t].textContent.trim() &&
            c === 'fontname'
          ) {
            R.style.removeProperty('font-family');
          }
          if (
            j[F].textContent === b &&
            (l.startContainer.nodeName === '#text' ||
              (l.startContainer.nodeName !== '#text' &&
                l.startContainer.classList &&
                !l.startContainer.classList.contains('e-multi-cells-select')))
          ) {
            F === 0 ? l.setStartBefore(j[F]) : F === j.length - 1 && l.setEndAfter(j[F]);
          }
        }
      var re = e[t].parentElement;
      if (!p(U) && U !== '') {
        e[t].parentElement.style.fontSize = U;
      }
      if (!p(Q) && Q !== '') {
        e[t].parentElement.style.backgroundColor = Q;
      }
      if (c === 'fontsize' || c === 'fontcolor' || c === 'fontname') {
        for (var R = e[t].parentElement, _e = e[t].parentElement; !p(_e) && _e.tagName.toLowerCase() !== 'li'; ) {
          _e = _e.parentElement;
          R = _e;
        }
        for (
          var F = t, $e = '';
          F >= 0 &&
          !p(R) &&
          R.tagName.toLowerCase() === 'li' &&
          R.contains(e[F]) &&
          R.textContent.replace('/\u200B/g', '').trim().includes(e[F].textContent.trim());

        ) {
          $e = e[F].textContent + $e;
          F--;
        }
        var vt = false;
        var be = 0;
        var Ee = false;
        if (!p(R) && R.childNodes)
          for (var Ce = 0; Ce < R.childNodes.length; Ce++)
            if (R.childNodes[Ce].nodeName === 'OL' || R.childNodes[Ce].nodeName === 'UL') {
              be++;
              vt = true;
            }
        if (
          !p(R) &&
          R.tagName.toLowerCase() === 'li' &&
          R.textContent.split('\u200B').join('').trim() === $e.split('\u200B').join('').trim()
        )
          c === 'fontsize'
            ? (R.style.fontSize = d)
            : c === 'fontname'
              ? R.removeAttribute('style')
              : ((R.style.color = d), (R.style.textDecoration = 'inherit'));
        else if (!p(R) && R.tagName.toLowerCase() === 'li' && vt) {
          if (vt && be > 0)
            for (var Ue = 0; Ue < R.childNodes.length; Ue++)
              if (
                e[t].textContent === R.childNodes[Ue].textContent &&
                e[t].textContent === e[t].textContent &&
                R.textContent.replace('/\u200B/g', '').trim().includes($e.split('\u200B').join('').trim())
              ) {
                Ee = true;
              }
          if (Ee) {
            for (var Ne = 0; Ne < R.childNodes.length; Ne++)
              if (R.childNodes[Ne].nodeName === 'OL' || R.childNodes[Ne].nodeName === 'UL') {
                R.childNodes[Ne].removeAttribute('style');
              }
            c === 'fontsize'
              ? (R.style.fontSize = d)
              : c === 'fontname'
                ? R.removeAttribute('style')
                : ((R.style.color = d), (R.style.textDecoration = 'inherit'));
          }
        }
      }
    }
    return e[t];
  };
  s.insertFormat = function (e, t, i, n, r, o, a, l, h, c, d, u, f, m, g) {
    if (r)
      if (d !== 'uppercase' && d !== 'lowercase') {
        var b = this.getInsertNode(e, h, d, u);
        t[i] = b.firstChild;
        c.position = 1;
      } else c.position = h.startOffset;
    else if ((n === null && a) || l) {
      if (!o && t[i].nodeName !== 'BR') {
        t[i] = c.GetSpliceNode(h, t[i]);
        t[i].textContent = c.TrimLineBreak(t[i].textContent);
      }
      if (d === 'uppercase' || d === 'lowercase')
        t[i].textContent =
          d === 'uppercase' ? t[i].textContent.toLocaleUpperCase() : t[i].textContent.toLocaleLowerCase();
      else if (!(l === true && u === '')) {
        var b = this.GetFormatNode(d, u);
        if (u === 'formatPainter' || l) {
          for (var C = t[i].parentElement, N = t[i].parentElement; !p(N) && N.tagName.toLowerCase() !== 'li'; ) {
            N = N.parentElement;
            C = N;
          }
          if (d === 'fontcolor' || d === 'fontname' || d === 'fontsize') {
            var w = N && N.tagName === 'LI' ? N : t[i].parentElement;
            if (!p(w) && w.childNodes)
              for (var T = 0; T < w.childNodes.length; T++) {
                if (this.concatenateTextExcludingList(t, i) === t[i].textContent) {
                  var S = void 0;
                  w.tagName === 'LI' ? (S = w) : w.closest('li') && (S = w.closest('li'));
                  if (!p(S))
                    switch (d) {
                      case 'fontcolor':
                        S.style.color = u;
                        break;
                      case 'fontname':
                        S.style.fontFamily = u;
                        break;
                      case 'fontsize':
                        S.style.fontSize = u;
                        break;
                    }
                }
                var O = w.childNodes[T];
                if (w.childNodes[T].tagName === 'OL' || w.childNodes[T].tagName === 'UL')
                  switch (d) {
                    case 'fontcolor':
                      w.childNodes[T].style.color = 'initial';
                      break;
                    case 'fontname':
                      w.childNodes[T].style.fontFamily = 'initial';
                      break;
                    case 'fontsize':
                      w.childNodes[T].style.fontSize = 'initial';
                      break;
                  }
              }
          }
          if (!p(C) && C.tagName.toLowerCase() === 'li' && C.textContent.trim() === t[i].textContent.trim()) {
            d === 'fontsize'
              ? (C.style.fontSize = u)
              : d === 'fontcolor'
                ? ((C.style.color = u), (C.style.textDecoration = 'inherit'))
                : d === 'fontname' && (C.style.fontFamily = u);
          }
          if (u === 'formatPainter') return this.insertFormatPainterElem(t, i, h, c, f, m);
          var L = t[i];
          var A = this.getPriorityFormatNode(t[i], g);
          if (!p(A) || l) {
            var k = p(A) ? t[i] : A;
            k = !p(A) && A.style.fontSize !== '' ? k.firstChild : k;
            if (p(A) || d === 'fontsize')
              for (; k; ) {
                var P = k.parentElement.textContent.trim() === t[i].textContent.trim();
                var I = k.parentElement;
                if (
                  !m.isBlockNode(k.parentElement) &&
                  P &&
                  !(k.parentElement.nodeName === 'SPAN' && k.parentElement.classList.contains('e-img-inner'))
                )
                  k = k.parentElement;
                else break;
              }
            var H = [];
            if (l) {
              var U = v(t[i].parentElement, 'A');
              if (!p(U) && U.firstChild.textContent.trim() === t[i].textContent.trim()) {
                k = t[i];
              }
            }
            if (t[i].textContent.trim() !== k.textContent.trim()) {
              k = t[i];
            }
            H[0] = k;
            this.applyStyles(H, 0, b);
            if (!p(C) && C.tagName.toLowerCase() === 'li' && C.textContent.trim() !== t[i].textContent.trim()) {
              s.conCatenateTextNode(C, d, C.textContent, d, u);
            }
          } else t[i] = this.applyStyles(t, i, b);
        } else {
          var C = t[i].parentElement;
          t[i] = this.applyStyles(t, i, b);
          if (!p(C) && C.tagName.toLowerCase() !== 'li') {
            C = v(C, 'li');
          }
          !p(C) &&
          C.tagName.toLowerCase() === 'li' &&
          (C.textContent.trim() === t[i].textContent.trim() ||
            (C.innerText.split(`
`).length === t.length &&
              C.innerText.split(`
`)[0] === t[i].textContent.trim()))
            ? d === 'bold'
              ? (C.style.fontWeight = 'bold')
              : d === 'italic' && (C.style.fontStyle = 'italic')
            : !p(C) &&
              C.tagName.toLowerCase() === 'li' &&
              C.textContent.trim() !== t[i].textContent.trim() &&
              s.conCatenateTextNode(C, d, C.textContent, d);
        }
      }
    } else if (!o && t[i].isConnected) {
      t[i] = c.GetSpliceNode(h, t[i]);
    }
    return t[i];
  };
  s.applyStyles = function (e, t, i) {
    if (!(e[t].nodeName === 'BR' && this.enterAction === 'BR')) {
      e[t] = t === e.length - 1 || e[t].nodeName === 'BR' ? V.Wrap(e[t], i) : V.WrapBefore(e[t], i, true);
      e[t] = this.getChildNode(e[t], i);
    }
    return e[t];
  };
  s.getPriorityFormatNode = function (e, t) {
    var i = new qe();
    var n = i.getFormattedNode(e, 'fontsize', t);
    var r;
    var o;
    var a;
    return p(n)
      ? ((o = i.getFormattedNode(e, 'backgroundcolor', t)),
        p(o)
          ? ((a = i.getFormattedNode(e, 'fontname', t)),
            p(a) ? ((r = i.getFormattedNode(e, 'fontcolor', t)), p(r) ? null : r) : a)
          : o)
      : n;
  };
  s.getInsertNode = function (e, t, i, n) {
    var r = this.GetFormatNode(i, n);
    r.innerHTML = '&#8203;';
    if (M.isIE) {
      var o = e.createDocumentFragment();
      o.appendChild(r);
      t.insertNode(o);
    } else t.insertNode(r);
    return r;
  };
  s.getChildNode = function (e, t) {
    if (e == null) {
      t.innerHTML = '&#8203;';
      e = t.firstChild;
    }
    return e;
  };
  s.applySelection = function (e, t, i, n, r) {
    e.length === 1 && !r
      ? ((t.startContainer = t.getNodeArray(e[n], true)),
        (t.endContainer = t.startContainer),
        (t.startOffset = 0),
        (t.endOffset = e[n].textContent.length))
      : e.length === 1 && r
        ? ((t.startContainer = t.getNodeArray(e[n], true)),
          (t.endContainer = t.startContainer),
          (t.startOffset = i.position),
          (t.endOffset = i.position))
        : n === 0
          ? ((t.startContainer = t.getNodeArray(e[n], true)), (t.startOffset = 0))
          : n === e.length - 1 &&
            ((t.endContainer = t.getNodeArray(e[n], false)), (t.endOffset = e[n].textContent.length));
    return t;
  };
  s.GetFormatNode = function (e, t, i, n) {
    var r;
    switch (e) {
      case 'bold':
        return document.createElement('strong');
      case 'italic':
        return document.createElement('em');
      case 'underline': {
        r = document.createElement('span');
        this.updateStyles(r, i, n);
        r.style.textDecoration = 'underline';
        return r;
      }
      case 'strikethrough': {
        r = document.createElement('span');
        this.updateStyles(r, i, n);
        r.style.textDecoration = 'line-through';
        return r;
      }
      case 'superscript':
        return document.createElement('sup');
      case 'subscript':
        return document.createElement('sub');
      case 'fontcolor': {
        r = document.createElement('span');
        this.updateStyles(r, i, n);
        r.style.color = t;
        r.style.textDecoration = 'inherit';
        return r;
      }
      case 'fontname': {
        r = document.createElement('span');
        this.updateStyles(r, i, n);
        r.style.fontFamily = t;
        return r;
      }
      case 'fontsize': {
        r = document.createElement('span');
        this.updateStyles(r, i, n);
        r.style.fontSize = t;
        return r;
      }
      case 'inlinecode':
        return document.createElement('code');
      default: {
        r = document.createElement('span');
        this.updateStyles(r, i, n);
        r.style.backgroundColor = t;
        return r;
      }
    }
  };
  s.updateStyles = function (e, t, i) {
    if (i !== null && t === 'SPAN') {
      e.style.cssText = i;
    }
  };
  s.insertFormatPainterElem = function (e, t, i, n, r, o) {
    var a = o.isBlockNode(e[t].parentElement) ? e[t] : e[t].parentElement;
    if (!o.isBlockNode(a))
      for (; a.textContent.trim() === a.parentElement.textContent.trim() && !o.isBlockNode(a.parentElement); )
        a = a.parentElement;
    if (
      !p(a) &&
      a.nodeType === 1 &&
      !(a.classList.contains('e-rte-img-caption') || a.classList.contains('e-img-inner'))
    ) {
      this.formatPainterCleanup(t, e, a, i, n, o);
    }
    var l = r.element;
    if (!p(r.element)) {
      var h = r.element.cloneNode(true);
      var c = h.querySelectorAll(r.lastChild.nodeName);
      var d = void 0;
      c.length > 0 ? (d = c[c.length - 1]) : !p(h) && h.nodeName === r.lastChild.nodeName && (d = h);
      d.textContent = e[t].textContent;
      var u = d.childNodes[0];
      e[t] = V.Wrap(e[t], h);
      e[t].textContent = '';
      e[t] = d.childNodes[0];
    }
    return e[t];
  };
  s.formatPainterCleanup = function (e, t, i, n, r, o) {
    var a = ['A', 'AUDIO', 'IMG', 'VIDEO', 'IFRAME'];
    if (e === 0 && i.textContent.trim() !== t[e].textContent.trim()) {
      r.SplitNode(n, i, true);
      for (var l = t[e].parentElement.childNodes, h = 0; h < l.length; h++)
        if (l[h].textContent.trim() === t[h].textContent.trim()) {
          i.parentNode.insertBefore(l[h], i);
          break;
        }
      for (var c = i.parentElement.childNodes, d = 0; d < c.length; d++)
        if (
          (c[d].textContent.trim() === '' || c[d].textContent.length === 0) &&
          c[d].textContent.charCodeAt(0) !== 160
        ) {
          y(c[d]);
        }
    } else if (i.textContent.trim() !== t[e].textContent.trim()) i.parentElement.insertBefore(t[e], i);
    else
      for (; !p(i) && i.nodeType !== 3 && !o.isBlockNode(i); ) {
        for (var u = void 0, h = 0; h < i.childNodes.length; h++) {
          var f = i.childNodes[h];
          if (i.childNodes[h].textContent.trim().length !== 0 && i.childNodes[h].nodeType !== 3) {
            u = i.childNodes[h];
          }
        }
        if (a.indexOf(i.tagName) === -1) {
          V.unwrap(i);
        }
        i = u;
      }
  };
  s.concatenateTextExcludingList = function (e, t) {
    var i = '';
    var n = e[t].nodeName === '#text' ? v(e[t].parentElement, 'li') : v(e[t], 'li');
    if (!p(n))
      for (var r = 0; r < n.childNodes.length; r++) {
        var o = n.childNodes[r];
        if (
          n.childNodes[r].nodeType === 3 ||
          (n.childNodes[r].nodeType === 1 && n.childNodes[r].tagName !== 'OL' && n.childNodes[r].tagName !== 'UL')
        ) {
          i += n.childNodes[r].textContent;
        }
      }
    return i;
  };
  s.conCatenateTextNode = function (e, t, i, n, r) {
    var o = '';
    var a = '';
    var l = '';
    var h = '';
    switch (t) {
      case 'bold':
        {
          e.querySelectorAll('strong').forEach(function (c) {
            o = o + c.textContent;
          });
          if (o === i) {
            e.style.fontWeight = n;
          }
        }
        break;
      case 'italic':
        {
          e.querySelectorAll('em').forEach(function (c) {
            o = o + c.textContent;
          });
          if (o === i) {
            e.style.fontStyle = n;
          }
        }
        break;
      case 'fontcolor':
        {
          e.querySelectorAll('span').forEach(function (c) {
            a = c.style.color;
            if (s.hasColorsEqual(a, r)) {
              o = o + c.textContent;
            }
          });
          if (!p(o) && !p(i) && o !== '' && i !== '' && o.replace(/\s+/g, '') === i.replace(/\s+/g, '')) {
            e.style.color = r;
            e.style.textDecoration = 'inherit';
          }
        }
        break;
      case 'fontsize':
        {
          e.querySelectorAll('span').forEach(function (c) {
            l = c.style.getPropertyValue('font-size');
            if (l === r) {
              o = o + c.textContent;
            }
          });
          if (!p(o) && !p(i) && o !== '' && i !== '' && o.replace(/\s+/g, '') === i.replace(/\s+/g, '')) {
            e.style.fontSize = r;
          }
        }
        break;
      case 'fontname':
        {
          e.querySelectorAll('span').forEach(function (c) {
            h = c.style.getPropertyValue('font-family');
            h = h.replace(/ /g, '');
            if (h === r) {
              o = o + c.textContent;
            }
          });
          if (!p(o) && !p(i) && o !== '' && i !== '' && o.replace(/\s+/g, '') === i.replace(/\s+/g, '')) {
            e.style.fontFamily = r;
          }
        }
        break;
    }
  };
  s.hasColorsEqual = function (e, t) {
    return p(e) || p(t) || e.trim() === '' || t.trim() === ''
      ? e === t
      : (e.startsWith('rgb(') && (e = e.replace('rgb(', 'rgba(').slice(0, -1) + ',1)'),
        t.startsWith('rgb(') && (t = t.replace('rgb(', 'rgba(').slice(0, -1) + ',1)'),
        e.replace(/\s+/g, '') === t.replace(/\s+/g, ''));
  };
  s.isMentionStartOrEnd = function (e, t, i) {
    var n = 'None';
    var r = new Mt(e);
    var o = r.getTopMostNode(t);
    var a = r.getTopMostNode(i);
    if (
      o.nodeType === Node.ELEMENT_NODE &&
      !o.isContentEditable &&
      a.nodeType === Node.ELEMENT_NODE &&
      !a.isContentEditable
    ) {
      n = 'Both';
    }
    if (o.nodeType === Node.ELEMENT_NODE && !o.isContentEditable) {
      n = 'Start';
    }
    if (a.nodeType === Node.ELEMENT_NODE && !a.isContentEditable) {
      n = 'End';
    }
    return n;
  };
  s.enterAction = 'P';
  s.isUnwrapped = false;
  s.isWrapped = false;
  s.userAgentData = new Mr(M.userAgent, false);
  return s;
})();
var os = (function () {
  function s(e) {
    this.parent = e;
    this.addEventListener();
  }
  s.prototype.addEventListener = function () {
    this.parent.observer.on(Ni, this.applySelection, this);
    this.parent.observer.on(ae, this.keyDownHandler, this);
    this.parent.observer.on(J, this.destroy, this);
  };
  s.prototype.removeEventListener = function () {
    this.parent.observer.off(Ni, this.applySelection);
    this.parent.observer.off(ae, this.keyDownHandler);
    this.parent.observer.off(J, this.destroy);
  };
  s.prototype.keyDownHandler = function (e) {
    var t = [
      'bold',
      'italic',
      'underline',
      'strikethrough',
      'superscript',
      'subscript',
      'uppercase',
      'lowercase',
      'inlinecode',
    ];
    if ((e.event.ctrlKey || e.event.metaKey) && t.indexOf(e.event.action) > -1) {
      e.event.preventDefault();
      Nr.applyFormat(
        this.parent.currentDocument,
        e.event.action,
        this.parent.editableElement,
        e.enterAction,
        this.parent.tableCellSelection,
      );
      this.callBack(e, e.event.action);
    }
  };
  s.prototype.applySelection = function (e) {
    Nr.applyFormat(
      this.parent.currentDocument,
      e.subCommand.toLocaleLowerCase(),
      this.parent.editableElement,
      e.enterAction,
      this.parent.tableCellSelection,
      e.value,
      e.selector,
    );
    this.callBack(e, e.subCommand);
  };
  s.prototype.callBack = function (e, t) {
    if (e.callBack) {
      e.callBack({
        requestType: t,
        event: e.event,
        editorMode: 'HTML',
        isKeyboardEvent: e.name === ae,
        range: this.parent.nodeSelection.getRange(this.parent.currentDocument),
        elements: this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument),
      });
    }
  };
  s.prototype.destroy = function () {
    this.removeEventListener();
  };
  return s;
})();
var as = (function () {
  function s(e) {
    this.parent = e;
    this.addEventListener();
  }
  s.prototype.addEventListener = function () {
    this.parent.observer.on(ki, this.applyHtml, this);
    this.parent.observer.on(J, this.destroy, this);
  };
  s.prototype.removeEventListener = function () {
    this.parent.observer.off(ki, this.applyHtml);
    this.parent.observer.off(J, this.destroy);
  };
  s.prototype.applyHtml = function (e) {
    var t = this.getSelectionRange();
    var i = e.value;
    var n = e.value.firstChild;
    if (e.value.firstChild && e.value.firstChild.nodeName === 'A' && t.startOffset !== t.endOffset) {
      var r = t.startContainer.nodeName === '#text';
      var o = r ? Br : wt;
      var a = r ? 'CreateLink' : 'InsertLink';
      this.parent.observer.notify(o, {
        value: a,
        item: this.extractHyperlinkDetails(e),
        callBack: e.callBack,
      });
    } else
      Pe.Insert(this.parent.currentDocument, e.value, this.parent.editableElement, true, e.enterAction, this.parent);
    if (e.subCommand === 'pasteCleanup') {
      var l = this.parent.editableElement.querySelectorAll('.pasteContent_RTE');
      var h = [].slice.call(l);
      var c = this.parent.editableElement.querySelectorAll('.pasteContent_Img');
      var d = [].slice.call(c);
      e.callBack({
        requestType: e.subCommand,
        editorMode: 'HTML',
        elements: h,
        imgElem: d,
      });
    } else if (e.callBack) {
      e.callBack({
        requestType: e.subCommand,
        editorMode: 'HTML',
        event: e.event,
        range: this.parent.nodeSelection.getRange(this.parent.currentDocument),
        elements: this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument),
      });
    }
  };
  s.prototype.extractHyperlinkDetails = function (e) {
    var t;
    var i = this.getSelectionRange();
    var n = this.parent.nodeSelection;
    var r = this.parent.nodeSelection.getParentNodeCollection(i);
    var o = e.value.querySelector('a');
    var a = this.findAnchorElement(r);
    if (a && a.nodeName === 'A') {
      var l = i.toString();
      var h = a.innerText;
      t = l.length < a.innerText.length ? a.innerText : l;
    } else t = i.toString();
    return {
      url: o.href || '',
      text: t,
      title: o.title || '',
      target: o.target || '',
      ariaLabel: o.ariaLabel || '',
      selection: this.parent.nodeSelection,
      selectNode: Array.from(this.getSelectionRange().startContainer.childNodes),
      selectParent: r,
    };
  };
  s.prototype.getSelectionRange = function () {
    return this.parent.nodeSelection.getRange(this.parent.currentDocument);
  };
  s.prototype.findAnchorElement = function (e) {
    for (var t = 0, i = e; t < i.length; t++) {
      var n = i[t];
      var r = v(i[t], 'a');
      if (r) return r;
    }
    return e[0];
  };
  s.prototype.destroy = function () {
    this.removeEventListener();
  };
  return s;
})();
var ss = (function () {
  function s() {}
  s.clear = function (e, t, i, n, r) {
    this.domNode = new ei(t, e);
    this.defaultTag = i === 'P' ? 'p' : 'div';
    var o = new Se(t);
    var a = new gt();
    var l = o.getRange(e);
    var h = l.collapsed ? o.getSelectionNodeCollection(l) : o.getSelectionNodeCollectionBr(l);
    var c = o.save(l, e);
    var d = false;
    if (l.collapsed && r !== 'ClearFormat') {
      d = true;
      l = a.GetCursorRange(e, l, h[0]);
    }
    var u = l.collapsed;
    if (!l.collapsed) {
      var f = void 0;
      h.length > 0 && h[0].nodeName === 'BR' && v(h[0], 'table')
        ? (f = a.GetSpliceNode(l, v(h[0], 'table')))
        : (f = a.GetSpliceNode(l, h[h.length > 1 && h[0].nodeName === 'IMG' ? 1 : 0]));
      if (h.length === 1) {
        o.setSelectionContents(e, f);
        l = o.getRange(e);
      } else if (h.length > 1) {
        for (var m = 1, g = h[h.length - m]; h.length <= m && h[h.length - m].nodeName === 'BR'; ) {
          m++;
          g = h[h.length - m];
        }
        var b = a.GetSpliceNode(l, g);
        if (b) {
          o.setSelectionText(e, f, b, 0, b.nodeType === 3 ? b.textContent.length : b.childNodes.length);
        }
        l = o.getRange(e);
      }
      var C = o.getNodeCollection(l);
      var N = C.slice();
      this.clearInlines(o.getSelectionNodesBr(N), N, o.getRange(e), a, t);
      this.reSelection(e, c, C);
      l = o.getRange(e);
      C = o.getNodeCollection(l);
      var w = C.slice();
      this.clearBlocks(e, w, t, a, o);
      if (W()) {
        Xe(t, n);
      }
      this.reSelection(e, c, C);
    }
    if (d) {
      o.setCursorPoint(e, l.endContainer, l.endOffset);
    }
  };
  s.reSelection = function (e, t, i) {
    var n = t.getInsertNodes(i);
    t.startContainer = t.getNodeArray(n[0], true, e);
    t.startOffset = 0;
    t.endContainer = t.getNodeArray(n[n.length - 1], false, e);
    var r = n[n.length - 1];
    t.endOffset =
      n[n.length - 1].nodeType === 3 ? n[n.length - 1].textContent.length : n[n.length - 1].childNodes.length;
    t.restore();
  };
  s.clearBlocks = function (e, t, i, n, r) {
    for (var o = [], a = 0; a < t.length; a++)
      this.BLOCK_TAGS.indexOf(t[a].nodeName.toLocaleLowerCase()) > -1 && o.indexOf(t[a]) === -1
        ? o.push(t[a])
        : this.BLOCK_TAGS.indexOf(t[a].parentNode.nodeName.toLocaleLowerCase()) > -1 &&
          o.indexOf(t[a].parentNode) === -1 &&
          i !== t[a].parentNode &&
          o.push(t[a].parentNode);
    o = this.spliceParent(o, t)[0];
    o = this.removeParent(o);
    this.unWrap(e, o, n, r);
  };
  s.spliceParent = function (e, t) {
    for (var i = 0; i < e.length; i++)
      for (var n = e[i].childNodes.length, r = 0; r < n; r++) {
        if (t.indexOf(e[i].childNodes[r]) > 0 && e[i].childNodes[r].childNodes.length > 0) {
          t = this.spliceParent([e[i].childNodes[r]], t)[1];
        }
        if (t.indexOf(e[i].childNodes[r]) <= -1 && e[i].childNodes[r].textContent.trim() !== '') {
          for (var o = 0; o < n; o++)
            if (t.indexOf(e[i].childNodes[o]) > -1) {
              t.splice(t.indexOf(e[i].childNodes[o]), 1);
            }
          r = e[i].childNodes.length;
          var a = e.indexOf(e[i].parentNode);
          var l = t.indexOf(e[i].parentNode);
          if (a > -1) {
            e.splice(a, 1);
          }
          if (l > -1) {
            t.splice(l, 1);
          }
          var h = t.indexOf(e[i]);
          if (h > -1) {
            t.splice(h, 1);
          }
          e.splice(i, 1);
          i--;
        }
      }
    return [e, t];
  };
  s.removeChild = function (e, t) {
    var i = t.childNodes.length;
    if (t.childNodes.length > 0)
      for (var n = 0; n < t.childNodes.length; n++)
        if (e.indexOf(t.childNodes[n]) > -1) {
          e = this.removeChild(e, t.childNodes[n]);
          e.splice(e.indexOf(t.childNodes[n]), 1);
        }
    return e;
  };
  s.removeParent = function (e) {
    for (var t = 0; t < e.length; t++)
      if (e.indexOf(e[t].parentNode) > -1) {
        e = this.removeChild(e, e[t]);
        e.splice(t, 1);
        t--;
      }
    return e;
  };
  s.unWrap = function (e, t, i, n) {
    for (
      var r = function (l) {
          t[l] = v(t[l], 'li') && t[l].nodeName !== 'UL' && t[l].nodeName !== 'OL' ? v(t[l], 'li') : t[l];
          if (
            o.NONVALID_TAGS.indexOf(t[l].nodeName.toLowerCase()) > -1 &&
            t[l].parentNode &&
            o.NONVALID_PARENT_TAGS.indexOf(t[l].parentNode.nodeName.toLowerCase()) > -1
          ) {
            n.setSelectionText(e, t[l], t[l], 0, t[l].childNodes.length);
            V.unwrap(i.GetSpliceNode(n.getRange(e), t[l].parentNode));
          }
          var h = v(t[l], 'blockquote');
          if (t[l].nodeName.toLocaleLowerCase() !== 'blockquote' && !p(h) && h.textContent === t[l].textContent) {
            var c = o.removeParent([h]);
            o.unWrap(e, c, i, n);
          }
          if (t[l].nodeName.toLocaleLowerCase() !== 'p') {
            if (
              o.NONVALID_PARENT_TAGS.indexOf(t[l].nodeName.toLowerCase()) < 0 &&
              !(
                (t[l].nodeName.toLocaleLowerCase() === 'blockquote' || t[l].nodeName.toLocaleLowerCase() === 'li') &&
                o.IGNORE_PARENT_TAGS.indexOf(t[l].childNodes[0].nodeName.toLocaleLowerCase()) > -1
              ) &&
              !(t[l].childNodes.length === 1 && t[l].childNodes[0].nodeName.toLocaleLowerCase() === 'p')
            ) {
              var d = t[l];
              if (['TABLE', 'TD', 'TH'].indexOf(d.nodeName) !== -1) {
                if (d.hasAttribute('style')) {
                  d.removeAttribute('style');
                }
                if (d.hasAttribute('class')) {
                  var u = new Set(['e-rte-table', 'e-rte-paste-table', 'e-rte-custom-table']);
                  var f = d.className.split(/\s+/).filter(function (b) {
                    return u.has(b);
                  });
                  f.length > 0 ? (d.className = f.join(' ')) : d.removeAttribute('class');
                }
              } else V.Wrap(t[l], e.createElement(o.defaultTag));
            }
            var m = [];
            t[l].nodeName === 'TABLE' || t[l].nodeName === 'TD' || t[l].nodeName === 'TH'
              ? (m = Array.from(t[l].childNodes))
              : (m = V.unwrap(t[l]));
            if (m.length === 1 && m[0].parentNode.nodeName.toLocaleLowerCase() === 'p') {
              V.Wrap(t[l], e.createElement(o.defaultTag));
              V.unwrap(t[l]);
            }
            for (var g = 0; g < m.length; g++)
              if (o.NONVALID_TAGS.indexOf(m[g].nodeName.toLowerCase()) > -1) o.unWrap(e, [m[g]], i, n);
              else if (
                o.BLOCK_TAGS.indexOf(m[g].nodeName.toLocaleLowerCase()) > -1 &&
                m[g].nodeName.toLocaleLowerCase() !== 'p'
              ) {
                var c = o.removeParent([m[g]]);
                o.unWrap(e, c, i, n);
              } else
                o.BLOCK_TAGS.indexOf(m[g].nodeName.toLocaleLowerCase()) > -1 &&
                m[g].nodeName.toLocaleLowerCase() === 'p'
                  ? (m[g].parentNode.nodeName.toLocaleLowerCase() === 'p' && V.unwrap(m[g].parentNode),
                    V.Wrap(m[g], e.createElement(o.defaultTag)),
                    V.unwrap(m[g]))
                  : o.BLOCK_TAGS.indexOf(m[g].nodeName.toLocaleLowerCase()) > -1 &&
                    m[g].parentNode.nodeName.toLocaleLowerCase() === m[g].nodeName.toLocaleLowerCase() &&
                    V.unwrap(m[g]);
          } else {
            V.Wrap(t[l], e.createElement(o.defaultTag));
            V.unwrap(t[l]);
          }
        },
        o = this,
        a = 0;
      a < t.length;
      a++
    )
      r(a);
  };
  s.clearInlines = function (e, t, i, n, r) {
    for (var o = 0; o < e.length; o++) {
      for (
        var a = e[o], l = void 0;
        !this.domNode.isBlockNode(a) && a.parentElement && !a.parentElement.classList.contains('e-img-inner');

      ) {
        l = a;
        a = a.parentElement;
      }
      if (l && qe.inlineTags.indexOf(l.nodeName.toLocaleLowerCase()) > -1) {
        n.GetSpliceNode(i, l);
        this.removeInlineParent(l);
      }
    }
  };
  s.removeInlineParent = function (e) {
    for (var t = V.unwrap(e), i = 0; i < t.length; i++)
      t[i].parentNode.childNodes.length === 1 &&
      !t[i].parentNode.classList.contains('e-img-inner') &&
      qe.inlineTags.indexOf(t[i].parentNode.nodeName.toLocaleLowerCase()) > -1
        ? this.removeInlineParent(t[i].parentNode)
        : qe.inlineTags.indexOf(t[i].nodeName.toLocaleLowerCase()) > -1 && this.removeInlineParent(t[i]);
  };
  s.BLOCK_TAGS = [
    'address',
    'article',
    'aside',
    'blockquote',
    'details',
    'dd',
    'div',
    'dl',
    'dt',
    'fieldset',
    'figcaption',
    'figure',
    'footer',
    'form',
    'h1',
    'h2',
    'h3',
    'h4',
    'h5',
    'h6',
    'header',
    'hgroup',
    'li',
    'main',
    'nav',
    'noscript',
    'ol',
    'p',
    'pre',
    'section',
    'ul',
    'table',
    'td',
    'th',
  ];
  s.NONVALID_PARENT_TAGS = ['thead', 'tbody', 'ul', 'ol', 'tfoot', 'tr'];
  s.IGNORE_PARENT_TAGS = ['ul', 'ol', 'table'];
  s.NONVALID_TAGS = ['thead', 'figcaption', 'tr', 'tfoot', 'figcaption', 'li'];
  s.defaultTag = 'p';
  return s;
})();
var ls = (function () {
  function s(e) {
    this.parent = e;
    this.addEventListener();
  }
  s.prototype.addEventListener = function () {
    this.parent.observer.on(wi, this.applyClear, this);
    this.parent.observer.on(ae, this.onKeyDown, this);
    this.parent.observer.on(J, this.destroy, this);
  };
  s.prototype.removeEventListener = function () {
    this.parent.observer.off(wi, this.applyClear);
    this.parent.observer.off(ae, this.onKeyDown);
    this.parent.observer.off(J, this.destroy);
  };
  s.prototype.onKeyDown = function (e) {
    switch (e.event.action) {
      case 'clear-format':
        {
          this.applyClear({
            subCommand: 'ClearFormat',
            callBack: e.callBack,
            enterAction: e.enterAction,
          });
          e.event.preventDefault();
        }
        break;
    }
  };
  s.prototype.applyClear = function (e) {
    if (e.subCommand === 'ClearFormat') {
      ss.clear(this.parent.currentDocument, this.parent.editableElement, e.enterAction, e.selector, e.subCommand);
      if (e.callBack) {
        e.callBack({
          requestType: e.subCommand,
          event: e.event,
          editorMode: 'HTML',
          range: this.parent.nodeSelection.getRange(this.parent.currentDocument),
          elements: this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument),
        });
      }
    }
  };
  s.prototype.destroy = function () {
    this.removeEventListener();
  };
  return s;
})();
var hs = (function () {
  function s(e, t) {
    this.undoRedoStack = [];
    this.parent = e;
    this.undoRedoSteps = p(t) ? 30 : t.undoRedoSteps;
    this.undoRedoTimer = p(t) ? 300 : t.undoRedoTimer;
    this.addEventListener();
  }
  s.prototype.addEventListener = function () {
    this.debounceListener = no(this.keyUp, this.undoRedoTimer);
    this.parent.observer.on(tt, this.debounceListener, this);
    this.parent.observer.on(ae, this.keyDown, this);
    this.parent.observer.on(Di, this.onAction, this);
    this.parent.observer.on(Oi, this.onPropertyChanged, this);
    this.parent.observer.on(J, this.destroy, this);
  };
  s.prototype.onPropertyChanged = function (e) {
    for (var t = 0, i = Object.keys(e.newProp); t < i.length; t++) {
      var n = i[t];
      switch (i[t]) {
        case 'undoRedoSteps':
          this.undoRedoSteps = e.newProp.undoRedoSteps;
          break;
        case 'undoRedoTimer':
          this.undoRedoTimer = e.newProp.undoRedoTimer;
          break;
      }
    }
  };
  s.prototype.removeEventListener = function () {
    this.parent.observer.off(tt, this.keyUp);
    this.parent.observer.off(ae, this.keyDown);
    this.parent.observer.off(Di, this.onAction);
    this.parent.observer.off(Oi, this.onPropertyChanged);
    this.parent.observer.off(J, this.destroy);
    this.debounceListener = null;
  };
  s.prototype.onAction = function (e) {
    e.subCommand === 'Undo' ? this.undo(e) : this.redo(e);
  };
  s.prototype.destroy = function () {
    this.removeEventListener();
    this.element = null;
    this.steps = null;
    this.undoRedoStack = [];
    this.undoRedoSteps = null;
    this.undoRedoTimer = null;
  };
  s.prototype.keyDown = function (e) {
    var t = e.event;
    var i = this;
    switch (e.event.action) {
      case 'undo':
        {
          e.event.preventDefault();
          i.undo(e);
        }
        break;
      case 'redo':
        {
          e.event.preventDefault();
          i.redo(e);
        }
        break;
    }
  };
  s.prototype.keyUp = function (e) {
    if (e.event.keyCode !== 17 && !e.event.ctrlKey) {
      this.saveData(e);
    }
  };
  s.prototype.getTextContentFromFragment = function (e) {
    for (var t = '', i = 0; i < e.childNodes.length; i++) {
      var n = e.childNodes[i];
      e.childNodes[i].nodeType === Node.TEXT_NODE
        ? (t += e.childNodes[i].textContent)
        : e.childNodes[i].nodeType === Node.ELEMENT_NODE && (t += this.getTextContentFromFragment(e.childNodes[i]));
    }
    return t;
  };
  s.prototype.isElementStructureEqual = function (e, t) {
    if (e.childNodes.length !== t.childNodes.length) return false;
    for (var i = 0; i < e.childNodes.length; i++) {
      var n = e.childNodes[i];
      var r = t.childNodes[i];
      if (
        !e.childNodes[i] ||
        !t.childNodes[i] ||
        e.childNodes[i].nodeType !== t.childNodes[i].nodeType ||
        e.childNodes[i].outerHTML !== t.childNodes[i].outerHTML
      )
        return false;
    }
    return true;
  };
  s.prototype.saveData = function (e) {
    if (this.parent.currentDocument) {
      for (
        var t = new Se(this.parent.editableElement).getRange(this.parent.currentDocument),
          i =
            this.parent.editableElement === t.startContainer.parentElement
              ? t.startContainer.parentElement
              : t.startContainer,
          n = i.childNodes.length - 1;
        n >= 0;
        n--
      )
        if (
          !p(i.childNodes[n]) &&
          i.childNodes[n].nodeName === '#text' &&
          i.childNodes[n].textContent.length === 0 &&
          i.childNodes[n].nodeName !== 'IMG' &&
          i.childNodes[n].nodeName !== 'BR' &&
          i.childNodes[n].nodeName
        ) {
          y(i.childNodes[n]);
        }
      t = new Se(this.parent.editableElement).getRange(this.parent.currentDocument);
      for (
        var r = new Se(this.parent.editableElement).save(t, this.parent.currentDocument),
          o = this.removeResizeElement(this.parent.editableElement.cloneNode(true)),
          a = document.createDocumentFragment();
        o.firstChild;

      )
        a.appendChild(o.firstChild);
      var l = {
        text: a,
        range: r,
      };
      if (this.undoRedoStack.length >= this.steps) {
        this.undoRedoStack = this.undoRedoStack.slice(0, this.steps + 1);
      }
      if (
        !(
          this.undoRedoStack.length > 1 &&
          this.undoRedoStack[this.undoRedoStack.length - 1].range.range.collapsed === t.collapsed &&
          this.undoRedoStack[this.undoRedoStack.length - 1].range.startOffset === r.range.startOffset &&
          this.undoRedoStack[this.undoRedoStack.length - 1].range.endOffset === r.range.endOffset &&
          this.undoRedoStack[this.undoRedoStack.length - 1].range.range.startContainer === r.range.startContainer &&
          this.getTextContentFromFragment(this.undoRedoStack[this.undoRedoStack.length - 1].text).trim() ===
            this.getTextContentFromFragment(l.text).trim() &&
          this.isElementStructureEqual(this.undoRedoStack[this.undoRedoStack.length - 1].text, l.text)
        )
      ) {
        this.undoRedoStack.push(l);
        this.steps = this.undoRedoStack.length - 1;
        if (this.steps > this.undoRedoSteps) {
          this.undoRedoStack.shift();
          this.steps--;
        }
        if (e && e.callBack) {
          e.callBack();
        }
      }
    }
  };
  s.prototype.removeResizeElement = function (e) {
    var t = e.querySelector('.e-vid-resize');
    if (t) {
      y(t);
    }
    var i = e.querySelector('.' + En);
    if (i) {
      x([i], [En, 'e-resize']);
    }
    var n = e.querySelector('.e-img-resize');
    if (n) {
      y(n);
    }
    for (var r = e.querySelectorAll('img'), o = 0; o < r.length; o++) {
      var a = r[o];
      x([r[o]], ['e-img-focus', 'e-resize']);
    }
    var l = e.querySelector('.' + Nn);
    if (l) {
      x([l], [Nn]);
    }
    for (var h = e.querySelectorAll('img, audio, video'), o = 0; o < h.length; o++) {
      var c = h[o];
      h[o].style.outline = '';
    }
    return e;
  };
  s.prototype.undo = function (e) {
    if (this.steps > 0) {
      var t = this.undoRedoStack[this.steps - 1].range;
      var i = this.undoRedoStack[this.steps - 1].text;
      this.parent.editableElement.innerHTML = '';
      this.parent.editableElement.appendChild(this.undoRedoStack[this.steps - 1].text.cloneNode(true));
      this.parent.editableElement.focus();
      kt(this.parent.currentDocument, this.parent.editableElement);
      if (W()) {
        Xe(this.parent.editableElement, e.selector);
      }
      this.undoRedoStack[this.steps - 1].range.restore();
      this.steps--;
      if (e.callBack) {
        e.callBack({
          requestType: 'Undo',
          editorMode: 'HTML',
          range: this.undoRedoStack[this.steps - 1].range,
          elements: this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument),
          event: e.event,
        });
      }
    }
  };
  s.prototype.redo = function (e) {
    if (this.undoRedoStack[this.steps + 1] != null) {
      var t = this.undoRedoStack[this.steps + 1].range;
      var i = this.undoRedoStack[this.steps + 1].text;
      this.parent.editableElement.innerHTML = '';
      this.parent.editableElement.appendChild(this.undoRedoStack[this.steps + 1].text.cloneNode(true));
      this.parent.editableElement.focus();
      kt(this.parent.currentDocument, this.parent.editableElement);
      if (W()) {
        Xe(this.parent.editableElement, e.selector);
      }
      this.undoRedoStack[this.steps + 1].range.restore();
      this.steps++;
      if (e.callBack) {
        e.callBack({
          requestType: 'Redo',
          editorMode: 'HTML',
          range: this.undoRedoStack[this.steps + 1].range,
          elements: this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument),
          event: e.event,
        });
      }
    }
  };
  s.prototype.getUndoStatus = function () {
    var e = {
      undo: false,
      redo: false,
    };
    if (this.steps > 0) {
      e.undo = true;
    }
    if (this.undoRedoStack[this.steps + 1] != null) {
      e.redo = true;
    }
    return e;
  };
  s.prototype.getCurrentStackIndex = function () {
    return this.steps;
  };
  s.prototype.clear = function () {
    this.undoRedoStack = [];
    this.steps = null;
  };
  return s;
})();
var ps = (function () {
  function s(e) {
    this.olData = [
      'decimal',
      'decimal-leading-zero',
      'lower-alpha',
      'lower-roman',
      'upper-alpha',
      'upper-roman',
      'lower-greek',
    ];
    this.ulData = ['disc', 'square', 'circle', 'disc', 'square', 'circle'];
    this.ignorableNodes = [
      'A',
      'APPLET',
      'B',
      'BLOCKQUOTE',
      'BR',
      'BUTTON',
      'CENTER',
      'CODE',
      'COL',
      'COLGROUP',
      'DD',
      'DEL',
      'DFN',
      'DIR',
      'DIV',
      'DL',
      'DT',
      'EM',
      'FIELDSET',
      'FONT',
      'FORM',
      'FRAME',
      'FRAMESET',
      'H1',
      'H2',
      'H3',
      'H4',
      'H5',
      'H6',
      'HR',
      'I',
      'IMG',
      'IFRAME',
      'INPUT',
      'INS',
      'LABEL',
      'LI',
      'OL',
      'OPTION',
      'P',
      'PARAM',
      'PRE',
      'Q',
      'S',
      'SELECT',
      'SPAN',
      'STRIKE',
      'STRONG',
      'SUB',
      'SUP',
      'TABLE',
      'TBODY',
      'TD',
      'TEXTAREA',
      'TFOOT',
      'TH',
      'THEAD',
      'TITLE',
      'TR',
      'TT',
      'U',
      'UL',
    ];
    this.blockNode = [
      'div',
      'p',
      'h1',
      'h2',
      'h3',
      'h4',
      'h5',
      'h6',
      'address',
      'blockquote',
      'button',
      'center',
      'dd',
      'dir',
      'dl',
      'dt',
      'fieldset',
      'frameset',
      'hr',
      'iframe',
      'isindex',
      'li',
      'map',
      'menu',
      'noframes',
      'noscript',
      'object',
      'ol',
      'pre',
      'table',
      'tbody',
      'td',
      'tfoot',
      'th',
      'thead',
      'tr',
      'ul',
      'header',
      'article',
      'nav',
      'footer',
      'section',
      'aside',
      'main',
      'figure',
      'figcaption',
    ];
    this.borderStyle = ['border-top', 'border-right', 'border-bottom', 'border-left'];
    this.upperRomanNumber = [
      'I',
      'II',
      'III',
      'IV',
      'V',
      'VI',
      'VII',
      'VIII',
      'IX',
      'X',
      'XI',
      'XII',
      'XIII',
      'XIV',
      'XV',
      'XVI',
      'XVII',
      'XVIII',
      'XIX',
      'XX',
    ];
    this.lowerRomanNumber = [
      'i',
      'ii',
      'iii',
      'iv',
      'v',
      'vi',
      'vii',
      'viii',
      'ix',
      'x',
      'xi',
      'xii',
      'xiii',
      'xiv',
      'xv',
      'xvi',
      'xvii',
      'xviii',
      'xix',
      'xx',
    ];
    this.lowerGreekNumber = [
      'α',
      'β',
      'γ',
      'δ',
      'ε',
      'ζ',
      'η',
      'θ',
      'ι',
      'κ',
      'λ',
      'μ',
      'ν',
      'ξ',
      'ο',
      'π',
      'ρ',
      'σ',
      'τ',
      'υ',
      'φ',
      'χ',
      'ψ',
      'ω',
    ];
    this.removableElements = ['o:p', 'style', 'w:sdt'];
    this.listContents = [];
    this.cropImageDimensions = [];
    this.parent = e;
    this.addEventListener();
  }
  s.prototype.addEventListener = function () {
    this.parent.observer.on(Mi, this.wordCleanup, this);
    this.parent.observer.on(J, this.destroy, this);
  };
  s.prototype.removeEventListener = function () {
    this.parent.observer.off(Mi, this.wordCleanup);
    this.parent.observer.off(J, this.destroy);
  };
  s.prototype.wordCleanup = function (e) {
    var t = p(e.allowedStylePropertiesArray) ? [] : e.allowedStylePropertiesArray;
    var i = [];
    var n = e.args.clipboardData.getData('text/HTML');
    var r = e.args.clipboardData.getData('text/rtf');
    var o = E('p');
    o.setAttribute('id', 'MSWord-Content');
    o.innerHTML = n;
    this.addDoubleBr(o);
    var a = /class='?Mso|style='[^ ]*\bmso-/i;
    var l = /class="?Mso|style="[^ ]*\bmso-/i;
    var h =
      /(class="?Mso|class='?Mso|class="?Xl|class='?Xl|class=Xl|style="[^"]*\bmso-|style='[^']*\bmso-|w:WordDocument)/gi;
    var c = /style='mso-width-source:/i;
    var d = this.findSource(o);
    a.test(n) || l.test(n) || h.test(n) || c.test(n)
      ? ((n = n.replace(/<img[^>]+>/i, '')),
        this.addListClass(o),
        (i = this.listCleanUp(o, i)),
        !p(i[0]) && i[0].parentElement.tagName !== 'UL' && i[0].parentElement.tagName !== 'OL' && this.listConverter(i),
        this.imageConversion(o, r),
        this.cleanList(o, 'UL'),
        this.cleanList(o, 'OL'),
        this.styleCorrection(o, t),
        this.removingComments(o),
        this.removeUnwantedElements(o),
        this.removeEmptyElements(o),
        this.removeEmptyAnchorTag(o),
        this.breakLineAddition(o),
        this.processMargin(o),
        this.removeClassName(o),
        c.test(n) && this.addTableBorderClass(o),
        e.callBack(o.innerHTML, this.cropImageDimensions, d))
      : (d === ni[2] && this.handleOneNoteContent(o), this.removeEmptyMetaTags(o), e.callBack(o.innerHTML, null, d));
  };
  s.prototype.addDoubleBr = function (e) {
    var t = e.querySelector('.Apple-interchange-newline');
    var i = !p(t) && M.userAgent.indexOf('Chrome') !== -1 && t.parentElement.nodeName === 'P' && e !== t.parentElement;
    if (i)
      for (var n = 0; n < e.childNodes.length; n++) {
        var r = e.childNodes[n];
        var o =
          e.childNodes[n].nodeType === Node.COMMENT_NODE && e.childNodes[n].nodeValue.indexOf('StartFragment') !== -1;
        if (o) {
          var a = E('p');
          a.innerHTML = '<br>';
          var l = t.parentElement.style.cssText;
          var h = a.getAttribute('style') || '';
          var c = h + t.parentElement.style.cssText;
          a.style.cssText = c;
          e.insertBefore(a, e.childNodes[n].nextSibling);
          y(t);
          break;
        }
      }
  };
  s.prototype.cleanList = function (e, t) {
    for (var i = e.querySelectorAll(t + ' div'), n = i.length - 1; n >= 0; n--) {
      for (var r = i[n], o = r.parentNode; r.firstChild; ) o.insertBefore(r.firstChild, r);
      var a = this.findClosestListElem(r);
      if (a) {
        this.insertAfter(r, a);
      }
    }
  };
  s.prototype.insertAfter = function (e, t) {
    if (t.parentNode) {
      t.parentNode.insertBefore(e, t.nextSibling);
    }
  };
  s.prototype.findClosestListElem = function (e) {
    for (var t; !p(e); ) {
      var i = !p(e.closest('ul')) && e.tagName !== 'UL';
      var n = e.tagName !== 'OL' && !p(e.closest('ol'));
      i ? (e = e.closest('ul')) : n ? (e = e.closest('ol')) : (e = null);
      t = p(e) ? t : e;
    }
    return t;
  };
  s.prototype.addListClass = function (e) {
    for (var t = e.querySelectorAll('*'), i = 0; i < t.length; i++) {
      var n = t[i];
      var r = t[i].getAttribute('style');
      if (!p(r)) {
        var o = r.replace(/ /g, '').replace(
          `
`,
          '',
        );
        var a = o.indexOf('mso-list:l') >= 0;
        var l = t[i].className.toLowerCase().indexOf('msolistparagraph') === -1;
        var h = t[i].tagName.charAt(0) !== 'H';
        var c = t[i].tagName !== 'LI' && t[i].tagName !== 'OL' && t[i].tagName !== 'UL';
        if (a && l && h && c) {
          t[i].classList.add('msolistparagraph');
        }
      }
    }
  };
  s.prototype.addTableBorderClass = function (e) {
    for (var t = e.querySelectorAll('table'), i = false, n = 0; n < t.length; n++) {
      for (var r = 0; r < this.borderStyle.length; r++)
        if (t[n].innerHTML.indexOf(this.borderStyle[r]) >= 0) {
          i = true;
          break;
        }
      if (i) {
        t[n].classList.add('e-rte-table-border');
        i = false;
      }
    }
  };
  s.prototype.imageConversion = function (e, t) {
    this.checkVShape(e);
    var i = e.querySelectorAll('img');
    this.markUnsupportedImages(i);
    i = e.querySelectorAll('img');
    if (i.length !== 0) {
      var n = [];
      var r = [];
      var o = [];
      this.extractImageInfo(i, n, o);
      var a = this.hexConversion(t);
      this.processHexValues(a, r);
      this.updateImageSources(e, n, r, o);
      this.cleanUnsupportedImages(e);
    }
  };
  s.prototype.markUnsupportedImages = function (e) {
    for (var t = 0; t < e.length; t++) {
      var i = e[t];
      var n = e[t].getAttribute('v:shapes');
      if (!p(n)) {
        var r = this.isUnsupportedImageShape(n);
        if (r) {
          e[t].classList.add('e-rte-image-unsupported');
        }
        e[t].removeAttribute('v:shapes');
      }
    }
  };
  s.prototype.isUnsupportedImageShape = function (e) {
    for (
      var t = ['Picture', 'Chart', '圖片', 'Grafik', 'image', 'Graphic', '_x0000_s', '_x0000_i', 'img1', 'Immagine'],
        i = 0;
      i < t.length;
      i++
    ) {
      var n = t[i];
      if (t[i] === 'image') {
        if (e.toLowerCase().indexOf(t[i]) >= 0) return false;
      } else if (e.indexOf(t[i]) >= 0) return false;
    }
    return true;
  };
  s.prototype.extractImageInfo = function (e, t, i) {
    for (var n = 0; n < e.length; n++) {
      var r = e[n];
      if (!e[n].classList.contains('e-rte-image-unsupported')) {
        var o = e[n].getAttribute('src');
        t.push(o);
        var a = o.split('/');
        var l = a[a.length - 1];
        var h = a[a.length - 1].split('.')[0] + n;
        i.push(h);
      }
    }
  };
  s.prototype.processHexValues = function (e, t) {
    for (var i = 0; i < e.length; i++) {
      var n = e[i];
      t.push({
        base64Data: p(e[i].hex) ? null : this.convertToBase64(e[i]),
        isCroppedImage: e[i].isCroppedImage,
      });
      if (e[i].isCroppedImage) {
        this.cropImageDimensions.push({
          goalWidth: e[i].goalWidth,
          goalHeight: e[i].goalHeight,
          cropLength: e[i].cropLength,
          cropTop: e[i].cropTop,
          cropR: e[i].cropR,
          cropB: e[i].cropB,
        });
      }
    }
  };
  s.prototype.updateImageSources = function (e, t, i, n) {
    for (
      var r = new RegExp(/([^\S]|^)(((https?\:\/\/)|(www\.)|(blob\:))|(data:image\/[a-zA-Z]+;base64,[\w+/=]+)(\S+))/gi),
        o = e.querySelectorAll('img:not(.e-rte-image-unsupported)'),
        a = 0;
      a < o.length;
      a++
    ) {
      var l = o[a];
      var h = t[a];
      if (t[a].match(r)) o[a].setAttribute('src', t[a]);
      else {
        var c = i[a];
        !p(i[a]) && !p(i[a].base64Data)
          ? o[a].setAttribute('src', i[a].base64Data)
          : (o[a].removeAttribute('src'), o[a].classList.add('e-rte-image-unsupported'));
        if (!p(i[a]) && i[a].isCroppedImage) {
          o[a].classList.add('e-img-cropped');
        }
      }
      o[a].setAttribute('id', 'msWordImg-' + n[a]);
    }
  };
  s.prototype.cleanUnsupportedImages = function (e) {
    for (var t = e.querySelectorAll('.e-rte-image-unsupported'), i = 0; i < t.length; i++) t[i].removeAttribute('src');
  };
  s.prototype.checkVShape = function (e) {
    for (var t = e.querySelectorAll('*'), i = 0; i < t.length; i++) {
      var n = t[i];
      var r = t[i].nodeName;
      switch (t[i].nodeName) {
        case 'V:SHAPETYPE':
          y(t[i]);
          break;
        case 'V:SHAPE':
          this.processVShapeElement(t[i]);
          break;
      }
    }
  };
  s.prototype.processVShapeElement = function (e) {
    var t = e.firstElementChild;
    if (e.firstElementChild && e.firstElementChild.nodeName === 'V:IMAGEDATA') {
      var i = e.firstElementChild.getAttribute('src');
      var n = E('img');
      n.setAttribute('src', i);
      e.parentElement.insertBefore(n, e);
      y(e);
    }
  };
  s.prototype.convertToBase64 = function (e) {
    var t = this.conHexStringToBytes(e.hex);
    var i = this.conBytesToBase64(t);
    var n = e.type;
    var r = e.type ? 'data:' + e.type + ';base64,' + i : null;
    return r;
  };
  s.prototype.conBytesToBase64 = function (e) {
    for (
      var t = '', i = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/', n = e.length, r = 0;
      r < n;
      r += 3
    ) {
      var o = e.slice(r, r + 3);
      var a = o.length;
      var l = [];
      if (o.length < 3) for (var h = o.length; h < 3; h++) o[h] = 0;
      l[0] = (o[0] & 252) >> 2;
      l[1] = ((o[0] & 3) << 4) | (o[1] >> 4);
      l[2] = ((o[1] & 15) << 2) | ((o[2] & 192) >> 6);
      l[3] = o[2] & 63;
      for (var h = 0; h < 4; h++) h <= o.length ? (t += i.charAt(l[h])) : (t += '=');
    }
    return t;
  };
  s.prototype.conHexStringToBytes = function (e) {
    for (var t = [], i = e.length / 2, n = 0; n < i; n++) {
      var r = e.substr(n * 2, 2);
      var o = parseInt(r, 16);
      t.push(o);
    }
    return t;
  };
  s.prototype.hexConversion = function (e) {
    var t = RegExp;
    var i = new RegExp(
      '\\{\\\\pict[\\s\\S]+?\\\\bliptag-?\\d+(\\\\blipupi-?\\d+)?(\\{\\\\\\*\\\\blipuid\\s?[\\da-fA-F]+)?[\\s\\}]*?',
    );
    var n = new RegExp(
      '(?:(\\{\\\\pict[\\s\\S]+?\\\\bliptag-?\\d+(\\\\blipupi-?\\d+)?(\\{\\\\\\*\\\\blipuid\\s?[\\da-fA-F]+)?[\\s\\}]*?))([\\da-fA-F\\s]+)\\}',
      'g',
    );
    var r = e.match(n);
    var o = [];
    if (p(r)) return o;
    for (var a = 0; a < r.length; a++) {
      var l = r[a];
      if (!(r[a].indexOf('fIsBullet') !== -1 && r[a].indexOf('wzName') === -1) && i.test(r[a])) {
        var h = this.extractImageData(r[a], i);
        if (h) {
          o.push(h);
        }
      }
    }
    return o;
  };
  s.prototype.extractImageData = function (e, t) {
    var i = null;
    if (e.indexOf('\\pngblip') !== -1) i = 'image/png';
    else if (e.indexOf('\\jpegblip') !== -1) i = 'image/jpeg';
    else if (e.indexOf('\\emfblip') !== -1) i = null;
    else return null;
    var n = this.isImageCropped(e);
    var r = {
      goalWidth: 0,
      goalHeight: 0,
      cropLength: 0,
      cropTop: 0,
      cropR: 0,
      cropB: 0,
    };
    if (n) {
      r.goalWidth = this.extractCropValue('wgoal', e);
      r.goalHeight = this.extractCropValue('hgoal', e);
      r.cropLength = this.extractCropValue('cropl', e);
      r.cropTop = this.extractCropValue('cropt', e);
      r.cropR = this.extractCropValue('cropr', e);
      r.cropB = this.extractCropValue('cropb', e);
    }
    return {
      hex: i ? e.replace(t, '').replace(/[^\da-fA-F]/g, '') : null,
      type: i,
      isCroppedImage: n,
      goalWidth: r.goalWidth,
      goalHeight: r.goalHeight,
      cropLength: r.cropLength,
      cropTop: r.cropTop,
      cropR: r.cropR,
      cropB: r.cropB,
    };
  };
  s.prototype.isImageCropped = function (e) {
    var t = this.extractCropValue('cropl', e) > 0 && this.extractCropValue('cropt', e) > 0;
    var i = this.extractCropValue('cropr', e) > 0;
    var n = this.extractCropValue('cropb', e) > 0;
    return t || i || n;
  };
  s.prototype.extractCropValue = function (e, t) {
    var i = t.replace(/\r\n\\/g, '\\').replace(/\n/g, '\\');
    var n = RegExp;
    var r = new RegExp('\\\\pic' + e + '(\\-?\\d+)\\\\');
    var o = r.exec(i);
    return !o || o.length < 2 ? 0 : parseInt(o[1], 10);
  };
  s.prototype.removeClassName = function (e) {
    for (
      var t = e.querySelectorAll('*[class]:not(.e-img-cropped):not(.e-rte-image-unsupported)'), i = 0;
      i < t.length;
      i++
    )
      t[i].removeAttribute('class');
  };
  s.prototype.breakLineAddition = function (e) {
    for (var t = e.querySelectorAll('*'), i = 0; i < t.length; i++) {
      var n = t[i];
      if (this.isReplacableWithBreak(t[i])) {
        var r = this.findDetachElem(t[i]);
        var o = E('br');
        var a = this.hasNonBreakingSpace(r);
        if (!a && !p(r.parentElement)) {
          r.parentElement.insertBefore(o, r);
          y(r);
        }
      }
    }
  };
  s.prototype.isReplacableWithBreak = function (e) {
    var t = e.children.length === 0;
    var i = e.innerHTML === '&nbsp;';
    var n = !e.closest('li');
    var r = !e.closest('td');
    var o = e.nodeName !== 'SPAN';
    var a = e.nodeName === 'SPAN' && p(e.previousElementSibling) && p(e.nextElementSibling);
    return t && i && n && r && (o || a);
  };
  s.prototype.hasNonBreakingSpace = function (e) {
    var t = e.textContent.length > 0;
    var i = e.textContent.match(/\u00a0/g);
    var n = i !== null && i.length > 0;
    return t && n;
  };
  s.prototype.findDetachElem = function (e) {
    var t = e.parentElement;
    if (p(e.parentElement)) return e;
    var i = e.parentElement.textContent.trim() === '';
    var n = e.parentElement.tagName !== 'TD' && e.parentElement.tagName !== 'TH';
    var r = p(e.parentElement.querySelector('img'));
    return i && n && r ? this.findDetachElem(e.parentElement) : e;
  };
  s.prototype.removeUnwantedElements = function (e) {
    this.removeStyleElements(e);
    this.removeElementsByTagName(e);
  };
  s.prototype.removeStyleElements = function (e) {
    var t = e.querySelector('style');
    if (!p(t)) {
      y(t);
    }
  };
  s.prototype.removeElementsByTagName = function (e) {
    for (var t = e.innerHTML, i = RegExp, n = 0; n < this.removableElements.length; n++) {
      var r = this.removableElements[n];
      var o = new i('<' + this.removableElements[n] + '\\s*[^>]*>', 'g');
      var a = new i('</' + this.removableElements[n] + '>', 'g');
      t = t.replace(o, '');
      t = t.replace(a, '');
    }
    e.innerHTML = t;
    e.querySelectorAll(':empty');
  };
  s.prototype.findDetachEmptyElem = function (e) {
    if (p(e.parentElement)) return null;
    var t = e.parentElement;
    var i = this.hasNonBreakingSpace(e.parentElement);
    var n = !i && e.parentElement.textContent.trim() === '';
    var r = e.parentElement.getAttribute('id') !== 'MSWord-Content';
    var o = !this.hasParentWithClass(e, 'MsoListParagraph');
    var a = p(e.parentElement.querySelector('img'));
    return n && r && o && a ? this.findDetachEmptyElem(e.parentElement) : e;
  };
  s.prototype.hasParentWithClass = function (e, t) {
    for (var i = e.parentElement; !p(i); ) {
      if (i.classList.contains(t)) return true;
      i = i.parentElement;
    }
    return false;
  };
  s.prototype.removeEmptyElements = function (e) {
    for (var t = e.querySelectorAll(':empty'), i = 0; i < t.length; i++) {
      var n = t[i];
      if (this.isEmptyCellWithMsoNormal(n)) {
        n.innerHTML = '-';
      }
      var r = this.isDivWithoutBorder(n);
      if (this.shouldRemoveEmptyElement(n, r)) {
        var o = this.findDetachEmptyElem(n);
        if (!p(o)) {
          y(o);
        }
      }
    }
  };
  s.prototype.isEmptyCellWithMsoNormal = function (e) {
    var t = e.closest('td');
    return !p(t) && !p(t.querySelector('.MsoNormal'));
  };
  s.prototype.isDivWithoutBorder = function (e) {
    if (e.tagName !== 'DIV') return true;
    var t = e.style.borderBottom;
    return e.style.borderBottom === 'none' || e.style.borderBottom === '';
  };
  s.prototype.shouldRemoveEmptyElement = function (e, t) {
    var i = ['IMG', 'BR', 'IFRAME', 'TD', 'TH', 'HR'];
    return i.indexOf(e.tagName) === -1 && t;
  };
  s.prototype.removeEmptyMetaTags = function (e) {
    for (var t = e.querySelectorAll('meta:empty'), i = t.length - 1; i >= 0; i--) {
      var n = t[i];
      if (t[i].textContent === '') {
        y(t[i]);
      }
    }
  };
  s.prototype.styleCorrection = function (e, t) {
    var i = e.querySelectorAll('style');
    var n = [];
    if (i.length !== 0) {
      var r = /[\S ]+\s+{[\s\S]+?}/gi;
      p(i[0].innerHTML.match(r)) ? i.length > 1 && (n = i[1].innerHTML.match(r)) : (n = i[0].innerHTML.match(r));
      var o = p(n) ? null : this.findStyleObject(n);
      if (!p(o)) {
        var a = this.sortSelectors(Object.keys(o));
        var l = a.map(function (h) {
          return o['' + h];
        });
        l = this.removeUnwantedStyle(l, t);
        this.filterStyles(e, t);
        this.applyStylesToElements(e, a, l);
        this.processListStyles(e, a, l);
      }
    }
  };
  s.prototype.sortSelectors = function (e) {
    return e.sort(function (t, i) {
      return (t.trim().startsWith('.') ? 0 : 1) - (i.trim().startsWith('.') ? 0 : 1);
    });
  };
  s.prototype.filterStyles = function (e, t) {
    for (var i = e.querySelectorAll('*[style]'), n = 0; n < i.length; n++) {
      for (var r = i[n], o = r.getAttribute('style').split(';'), a = '', l = 0; l < o.length; l++) {
        var h = o[l];
        var c = o[l].split(':')[0].trim();
        if (t.indexOf(c) >= 0) {
          a += o[l] + ';';
        }
      }
      r.style.cssText = a;
    }
  };
  s.prototype.applyStylesToElements = function (e, t, i) {
    for (var n, r = false, o = /^(p|div|li)\.(1|10|11)$/, a = 0; a < t.length; a++) {
      var l = t[a];
      var h = t[a].split('.');
      var c = h[0];
      if (h[0] === '') {
        var d = h[1];
        n = e.getElementsByClassName(h[1]);
        r = true;
      } else {
        if ((h.length === 1 && h[0].indexOf('@') >= 0) || o.test(t[a])) continue;
        h.length === 1 && h[0].indexOf('@') < 0 ? (n = e.getElementsByTagName(h[0])) : (n = e.querySelectorAll(t[a]));
      }
      this.applyStyleToElementCollection(n, t[a], i[a], r);
      r = false;
    }
  };
  s.prototype.applyStyleToElementCollection = function (e, t, i, n) {
    for (var r = 0; r < e.length; r++) {
      var o = e[r];
      if (!(e[r].closest('li') && t === 'p')) {
        var a = e[r].getAttribute('style');
        var l = !p(a) && a.trim() !== '';
        if (l) {
          var h = i.split(';');
          this.removeBorderNoneStyles(h);
          if (!n) {
            this.removeOverlappingStyles(h, a);
          }
          var c = h.join(';') + ';' + a;
          e[r].style.cssText = c;
        } else {
          i = i
            .replace(/text-indent:-.*?;?/g, '')
            .replace(/border:\s*none;?/g, '')
            .trim();
          e[r].style.cssText = i;
        }
      }
    }
  };
  s.prototype.removeBorderNoneStyles = function (e) {
    for (var t = 0; t < e.length; t++) {
      var i = e[t].split(':');
      if (i[0] === 'border' && i[1] === 'none') {
        e.splice(t, 1);
        t--;
      }
    }
  };
  s.prototype.removeOverlappingStyles = function (e, t) {
    for (var i = 0; i < e.length; i++) {
      var n = e[i].split(':')[0];
      if (t.indexOf(e[i].split(':')[0] + ':') >= 0) {
        e.splice(i, 1);
        i--;
      }
    }
  };
  s.prototype.processListStyles = function (e, t, i) {
    for (
      var n = ['MsoListParagraphCxSpFirst', 'MsoListParagraphCxSpMiddle', 'MsoListParagraphCxSpLast'], r = 0;
      r < n.length;
      r++
    ) {
      var o = n[r];
      var a = 'li.' + n[r];
      var l = t.indexOf(a);
      if (l > -1) {
        var h = e.querySelectorAll('ol.' + n[r] + ', ul.' + n[r]);
        this.adjustListMargins(h, i[l]);
      }
    }
  };
  s.prototype.adjustListMargins = function (e, t) {
    for (var i = 0; i < e.length; i++) {
      var n = e[i];
      var r = e[i].getAttribute('style');
      var o = !p(r) && r.trim() !== '' && e[i].style.marginLeft !== '';
      if (o)
        for (var a = t.split(';'), l = 0; l < a.length; l++) {
          var h = a[l];
          var c = a[l].split(':')[0];
          if ('margin-left'.indexOf(a[l].split(':')[0]) >= 0) {
            this.adjustMarginLeftValue(e[i], a[l]);
          }
        }
    }
  };
  s.prototype.adjustMarginLeftValue = function (e, t) {
    var i = t.split(':');
    var n = i[1];
    var r = e.style.marginLeft;
    var o = !p(i[1]) && i[1].indexOf('in') >= 0 && e.style.marginLeft.indexOf('in') >= 0;
    if (o) {
      var a = parseFloat(i[1].split('in')[0]);
      var l = parseFloat(e.style.marginLeft.split('in')[0]);
      e.style.marginLeft = l - a + 'in';
    }
  };
  s.prototype.removeUnwantedStyle = function (e, t) {
    for (var i = [], n = 0; n < e.length; n++) {
      for (var r = e[n].split(';'), o = '', a = 0; a < r.length; a++) {
        var l = r[a];
        var h = r[a].split(':')[0];
        if (t.indexOf(r[a].split(':')[0]) >= 0) {
          o += r[a] + ';';
        }
      }
      i[n] = o;
    }
    return i;
  };
  s.prototype.findStyleObject = function (e) {
    for (var t = {}, i = 0; i < e.length; i++) {
      var n = e[i];
      var r = e[i].replace(/([\S ]+\s+){[\s\S]+?}/gi, '$1');
      var o = e[i].replace(/[\S ]+\s+{([\s\S]+?)}/gi, '$1');
      r = this.cleanupStyleText(r);
      o = this.cleanupStyleText(o);
      for (var a = r.split(', '), l = 0; l < a.length; l++) t[a[l]] = o;
    }
    return t;
  };
  s.prototype.cleanupStyleText = function (e) {
    var t = e;
    t = t.replace(/^[\s]|[\s]$/gm, '');
    t = t.replace(/\n|\r|\n\r/g, '');
    return t;
  };
  s.prototype.removingComments = function (e) {
    var t = e.innerHTML;
    var i = /<!--[\s\S]*?-->/g;
    var n = e.innerHTML.replace(i, '');
    e.innerHTML = n;
  };
  s.prototype.listCleanUp = function (e, t) {
    for (var i = false, n = e.querySelectorAll('*'), r = 0; r < n.length; r++) {
      var o = n[r];
      if (!this.shouldIgnoreElement(n[r])) {
        if (this.isMsoListParagraph(n[r])) {
          if (this.isFirstListItem(n[r]) && t.length > 0 && t[t.length - 1] !== null) {
            t.push(null);
          }
          t.push(n[r]);
        }
        if (this.shouldAddListSeparator(i, n[r])) {
          t.push(null);
        }
        if (this.isBlockElement(n[r])) {
          i = this.isMsoListParagraph(n[r]);
        }
      }
    }
    if (t.length > 0 && t[t.length - 1] !== null) {
      t.push(null);
    }
    return t;
  };
  s.prototype.shouldIgnoreElement = function (e) {
    var t = this.ignorableNodes.indexOf(e.nodeName) === -1;
    var i = e.nodeType === 3 && e.textContent.trim() === '';
    return t || i;
  };
  s.prototype.isMsoListParagraph = function (e) {
    var t = e.className;
    var i = e.className && e.className.toLowerCase().indexOf('msolistparagraph') !== -1;
    var n = e.getAttribute('style');
    var r = !p(n) && n.indexOf('mso-list:') >= 0;
    return i && r;
  };
  s.prototype.isFirstListItem = function (e) {
    return e.className.indexOf('MsoListParagraphCxSpFirst') >= 0;
  };
  s.prototype.shouldAddListSeparator = function (e, t) {
    return e && this.isBlockElement(t) && !this.isMsoListParagraph(t);
  };
  s.prototype.isBlockElement = function (e) {
    return this.blockNode.indexOf(e.nodeName.toLowerCase()) !== -1;
  };
  s.prototype.listConverter = function (e) {
    var t = [];
    var i = [];
    var n = '';
    this.processListNodes(e, t, i, '');
    this.replaceNodesWithLists(e, t);
  };
  s.prototype.processListNodes = function (e, t, i, n) {
    for (var r, o = 0; o < e.length; o++) {
      var a = e[o];
      if (e[o] === null) {
        t.push({
          content: this.makeConversion(i),
          node: e[o - 1],
        });
        i = [];
        continue;
      }
      this.fixOutlineLevel(e[o]);
      var l = e[o].getAttribute('style') || '';
      var h = this.extractNestingLevel(l);
      r = this.extractListFormatOverride(l, r);
      this.listContents = [];
      this.getListContent(e[o]);
      if (!p(this.listContents[0])) {
        for (
          var c = this.determineListProperties(this.listContents[0], o, e, e[o]), d = [], u = 1;
          u < this.listContents.length;
          u++
        )
          d.push(this.listContents[u]);
        var f = p(e[o].className) ? '' : e[o].className;
        n = this.updateNodeStyle(e[o], l);
        i.push({
          listType: c.type,
          content: d,
          nestedLevel: h,
          listFormatOverride: r,
          class: f,
          listStyle: n,
          listStyleTypeName: c.styleType,
          start: c.startAttr,
          styleMarginLeft: c.marginLeft,
        });
      }
    }
  };
  s.prototype.fixOutlineLevel = function (e) {
    var t = e.getAttribute('style');
    if (t && t.indexOf('mso-outline-level') !== -1) {
      e.style.cssText = t.replace('mso-outline-level', 'mso-outline');
    }
  };
  s.prototype.extractNestingLevel = function (e) {
    return e && e.indexOf('level') !== -1 ? parseInt(e.charAt(e.indexOf('level') + 5), null) : 1;
  };
  s.prototype.extractListFormatOverride = function (e, t) {
    if (e && e.indexOf('mso-list:') !== -1)
      if (e.match(/mso-list:[^;]+;?/)) {
        var i = e.replace(new RegExp('\\n', 'g'), '').split(' ').join('');
        var n = i.match(/mso-list:[^;]+;?/)[0].split(':l');
        return p(n) ? null : parseInt(n[1].split('level')[0], 10);
      } else return null;
    return t;
  };
  s.prototype.determineListProperties = function (e, t, i, n) {
    var r = {
      type: e.trim().length > 1 ? 'ol' : 'ul',
      styleType: '',
    };
    r.styleType = this.getlistStyleType(e, r.type);
    if (r.type === 'ol' && (t === 0 || i[t - 1] === null)) {
      r.startAttr = this.determineStartAttribute(e, r.styleType);
    }
    if (n.style.marginLeft !== '') {
      r.marginLeft = n.style.marginLeft;
    }
    return r;
  };
  s.prototype.determineStartAttribute = function (e, t) {
    var i = e.split('.')[0];
    var n = ['A', 'a', 'I', 'i', 'α', '1', '01', '1-'];
    if (n.indexOf(e.split('.')[0]) === -1)
      switch (t) {
        case 'decimal':
        case 'decimal-leading-zero':
          if (!isNaN(parseInt(e.split('.')[0], 10))) return parseInt(e.split('.')[0], 10);
          break;
        case 'upper-alpha':
          return e.split('.')[0].split('.')[0].charCodeAt(0) - 64;
        case 'lower-alpha':
          return e.split('.')[0].split('.')[0].charCodeAt(0) - 96;
        case 'upper-roman':
          return this.upperRomanNumber.indexOf(e.split('.')[0].split('.')[0]) + 1;
        case 'lower-roman':
          return this.lowerRomanNumber.indexOf(e.split('.')[0].split('.')[0]) + 1;
        case 'lower-greek':
          return this.lowerGreekNumber.indexOf(e.split('.')[0].split('.')[0]) + 1;
        default:
          return;
      }
  };
  s.prototype.updateNodeStyle = function (e, t) {
    return p(e.getAttribute('style'))
      ? ''
      : ((e.style.cssText = t.replace('text-align:start;', '')), (e.style.textIndent = ''), e.getAttribute('style'));
  };
  s.prototype.replaceNodesWithLists = function (e, t) {
    for (var i = e.shift(); i; ) {
      for (var n = [], r = 0; r < t.length; r++)
        if (t[r].node === i) {
          for (var o = t[r].content, a = 0; a < o.childNodes.length; a++) n.push(o.childNodes[a]);
          for (var a = 0; a < n.length; a++) i.parentElement.insertBefore(n[a], i);
          break;
        }
      i.remove();
      i = e.shift();
      if (!i) {
        i = e.shift();
      }
    }
  };
  s.prototype.getlistStyleType = function (e, t) {
    var i = e.split('.')[0];
    return t === 'ol' ? this.getOrderedListStyleType(e.split('.')[0]) : this.getUnorderedListStyleType(e.split('.')[0]);
  };
  s.prototype.getOrderedListStyleType = function (e) {
    var t = e.charCodeAt(0);
    if (this.upperRomanNumber.indexOf(e) > -1) return 'upper-roman';
    if (this.lowerRomanNumber.indexOf(e) > -1) return 'lower-roman';
    if (this.lowerGreekNumber.indexOf(e) > -1) return 'lower-greek';
    if (t > 64 && t < 91) return 'upper-alpha';
    if (t > 96 && t < 123) return 'lower-alpha';
    var i = e.length > 1 && e[0] === '0' && !isNaN(Number(e));
    return i ? 'decimal-leading-zero' : 'decimal';
  };
  s.prototype.getUnorderedListStyleType = function (e) {
    switch (e) {
      case 'o':
        return 'circle';
      case '\xA7':
        return 'square';
      default:
        return 'disc';
    }
  };
  s.prototype.makeConversion = function (e) {
    var t = E('div');
    var i = 'e-current-list-item';
    if (e.length === 0) return t;
    for (var n, r = 1, o, a = 0, l = e[0].listFormatOverride, h = 0; h < e.length; h++) {
      var c = e[h];
      var d = this.isStandardListType(e[h].class);
      if (o) {
        o.classList.remove('e-current-list-item');
      }
      if (this.shouldResetListItem(o, h, e, d)) {
        o = null;
      }
      var u = this.createParagraphWithContent(e[h]);
      this.isNewRootList(e[h], a, l)
        ? ((n = this.createRootList(t, e[h], u)), (o = n.querySelector('.e-current-list-item')))
        : this.isSameLevelList(e[h], r, l)
          ? ((n = this.addToSameLevelList(e[h], n, u, o, t)), (o = n.querySelector('.e-current-list-item')))
          : this.isDeeperNestedList(e[h], r)
            ? ((n = this.createNestedList(e[h], o, u, d, t, r)), (o = n.querySelector('.e-current-list-item')))
            : this.isTopLevelList(e[h])
              ? ((n = this.handleTopLevelList(e[h], t, u)), (o = n.querySelector('.e-current-list-item')))
              : (this.handleOtherNestingScenarios(e[h], o, u, l), (o = t.querySelector('.e-current-list-item')));
      this.applyListItemStyles(o, e[h]);
      r = e[h].nestedLevel;
      l = e[h].listFormatOverride;
      a++;
      this.setStartAttributeIfNeeded(n, e[h]);
    }
    for (var f = t.querySelectorAll('.e-current-list-item'), h = 0; h < f.length; h++) {
      f[h].classList.remove('e-current-list-item');
      if (f[h].className === '') {
        f[h].removeAttribute('class');
      }
    }
    return t;
  };
  s.prototype.isStandardListType = function (e) {
    for (
      var t = ['MsoListParagraphCxSpFirst', 'MsoListParagraphCxSpMiddle', 'MsoListParagraphCxSpLast'], i = 0;
      i < t.length;
      i++
    )
      if (!p(e) && t[i].indexOf(e) >= 0) return true;
    return false;
  };
  s.prototype.shouldResetListItem = function (e, t, i, n) {
    return !p(e) && t !== 0 && i[t - 1].listType !== i[t].listType && !n;
  };
  s.prototype.createParagraphWithContent = function (e) {
    var t = E('p', { className: 'MsoNoSpacing' });
    t.innerHTML = e.content.join(' ');
    return t;
  };
  s.prototype.isNewRootList = function (e, t, i) {
    return e.nestedLevel === 1 && (t === 0 || i !== e.listFormatOverride) && e.content.length > 0;
  };
  s.prototype.createRootList = function (e, t, i) {
    var n = E(t.listType, { className: t.class });
    var r = E('li');
    r.appendChild(i);
    n.appendChild(r);
    e.appendChild(n);
    n.setAttribute('level', t.nestedLevel.toString());
    t.class !== 'msolistparagraph' ? (n.style.marginLeft = t.styleMarginLeft) : B([n], 'marginLeftIgnore');
    n.style.listStyleType = t.listStyleTypeName;
    r.classList.add('e-current-list-item');
    return n;
  };
  s.prototype.isSameLevelList = function (e, t, i) {
    return e.nestedLevel === t && i === e.listFormatOverride;
  };
  s.prototype.addToSameLevelList = function (e, t, i, n, r) {
    if (!p(n) && !p(n.parentElement) && n.parentElement.tagName.toLowerCase() === e.listType) {
      var o = E('li');
      o.classList.add('e-current-list-item');
      o.appendChild(i);
      n.parentElement.appendChild(o);
      return n.parentElement;
    } else if (p(n)) {
      var a = E(e.listType);
      a.style.listStyleType = e.listStyleTypeName;
      var o = E('li');
      o.classList.add('e-current-list-item');
      o.appendChild(i);
      a.appendChild(o);
      a.setAttribute('level', e.nestedLevel.toString());
      r.appendChild(a);
      return a;
    } else {
      var a = E(e.listType);
      a.style.listStyleType = e.listStyleTypeName;
      var o = E('li');
      o.classList.add('e-current-list-item');
      o.appendChild(i);
      a.appendChild(o);
      a.setAttribute('level', e.nestedLevel.toString());
      n.parentElement.parentElement.appendChild(a);
      return a;
    }
  };
  s.prototype.isDeeperNestedList = function (e, t) {
    return e.nestedLevel > t;
  };
  s.prototype.createNestedList = function (e, t, i, n, r, o) {
    var a;
    if (p(t)) return n ? this.createStandardNestedList(e, i, r) : this.createRootList(r, e, i);
    for (var l = e.nestedLevel - o, h = 0; h < l; h++) {
      a = E(e.listType);
      t.appendChild(a);
      t = E('li');
      if (h !== l - 1 && l > 1) {
        t.style.listStyleType = 'none';
      }
      a.appendChild(t);
    }
    t.classList.add('e-current-list-item');
    t.appendChild(i);
    a.setAttribute('level', e.nestedLevel.toString());
    a.style.listStyleType = e.listStyleTypeName;
    return a;
  };
  s.prototype.createStandardNestedList = function (e, t, i) {
    var n = E(e.listType);
    var r = E('li');
    var o;
    n.appendChild(r);
    n.style.listStyleType = 'none';
    for (var a = 0; a < e.nestedLevel - 1; a++) {
      o = E(e.listType);
      r.appendChild(o);
      r = E('li');
      o.appendChild(r);
      o.style.listStyleType = 'none';
    }
    r.classList.add('e-current-list-item');
    r.appendChild(t);
    i.appendChild(n);
    o.setAttribute('level', e.nestedLevel.toString());
    o.style.listStyleType = e.listStyleTypeName;
    return o;
  };
  s.prototype.getLastListItem = function (e) {
    return e.querySelector('li:last-child');
  };
  s.prototype.isTopLevelList = function (e) {
    return e.nestedLevel === 1;
  };
  s.prototype.handleTopLevelList = function (e, t, i) {
    var n;
    var r = t.lastChild;
    t.lastChild && t.lastChild.tagName.toLowerCase() === e.listType
      ? (n = t.lastChild)
      : ((n = E(e.listType)), (n.style.listStyleType = e.listStyleTypeName), t.appendChild(n));
    var o = E('li');
    o.appendChild(i);
    n.appendChild(o);
    n.setAttribute('level', e.nestedLevel.toString());
    o.classList.add('e-current-list-item');
    return n;
  };
  s.prototype.handleOtherNestingScenarios = function (e, t, i, n) {
    for (var r = t, o; r.parentElement; ) {
      r = r.parentElement;
      var a = r.attributes.getNamedItem('level');
      if (a) {
        var l = parseInt(a.textContent, 10);
        if (l === e.nestedLevel && n === e.listFormatOverride) {
          var h = E('li');
          h.appendChild(i);
          r.appendChild(h);
          h.classList.add('e-current-list-item');
          break;
        } else if (l === e.nestedLevel && n !== e.listFormatOverride) {
          this.createDifferentFormatList(e, r, i);
          break;
        } else if (e.nestedLevel > l) {
          o = E(e.listType);
          var h = E('li');
          h.appendChild(i);
          o.appendChild(h);
          r.appendChild(o);
          o.setAttribute('level', e.nestedLevel.toString());
          o.style.listStyleType = e.listStyleTypeName;
          h.classList.add('e-current-list-item');
          break;
        }
      }
    }
  };
  s.prototype.createDifferentFormatList = function (e, t, i) {
    var n = E(e.listType);
    var r = E('li');
    n.appendChild(r);
    if (e.nestedLevel > 1)
      for (var o = 0; o < e.nestedLevel - 1; o++) {
        r.appendChild((n = E(e.listType)));
        r = E('li');
        n.appendChild(r);
        n.style.listStyleType = 'none';
      }
    r.appendChild(i);
    r.classList.add('e-current-list-item');
    t.appendChild(n);
    n.setAttribute('level', e.nestedLevel.toString());
    n.style.listStyleType = e.listStyleTypeName;
  };
  s.prototype.applyListItemStyles = function (e, t) {
    if (!p(e)) {
      e.setAttribute('class', t.class);
      e.style.cssText = p(t.listStyle) ? '' : t.listStyle;
    }
  };
  s.prototype.setStartAttributeIfNeeded = function (e, t) {
    var i = !p(t.start) && t.start !== 1 && t.listType === 'ol';
    if (i) {
      e.setAttribute('start', t.start.toString());
    }
  };
  s.prototype.getListContent = function (e) {
    var t = e.firstElementChild;
    this.isImageList(e.firstElementChild)
      ? this.handleImageList(e)
      : e.firstElementChild.childNodes.length > 0 && this.handleTextList(e, e.firstElementChild);
    this.listContents.push(e.innerHTML);
  };
  s.prototype.isImageList = function (e) {
    return e.textContent.trim() === '' && !p(e.firstElementChild) && e.firstElementChild.nodeName === 'IMG';
  };
  s.prototype.handleImageList = function (e) {
    var t = e.innerHTML.trim();
    this.listContents.push('');
    this.listContents.push(t);
  };
  s.prototype.handleTextList = function (e, t) {
    this.cleanupListIgnoreTags(t);
    var i = this.cleanupListOrder(t);
    this.processListOrderElement(e, t, i);
  };
  s.prototype.cleanupListIgnoreTags = function (e) {
    for (var t = e.querySelectorAll('[style*="mso-list"]'), i = 0; i < t.length; i++) {
      var n = t[i];
      var r = t[i].getAttribute('style').replace(/\n/g, '');
      t[i].setAttribute('style', r);
    }
  };
  s.prototype.cleanupListOrder = function (e) {
    var t = e.querySelector('span[style*="mso-list"]');
    if (t) {
      var i = t.getAttribute('style');
      if (i) {
        i = i.replace(/\s*:\s*/g, ':');
        t.setAttribute('style', i);
      }
    }
    return e.querySelector('span[style="mso-list:Ignore"]');
  };
  s.prototype.processListOrderElement = function (e, t, i) {
    var n = p(i);
    i = n ? t : i;
    if (!p(i)) {
      var r = i.textContent.trim();
      if (n) {
        r = this.extractBulletMarker(i, r);
      }
      this.listContents.push(r);
      if (!n) {
        y(i);
      }
      this.removingComments(e);
      this.removeUnwantedElements(e);
    }
  };
  s.prototype.extractBulletMarker = function (e, t) {
    var i = /^(\d{1,2}|[a-zA-Z]|[*#~•○■])(\.|\)|-)\s*/;
    var n = t.match(i);
    if (!p(n)) {
      var r = n[0].trim();
      e.textContent = e.textContent.trim().substring(r.length).trim();
      return r;
    }
    return t;
  };
  s.prototype.processMargin = function (e) {
    this.processListItemMargins(e);
    this.processTableMargins(e);
    this.processIgnoredNodeMargins(e);
  };
  s.prototype.processListItemMargins = function (e) {
    for (var t = e.querySelectorAll('li'), i = 0; i < t.length; i++) {
      var n = t[i];
      if (!p(t[i].style.marginLeft) && !t[i].parentElement.classList.contains('marginLeftIgnore')) {
        t[i].style.marginLeft = '';
      }
    }
  };
  s.prototype.processTableMargins = function (e) {
    for (var t = e.querySelectorAll('table'), i = 0; i < t.length; i++) {
      var n = t[i];
      var r = t[i].style.marginLeft;
      if (!p(t[i].style.marginLeft) && t[i].style.marginLeft.indexOf('-') >= 0) {
        t[i].style.marginLeft = '';
      }
    }
  };
  s.prototype.processIgnoredNodeMargins = function (e) {
    for (var t = e.querySelectorAll('.marginLeftIgnore li'), i = 0; i < t.length; i++) {
      var n = t[i];
      var r = t[i].style.marginLeft;
      if (!p(t[i].style.marginLeft) && t[i].style.marginLeft !== '') {
        var o = parseFloat(t[i].style.marginLeft.split('in')[0]);
        var a = o - 0.5;
        t[i].style.marginLeft = a.toString() + 'in';
      }
    }
  };
  s.prototype.removeEmptyAnchorTag1 = function (e) {
    for (var t = e.querySelectorAll('a:not([href])'), i = t.length - 1; i >= 0; i--) {
      for (var n = t[i].parentNode; t[i].firstChild; ) n.insertBefore(t[i].firstChild, t[i]);
      n.removeChild(t[i]);
    }
  };
  s.prototype.removeEmptyAnchorTag = function (e) {
    for (var t = e.querySelectorAll('a:not([href])'), i = t.length - 1; i >= 0; i--) {
      for (var n = t[i], r = n.parentNode; n.firstChild; ) r.insertBefore(n.firstChild, n);
      r.removeChild(n);
    }
  };
  s.prototype.findSource = function (e) {
    for (var t = e.querySelectorAll('meta'), i = 0; i < t.length; i++) {
      var n = t[i];
      var r = t[i].getAttribute('content');
      var o = t[i].getAttribute('name');
      var a = o && o.toLowerCase().indexOf('generator') >= 0 && r && r.toLowerCase().indexOf('microsoft') >= 0;
      if (a)
        for (var l = 0; l < ni.length; l++) {
          var h = ni[l];
          if (r.toLowerCase().indexOf(ni[l]) >= 0) return ni[l];
        }
    }
    return 'html';
  };
  s.prototype.handleOneNoteContent = function (e) {
    for (var t = e.querySelectorAll('ul, ol'), i = 0; i < t.length; i++) {
      var n = t[i];
      var r = t[i].querySelectorAll('li').length === 0;
      var o = t[i].childNodes.length > 0;
      if (r && o) {
        V.unwrap(t[i]);
      }
    }
  };
  s.prototype.destroy = function () {
    this.removeEventListener();
  };
  return s;
})();
var cs = (function () {
  function s(e) {
    this.parent = e;
    this.addEventListener();
  }
  s.prototype.addEventListener = function () {
    this.parent.observer.on(Bi, this.insertText, this);
    this.parent.observer.on(J, this.destroy, this);
  };
  s.prototype.removeEventListener = function () {
    this.parent.observer.off(Bi, this.insertText);
    this.parent.observer.off(J, this.destroy);
  };
  s.prototype.insertText = function (e) {
    var t = document.createTextNode(e.value);
    Pe.Insert(this.parent.currentDocument, t, this.parent.editableElement);
    if (e.callBack) {
      e.callBack({
        requestType: e.subCommand,
        editorMode: 'HTML',
        event: e.event,
        range: this.parent.nodeSelection.getRange(this.parent.currentDocument),
        elements: this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument),
      });
    }
  };
  s.prototype.destroy = function () {
    this.removeEventListener();
  };
  return s;
})();
var ds = (function () {
  function s(e) {
    this.clickCount = 0;
    this.lastClickTime = 0;
    this.currentDocument = e.document;
    this.editableElement = e.editableElement;
    this.nodeSelection = new Se(this.editableElement);
    this.nodeCutter = new gt();
    this.domNode = new ei(this.editableElement, this.currentDocument);
    this.domTree = new Mt(this.editableElement);
    this.observer = new ro(this);
    this.listObj = new ts(this);
    this.formatObj = new is(this);
    this.alignmentObj = new ns(this);
    this.indentsObj = new rs(this);
    this.selectionObj = new os(this);
    this.inserthtmlObj = new as(this);
    this.insertTextObj = new cs(this);
    this.clearObj = new ls(this);
    this.undoRedoManager = new hs(this, e.options);
    this.msWordPaste = new ps(this);
    this.tableCellSelection = new Kr(this.editableElement, this.currentDocument);
    this.userAgentData = new Mr(M.userAgent, false);
    this.wireEvents();
    this.isDestroyed = false;
  }
  s.prototype.wireEvents = function () {
    this.observer.on(Ri, this.editorKeyDown, this);
    this.observer.on(ct, this.editorKeyUp, this);
    this.observer.on(ct, this.editorKeyUp, this);
    this.observer.on(kn, this.onPropertyChanged, this);
    this.observer.on(wn, this.onWordPaste, this);
    this.observer.on(Ai, this.onBegin, this);
    this.observer.on(Dn, this.editorMouseDown, this);
    this.observer.on(On, this.destroy, this);
  };
  s.prototype.unwireEvents = function () {
    this.observer.off(Ri, this.editorKeyDown);
    this.observer.off(ct, this.editorKeyUp);
    this.observer.off(ct, this.editorKeyUp);
    this.observer.off(kn, this.onPropertyChanged);
    this.observer.off(wn, this.onWordPaste);
    this.observer.off(Ai, this.onBegin);
    this.observer.off(Dn, this.editorMouseDown);
    this.observer.off(On, this.destroy);
  };
  s.prototype.onWordPaste = function (e) {
    this.observer.notify(Mi, e);
  };
  s.prototype.onPropertyChanged = function (e) {
    this.observer.notify(Oi, e);
  };
  s.prototype.editorKeyDown = function (e) {
    this.observer.notify(ae, e);
  };
  s.prototype.editorKeyUp = function (e) {
    this.observer.notify(tt, e);
  };
  s.prototype.onBegin = function (e) {
    this.observer.notify(yi, e);
  };
  s.prototype.execCommand = function (e, t, i, n, r, o, a, l) {
    switch (e.toLowerCase()) {
      case 'lists':
        this.observer.notify(zt, {
          subCommand: t,
          event: i,
          callBack: n,
          selector: a,
          item: o,
          enterAction: l,
        });
        break;
      case 'checklist':
        this.observer.notify(zt, {
          subCommand: t,
          event: i,
          callBack: n,
          selector: a,
          item: o,
          enterAction: l,
        });
        break;
      case 'codeblock':
        this.observer.notify(ho, {
          subCommand: t,
          event: i,
          callBack: n,
          selector: a,
          item: o,
          enterAction: l,
        });
        break;
      case 'formats':
        this.observer.notify(Si, {
          subCommand: t,
          event: i,
          callBack: n,
          selector: a,
          exeValue: o,
          enterAction: l,
        });
        break;
      case 'alignments':
        this.observer.notify(Li, {
          subCommand: t,
          event: i,
          callBack: n,
          selector: a,
          value: o,
          enterAction: l,
        });
        break;
      case 'indents':
        this.observer.notify(Ei, {
          subCommand: t,
          event: i,
          callBack: n,
          selector: a,
          enterAction: l,
        });
        break;
      case 'links':
        this.observer.notify(Br, {
          command: e,
          value: t,
          item: o,
          event: i,
          callBack: n,
          enterAction: l,
        });
        break;
      case 'files':
        this.observer.notify(wt, {
          command: e,
          value: 'Image',
          item: o,
          event: i,
          callBack: n,
          selector: a,
        });
        break;
      case 'images':
        this.observer.notify(wt, {
          command: e,
          value: t,
          item: o,
          event: i,
          callBack: n,
          selector: a,
        });
        break;
      case 'audios':
        this.observer.notify(lo, {
          command: e,
          value: t,
          item: o,
          event: i,
          callBack: n,
          selector: a,
        });
        break;
      case 'videos':
        this.observer.notify(so, {
          command: e,
          value: t,
          item: o,
          event: i,
          callBack: n,
          selector: a,
        });
        break;
      case 'table':
        switch (t.toString().toLocaleLowerCase()) {
          case 'createtable':
            this.observer.notify(Vi, {
              item: o,
              event: i,
              callBack: n,
              enterAction: l,
            });
            break;
          case 'insertrowbefore':
          case 'insertrowafter':
            this.observer.notify(Wi, {
              item: o,
              event: i,
              callBack: n,
            });
            break;
          case 'insertcolumnleft':
          case 'insertcolumnright':
            this.observer.notify(Qi, {
              item: o,
              event: i,
              callBack: n,
            });
            break;
          case 'deleterow':
            this.observer.notify(Ui, {
              item: o,
              event: i,
              callBack: n,
            });
            break;
          case 'deletecolumn':
            this.observer.notify(_i, {
              item: o,
              event: i,
              callBack: n,
            });
            break;
          case 'tableremove':
            this.observer.notify(zi, {
              item: o,
              event: i,
              callBack: n,
            });
            break;
          case 'tableheader':
            this.observer.notify(ji, {
              item: o,
              event: i,
              callBack: n,
            });
            break;
          case 'aligntop':
          case 'alignmiddle':
          case 'alignbottom':
            this.observer.notify(Fi, {
              item: o,
              event: i,
              callBack: n,
            });
            break;
          case 'merge':
            this.observer.notify(qi, {
              item: o,
              event: i,
              callBack: n,
            });
            break;
          case 'horizontalsplit':
            this.observer.notify(Hi, {
              item: o,
              event: i,
              callBack: n,
            });
            break;
          case 'verticalsplit':
            this.observer.notify(Pi, {
              item: o,
              event: i,
              callBack: n,
            });
            break;
          case 'dashed':
          case 'alternate':
          case 'custom':
            this.observer.notify(Ii, {
              item: o,
              event: i,
              callBack: n,
            });
            break;
          case 'backgroundcolor':
            this.observer.notify(xi, {
              subCommand: t,
              value: o,
              event: i,
              callBack: n,
            });
            break;
        }
        break;
      case 'font':
      case 'style':
      case 'effects':
      case 'casing':
        this.observer.notify(Ni, {
          subCommand: t,
          event: i,
          callBack: n,
          value: r,
          selector: a,
          enterAction: l,
        });
        break;
      case 'inserthtml':
        this.observer.notify(ki, {
          subCommand: t,
          callBack: n,
          value: r,
          enterAction: l,
        });
        break;
      case 'inserttext':
        this.observer.notify(Bi, {
          subCommand: t,
          callBack: n,
          value: r,
        });
        break;
      case 'clear':
        this.observer.notify(wi, {
          subCommand: t,
          event: i,
          callBack: n,
          selector: a,
          enterAction: l,
        });
        break;
      case 'actions':
        this.observer.notify(Di, {
          subCommand: t,
          event: i,
          callBack: n,
          selector: a,
        });
        break;
      case 'formatpainter':
        this.observer.notify(ao, {
          item: o,
          subCommand: t,
          event: i,
          callBack: n,
        });
        break;
      case 'emojipicker':
        this.observer.notify(oo, {
          item: o,
          subCommand: t,
          value: r,
          event: i,
          callBack: n,
        });
    }
  };
  s.prototype.editorMouseDown = function (e) {
    if (e.args.detail === 3) {
      this.tripleClickSelection(e.args);
    }
    if (M.userAgent.indexOf('Safari') !== -1) {
      var t = new Date().getTime();
      if (t - this.lastClickTime > 500) {
        this.clickCount = 0;
      }
      this.clickCount++;
      this.lastClickTime = t;
      if (this.clickCount === 3) {
        this.tripleClickSelection(e.args);
        this.clickCount = 0;
      }
    }
  };
  s.prototype.tripleClickSelection = function (e) {
    var t = this.nodeSelection.getRange(this.currentDocument);
    var i = this.nodeSelection.get(this.currentDocument);
    var n = new Mt(this.editableElement);
    if (i.rangeCount > 0 && i.toString() !== '') {
      var r = this.getParentBlockNode(t.startContainer);
      var o = this.getParentBlockNode(t.endContainer);
      if (r && o && r === o) {
        var a = this.currentDocument.createRange();
        var l = n.getFirstTextNode(r);
        var h = n.getLastTextNode(o);
        if (l && h) {
          a.setStart(l, 0);
          a.setEnd(h, h.textContent.length);
          this.nodeSelection.setRange(this.currentDocument, a);
          e.preventDefault();
        }
      }
    }
  };
  s.prototype.getParentBlockNode = function (e) {
    var t = this.currentDocument.createTreeWalker(this.editableElement, NodeFilter.SHOW_ELEMENT, {
      acceptNode: function (n) {
        var r = window.getComputedStyle(n).display;
        return window.getComputedStyle(n).display.indexOf('inline') < 0
          ? NodeFilter.FILTER_ACCEPT
          : NodeFilter.FILTER_SKIP;
      },
    });
    t.currentNode = e;
    var i = t.parentNode();
    return i;
  };
  s.prototype.destroy = function () {
    if (!this.isDestroyed) {
      this.unwireEvents();
      this.observer.notify(J);
      if (this.editableElement) {
        this.editableElement = null;
      }
      this.currentDocument = null;
      if (this.nodeCutter) {
        this.nodeCutter = null;
      }
      if (this.domNode) {
        this.domNode = null;
      }
      if (this.listObj) {
        this.listObj = null;
      }
      if (this.formatObj) {
        this.formatObj = null;
      }
      if (this.alignmentObj) {
        this.alignmentObj = null;
      }
      if (this.indentsObj) {
        this.indentsObj = null;
      }
      if (this.linkObj) {
        this.linkObj = null;
      }
      if (this.imgObj) {
        this.imgObj = null;
      }
      if (this.audioObj) {
        this.audioObj = null;
      }
      if (this.videoObj) {
        this.videoObj = null;
      }
      if (this.selectionObj) {
        this.selectionObj = null;
      }
      if (this.inserthtmlObj) {
        this.inserthtmlObj = null;
      }
      if (this.insertTextObj) {
        this.insertTextObj = null;
      }
      if (this.clearObj) {
        this.clearObj = null;
      }
      if (this.tableObj) {
        this.tableObj = null;
      }
      if (this.codeBlockObj) {
        this.codeBlockObj = null;
      }
      if (this.msWordPaste) {
        this.msWordPaste = null;
      }
      if (this.formatPainterEditor) {
        this.formatPainterEditor = null;
      }
      if (this.emojiPickerObj) {
        this.emojiPickerObj = null;
      }
      if (this.tableCellSelection) {
        this.tableCellSelection = null;
      }
      if (this.domTree) {
        this.domTree = null;
      }
      this.userAgentData = null;
      this.isDestroyed = true;
    }
  };
  s.prototype.beforeSlashMenuApplyFormat = function () {
    for (
      var e = this.nodeSelection.getRange(this.currentDocument),
        t = this.nodeSelection.getNodeCollection(e)[0],
        i = e.startOffset;
      this.nodeSelection.getRange(this.currentDocument).toString().indexOf('/') === -1;

    ) {
      this.nodeSelection.setSelectionText(this.currentDocument, t, t, i, e.endOffset);
      i--;
    }
    var n = this.nodeSelection.getRange(this.currentDocument);
    var r = this.nodeCutter.GetSpliceNode(n, t);
    var o = r.previousSibling;
    if (r.parentElement && (r.parentElement.innerHTML.length === 1 || r.parentNode.childNodes.length === 1)) {
      r.parentElement.appendChild(document.createElement('br'));
    }
    r.parentNode.removeChild(r);
    if (r.previousSibling) {
      this.nodeSelection.setCursorPoint(document, r.previousSibling, r.previousSibling.textContent.length);
    }
  };
  return s;
})();
var we = 'e-imgright';
var De = 'e-imgleft';
var ht = 'e-imgcenter';
var bi = 'e-imgbreak';
var X = 'e-img-caption';
var kr = 'e-caption-inline';
var us = 'e-imginline';
var Ci = Rr();
var Gr = (function () {
  function s() {}
  s.get = function (e, t, i, n, r, o) {
    for (
      var a = JSON.parse(JSON.stringify(Ci)),
        l = JSON.parse(JSON.stringify(Ci)),
        h = new Se(t),
        c = h.getRange(e),
        d = o ? [o] : c.collapsed ? h.getNodeCollection(c) : h.getSelectionNodeCollectionBr(c),
        u = d.length,
        f = false,
        m = 0;
      m < d.length;
      m++
    ) {
      for (
        ;
        d[m] &&
        d[m].nodeType === 3 &&
        c.startContainer.nodeType === 3 &&
        d[m].parentNode &&
        d[m].parentNode.lastElementChild &&
        d[m].parentNode.lastElementChild.nodeName !== 'BR' &&
        this.getImmediateBlockNode(d[m].parentNode) &&
        this.getImmediateBlockNode(d[m].parentNode).textContent.replace(/\u200B/g, '').length === 0 &&
        c.startContainer.textContent.replace(/\u200B/g, '').length === 0 &&
        h
          .get(e)
          .toString()
          .replace(/\u200B/g, '').length === 0;

      ) {
        d[m] = d[m].parentNode.lastElementChild.firstChild;
        f = true;
      }
      if (f && d[m]) {
        h.setCursorPoint(e, d[m], d[m].textContent.length);
        f = false;
      }
      if (
        d[m] &&
        ((d[m].nodeName !== 'BR' && d[m].nodeType !== 3) ||
          (u > 1 && d[m].nodeType === 3 && d[m].textContent.trim() === ''))
      ) {
        d.splice(m, 1);
        m--;
      }
    }
    for (var m = 0; m < d.length; m++) {
      var g = v(d[m], 'col, colgroup');
      if (p(g)) {
        a = this.getFormatParent(e, a, d[m], t, i, n, r);
        if ((m === 0 && a.bold) || !a.bold) {
          l.bold = a.bold;
        }
        if ((m === 0 && a.insertcode) || !a.insertcode) {
          l.insertcode = a.insertcode;
        }
        if ((m === 0 && a.isCodeBlock) || !a.isCodeBlock) {
          l.isCodeBlock = a.isCodeBlock;
        }
        if ((m === 0 && a.isCheckList) || !a.isCheckList) {
          l.isCheckList = a.isCheckList;
        }
        if ((m === 0 && a.blockquote) || !a.blockquote) {
          l.blockquote = a.blockquote;
        }
        if ((m === 0 && a.italic) || !a.italic) {
          l.italic = a.italic;
        }
        if ((m === 0 && a.underline) || !a.underline) {
          l.underline = a.underline;
        }
        if ((m === 0 && a.strikethrough) || !a.strikethrough) {
          l.strikethrough = a.strikethrough;
        }
        if ((m === 0 && a.superscript) || !a.superscript) {
          l.superscript = a.superscript;
        }
        if ((m === 0 && a.subscript) || !a.subscript) {
          l.subscript = a.subscript;
        }
        if ((m === 0 && a.fontcolor) || !a.fontcolor) {
          l.fontcolor = a.fontcolor;
        }
        m === 0 && a.fontname
          ? (l.fontname = a.fontname)
          : (l.fontname = a.fontname === l.fontname ? a.fontname : 'empty');
        m === 0 && a.fontsize
          ? (l.fontsize = a.fontsize)
          : (l.fontsize = a.fontsize === l.fontsize ? a.fontsize : 'empty');
        if ((m === 0 && a.backgroundcolor) || !a.backgroundcolor) {
          l.backgroundcolor = a.backgroundcolor;
        }
        if ((m === 0 && a.orderedlist) || !a.orderedlist) {
          l.orderedlist = a.orderedlist;
        }
        if ((m === 0 && a.unorderedlist) || !a.unorderedlist) {
          l.unorderedlist = a.unorderedlist;
        }
        if ((m === 0 && a.alignments) || !a.alignments) {
          l.alignments = a.alignments;
        }
        m === 0 && a.formats ? (l.formats = a.formats) : (l.formats = a.formats === l.formats ? a.formats : 'empty');
        if ((m === 0 && a.createlink) || !a.createlink) {
          l.createlink = a.createlink;
        }
        if ((m === 0 && a.numberFormatList) || !a.numberFormatList) {
          l.numberFormatList = a.numberFormatList;
        }
        if ((m === 0 && a.bulletFormatList) || !a.bulletFormatList) {
          l.bulletFormatList = a.bulletFormatList;
        }
        if ((m === 0 && a.inlinecode) || !a.inlinecode) {
          l.inlinecode = a.inlinecode;
        }
        a = JSON.parse(JSON.stringify(Ci));
      }
    }
    return l;
  };
  s.getImmediateBlockNode = function (e) {
    do e = e.parentNode;
    while (e && ge.indexOf(e.nodeName.toLocaleLowerCase()) < 0);
    return e;
  };
  s.getFormatParent = function (e, t, i, n, r, o, a) {
    var l = false;
    var h = false;
    if (n.contains(i) || (i && i.nodeType === 3 && n.nodeType !== 3 && n.contains(i.parentNode))) {
      t = this.isFormattedNode(e, t, i, l, h, r, o, a, n);
    }
    return t;
  };
  s.checkCodeBlock = function (e) {
    return (
      e.nodeName === 'CODE' &&
      e.parentElement &&
      e.parentElement.nodeName === 'PRE' &&
      e.parentElement.hasAttribute('data-language')
    );
  };
  s.isFormattedNode = function (e, t, i, n, r, o, a, l, h) {
    for (
      var c = ge, d = i, u = [], f = {};
      d && !(c.indexOf(d.nodeName.toLowerCase()) > -1) && (!h || d.nodeName !== h.nodeName);

    ) {
      if (d.nodeType === 1) {
        var m = d;
        if (!this.checkCodeBlock(d)) {
          u.push(d.nodeName.toLowerCase());
        }
        this.collectStyles(d, f, e, l, a);
      }
      d = d.parentNode;
    }
    for (; d && d !== h; ) {
      var g = d.nodeName.toLowerCase();
      var b = d.tagName === 'UL' && d.classList.contains('e-rte-checklist');
      if (!t.unorderedlist && g === 'ul' && !n && !r && !b) {
        t.unorderedlist = true;
        n = true;
        t.bulletFormatList = this.isBulletFormatList(d);
        r = t.bulletFormatList !== null;
      }
      if (!t.orderedlist && g === 'ol' && !n && !r) {
        t.orderedlist = true;
        n = true;
        t.numberFormatList = this.isNumberFormatList(d);
        r = t.numberFormatList !== null;
      }
      if (!t.blockquote && g === 'blockquote') {
        t.blockquote = true;
      }
      if (!t.formats) {
        t.formats = this.isFormats(d, o);
        if (
          t.formats === 'pre' &&
          g === 'pre' &&
          d.firstChild.nodeName !== 'CODE' &&
          !d.hasAttribute('data-language')
        ) {
          t.insertcode = true;
        }
      }
      if (!t.isCodeBlock && d.nodeName.toLocaleLowerCase() === 'pre' && d.hasAttribute('data-language')) {
        t.isCodeBlock = true;
      }
      if (!t.isCheckList && b) {
        t.isCheckList = true;
      }
      this.collectStyles(d, f, e, l, a);
      d = d.parentNode;
    }
    if (u.indexOf('b') > -1 || u.indexOf('strong') > -1) {
      t.bold = true;
    }
    if (u.indexOf('i') > -1 || u.indexOf('em') > -1) {
      t.italic = true;
    }
    if (u.indexOf('u') > -1 || f.underLine) {
      t.underline = true;
    }
    if (u.indexOf('s') > -1 || u.indexOf('del') > -1 || f.strikeThrough) {
      t.strikethrough = true;
    }
    if (u.indexOf('sup') > -1) {
      t.superscript = true;
    }
    if (u.indexOf('sub') > -1) {
      t.subscript = true;
    }
    if (f.color) {
      t.fontcolor = f.color;
    }
    if (f.backgroundColor) {
      t.backgroundcolor = f.backgroundColor;
    }
    if (f.fontFamily) {
      t.fontname = f.fontFamily;
    }
    if (f.fontSize) {
      t.fontsize = f.fontSize;
    }
    if (f.textAlign) {
      t.alignments = f.textAlign;
    }
    if (u.indexOf('a') > -1) {
      t.createlink = true;
    }
    if (u.indexOf('code') > -1) {
      t.inlinecode = true;
    }
    return t;
  };
  s.isFontColor = function (e, t) {
    var i = t.style && t.style.color;
    if ((i == null || i === '') && t.nodeType !== 3) {
      i = this.getComputedStyle(e, t, 'color');
    }
    return i !== null && i !== '' && i !== void 0 ? i : null;
  };
  s.isBackgroundColor = function (e) {
    var t = e.style && e.style.backgroundColor;
    return t !== null && t !== '' && t !== void 0 ? t : null;
  };
  s.isFontSize = function (e, t, i) {
    var n = t.style && t.style.fontSize;
    var r = qe.inlineTags.indexOf(t.nodeName.toLowerCase()) > -1;
    if (n && t.nodeType === 1 && !r) {
      n = null;
    }
    if ((n == null || n === '') && t.nodeType !== 3 && t.parentElement.classList.contains('e-content')) {
      n = this.getComputedStyle(e, t, 'font-size');
    }
    return n !== null && n !== '' && n !== void 0 && (i == null || i.indexOf(n) > -1) ? n : null;
  };
  s.isFontName = function (e, t, i) {
    var n = t.style && t.style.fontFamily;
    var r = qe.inlineTags.indexOf(t.nodeName.toLowerCase()) > -1;
    if (n && t.nodeType === 1 && !r) {
      n = null;
    }
    if ((n == null || n === '') && t.nodeType !== 3 && r) {
      n = this.getComputedStyle(e, t, 'font-family');
    }
    var o = null;
    return n !== null &&
      n !== '' &&
      n !== void 0 &&
      (i == null ||
        (i.filter(function (a, l) {
          var h = RegExp;
          var c = new RegExp(n, 'i');
          if (
            a.replace(/"/g, '').replace(/ /g, '').toLowerCase() ===
              n.replace(/"/g, '').replace(/ /g, '').toLowerCase() ||
            (a.split(',')[0] &&
              !p(a.split(',')[0].trim().match(c)) &&
              a.split(',')[0].trim() === a.split(',')[0].trim().match(c)[0])
          ) {
            o = l;
          }
        }) &&
          o !== null))
      ? o !== null
        ? i[o]
        : n.replace(/"/g, '')
      : null;
  };
  s.isAlignment = function (e) {
    var t = e.style && e.style.textAlign;
    return t === 'left'
      ? 'justifyleft'
      : t === 'center'
        ? 'justifycenter'
        : t === 'right'
          ? 'justifyright'
          : t === 'justify'
            ? 'justifyfull'
            : null;
  };
  s.isFormats = function (e, t) {
    var i = ['tbody', 'tfoot', 'thead', 'ol', 'ul', 'table', 'li', 'td', 'th'];
    return (t == null && ge.indexOf(e.nodeName.toLocaleLowerCase()) > -1) ||
      (t != null && t.indexOf(e.nodeName.toLocaleLowerCase()) > -1)
      ? e.nodeName.toLocaleLowerCase()
      : i.indexOf(e.nodeName.toLocaleLowerCase()) > -1
        ? 'p'
        : null;
  };
  s.getComputedStyle = function (e, t, i) {
    return e.defaultView.getComputedStyle(t, null).getPropertyValue(i);
  };
  s.isNumberFormatList = function (e) {
    var t = e.style && e.style.listStyleType;
    return t === 'lower-alpha'
      ? 'Lower Alpha'
      : t === 'number'
        ? 'Number'
        : t === 'upper-alpha'
          ? 'Upper Alpha'
          : t === 'lower-roman'
            ? 'Lower Roman'
            : t === 'upper-roman'
              ? 'Upper Roman'
              : t === 'lower-greek'
                ? 'Lower Greek'
                : t === 'none' && e.nodeName === 'OL'
                  ? 'None'
                  : e.nodeName === 'OL'
                    ? true
                    : null;
  };
  s.isBulletFormatList = function (e) {
    var t = e.style && e.style.listStyleType;
    return t === 'circle'
      ? 'Circle'
      : t === 'square'
        ? 'Square'
        : t === 'none' && e.nodeName === 'UL'
          ? 'None'
          : t === 'disc'
            ? 'Disc'
            : e.nodeName === 'UL'
              ? true
              : null;
  };
  s.collectStyles = function (e, t, i, n, r) {
    if (!t.color) {
      t.color = this.isFontColor(i, e);
    }
    if (!t.backgroundColor) {
      t.backgroundColor = this.isBackgroundColor(e);
    }
    if (!t.fontFamily) {
      var o = this.isFontName(i, e, n);
      if (o) {
        t.fontFamily = o;
      }
    }
    if (!t.fontSize) {
      var a = this.isFontSize(i, e, r);
      if (a) {
        t.fontSize = a;
      }
    }
    if (!t.textAlign) {
      t.textAlign = this.isAlignment(e);
    }
    var l = null;
    e.style && e.style.textDecoration
      ? (l = e.style.textDecoration)
      : ((l = this.getComputedStyle(i, e, 'text-decoration')),
        e.nodeName === 'A' && l.includes('underline') && (l = null));
    if (l) {
      if (!t.underLine) {
        t.underLine = l.includes('underline') ? 'underline' : null;
      }
      if (!t.strikeThrough) {
        t.strikeThrough = l.includes('line-through') ? 'line-through' : null;
      }
    }
  };
  return s;
})();
var wr = (function () {
  function s(e, t) {
    this.isEscapeKey = false;
    this.rangeStore = false;
    this.parent = e;
    this.isDestroyed = false;
    if (t) {
      this.l10n = t.getService('rteLocale');
    }
    this.wireEvent();
  }
  s.prototype.wireEvent = function () {
    this.parent.on(ee, this.destroy, this);
    this.parent.on(Mn, this.destroyTooltip, this);
    this.parent.on(_t, this.closeTooltip, this);
  };
  s.prototype.destroyTooltip = function () {
    var e = this.parent.iframeSettings.enable
      ? this.parent.contentModule.getPanel().ownerDocument
      : this.parent.contentModule.getDocument();
    if (!p(e.querySelector('.e-tooltip-wrap')) && !p(e.querySelector('[data-tooltip-id]'))) {
      var t = e.querySelector('[data-tooltip-id]');
      var i = new MouseEvent('mouseleave', {
        bubbles: true,
        cancelable: true,
      });
      t.dispatchEvent(i);
    }
  };
  s.prototype.unWireEvent = function () {
    this.parent.off(ee, this.destroy);
    this.parent.off(Mn, this.destroyTooltip);
    this.parent.off(_t, this.closeTooltip);
  };
  s.prototype.toolbarBeforeCreate = function (e) {
    if (this.mode === 'Extended') {
      e.enableCollision = false;
    }
  };
  s.prototype.toolbarCreated = function () {
    this.parent.notify(po, this);
    if (this.mode === 'Extended') {
      var e = this.toolbarPanel.querySelector('.e-expended-nav');
      if (e) {
        D.add(e, 'mousedown', this.extendedToolbarMouseDownHandler, this);
      }
    }
  };
  s.prototype.extendedToolbarMouseDownHandler = function () {
    if (this.parent.userAgentData.isSafari()) {
      this.parent.notify(Fe, {});
    }
  };
  s.prototype.toolbarClicked = function (e) {
    var t = this;
    if (this.parent.enabled) {
      if (this.parent.toolbarSettings.type === me.Popup) {
        var i = void 0;
        if (e.item && e.item.command) {
          i = e.item.command;
        }
        var n = [
          'Formats',
          'Font',
          'Alignments',
          'EmojiPicker',
          'Table',
          'BulletFormatList',
          'NumberFormatList',
          'CodeBlock',
        ];
        var r = !p(i) && n.indexOf(i) !== -1;
        if (r) {
          e.cancel = true;
        }
      }
      var o = {
        item: e.item,
        originalEvent: e.originalEvent,
        cancel: false,
      };
      this.parent.trigger('toolbarClick', o, function (a) {
        if ((!t.parent.readonly || p(e.item)) && !a.cancel) {
          t.parent.notify(Ki, a);
        }
      });
    }
  };
  s.prototype.dropDownSelected = function (e) {
    this.parent.notify(it, {
      element: e.element,
      item: e.item,
      originalEvent: e.event,
    });
    this.destroyTooltip();
  };
  s.prototype.beforeDropDownItemRender = function (e) {
    if (!(this.parent.readonly || !this.parent.enabled)) {
      this.parent.notify(Gi, e);
    }
  };
  s.prototype.tooltipBeforeRender = function (e) {
    if (!p(e.target.getAttribute('title'))) {
      var t = e.target.getAttribute('title');
      var i = void 0;
      switch (t) {
        case 'Minimize':
          {
            i = this.l10n.getConstant('minimize');
            e.target.setAttribute('title', i + ' (Esc)');
          }
          break;
        case 'Maximize':
          {
            i = this.l10n.getConstant('maximize');
            e.target.setAttribute('title', i + ' (Ctrl+Shift+F)');
          }
          break;
      }
    }
    if (e.target.querySelector('.e-active')) {
      e.cancel = true;
      if (!p(e.target.getAttribute('title'))) {
        this.closeTooltip({
          target: e.target,
          isTitle: true,
        });
      }
    }
  };
  s.prototype.dropDownOpen = function (e) {
    if (
      e.element.parentElement.getAttribute('id').indexOf('TableCell') > -1 &&
      !p(e.element.parentElement.querySelector('.e-cell-merge'))
    ) {
      var t = e.element.querySelectorAll('li');
      var i = this.parent.inputElement.querySelectorAll('.e-cell-select');
      i.length === 1
        ? (B([t[0]], 'e-disabled'), x([t[1], t[2]], 'e-disabled'))
        : i.length > 1 &&
          (Array.from(i).every(function (n) {
            return n.tagName.toLowerCase() === i[0].tagName.toLowerCase();
          })
            ? x([t[0]], 'e-disabled')
            : B([t[0]], 'e-disabled'),
          B([t[1], t[2]], 'e-disabled'));
    }
    this.parent.notify(Fe, e);
  };
  s.prototype.dropDownClose = function (e) {
    if (!this.isEscapeKey) {
      this.parent.notify(Me, e);
    }
    this.isEscapeKey = false;
  };
  s.prototype.dropDownBeforeClose = function (e) {
    if (!p(e.event) && e.event.key === 'Escape' && e.event.keyCode === 27) {
      this.isEscapeKey = true;
      this.parent.notify(Xi, e);
    }
  };
  s.prototype.renderToolbar = function (e) {
    var t = this;
    var i = this.parent.toolbarSettings && this.parent.toolbarSettings.position === 'Bottom';
    this.setPanel(e.target);
    this.renderPanel();
    this.mode = e.overflowMode;
    e.rteToolbarObj.toolbarObj = new co({
      items: e.items,
      width: '100%',
      overflowMode: e.overflowMode,
      beforeCreate: this.toolbarBeforeCreate.bind(this),
      created: function () {
        t.positionToolbar(i);
        t.toolbarCreated();
      },
      clicked: this.toolbarClicked.bind(this),
      enablePersistence: e.enablePersistence,
      enableRtl: e.enableRtl,
      cssClass: e.cssClass,
    });
    e.rteToolbarObj.toolbarObj.isStringTemplate = true;
    e.rteToolbarObj.toolbarObj.createElement = this.parent.createElement;
    e.rteToolbarObj.toolbarObj.appendTo(e.target);
    if (this.parent.showTooltip && e.type === 'toolbar') {
      this.tooltip = new vn({
        target: '#' + this.parent.getID() + '_toolbar_wrapper [title]',
        showTipPointer: true,
        openDelay: 400,
        opensOn: 'Hover',
        beforeRender: this.tooltipBeforeRender.bind(this),
        beforeOpen: this.tooltipBeforeOpen.bind(this),
        cssClass: this.parent.getCssClass(),
        windowCollision: true,
        position: i ? 'TopCenter' : 'BottomCenter',
      });
      this.tooltip.appendTo(e.target.parentElement);
    }
  };
  s.prototype.positionToolbar = function (e) {
    var t = this.parent.element.querySelector('.e-rte-container');
    var i = this.parent.element.querySelector('.e-toolbar-wrapper');
    if (e && t && i) {
      B([i], 'e-rte-tb-bottom');
    }
  };
  s.prototype.tooltipBeforeOpen = function (e) {
    if (e.element) {
      e.element.setAttribute('data-rte-id', this.parent.getID());
    }
  };
  s.prototype.renderDropDownButton = function (e) {
    var t = this;
    var i;
    var n = e.activeElement;
    e.element.classList.add(se);
    i = e.cssClass + ' ' + Be + ' ' + uo;
    if (this.parent.inlineMode.enable && M.isDevice) {
      i = i + ' ' + To;
    }
    var r = this.parent.element && this.parent.element.dataset && this.parent.element.dataset.rteUnitTesting === 'true';
    var o = this;
    var a = new fo({
      items: e.items,
      iconCss: e.iconCss,
      cssClass: i,
      content: e.content,
      enablePersistence: this.parent.enablePersistence,
      enableRtl: this.parent.enableRtl,
      select: this.dropDownSelected.bind(this),
      animationSettings: r
        ? {
            effect: 'None',
            duration: 0,
          }
        : {
            effect: 'None',
            duration: 400,
            easing: 'ease',
          },
      beforeOpen: function (h) {
        if (o.parent.readonly || !o.parent.enabled) {
          h.cancel = true;
          return;
        }
        if (
          t.parent.userAgentData.isSafari() &&
          h.event.type === 'keydown' &&
          t.parent.formatter.editorManager.nodeSelection &&
          !t.parent.inputElement.contains(t.parent.getRange().startContainer)
        ) {
          t.parent.notify(Me, h);
        }
        if (o.parent.editorMode !== 'Markdown') {
          var c = o.parent.getRange().startContainer.parentElement;
          var d = o.parent.getRange().startContainer.parentElement.closest('table');
          var u = o.parent.getRange().startContainer.parentElement.closest('tr');
          if (!p(d) && d.classList.contains('e-dashed-border'))
            for (var f = 0; f < h.element.childNodes.length; f++)
              if (h.element.childNodes[f].classList.contains('e-dashed-borders')) {
                B([h.element.childNodes[f]], 'e-active');
              }
          if (!p(d) && d.classList.contains('e-alternate-rows') && window.getComputedStyle(u).backgroundColor !== '')
            for (var f = 0; f < h.element.childNodes.length; f++)
              if (h.element.childNodes[f].classList.contains('e-alternate-rows')) {
                B([h.element.childNodes[f]], 'e-active');
              }
          if (!p(h.element.parentElement) && h.element.parentElement.classList.contains('e-border-style-btn'))
            for (
              var m = o.parent.contentModule.getDocument().activeElement.innerText.toLowerCase(), g = 0;
              g < h.items.length;
              g++
            )
              if (h.items[g].text.toLowerCase() === m) {
                B([h.element.childNodes[g]], 'e-active');
                break;
              } else x([h.element.childNodes[g]], 'e-active');
          for (var b = o.parent.getRange().startContainer; b !== o.parent.inputElement && !p(b.parentElement); ) {
            if (b.nodeName === '#text') {
              b = b.parentElement;
            }
            var C = window.getComputedStyle(b).textAlign;
            if (!p(h.items[0]) && h.items[0].command === 'Alignments') {
              if (
                (h.items[0].text === 'Align Left' && window.getComputedStyle(b).textAlign === 'left') ||
                window.getComputedStyle(b).textAlign === 'start'
              ) {
                B([h.element.childNodes[0]], 'e-active');
                break;
              } else if (h.items[1].text === 'Align Center' && window.getComputedStyle(b).textAlign === 'center') {
                B([h.element.childNodes[1]], 'e-active');
                break;
              } else if (h.items[2].text === 'Align Right' && window.getComputedStyle(b).textAlign === 'right') {
                B([h.element.childNodes[2]], 'e-active');
                break;
              } else if (h.items[3].text === 'Align Justify' && window.getComputedStyle(b).textAlign === 'justify') {
                B([h.element.childNodes[3]], 'e-active');
                break;
              }
            }
            b = b.parentElement;
          }
          var N = o.parent.getRange().startContainer.parentElement.closest('img');
          var w = N || e.activeElement || o.parent.getRange().startContainer.parentElement.querySelector('img');
          if (!p(h.items[0]) && h.items[0].command === 'Images' && !p(w)) {
            var f = void 0;
            w.classList.contains('e-imgleft') || w.classList.contains('e-imginline')
              ? (f = 0)
              : w.classList.contains('e-imgcenter') || w.classList.contains('e-imgbreak')
                ? (f = 1)
                : w.classList.contains('e-imgright') && (f = 2);
            if (!p(h.element.childNodes[f])) {
              B([h.element.childNodes[f]], 'e-active');
            }
          }
          var T = o.parent.getRange().startContainer.parentElement.closest('.e-video-wrap');
          var S = T || e.activeElement || o.parent.getRange().startContainer.parentElement.querySelector('video');
          if (!p(h.items[0]) && h.items[0].command === 'Videos' && !p(S)) {
            var f = void 0;
            S.classList.contains('e-video-left') || S.classList.contains('e-video-inline')
              ? (f = 0)
              : S.classList.contains('e-video-center') || S.classList.contains('e-video-break')
                ? (f = 1)
                : S.classList.contains('e-video-right') && (f = 2);
            if (!p(h.element.childNodes[f])) {
              B([h.element.childNodes[f]], 'e-active');
            }
          }
          if (!p(h.items[0]) && (h.items[0].command === 'Formats' || h.items[0].command === 'Font')) {
            var O = [];
            var L = [];
            var A = false;
            t.parent.format.types.forEach(function (j) {
              L.push(j.value.toLocaleLowerCase());
            });
            t.parent.fontFamily.items.forEach(function (j) {
              O.push(j.value);
            });
            for (
              var k = Gr.get(t.parent.contentModule.getDocument(), t.parent.contentModule.getEditPanel(), L, null, O),
                f = 0;
              f < h.element.childNodes.length;
              f++
            ) {
              var P = a.content.trim();
              var I = P.match(/style="([^"]*)"/);
              var H = '';
              if (I) {
                H = I[1];
              }
              var U = P.replace(/ style="([^"]*)"/, '');
              var Q = t.parent.createElement('div');
              Q.innerHTML = U;
              var K = Q.querySelector('span');
              K.style.cssText = H;
              !A &&
              ((Q.textContent.trim() !== '' && h.element.childNodes[f].textContent.trim() === Q.textContent.trim()) ||
                (h.items[0].command === 'Formats' &&
                  !p(k.formats) &&
                  t.parent.format.types[f].value.toLowerCase() === k.formats.toLowerCase() &&
                  h.element.childNodes[f].classList.contains(t.parent.format.types[f].cssClass)) ||
                (h.items[0].subCommand === 'FontName' &&
                  h.items[0].command === 'Font' &&
                  !p(k.fontname) &&
                  !p(t.parent.fontFamily.items[f]) &&
                  t.parent.fontFamily.items[f].value.toLowerCase() === k.fontname.toLowerCase() &&
                  h.element.childNodes[f].classList.contains(t.parent.fontFamily.items[f].cssClass)) ||
                (h.items[0].subCommand === 'FontName' &&
                  t.parent.fontFamily.items[f].value === '' &&
                  p(k.fontname) &&
                  h.element.childNodes[f].classList.contains(t.parent.fontFamily.items[f].cssClass)) ||
                (h.items[0].subCommand === 'FontSize' &&
                  h.element.childNodes[f].textContent === 'Default' &&
                  Q.textContent === 'Font Size' &&
                  t.parent.fontSize.items[f].value === '' &&
                  !p(k.fontsize)))
                ? h.element.childNodes[f].classList.contains('e-active') ||
                  (B([h.element.childNodes[f]], 'e-active'), (A = true))
                : x([h.element.childNodes[f]], 'e-active');
            }
          }
        } else if (o.parent.editorMode === 'Markdown' && h.items[0].command === 'Formats') {
          var Z = [];
          var A = false;
          t.parent.format.types.forEach(function ($) {
            Z.push($.value.toLocaleLowerCase());
          });
          for (var G = h.element.childNodes, f = 0; f < G.length; f++) {
            var Q = t.parent.createElement('div');
            Q.innerHTML = a.content.trim();
            !A && Q.textContent.trim() !== '' && G[f].textContent.trim() === Q.textContent.trim()
              ? G[f].classList.contains('e-active') || (B([G[f]], 'e-active'), (A = true))
              : x([G[f]], 'e-active');
          }
        }
        o.parent.notify(Yi, h);
      },
      close: this.dropDownClose.bind(this),
      beforeClose: this.dropDownBeforeClose.bind(this),
      open: this.dropDownOpen.bind(this),
      beforeItemRender: this.beforeDropDownItemRender.bind(this),
    });
    a.isStringTemplate = true;
    a.createElement = o.parent.createElement;
    a.appendTo(e.element);
    e.element.tabIndex = -1;
    var l = document.getElementById(a.element.id + '-popup');
    l.setAttribute('aria-owns', this.parent.getID());
    return a;
  };
  s.prototype.mouseOutHandler = function () {
    if (!p(this.tooltipTargetEle))
      this.tooltipTargetEle.setAttribute('title', this.tooltipTargetEle.getAttribute('data-title'));
    else {
      var e = this.parent.iframeSettings.enable
        ? this.parent.contentModule.getPanel().ownerDocument
        : this.parent.contentModule.getDocument();
      this.tooltipTargetEle = e.querySelector('[data-title]');
      this.tooltipTargetEle.setAttribute('title', this.tooltipTargetEle.getAttribute('data-title'));
    }
    this.tooltipTargetEle.removeAttribute('data-title');
    D.remove(this.tooltipTargetEle, 'mouseout', this.mouseOutHandler);
  };
  s.prototype.closeTooltip = function (e) {
    if (e.isTitle) {
      this.tooltipTargetEle = e.target;
      this.tooltipTargetEle.setAttribute('data-title', this.tooltipTargetEle.getAttribute('title'));
      this.tooltipTargetEle.removeAttribute('title');
      D.add(this.tooltipTargetEle, 'mouseout', this.mouseOutHandler, this);
    } else {
      var t = this.parent.iframeSettings.enable
        ? this.parent.contentModule.getPanel().ownerDocument
        : this.parent.contentModule.getDocument();
      this.tooltipTargetEle = v(e.target, '[data-tooltip-id]');
      if (!p(this.tooltipTargetEle) && this.parent.showTooltip && !p(t.querySelector('.e-tooltip-wrap'))) {
        this.destroyTooltip();
        this.tooltipTargetEle.setAttribute('data-title', this.tooltipTargetEle.getAttribute('title'));
        this.tooltipTargetEle.removeAttribute('title');
        D.add(this.tooltipTargetEle, 'mouseout', this.mouseOutHandler, this);
      }
    }
  };
  s.prototype.handleCodeBlockDropdown = function (e) {
    var t = this.parent.getRange();
    var i = this.parent.formatter.editorManager.codeBlockObj.isValidCodeBlockStructure(t.startContainer);
    var n = this.parent.formatter.editorManager.codeBlockObj.isValidCodeBlockStructure(t.endContainer);
    var r = !p(i) || !p(n);
    var o = i || n;
    var a = '';
    if (r) {
      a = o.getAttribute('data-language') || '';
      for (var l = e.element.querySelectorAll('li'), h = 0; h < l.length; h++) {
        var c = l[h].getAttribute('data-language') || l[h].textContent.toLowerCase();
        a.toLowerCase() === c ? B([l[h]], 'e-active') : x([l[h]], 'e-active');
      }
    }
  };
  s.prototype.handleListsDropdown = function (e) {
    var t = this;
    if (t.parent.readonly || !t.parent.enabled) {
      e.cancel = true;
      return;
    }
    if (M.info.name === 'safari' && !t.parent.inputElement.contains(t.parent.getRange().startContainer)) {
      t.parent.notify(Me, {});
    }
    if (t.parent.editorMode !== 'Markdown') {
      var i = t.parent.getRange().startContainer.parentElement;
      var n = t.parent.getRange().startContainer.parentElement.closest('LI');
      var r = p(n) ? null : n.parentElement;
      var o = e.items[0].subCommand;
      if (!p(r)) {
        var a = e.items[0].subCommand === 'NumberFormatList' && r.nodeName === 'OL';
        var l = e.items[0].subCommand === 'BulletFormatList' && r.nodeName === 'UL';
        if (a || l) {
          var h = r.style.listStyleType.split('-').join('').toLocaleLowerCase();
          h = h === 'decimal' ? 'number' : h;
          for (var c = 0; c < e.element.childNodes.length; c++)
            if (h === e.element.childNodes[c].innerHTML.split(' ').join('').toLocaleLowerCase()) {
              B([e.element.childNodes[c]], 'e-active');
              break;
            } else if (
              h === '' &&
              (e.element.childNodes[c].innerHTML === 'Number' || e.element.childNodes[c].innerHTML === 'Disc')
            ) {
              B([e.element.childNodes[c]], 'e-active');
              break;
            }
        }
      }
    }
  };
  s.prototype.renderSplitButton = function (e) {
    var t = this;
    var i = e.cssClass;
    var n = new mo({
      items: e.items,
      cssClass: e.cssClass,
      iconCss: e.iconCss,
      enablePersistence: this.parent.enablePersistence,
      enableRtl: this.parent.enableRtl,
      select: this.dropDownSelected.bind(this),
      created: function () {
        var o = e.element.parentElement;
        if (o) {
          o.tabIndex = -1;
        }
      },
      beforeOpen: function (o) {
        if (t.parent.readonly || !t.parent.enabled) {
          o.cancel = true;
          return;
        }
        if (o.items) {
          if (o.items[0].command === 'CodeBlock') {
            t.handleCodeBlockDropdown(o);
          }
          if (o.items[0].command === 'Lists') {
            t.handleListsDropdown(o);
          }
          t.currentElement = n.element;
          t.currentDropdown = n;
        }
      },
      close: this.dropDownClose.bind(this),
      beforeClose: this.dropDownBeforeClose.bind(this),
      open: this.dropDownOpen.bind(this),
      beforeItemRender: this.beforeDropDownItemRender.bind(this),
    });
    n.appendTo(e.element);
    var r = document.getElementById(n.element.id + '_dropdownbtn-popup');
    r.setAttribute('aria-owns', this.parent.getID());
    return n;
  };
  s.prototype.renderColorPicker = function (e, t, i) {
    var n = this;
    var r = this;
    var o;
    var a = false;
    t === 'bordercolor' || t === 'tablebackgroundcolor'
      ? ((o = e.value), (a = true))
      : (o = p(this.defaultColorPicker)
          ? t === 'backgroundcolor'
            ? r.parent.backgroundColor.default
            : r.parent.fontColor.default
          : this.defaultColorPicker);
    var l = new go({
      enableRtl: this.parent.enableRtl,
      inline: false,
      value: o,
      showButtons: false,
      cssClass: e.cssClass,
      disabled: !this.parent.enabled,
      created: function () {
        var h;
        var c;
        var d;
        var u = e.element.parentElement;
        if (u) {
          u.tabIndex = -1;
          var f = u.childNodes[1];
          if (u.childNodes[1]) {
            (h = u.childNodes[1].classList).add.apply(h, e.cssClass.split(' '));
            var m = u.querySelector('.e-split-colorpicker');
            if (m) {
              (c = m.classList).add.apply(c, e.cssClass.split(' '));
              var g = u.querySelector('.e-dropdown-btn');
              if (g) {
                (d = g.classList).add.apply(d, e.cssClass.split(' '));
              }
            }
          }
        }
      },
      mode: t === 'backgroundcolor' ? r.parent.backgroundColor.mode : r.parent.fontColor.mode,
      modeSwitcher: t === 'backgroundcolor' ? r.parent.backgroundColor.modeSwitcher : r.parent.fontColor.modeSwitcher,
      showRecentColors:
        i === 'quick' && !a
          ? false
          : a
            ? true
            : t === 'backgroundcolor'
              ? r.parent.backgroundColor.showRecentColors
              : r.parent.fontColor.showRecentColors,
      presetColors: t === 'backgroundcolor' ? this.parent.backgroundColor.colorCode : this.parent.fontColor.colorCode,
      columns: t === 'backgroundcolor' ? this.parent.backgroundColor.columns : this.parent.fontColor.columns,
      beforeTileRender: function (h) {
        h.element.classList.add(bo);
        h.element.classList.add(Co);
        if (!p(n.parent.cssClass))
          for (var c = n.parent.getCssClass().split(' '), d = 0; d < c.length; d++)
            if (c[d].trim() !== '') {
              h.element.classList.add(c[d]);
            }
        if (h.value === '') {
          h.element.classList.add(yo);
        }
      },
      beforeOpen: function () {
        if (
          (r.parent.userAgentData.isSafari() || !r.parent.userAgentData.isSafari()) &&
          n.parent.formatter.editorManager.nodeSelection &&
          n.parent.inputElement.contains(n.parent.getRange().startContainer)
        ) {
          r.parent.notify(Fe, {});
          n.rangeStore = true;
        }
      },
      change: function (h) {
        if (n.rangeStore) {
          r.parent.notify(Me, {});
          n.rangeStore = false;
        }
        if (
          !r.parent.userAgentData.isSafari() ||
          (r.parent.userAgentData.isSafari() &&
            n.parent.formatter.editorManager.nodeSelection &&
            n.parent.inputElement.contains(n.parent.getRange().startContainer))
        ) {
          r.parent.notify(Fe, {});
        }
        var c = h.currentValue.rgba;
        h.item = {
          command: e.command,
          subCommand: e.subCommand,
          value: h.currentValue.rgba,
        };
        r.parent.notify(Me, {});
        var d = r.parent.formatter.editorManager.nodeSelection.getRange(r.parent.contentModule.getDocument());
        var u = v(d.startContainer.parentNode, 'table');
        (d.startContainer.nodeName === 'TD' ||
          d.startContainer.nodeName === 'TH' ||
          d.startContainer.nodeName === 'BODY' ||
          (d.startContainer.parentNode && v(d.startContainer.parentNode, 'td,th'))) &&
        d.collapsed &&
        e.subCommand === 'BackgroundColor' &&
        ((u && v(u, '.' + vo)) || r.parent.iframeSettings.enable) &&
        i === 'quick'
          ? ((n.defaultColorPicker = h.currentValue.hex),
            (h.name = 'tableColorPickerChanged'),
            (h.item.command = 'Table'),
            r.parent.formatter.process(n.parent, h, h.event, h.item.value))
          : r.parent.notify(Dt, h);
      },
      beforeModeSwitch: function (h) {
        o = l.value;
        if (o === '') {
          l.setProperties({ value: h.mode === 'Picker' ? '#008000ff' : '' }, true);
        }
        l.showButtons = h.mode !== 'Palette';
      },
      beforeClose: this.dropDownClose.bind(this),
    });
    l.isStringTemplate = true;
    l.createElement = this.parent.createElement;
    l.appendTo(e.element);
    e.element.setAttribute('role', 'button');
    return l;
  };
  s.prototype.renderPanel = function () {
    this.getPanel().classList.add(Lt);
  };
  s.prototype.getPanel = function () {
    return this.toolbarPanel;
  };
  s.prototype.setPanel = function (e) {
    this.toolbarPanel = e;
  };
  s.prototype.destroy = function () {
    if (!this.isDestroyed) {
      if (this.tooltip && !this.tooltip.isDestroyed) {
        this.tooltip.destroy();
        for (
          var e = document.querySelectorAll('[data-rte-id="' + this.parent.getID() + '"]'), t = 0;
          t < e.length;
          t++
        ) {
          var i = e[t];
          if (this.parent.getID() === e[t].getAttribute('data-rte-id')) {
            y(e[t]);
          }
        }
      }
      this.unWireEvent();
      this.mode = null;
      this.defaultColorPicker = null;
      this.toolbarPanel = null;
      this.currentElement = null;
      this.currentDropdown = null;
      this.tooltip = null;
      this.tooltipTargetEle = null;
      this.isDestroyed = true;
    }
  };
  return s;
})();
var fs = (function () {
  function s(e) {
    this.parent = e;
    this.addEventListener();
  }
  s.prototype.addEventListener = function () {
    this.parent.observer.on(wt, this.imageCommand, this);
    this.parent.observer.on(J, this.destroy, this);
  };
  s.prototype.removeEventListener = function () {
    this.parent.observer.off(wt, this.imageCommand);
    this.parent.observer.off(J, this.destroy);
  };
  s.prototype.imageCommand = function (e) {
    switch (e.value.toString().toLowerCase()) {
      case 'image':
      case 'replace':
        this.createImage(e);
        break;
      case 'insertlink':
        this.insertImageLink(e);
        break;
      case 'openimagelink':
        this.openImageLink(e);
        break;
      case 'editimagelink':
        this.editImageLink(e);
        break;
      case 'removeimagelink':
        this.removeImageLink(e);
        break;
      case 'remove':
        this.removeImage(e);
        break;
      case 'alttext':
        this.insertAltTextImage(e);
        break;
      case 'dimension':
        this.imageDimension(e);
        break;
      case 'caption':
        this.imageCaption(e);
        break;
      case 'justifyleft':
        this.imageJustifyLeft(e);
        break;
      case 'justifycenter':
        this.imageJustifyCenter(e);
        break;
      case 'justifyright':
        this.imageJustifyRight(e);
        break;
      case 'inline':
        this.imageInline(e);
        break;
      case 'break':
        this.imageBreak(e);
        break;
    }
  };
  s.prototype.createImage = function (e) {
    var t = this;
    var i = false;
    e.item.url = p(e.item.url) || e.item.url === 'undefined' ? e.item.src : e.item.url;
    if (!p(e.item.selectParent) && e.item.selectParent[0].tagName === 'IMG') {
      var n = e.item.selectParent[0];
      i = true;
      this.setStyle(e.item.selectParent[0], e, i);
    } else {
      var r = E('img');
      this.setStyle(r, e);
      if (!p(e.item.selection)) {
        e.item.selection.restore();
      }
      !p(e.selector) && e.selector === 'pasteCleanupModule'
        ? p(this.parent.currentDocument) ||
          e.callBack({
            requestType: 'Images',
            editorMode: 'HTML',
            event: e.event,
            range: this.parent.nodeSelection.getRange(this.parent.currentDocument),
            elements: [r],
          })
        : Pe.Insert(this.parent.currentDocument, r, this.parent.editableElement);
    }
    if (e.callBack && (p(e.selector) || (!p(e.selector) && e.selector !== 'pasteCleanupModule'))) {
      var o = this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)[0];
      var a =
        e.value === 'Replace' || i
          ? e.item.selectParent[0]
          : M.isIE
            ? this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)[0].previousSibling
            : this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)[0].previousElementSibling;
      var l = function () {
        if (!p(t.parent.currentDocument)) {
          if (t.parent.userAgentData.isSafari()) {
            kt(t.parent.currentDocument, t.parent.editableElement);
          }
          var h = a.getAttribute('width');
          var c = a.getAttribute('height');
          if (p(h) || h === 'auto') {
            a.setAttribute('width', a.offsetWidth.toString());
          }
          if (p(c) || c === 'auto') {
            a.setAttribute('height', a.offsetHeight.toString());
          }
          e.callBack({
            requestType: e.value === 'Replace' ? ((e.item.subCommand = 'Replace'), 'Replace') : 'Images',
            editorMode: 'HTML',
            event: e.event,
            range: t.parent.nodeSelection.getRange(t.parent.currentDocument),
            elements: [a],
          });
        }
        a.removeEventListener('load', l);
      };
      a.addEventListener('load', l);
    }
  };
  s.prototype.setStyle = function (e, t, i) {
    if (!p(t.item.url)) {
      e.setAttribute('src', t.item.url);
    }
    var n;
    if (i)
      for (
        var r = {
            'e-imgcenter': 'e-imgcenter',
            'e-imgright': 'e-imgright',
            'e-imgleft': 'e-imgleft',
          },
          o = e.classList,
          a = 0;
        a < o.length;
        a++
      )
        if (!p(r[o[a]])) {
          n = r[o[a]];
        }
    e.setAttribute('class', 'e-rte-image' + (p(t.item.cssClass) ? '' : ' ' + t.item.cssClass) + (p(n) ? '' : ' ' + n));
    if (!p(t.item.altText)) {
      e.setAttribute('alt', t.item.altText.replace(/\.[a-zA-Z0-9]+$/, ''));
    }
    if (!p(t.item.width) && !p(t.item.width.width)) {
      e.setAttribute('width', this.calculateStyleValue(t.item.width.width));
    }
    if (!p(t.item.height) && !p(t.item.height.height)) {
      e.setAttribute('height', this.calculateStyleValue(t.item.height.height));
    }
    if (!p(t.item.width) && !p(t.item.width.minWidth)) {
      e.style.minWidth = this.calculateStyleValue(t.item.width.minWidth);
    }
    if (!p(t.item.width) && !p(t.item.width.maxWidth)) {
      e.style.maxWidth = this.calculateStyleValue(t.item.width.maxWidth);
    }
    if (!p(t.item.height) && !p(t.item.height.minHeight)) {
      e.style.minHeight = this.calculateStyleValue(t.item.height.minHeight);
    }
    if (!p(t.item.height) && !p(t.item.height.maxHeight)) {
      e.style.maxHeight = this.calculateStyleValue(t.item.height.maxHeight);
    }
  };
  s.prototype.calculateStyleValue = function (e) {
    var t;
    typeof e == 'string' && (e.indexOf('px') !== -1 || e.indexOf('%') !== -1 || e.indexOf('auto') !== -1)
      ? (t = e)
      : (t = e + 'px');
    return t;
  };
  s.prototype.insertImageLink = function (e) {
    var t = E('a', { attrs: { href: e.item.url } });
    if (e.item.selectNode[0].parentElement.classList.contains('e-img-wrap')) {
      e.item.selection.restore();
      t.setAttribute('contenteditable', 'true');
    }
    t.appendChild(e.item.selectNode[0]);
    if (!p(e.item.target)) {
      t.setAttribute('target', e.item.target);
    }
    if (!p(e.item.ariaLabel)) {
      t.setAttribute('aria-label', e.item.ariaLabel);
    }
    Pe.Insert(this.parent.currentDocument, t, this.parent.editableElement);
    this.callBack(e);
  };
  s.prototype.openImageLink = function (e) {
    document.defaultView.open(e.item.url, e.item.target);
    this.callBack(e);
  };
  s.prototype.removeImageLink = function (e) {
    var t = e.item.selectParent[0];
    if (e.item.selectParent[0].classList.contains('e-img-caption')) {
      var i = _('.e-img-wrap', e.item.selectParent[0]);
      var n = _('.e-img-inner', e.item.selectParent[0]);
      var r = n.cloneNode(true);
      y(_('a', e.item.selectParent[0]));
      y(n);
      i.appendChild(e.item.insertElement);
      i.appendChild(r);
    } else {
      y(e.item.selectParent[0]);
      if (M.isIE && e.item.selection) {
        e.item.selection.restore();
      }
      Pe.Insert(this.parent.currentDocument, e.item.insertElement, this.parent.editableElement);
    }
    this.callBack(e);
  };
  s.prototype.editImageLink = function (e) {
    e.item.selectNode[0].parentElement.href = e.item.url;
    p(e.item.target)
      ? (e.item.selectNode[0].parentElement.removeAttribute('target'),
        e.item.selectNode[0].parentElement.removeAttribute('aria-label'))
      : ((e.item.selectNode[0].parentElement.target = e.item.target),
        e.item.selectNode[0].parentElement.setAttribute('aria-label', e.item.ariaLabel));
    this.callBack(e);
  };
  s.prototype.removeImage = function (e) {
    if (v(e.item.selectNode[0], 'a'))
      e.item.selectNode[0].parentElement.nodeName === 'A' && !p(e.item.selectNode[0].parentElement.innerText)
        ? p(v(e.item.selectNode[0], '.e-img-caption'))
          ? y(e.item.selectNode[0])
          : y(v(e.item.selectNode[0], '.e-img-caption'))
        : y(v(e.item.selectNode[0], 'a'));
    else if (!p(v(e.item.selectNode[0], '.e-img-caption'))) y(v(e.item.selectNode[0], '.e-img-caption'));
    else {
      var t = e.item.selectNode[0].parentElement;
      y(e.item.selectNode[0]);
      if (e.item.selectNode[0].parentElement.childNodes.length === 0) {
        e.item.selectNode[0].parentElement.appendChild(document.createElement('br'));
      }
    }
    this.callBack(e);
  };
  s.prototype.insertAltTextImage = function (e) {
    e.item.selectNode[0].setAttribute('alt', e.item.altText);
    this.callBack(e);
  };
  s.prototype.imageDimension = function (e) {
    var t = e.item.selectNode[0];
    e.item.selectNode[0].style.height = '';
    e.item.selectNode[0].style.width = '';
    e.item.width !== 'auto'
      ? (e.item.selectNode[0].style.width = dt(e.item.width))
      : e.item.selectNode[0].removeAttribute('width');
    e.item.height !== 'auto'
      ? (e.item.selectNode[0].style.height = dt(e.item.height))
      : e.item.selectNode[0].removeAttribute('height');
    this.callBack(e);
  };
  s.prototype.imageCaption = function (e) {
    Pe.Insert(this.parent.currentDocument, e.item.insertElement, this.parent.editableElement);
    this.callBack(e);
  };
  s.prototype.imageJustifyLeft = function (e) {
    var t = e.item.selectNode[0];
    if (!p(e.item.selectNode[0])) {
      e.item.selectNode[0].removeAttribute('class');
      B([e.item.selectNode[0]], 'e-rte-image');
      if (!p(v(e.item.selectNode[0], '.e-img-caption'))) {
        x([v(e.item.selectNode[0], '.e-img-caption')], 'e-imgright');
        B([v(e.item.selectNode[0], '.e-img-caption')], 'e-imgleft');
      }
      e.item.selectNode[0].parentElement.nodeName === 'A'
        ? (x([e.item.selectNode[0].parentElement], 'e-imgright'),
          B([e.item.selectNode[0].parentElement], 'e-imgleft'),
          B([e.item.selectNode[0]], 'e-imgleft'))
        : e.item.selectNode[0].parentElement.nextElementSibling != null
          ? (B([e.item.selectNode[0]], 'e-imgleft'),
            (e.item.selectNode[0].parentElement.nextElementSibling.style.clear = 'left'))
          : B([e.item.selectNode[0]], 'e-imgleft');
      this.callBack(e);
    }
  };
  s.prototype.imageJustifyCenter = function (e) {
    var t = e.item.selectNode[0];
    if (!p(e.item.selectNode[0])) {
      e.item.selectNode[0].removeAttribute('class');
      B([e.item.selectNode[0]], 'e-rte-image');
      if (!p(v(e.item.selectNode[0], '.e-img-caption'))) {
        x([v(e.item.selectNode[0], '.e-img-caption')], 'e-imgleft');
        x([v(e.item.selectNode[0], '.e-img-caption')], 'e-imgright');
        B([v(e.item.selectNode[0], '.e-img-caption')], 'e-imgcenter');
      }
      e.item.selectNode[0].parentElement.nodeName === 'A'
        ? (x([e.item.selectNode[0].parentElement], 'e-imgleft'),
          x([e.item.selectNode[0].parentElement], 'e-imgright'),
          B([e.item.selectNode[0].parentElement], 'e-imgcenter'),
          B([e.item.selectNode[0]], 'e-imgcenter'))
        : B([e.item.selectNode[0]], 'e-imgcenter');
      this.callBack(e);
    }
  };
  s.prototype.imageJustifyRight = function (e) {
    var t = e.item.selectNode[0];
    if (!p(e.item.selectNode[0])) {
      e.item.selectNode[0].removeAttribute('class');
      B([e.item.selectNode[0]], 'e-rte-image');
      if (!p(v(e.item.selectNode[0], '.e-img-caption'))) {
        x([v(e.item.selectNode[0], '.e-img-caption')], 'e-imgleft');
        B([v(e.item.selectNode[0], '.e-img-caption')], 'e-imgright');
      }
      e.item.selectNode[0].parentElement.nodeName === 'A'
        ? (x([e.item.selectNode[0].parentElement], 'e-imgleft'),
          B([e.item.selectNode[0].parentElement], 'e-imgright'),
          B([e.item.selectNode[0]], 'e-imgright'))
        : e.item.selectNode[0].parentElement.nextElementSibling != null
          ? (B([e.item.selectNode[0]], 'e-imgright'),
            (e.item.selectNode[0].parentElement.nextElementSibling.style.clear = 'right'))
          : B([e.item.selectNode[0]], 'e-imgright');
      this.callBack(e);
    }
  };
  s.prototype.imageInline = function (e) {
    var t = e.item.selectNode[0];
    e.item.selectNode[0].removeAttribute('class');
    B([e.item.selectNode[0]], 'e-rte-image');
    B([e.item.selectNode[0]], 'e-imginline');
    if (!p(v(e.item.selectNode[0], '.e-img-caption'))) {
      x([v(e.item.selectNode[0], '.e-img-caption')], 'e-imgbreak');
      x([v(e.item.selectNode[0], '.e-img-caption')], 'e-imgcenter');
      x([v(e.item.selectNode[0], '.e-img-caption')], 'e-imgleft');
      x([v(e.item.selectNode[0], '.e-img-caption')], 'e-imgright');
      B([v(e.item.selectNode[0], '.e-img-caption')], 'e-caption-inline');
    }
    this.callBack(e);
  };
  s.prototype.imageBreak = function (e) {
    var t = e.item.selectNode[0];
    e.item.selectNode[0].removeAttribute('class');
    B([e.item.selectNode[0]], 'e-imgbreak');
    B([e.item.selectNode[0]], 'e-rte-image');
    if (!p(v(e.item.selectNode[0], '.e-img-caption'))) {
      x([v(e.item.selectNode[0], '.e-img-caption')], 'e-caption-inline');
      x([v(e.item.selectNode[0], '.e-img-caption')], 'e-imgcenter');
      x([v(e.item.selectNode[0], '.e-img-caption')], 'e-imgleft');
      x([v(e.item.selectNode[0], '.e-img-caption')], 'e-imgright');
      B([v(e.item.selectNode[0], '.e-img-caption')], 'e-imgbreak');
    }
    this.callBack(e);
  };
  s.prototype.callBack = function (e) {
    if (e.callBack) {
      e.callBack({
        requestType: e.item.subCommand,
        editorMode: 'HTML',
        event: e.event,
        range: this.parent.nodeSelection.getRange(this.parent.currentDocument),
        elements: this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument),
      });
    }
  };
  s.prototype.destroy = function () {
    this.removeEventListener();
  };
  return s;
})();
var Ms = (function () {
  function s(e, t) {
    this.isImgUploaded = false;
    this.isAllowedTypes = true;
    this.pageX = null;
    this.pageY = null;
    this.deletedImg = [];
    this.parent = e;
    this.rteID = e.element.id;
    this.i10n = t.getService('rteLocale');
    this.rendererFactory = t.getService('rendererFactory');
    this.dialogRenderObj = t.getService('dialogRenderObject');
    this.popupUploaderObj = t.getService('popupUploaderObject');
    this.addEventListener();
    this.drop = this.dragDrop.bind(this);
    this.drag = this.dragOver.bind(this);
    this.enter = this.dragEnter.bind(this);
    this.start = this.dragStart.bind(this);
    this.docClick = this.onDocumentClick.bind(this);
    this.isDestroyed = false;
  }
  s.prototype.addEventListener = function () {
    if (!this.parent.isDestroyed) {
      this.parent.on(Ie, this.onKeyDown, this);
      this.parent.on(nt, this.onKeyUp, this);
      this.parent.on(Pt, this.insertImage, this);
      this.parent.on(Bn, this.showDialog, this);
      this.parent.on(Rn, this.closeDialog, this);
      this.parent.on(Ut, this.onWindowResize, this);
      this.parent.on(Ji, this.showImageQuickToolbar, this);
      this.parent.on(Qt, this.clearDialogObj, this);
      this.parent.on($i, this.onToolbarAction, this);
      this.parent.on(ri, this.caption, this);
      this.parent.on(oi, this.deleteImg, this);
      this.parent.on(ai, this.insertImgLink, this);
      this.parent.on(si, this.insertAltText, this);
      this.parent.on(Wt, this.editAreaClickHandler, this);
      this.parent.on(Ye, this.onIframeMouseDown, this);
      this.parent.on(li, this.imageSize, this);
      this.parent.on(it, this.alignmentSelect, this);
      this.parent.on(Le, this.afterRender, this);
      this.parent.on(Ot, this.afterRender, this);
      this.parent.on(Vt, this.imagePaste, this);
      this.parent.on(he, this.setCssClass, this);
      this.parent.on(ee, this.destroy, this);
      this.parent.on(rt, this.bindOnEnd, this);
      this.parent.on(pe, this.onPropertyChanged, this);
    }
  };
  s.prototype.removeEventListener = function () {
    if (!this.parent.isDestroyed) {
      this.parent.off(Ie, this.onKeyDown);
      this.parent.off(nt, this.onKeyUp);
      this.parent.off(Ut, this.onWindowResize);
      this.parent.off(Pt, this.insertImage);
      this.parent.off(Bn, this.showDialog);
      this.parent.off(Rn, this.closeDialog);
      this.parent.off(Ji, this.showImageQuickToolbar);
      this.parent.off(Qt, this.clearDialogObj);
      this.parent.off(ri, this.caption);
      this.parent.off($i, this.onToolbarAction);
      this.parent.off(oi, this.deleteImg);
      this.parent.off(ai, this.insertImgLink);
      this.parent.off(si, this.insertAltText);
      this.parent.off(Wt, this.editAreaClickHandler);
      this.parent.off(Ye, this.onIframeMouseDown);
      this.parent.off(li, this.imageSize);
      this.parent.off(it, this.alignmentSelect);
      this.parent.off(Le, this.afterRender);
      this.parent.off(Ot, this.afterRender);
      this.parent.off(Vt, this.imagePaste);
      this.parent.off(he, this.setCssClass);
      this.parent.off(ee, this.destroy);
      this.parent.off(rt, this.bindOnEnd);
      this.parent.off(pe, this.onPropertyChanged);
      var e = this.parent.iframeSettings.enable ? this.parent.inputElement.ownerDocument : this.parent.inputElement;
      e.removeEventListener('drop', this.drop, true);
      e.removeEventListener('dragstart', this.drag, true);
      e.removeEventListener('dragenter', this.enter, true);
      e.removeEventListener('dragover', this.start, true);
      this.drop = null;
      this.drag = null;
      this.enter = null;
      this.start = null;
      if (!p(this.contentModule)) {
        D.remove(this.contentModule.getEditPanel(), M.touchEndEvent, this.imageClick);
        this.parent.formatter.editorManager.observer.off(Zi, this.undoStack);
        if (this.parent.insertImageSettings.resize) {
          D.remove(this.parent.contentModule.getEditPanel(), M.touchStartEvent, this.resizeStart);
          this.parent.element.ownerDocument.removeEventListener('mousedown', this.docClick);
          this.docClick = null;
          D.remove(this.contentModule.getEditPanel(), 'cut', this.onCutHandler);
          D.remove(this.contentModule.getDocument(), M.touchMoveEvent, this.resizing);
        }
      }
    }
  };
  s.prototype.bindOnEnd = function () {
    if (this.parent.formatter.editorManager && !this.parent.formatter.editorManager.imgObj) {
      this.parent.formatter.editorManager.imgObj = new fs(this.parent.formatter.editorManager);
    }
  };
  s.prototype.onPropertyChanged = function (e) {
    for (var t = 0, i = Object.keys(e.newProp); t < i.length; t++) {
      var n = i[t];
      if (i[t] === 'insertImageSettings')
        switch (Object.keys(e.newProp.insertImageSettings)[0]) {
          case 'resize':
            this.parent.insertImageSettings.resize === false
              ? (D.remove(this.parent.contentModule.getEditPanel(), M.touchStartEvent, this.resizeStart),
                D.remove(this.contentModule.getEditPanel(), 'cut', this.onCutHandler),
                this.cancelResizeAction())
              : this.addresizeHandler();
            break;
        }
    }
  };
  s.prototype.updateCss = function (e, t) {
    if (e && t.cssClass) {
      p(t.oldCssClass)
        ? e.setProperties({ cssClass: (e.cssClass + ' ' + t.cssClass).trim() })
        : e.setProperties({ cssClass: (e.cssClass.replace(t.oldCssClass, '').trim() + ' ' + t.cssClass).trim() });
    }
  };
  s.prototype.setCssClass = function (e) {
    if (this.popupObj && e.cssClass) {
      p(e.oldCssClass)
        ? B([this.popupObj.element], e.cssClass)
        : (x([this.popupObj.element], e.oldCssClass), B([this.popupObj.element], e.cssClass));
    }
    this.updateCss(this.checkBoxObj, e);
    this.updateCss(this.widthNum, e);
    this.updateCss(this.heightNum, e);
    this.updateCss(this.uploadObj, e);
    this.updateCss(this.dialogObj, e);
  };
  s.prototype.onIframeMouseDown = function (e) {
    var t = e.target;
    if (this.dialogObj) {
      this.dialogObj.hide({ returnValue: true });
    }
    if (
      !(!p(this.parent.currentTarget) && this.parent.currentTarget.nodeName === 'IMG') &&
      this.imgEle &&
      this.imgResizeDiv &&
      this.contentModule.getEditPanel().contains(this.imgResizeDiv)
    ) {
      this.cancelResizeAction();
    }
    if (
      this.contentModule.getEditPanel().querySelector('.e-img-resize') &&
      this.parent.currentTarget.nodeName === 'IMG' &&
      !p(this.prevSelectedImgEle) &&
      this.prevSelectedImgEle !== e.target
    ) {
      this.prevSelectedImgEle.style.outline = '';
    }
  };
  s.prototype.addresizeHandler = function () {
    D.add(this.parent.contentModule.getEditPanel(), M.touchStartEvent, this.resizeStart, this);
    this.parent.element.ownerDocument.addEventListener('mousedown', this.docClick);
    D.add(this.contentModule.getEditPanel(), 'cut', this.onCutHandler, this);
  };
  s.prototype.afterRender = function () {
    this.contentModule = this.rendererFactory.getRenderer(te.Content);
    D.add(this.contentModule.getEditPanel(), M.touchEndEvent, this.imageClick, this);
    if (this.parent.insertImageSettings.resize) {
      this.addresizeHandler();
    }
    var e = this.parent.iframeSettings.enable ? this.parent.inputElement.ownerDocument : this.parent.inputElement;
    e.addEventListener('drop', this.drop, true);
    e.addEventListener('dragstart', this.drag, true);
    e.addEventListener('dragenter', this.enter, true);
    e.addEventListener('dragover', this.start, true);
  };
  s.prototype.undoStack = function (e) {
    if (
      (e.subCommand.toLowerCase() === 'undo' || e.subCommand.toLowerCase() === 'redo') &&
      this.parent.editorMode === 'HTML'
    )
      for (var t = 0; t < this.parent.formatter.getUndoRedoStack().length; t++) {
        var i = this.parent.createElement('div');
        var n = this.parent.formatter.getUndoRedoStack()[t].text;
        i.appendChild(this.parent.formatter.getUndoRedoStack()[t].text.cloneNode(true));
        var r = i.querySelectorAll('img');
        if (i.querySelector('.e-img-resize') && r.length > 0) {
          for (var o = 0; o < r.length; o++) r[o].style.outline = '';
          y(i.querySelector('.e-img-resize'));
          for (var a = i.cloneNode(true), l = document.createDocumentFragment(); a.firstChild; )
            l.appendChild(a.firstChild);
          this.parent.formatter.getUndoRedoStack()[t].text = l;
        }
      }
  };
  s.prototype.resizeEnd = function (e) {
    this.resizeBtnInit();
    if (this.imgEle.parentElement) {
      this.imgEle.parentElement.style.cursor = 'auto';
    }
    if (M.isDevice) {
      x([e.target.parentElement], 'e-mob-span');
    }
    var t = {
      event: e,
      requestType: 'images',
    };
    this.parent.trigger(Ar, t);
    this.parent.formatter.editorManager.observer.on(Zi, this.undoStack, this);
    this.parent.formatter.saveData();
    D.remove(this.contentModule.getDocument(), M.touchMoveEvent, this.resizing);
    D.remove(this.contentModule.getDocument(), M.touchEndEvent, this.resizeEnd);
  };
  s.prototype.resizeStart = function (e, t) {
    var i = this;
    if (!this.parent.readonly) {
      var n = t || e.target;
      this.prevSelectedImgEle = this.imgEle;
      if (n.tagName === 'IMG') {
        this.parent.preventDefaultResize(e);
        var r = n;
        if (this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {
          y(this.imgResizeDiv);
        }
        this.imageResize(n);
      }
      if (n.classList.contains('e-rte-imageboxmark')) {
        if (this.parent.formatter.getUndoRedoStack().length === 0) {
          this.parent.formatter.saveData();
        }
        this.pageX = this.getPointX(e);
        this.pageY = this.getPointY(e);
        e.preventDefault();
        e.stopImmediatePropagation();
        this.resizeBtnInit();
        if (this.quickToolObj) {
          this.quickToolObj.imageQTBar.hidePopup();
        }
        for (var o = ['topLeft', 'topRight', 'botLeft', 'botRight'], a = 0; a < o.length; a++) {
          var l = o[a];
          if (n.classList.contains('e-rte-' + l)) {
            this.resizeBtnStat[l] = true;
            this.currentResizeHandler = l;
            this.aspectRatio = this.findAspectRatio(this.imgEle);
            break;
          }
        }
        if (
          M.isDevice &&
          this.contentModule.getEditPanel().contains(this.imgResizeDiv) &&
          !this.imgResizeDiv.classList.contains('e-mob-span')
        )
          B([this.imgResizeDiv], 'e-mob-span');
        else {
          var h = {
            event: e,
            requestType: 'images',
          };
          this.parent.trigger(xr, h, function (c) {
            if (c.cancel) {
              i.cancelResizeAction();
            }
          });
        }
        D.add(this.contentModule.getDocument(), M.touchMoveEvent, this.resizing, this);
        D.add(this.contentModule.getDocument(), M.touchEndEvent, this.resizeEnd, this);
      }
    }
  };
  s.prototype.imageClick = function (e) {
    if (M.isDevice) {
      (e.target.tagName === 'IMG' && e.target.parentElement.tagName === 'A') || e.target.tagName === 'IMG'
        ? (this.contentModule.getEditPanel().setAttribute('contenteditable', 'false'), e.target.focus())
        : this.parent.readonly || this.contentModule.getEditPanel().setAttribute('contenteditable', 'true');
    }
    if (e.target.tagName === 'IMG' && e.target.parentElement.tagName === 'A') {
      e.preventDefault();
    }
  };
  s.prototype.onCutHandler = function () {
    if (this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {
      this.cancelResizeAction();
    }
  };
  s.prototype.imageResize = function (e) {
    this.resizeBtnInit();
    this.imgEle = e;
    B([this.imgEle], 'e-resize');
    this.imgResizeDiv = this.parent.createElement('span', {
      className: 'e-img-resize' + this.parent.getCssClass(true),
      id: this.rteID + '_imgResize',
    });
    this.imgResizeDiv.appendChild(
      this.parent.createElement('span', {
        className: 'e-rte-imageboxmark e-rte-topLeft' + this.parent.getCssClass(true),
        styles: 'cursor: nwse-resize',
      }),
    );
    this.imgResizeDiv.appendChild(
      this.parent.createElement('span', {
        className: 'e-rte-imageboxmark e-rte-topRight' + this.parent.getCssClass(true),
        styles: 'cursor: nesw-resize',
      }),
    );
    this.imgResizeDiv.appendChild(
      this.parent.createElement('span', {
        className: 'e-rte-imageboxmark e-rte-botLeft' + this.parent.getCssClass(true),
        styles: 'cursor: nesw-resize',
      }),
    );
    this.imgResizeDiv.appendChild(
      this.parent.createElement('span', {
        className: 'e-rte-imageboxmark e-rte-botRight' + this.parent.getCssClass(true),
        styles: 'cursor: nwse-resize',
      }),
    );
    if (M.isDevice) {
      B([this.imgResizeDiv], 'e-mob-rte');
    }
    e.style.outline = '2px solid #4a90e2';
    this.imgResizePos(e, this.imgResizeDiv);
    this.resizeImgDupPos(e);
    this.contentModule.getEditPanel().appendChild(this.imgResizeDiv);
    if (this.parent.element.style.height === 'auto') {
      this.imgResizePos(e, this.imgResizeDiv);
    }
  };
  s.prototype.getPointX = function (e) {
    return this.parent.iframeSettings.enable
      ? e.touches && e.touches.length
        ? e.touches[0].screenX
        : e.screenX
      : e.touches && e.touches.length
        ? e.touches[0].pageX
        : e.pageX;
  };
  s.prototype.getPointY = function (e) {
    return this.parent.iframeSettings.enable
      ? e.touches && e.touches.length
        ? e.touches[0].screenY
        : e.screenY
      : e.touches && e.touches.length
        ? e.touches[0].pageY
        : e.pageY;
  };
  s.prototype.imgResizePos = function (e, t) {
    var i = this.calcPos(e);
    var n = i.top;
    var r = i.left;
    var o = e.getBoundingClientRect().width;
    var a = e.getBoundingClientRect().height;
    var l = M.isDevice
      ? 4 * parseInt(e.style.outline.slice(-3), 10) + 2
      : 2 * parseInt(e.style.outline.slice(-3), 10) + 2;
    var h = M.isDevice ? 0 : 2;
    t.querySelector('.e-rte-botLeft').style.left = i.left - l + 'px';
    t.querySelector('.e-rte-botLeft').style.top = e.getBoundingClientRect().height - l + i.top + 'px';
    t.querySelector('.e-rte-botRight').style.left = e.getBoundingClientRect().width - (l - h) + i.left + 'px';
    t.querySelector('.e-rte-botRight').style.top = e.getBoundingClientRect().height - l + i.top + 'px';
    t.querySelector('.e-rte-topRight').style.left = e.getBoundingClientRect().width - (l - h) + i.left + 'px';
    t.querySelector('.e-rte-topRight').style.top = i.top - l + 'px';
    t.querySelector('.e-rte-topLeft').style.left = i.left - l + 'px';
    t.querySelector('.e-rte-topLeft').style.top = i.top - l + 'px';
  };
  s.prototype.calcPos = function (e) {
    for (
      var t = ['TD', 'TH', 'TABLE', 'A'],
        i = {
          top: 0,
          left: 0,
        },
        n,
        r = e.ownerDocument,
        o =
          (e.offsetParent &&
          (e.offsetParent.classList.contains('e-img-caption') || t.indexOf(e.offsetParent.tagName) > -1)
            ? v(e, '#' + this.parent.getID() + '_rte-edit-view')
            : e.offsetParent) || r.documentElement;
      o && (o === r.body || o === r.documentElement) && o.style.position === 'static';

    )
      o = o.parentNode;
    if (o && o !== e && o.nodeType === 1) {
      i = o.getBoundingClientRect();
    }
    return e.offsetParent && e.offsetParent.classList.contains('e-img-caption')
      ? ((n = e.getBoundingClientRect()),
        {
          top: n.top - i.top,
          left: n.left - i.left,
        })
      : {
          top: e.offsetTop,
          left: e.offsetLeft,
        };
  };
  s.prototype.setAspectRatio = function (e, t, i) {
    if (!p(e.width)) {
      var n = e.width;
      var r = e.height;
      var o = e.width === e.height;
      var a = this.parent.insertImageSettings.resizeByPercent ? '%' : 'px';
      var l = e.style.width === '' && e.style.height === '';
      !o && !l
        ? e.style.width !== '' && e.style.height !== ''
          ? this.parent.insertImageSettings.resizeByPercent
            ? (this.setImageWidth(e, t, a), this.removeImageHeight(e))
            : (this.setImageWidth(e, t, a), this.setImageHeight(e, i, a))
          : e.style.width !== ''
            ? this.parent.insertImageSettings.resizeByPercent
              ? (this.setImageWidth(e, t, a), this.removeImageHeight(e))
              : this.setImageWidth(e, t, a)
            : e.style.height !== '' &&
              (this.parent.insertImageSettings.resizeByPercent
                ? (this.setImageWidth(e, t, a), this.removeImageHeight(e))
                : this.setImageHeight(e, i, a))
        : (this.setImageWidth(e, t, a),
          this.parent.insertImageSettings.resizeByPercent ? this.removeImageHeight(e) : this.setImageHeight(e, i, a));
    }
  };
  s.prototype.setImageWidth = function (e, t, i) {
    e.style.width = this.getImageDimension(t, e) + i;
    if (!this.parent.insertImageSettings.resizeByPercent) {
      e.setAttribute('width', t.toString());
    }
  };
  s.prototype.setImageHeight = function (e, t, i) {
    e.style.height = this.getImageDimension(t, e) + i;
    if (!this.parent.insertImageSettings.resizeByPercent) {
      e.setAttribute('height', t.toString());
    }
  };
  s.prototype.removeImageHeight = function (e) {
    e.style.height = '';
    e.removeAttribute('height');
  };
  s.prototype.getImageDimension = function (e, t) {
    if (this.parent.insertImageSettings.resizeByPercent) {
      var i = t.parentElement;
      return this.pixToPerc(e, t.parentElement);
    } else return e;
  };
  s.prototype.adjustDimensionsByAspectRatio = function (e, t, i) {
    t = Math.round(e / i);
    e = Math.round(t * i);
    return {
      width: e,
      height: t,
    };
  };
  s.prototype.pixToPerc = function (e, t) {
    return (e / parseFloat(getComputedStyle(t).width)) * 100;
  };
  s.prototype.imgDupMouseMove = function (e, t, i) {
    var n = this;
    var r = {
      event: i,
      requestType: 'images',
    };
    this.parent.trigger(Ir, r, function (o) {
      if (o.cancel) n.cancelResizeAction();
      else {
        if (
          parseInt(n.parent.insertImageSettings.minWidth, 10) >= parseInt(e, 10) ||
          (parseInt(n.parent.getInsertImgMaxWidth(), 10) <= parseInt(e, 10) && p(n.imgEle.style.width)) ||
          (!n.parent.insertImageSettings.resizeByPercent &&
            (parseInt(n.parent.insertImageSettings.minHeight, 10) >= parseInt(t, 10) ||
              parseInt(n.parent.insertImageSettings.maxHeight, 10) <= parseInt(t, 10)))
        )
          return;
        n.imgEle.parentElement.style.cursor = 'pointer';
        n.setAspectRatio(n.imgEle, parseInt(e, 10), parseInt(t, 10));
        n.resizeImgDupPos(n.imgEle);
        n.imgResizePos(n.imgEle, n.imgResizeDiv);
      }
    });
  };
  s.prototype.resizing = function (e) {
    if (!this.parent) {
      this.cancelResizeAction();
      return;
    }
    if (
      this.resizeBtnStat.botRight ||
      this.resizeBtnStat.botLeft ||
      this.resizeBtnStat.topRight ||
      this.resizeBtnStat.topLeft
    )
      if (this.parent.iframeSettings.enable) {
        var t = this.getResizeFactor(this.currentResizeHandler);
        var i = this.getPointX(e);
        var n = this.getPointY(e);
        var r = this.imgEle.clientWidth;
        var o = this.imgEle.clientHeight;
        var a = i - this.pageX;
        var l = n - this.pageY;
        var h = a * t[0] + this.imgEle.clientWidth;
        var c = l * t[1] + this.imgEle.clientHeight;
        var d = this.adjustDimensions(h, c, a, l, this.aspectRatio);
        this.pageX = i;
        this.pageY = n;
        this.imgDupMouseMove(d.width + 'px', d.height + 'px', e);
        this.parent.autoResize();
      } else {
        var u = this.getPointX(e);
        var f = this.getPointY(e);
        var t = this.getResizeFactor(this.currentResizeHandler);
        var m = u - this.pageX;
        var g = f - this.pageY;
        var r = this.imgEle.clientWidth;
        var o = this.imgEle.clientHeight;
        var h = m * t[0] + this.imgEle.clientWidth;
        var c = g * t[1] + this.imgEle.clientHeight;
        var d = this.adjustDimensions(h, c, m, g, this.aspectRatio);
        this.pageX = u;
        this.pageY = f;
        this.imgDupMouseMove(d.width + 'px', d.height + 'px', e);
      }
  };
  s.prototype.adjustDimensions = function (e, t, i, n, r) {
    e = e < 16 ? 16 : e;
    t = t < 16 ? 16 : t;
    var o = this.adjustDimensionsByAspectRatio(e, t, r);
    return o;
  };
  s.prototype.getResizeFactor = function (e) {
    return So[e];
  };
  s.prototype.findAspectRatio = function (e) {
    return e.clientWidth / e.clientHeight;
  };
  s.prototype.cancelResizeAction = function () {
    D.remove(this.contentModule.getDocument(), M.touchMoveEvent, this.resizing);
    D.remove(this.contentModule.getDocument(), M.touchEndEvent, this.resizeEnd);
    if (this.imgEle && this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {
      y(this.imgResizeDiv);
      this.imgEle.style.outline = '';
      this.imgResizeDiv = null;
      this.pageX = null;
      this.pageY = null;
      this.currentResizeHandler = null;
      this.aspectRatio = null;
    }
  };
  s.prototype.resizeImgDupPos = function (e) {
    this.imgDupPos = {
      width:
        e.style.width !== '' && this.parent.insertImageSettings && !this.parent.insertImageSettings.resizeByPercent
          ? this.imgEle.style.width
          : e.width + 'px',
      height: e.style.height !== '' ? this.imgEle.style.height : e.height + 'px',
    };
  };
  s.prototype.resizeBtnInit = function () {
    this.aspectRatio = null;
    this.currentResizeHandler = null;
    return (this.resizeBtnStat = {
      botLeft: false,
      botRight: false,
      topRight: false,
      topLeft: false,
    });
  };
  s.prototype.onToolbarAction = function (e) {
    if (W()) {
      this.parent.notify(Me, {});
    }
    var t = e.args.item;
    switch (e.args.item.subCommand) {
      case 'Replace':
        this.parent.fileManagerSettings.enable ? this.parent.notify(Pr, e) : this.parent.notify(Pt, e);
        break;
      case 'Caption':
        this.parent.notify(ri, e);
        break;
      case 'InsertLink':
        this.parent.notify(ai, e);
        break;
      case 'AltText':
        this.parent.notify(si, e);
        break;
      case 'Remove':
        this.parent.notify(oi, e);
        break;
      case 'Dimension':
        this.parent.notify(li, e);
        break;
      case 'OpenImageLink':
        this.openImgLink(e);
        break;
      case 'EditImageLink':
        this.editImgLink(e);
        break;
      case 'RemoveImageLink':
        this.removeImgLink(e);
        break;
    }
  };
  s.prototype.openImgLink = function (e) {
    var t = this.parent.htmlEditorModule.sanitizeHelper(e.selectParent[0].parentNode.outerHTML);
    var i = document.createElement('div');
    i.innerHTML = t;
    var n = e.selectParent[0].parentNode.target === '' ? '_self' : '_blank';
    this.parent.formatter.process(this.parent, e.args, e.args, {
      url: i.firstChild.href,
      target: n,
      selectNode: e.selectNode,
      subCommand: e.args.item.subCommand,
    });
    i.remove();
  };
  s.prototype.editImgLink = function (e) {
    var t = e.selectParent[0].parentNode;
    var i = this.i10n.getConstant('dialogUpdate');
    var n = {
      url: e.selectParent[0].parentNode.href,
      target: e.selectParent[0].parentNode.target,
      header: 'Edit Link',
      btnText: i,
    };
    this.insertImgLink(e, n);
  };
  s.prototype.removeImgLink = function (e) {
    if (M.isIE) {
      this.contentModule.getEditPanel().focus();
    }
    e.selection.restore();
    var t = !!(this.contentModule.getEditPanel().contains(this.captionEle) && _('a', this.captionEle));
    var i = t ? [this.captionEle] : [e.selectNode[0].parentElement];
    this.parent.formatter.process(this.parent, e.args, e.args, {
      insertElement: e.selectNode[0],
      selectParent: i,
      selection: e.selection,
      subCommand: e.args.item.subCommand,
    });
    if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {
      this.quickToolObj.imageQTBar.hidePopup();
      if (!p(e.selectParent)) {
        x([e.selectParent[0]], 'e-img-focus');
      }
    }
    if (t) {
      _('.e-img-inner', this.captionEle).focus();
    }
  };
  s.prototype.onKeyDown = function (e) {
    var t = e.args;
    var i;
    var n;
    var r;
    var o;
    this.deletedImg = [];
    var a;
    var l = [
      27, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 44, 45, 9, 16, 17, 18, 19, 20, 33, 34, 35, 36, 37,
      38, 39, 40, 91, 92, 93, 144, 145, 182, 183,
    ];
    if (this.parent.editorMode === 'HTML') {
      i = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());
      a = i.startContainer === i.endContainer && i.startOffset === i.endOffset;
    }
    if (!a && this.parent.editorMode === 'HTML' && l.indexOf(t.which) < 0)
      for (var h = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(i), c = 0; c < h.length; c++)
        if (h[c].nodeName === 'IMG') {
          this.deletedImg.push(h[c]);
        }
    if (
      this.parent.editorMode === 'HTML' &&
      ((t.which === 8 && t.code === 'Backspace') || (t.which === 46 && t.code === 'Delete'))
    ) {
      var d = i.startContainer === i.endContainer && i.startOffset === i.endOffset;
      t.which === 8 && t.code === 'Backspace' && d
        ? this.checkImageBack(i)
        : t.which === 46 && t.code === 'Delete' && d && this.checkImageDel(i);
    }
    if (!p(this.parent.formatter.editorManager.nodeSelection) && t.code !== 'KeyK') {
      i = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());
      r = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(i);
      o = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(i);
      if (
        !t.ctrlKey &&
        t.key &&
        (t.key.length === 1 || t.action === 'enter') &&
        !p(o[0]) &&
        o[0].tagName === 'IMG' &&
        o[0].parentElement
      ) {
        if (this.contentModule.getEditPanel().querySelector('.e-img-resize')) {
          this.removeResizeEle();
        }
        x([o[0]], 'e-img-focus');
        if (this.quickToolObj && this.quickToolObj.imageQTBar) {
          this.quickToolObj.imageQTBar.hidePopup();
        }
      }
    }
    if (t.ctrlKey && (t.keyCode === 89 || t.keyCode === 90) && this.parent.editorMode !== 'Markdown') {
      this.undoStack({ subCommand: t.keyCode === 90 ? 'undo' : 'redo' });
    }
    if (t.keyCode === 8 || t.keyCode === 46) {
      if (r && r[0] && r[0].nodeName === 'IMG' && r.length < 1) {
        if (!p(this.parent.formatter.editorManager.nodeSelection)) {
          n = this.parent.formatter.editorManager.nodeSelection.save(i, this.parent.contentModule.getDocument());
        }
        t.preventDefault();
        var u = {
          selectNode: r,
          selection: n,
          selectParent: o,
          args: {
            item: {
              command: 'Images',
              subCommand: 'Remove',
            },
            originalEvent: t,
          },
        };
        this.deleteImg(u, t.keyCode);
      }
      if (this.parent.contentModule.getEditPanel().querySelector('.e-img-resize')) {
        this.removeResizeEle();
      }
    }
    switch ((t.code === 'Backspace' && (t.action = 'backspace'), t.action)) {
      case 'escape':
        if (!p(this.dialogObj)) {
          this.dialogObj.close();
        }
        break;
      case 'backspace':
      case 'delete':
        if (this.parent.editorMode !== 'Markdown') {
          if (i.startContainer.nodeType === 3)
            t.code === 'Backspace'
              ? i.startContainer.previousElementSibling &&
                i.startOffset === 0 &&
                i.startContainer.previousElementSibling.classList.contains(ye) &&
                i.startContainer.previousElementSibling.classList.contains(bt) &&
                y(i.startContainer.previousElementSibling)
              : i.startContainer.nextElementSibling &&
                i.endContainer.textContent.length === i.endOffset &&
                i.startContainer.nextElementSibling.classList.contains(ye) &&
                i.startContainer.nextElementSibling.classList.contains(bt) &&
                y(i.startContainer.nextElementSibling);
          else if (i.startContainer.nodeType === 1) {
            if (i.startContainer.querySelector('.' + ye + '.' + bt))
              y(i.startContainer.querySelector('.' + ye + '.' + bt));
            else if (i.startContainer.querySelector('.' + ye + '.' + Re))
              y(i.startContainer.querySelector('.' + ye + '.' + Re));
            else if (i.startContainer.classList.contains('e-img-wrap') && v(i.startContainer, '.' + ye)) {
              var f = i.startContainer.parentElement.parentElement;
              y(v(i.startContainer, '.' + ye));
              if (
                i.startContainer.parentElement.parentElement &&
                i.startContainer.parentElement.parentElement.textContent.trim() === ''
              ) {
                var m = this.parent.createElement('br');
                m.classList.add('e-rte-image-remove-focus');
                i.startContainer.parentElement.parentElement.appendChild(m);
              }
            }
          }
        }
        break;
      case 'insert-image':
        {
          if (!p(this.parent.formatter.editorManager.nodeSelection)) {
            n = this.parent.formatter.editorManager.nodeSelection.save(i, this.parent.contentModule.getDocument());
          }
          this.openDialog(true, t, n, r, o);
          t.preventDefault();
        }
        break;
    }
    if (t.ctrlKey && t.key === 'a') {
      this.handleSelectAll();
    }
  };
  s.prototype.handleSelectAll = function () {
    this.cancelResizeAction();
    var e = this.parent.inputElement.querySelectorAll('.' + An);
    x(e, An);
  };
  s.prototype.openDialog = function (e, t, i, n, r) {
    var o;
    var a;
    var l;
    var h;
    !e && !p(this.parent.formatter.editorManager.nodeSelection)
      ? ((o = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument())),
        (a = this.parent.formatter.editorManager.nodeSelection.save(o, this.parent.contentModule.getDocument())),
        (l = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(o)),
        (h = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(o)))
      : ((a = i), (l = n), (h = r));
    this.parent.editorMode === 'HTML'
      ? this.insertImage({
          args: {
            item: {
              command: 'Images',
              subCommand: 'Image',
            },
            originalEvent: t,
            name: e ? null : 'showDialog',
          },
          selectNode: l,
          selection: a,
          selectParent: h,
        })
      : this.insertImage({
          args: {
            item: {
              command: 'Images',
              subCommand: 'Image',
            },
            originalEvent: t,
            name: e ? null : 'showDialog',
          },
          member: 'image',
          text: this.parent.formatter.editorManager.markdownSelection.getSelectedText(
            this.parent.contentModule.getEditPanel(),
          ),
          module: 'Markdown',
          name: 'insertImage',
        });
  };
  s.prototype.showDialog = function (e) {
    p(e.originalEvent) ? this.openDialog(false) : this.openDialog(false, e.originalEvent);
    this.setCssClass({ cssClass: this.parent.getCssClass() });
  };
  s.prototype.closeDialog = function () {
    if (this.dialogObj) {
      this.dialogObj.hide({ returnValue: true });
    }
  };
  s.prototype.onKeyUp = function () {
    if (!p(this.deletedImg) && this.deletedImg.length > 0)
      for (var e = Array.from(this.deletedImg), t = e.length - 1; t >= 0; t--) {
        var i = {
          element: this.deletedImg[t],
          src: this.deletedImg[t].getAttribute('src'),
        };
        this.parent.trigger(hi, i);
        this.deletedImg.splice(t, 1);
      }
  };
  s.prototype.checkImageBack = function (e) {
    e.startContainer.nodeName === '#text' &&
    e.startOffset === 0 &&
    !p(e.startContainer.previousSibling) &&
    e.startContainer.previousSibling.nodeName === 'IMG'
      ? this.deletedImg.push(e.startContainer.previousSibling)
      : e.startContainer.nodeName !== '#text' &&
        !p(e.startContainer.childNodes[e.startOffset - 1]) &&
        e.startContainer.childNodes[e.startOffset - 1].nodeName === 'IMG' &&
        this.deletedImg.push(e.startContainer.childNodes[e.startOffset - 1]);
  };
  s.prototype.checkImageDel = function (e) {
    e.startContainer.nodeName === '#text' &&
    e.startOffset === e.startContainer.textContent.length &&
    !p(e.startContainer.nextSibling) &&
    e.startContainer.nextSibling.nodeName === 'IMG'
      ? this.deletedImg.push(e.startContainer.nextSibling)
      : e.startContainer.nodeName !== '#text' &&
        !p(e.startContainer.childNodes[e.startOffset]) &&
        e.startContainer.childNodes[e.startOffset].nodeName === 'IMG' &&
        this.deletedImg.push(e.startContainer.childNodes[e.startOffset]);
  };
  s.prototype.alignmentSelect = function (e) {
    var t = e.item;
    if (
      !(!document.body.contains(document.body.querySelector('.e-rte-quick-toolbar')) || e.item.command !== 'Images')
    ) {
      var i = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());
      var n = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(i);
      n = n[0].nodeName === 'IMG' ? n : [this.imgEle];
      var r = {
        args: e,
        selectNode: n,
      };
      switch (
        (this.parent.formatter.getUndoRedoStack().length === 0 && this.parent.formatter.saveData(), e.item.subCommand)
      ) {
        case 'JustifyLeft':
          this.alignImage(r);
          break;
        case 'JustifyCenter':
          this.alignImage(r);
          break;
        case 'JustifyRight':
          this.alignImage(r);
          break;
        case 'Inline':
          this.inline(r);
          break;
        case 'Break':
          this.break(r);
          break;
      }
      if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {
        this.quickToolObj.imageQTBar.hidePopup();
        x([n[0]], 'e-img-focus');
      }
      this.cancelResizeAction();
    }
  };
  s.prototype.showImageQuickToolbar = function (e) {
    var t = this;
    if (
      !(
        (e.type !== 'Images' && e.type !== 'Replace') ||
        p(this.parent.quickToolbarModule) ||
        p(this.parent.quickToolbarModule.imageQTBar) ||
        p(e.args)
      )
    ) {
      this.quickToolObj = this.parent.quickToolbarModule;
      var i = e.elements;
      [].forEach.call(e.elements, function (r, o) {
        if (o === 0) {
          i = r;
        }
      });
      var n = this.quickToolObj.imageQTBar.quickTBarObj.toolbarObj.element;
      if (!p(this.quickToolObj.imageQTBar.quickTBarObj.toolbarObj.element.querySelector('.e-insert-link'))) {
        i.closest('a')
          ? this.quickToolObj.imageQTBar.quickTBarObj.toolbarObj.element.classList.add('e-link-enabled')
          : this.quickToolObj.imageQTBar.quickTBarObj.toolbarObj.element.classList.contains('e-link-enabled') &&
            this.quickToolObj.imageQTBar.quickTBarObj.toolbarObj.element.classList.remove('e-link-enabled');
      }
      if (i.nodeName === 'IMG') {
        B([i], ['e-img-focus']);
      }
      if (this.parent.quickToolbarModule.imageQTBar) {
        e.isNotify
          ? (this.imageQTPopupTime = setTimeout(
              function () {
                t.parent.formatter.editorManager.nodeSelection.Clear(t.contentModule.getDocument());
                t.parent.formatter.editorManager.nodeSelection.setSelectionContents(t.contentModule.getDocument(), i);
                t.quickToolObj.imageQTBar.showPopup(i, e.args);
                if (t.parent.insertImageSettings.resize === true) {
                  t.resizeStart(e.args, i);
                }
              },
              this.parent.element.dataset.rteUnitTesting === 'true' ? 0 : 400,
            ))
          : this.quickToolObj.imageQTBar.showPopup(i, e.args);
      }
    }
  };
  s.prototype.hideImageQuickToolbar = function () {
    if (!p(this.contentModule.getEditPanel().querySelector('.e-img-focus'))) {
      x([this.contentModule.getEditPanel().querySelector('.e-img-focus')], 'e-img-focus');
      if (
        this.quickToolObj &&
        this.quickToolObj.imageQTBar &&
        document.body.contains(this.quickToolObj.imageQTBar.element)
      ) {
        this.quickToolObj.imageQTBar.hidePopup();
      }
    }
  };
  s.prototype.editAreaClickHandler = function (e) {
    if (this.parent.readonly) {
      this.hideImageQuickToolbar();
      return;
    }
    var t = e.args;
    var i = this.parent.quickToolbarSettings.showOnRightClick;
    if (
      e.args.which === 2 ||
      (this.parent.quickToolbarSettings.showOnRightClick && e.args.which === 1) ||
      (!this.parent.quickToolbarSettings.showOnRightClick && e.args.which === 3)
    ) {
      if (
        this.parent.quickToolbarSettings.showOnRightClick &&
        e.args.which === 1 &&
        !p(e.args.target) &&
        e.args.target.tagName === 'IMG'
      ) {
        this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());
        this.parent.formatter.editorManager.nodeSelection.setSelectionContents(
          this.contentModule.getDocument(),
          e.args.target,
        );
      }
      return;
    }
    if (
      this.parent.editorMode === 'HTML' &&
      this.parent.quickToolbarModule &&
      this.parent.quickToolbarModule.imageQTBar
    ) {
      this.quickToolObj = this.parent.quickToolbarModule;
      var n = e.args.target;
      this.contentModule = this.rendererFactory.getRenderer(te.Content);
      e.args.target.nodeName === 'IMG' && this.parent.quickToolbarModule
        ? (this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument()),
          this.parent.formatter.editorManager.nodeSelection.setSelectionContents(
            this.contentModule.getDocument(),
            e.args.target,
          ),
          W() && this.parent.notify(Fe, e),
          B([e.args.target], 'e-img-focus'),
          this.showImageQuickToolbar({
            args: e.args,
            type: 'Images',
            elements: [e.args.target],
          }))
        : this.hideImageQuickToolbar();
    }
  };
  s.prototype.insertImgLink = function (e, t) {
    var i = this;
    if (e.selectNode[0].nodeName === 'IMG' && (this.imagDialog(e), !p(this.dialogObj))) {
      var n = this.parent.createElement('div', { className: 'e-img-linkwrap' + this.parent.getCssClass(true) });
      var r = this.i10n.getConstant('linkurl');
      var o =
        '<div class="e-rte-field' +
        this.parent.getCssClass(true) +
        '"><input type="text" data-role ="none" class="e-input e-img-link' +
        this.parent.getCssClass(true) +
        '" spellcheck="false" placeholder="' +
        r +
        '"/></div><div class="e-rte-label"></div><div class="e-rte-field"><input type="checkbox" class="e-rte-linkTarget' +
        this.parent.getCssClass(true) +
        '"  data-role ="none"></div>';
      var a = Et(o);
      n.appendChild(a);
      var l = n.querySelector('.e-rte-linkTarget');
      var h = n.querySelector('.e-img-link');
      var c = this.i10n.getConstant('linkOpenInNewWindow');
      this.checkBoxObj = new Lo({
        label: c,
        checked: true,
        enableRtl: this.parent.enableRtl,
        cssClass: this.parent.getCssClass(),
        change: function (g) {
          g.checked ? (d = '_blank') : (d = null);
        },
      });
      this.checkBoxObj.isStringTemplate = true;
      this.checkBoxObj.createElement = this.parent.createElement;
      this.checkBoxObj.appendTo(l);
      var d = '_blank';
      var u = this.i10n.getConstant('imageLinkAriaLabel');
      var f = this.i10n.getConstant('dialogUpdate');
      var m = {
        args: e.args,
        selfImage: this,
        selection: e.selection,
        selectNode: e.selectNode,
        selectParent: e.selectParent,
        link: h,
        target: d,
        ariaLabel: u,
      };
      this.dialogObj.setProperties({
        width: '290px',
        header: this.parent.localeObj.getConstant('imageInsertLinkHeader'),
        content: n,
        buttons: [
          {
            click: function (g) {
              i.insertlink(m);
            },
            buttonModel: {
              content: f,
              cssClass: 'e-flat e-update-link' + this.parent.getCssClass(true),
              isPrimary: true,
            },
          },
        ],
        cssClass: this.dialogObj.cssClass + ' e-rte-img-link-dialog',
      });
      if (!p(this.parent.cssClass)) {
        this.dialogObj.setProperties({ cssClass: this.parent.cssClass });
      }
      if (!p(t)) {
        h.value = t.url;
        this.checkBoxObj.checked = !!t.target;
        this.dialogObj.header = t.header;
      }
      this.dialogObj.element.style.maxHeight = 'inherit';
      this.dialogObj.content.querySelector('input').focus();
    }
  };
  s.prototype.insertAltText = function (e) {
    var t = this;
    if (e.selectNode[0].nodeName === 'IMG') {
      this.imagDialog(e);
      var i = this.i10n.getConstant('altText');
      if (!p(this.dialogObj)) {
        var n = this.parent.createElement('div', { className: 'e-img-altwrap' + this.parent.getCssClass(true) });
        var r = this.i10n.getConstant('alternateHeader');
        var o = this.i10n.getConstant('dialogUpdate');
        var a = e.selectNode[0].getAttribute('alt') === null ? '' : e.selectNode[0].getAttribute('alt');
        var l =
          '<div class="e-rte-field' +
          this.parent.getCssClass(true) +
          '"><input type="text" spellcheck="false"  class="e-input e-img-alt' +
          this.parent.getCssClass(true) +
          '" placeholder="' +
          i +
          '"/></div>';
        var h = Et(l);
        h.querySelector('input').setAttribute('value', a);
        n.appendChild(h);
        var c = n.querySelector('.e-img-alt');
        var d = {
          args: e.args,
          selfImage: this,
          selection: e.selection,
          selectNode: e.selectNode,
          alt: c,
        };
        this.dialogObj.setProperties({
          width: '290px',
          header: r,
          content: n,
          buttons: [
            {
              click: function (u) {
                t.insertAlt(d);
              },
              buttonModel: {
                content: o,
                cssClass: 'e-flat e-update-alt' + this.parent.getCssClass(true),
                isPrimary: true,
              },
            },
          ],
          cssClass: this.dialogObj.cssClass + ' e-rte-img-alt-dialog',
        });
        if (!p(this.parent.cssClass)) {
          this.dialogObj.setProperties({ cssClass: this.parent.cssClass });
        }
        this.dialogObj.element.style.maxHeight = 'inherit';
        this.dialogObj.content.querySelector('input').focus();
      }
    }
  };
  s.prototype.insertAlt = function (e) {
    if (!p(e.alt)) {
      e.selection.restore();
      if (this.parent.formatter.getUndoRedoStack().length === 0) {
        this.parent.formatter.saveData();
      }
      var t = e.alt.value;
      this.parent.formatter.process(this.parent, e.args, e.args, {
        altText: e.alt.value,
        selectNode: e.selectNode,
        subCommand: e.args.item.subCommand,
      });
      this.dialogObj.hide({ returnValue: false });
      this.parent.iframeSettings.enable
        ? this.parent.inputElement.focus({ preventScroll: true })
        : e.selectNode[0].focus({ preventScroll: true });
      e.selection.restore();
    }
  };
  s.prototype.handleKeyDown = function () {
    var e = this.parent.element.querySelector('#' + this.rteID + '_image_dialog-content');
    var t = e.querySelector('.e-img-link');
    if (t.classList.contains('e-error') && t.value.length >= 1 && t.value.trim() !== ' ') {
      x([t], 'e-error');
    }
  };
  s.prototype.insertlink = function (e) {
    if (e.selectNode[0].nodeName === 'IMG') {
      var t = e.link.value;
      if (t.trim() === '') {
        B([e.link], 'e-error');
        e.link.setSelectionRange(0, t.length);
        e.link.focus();
        D.add(e.link, 'input', this.handleKeyDown, this);
        return;
      } else {
        D.remove(e.link, 'input', this.handleKeyDown);
        x([e.link], 'e-error');
      }
      this.isUrl(t)
        ? x([e.link], 'e-error')
        : this.parent.enableAutoUrl || (t = t.indexOf('http') > -1 ? t : 'http://' + t);
      var i = e.selfImage;
      if (e.selfImage.parent.editorMode === 'HTML') {
        e.selection.restore();
      }
      if (e.selfImage.parent.formatter.getUndoRedoStack().length === 0) {
        e.selfImage.parent.formatter.saveData();
      }
      if (e.selectNode[0].parentElement.nodeName === 'A') {
        e.selfImage.parent.formatter.process(e.selfImage.parent, e.args, e.args, {
          url: t,
          target: e.selfImage.checkBoxObj.checked ? '_blank' : null,
          ariaLabel: e.selfImage.checkBoxObj.checked ? this.i10n.getConstant('imageLinkAriaLabel') : null,
          selectNode: e.selectNode,
          subCommand: e.args.item.subCommand,
        });
        e.selfImage.dialogObj.hide({ returnValue: true });
        return;
      }
      e.selfImage.parent.formatter.process(e.selfImage.parent, e.args, e.args, {
        url: t,
        target: e.selfImage.checkBoxObj.checked ? '_blank' : null,
        ariaLabel: e.selfImage.checkBoxObj.checked ? this.i10n.getConstant('imageLinkAriaLabel') : null,
        selectNode: e.selectNode,
        subCommand: e.args.item.subCommand,
        selection: e.selection,
      });
      var n = v(e.selectNode[0], '.e-img-caption');
      if (n) {
        var r = _('.' + Eo, n);
        if (n) {
          r.focus();
        }
      }
      e.selfImage.dialogObj.hide({ returnValue: false });
    }
  };
  s.prototype.isUrl = function (e) {
    var t = RegExp;
    var i = new RegExp('(ftp|http|https)://(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(/|/([\\w#!:.?+=&%@\\-\\/]))?', 'gi');
    return i.test(e);
  };
  s.prototype.deleteImg = function (e, t) {
    if (e.selectNode[0].nodeName === 'IMG') {
      var i = {
        element: e.selectNode[0],
        src: e.selectNode[0].getAttribute('src'),
      };
      if (this.parent.formatter.getUndoRedoStack().length === 0) {
        this.parent.formatter.saveData();
      }
      var n = e.selection.range.startContainer;
      if (
        e.selection.range.startContainer.nodeName === 'SPAN' &&
        n.classList.contains('e-img-wrap') &&
        n.parentElement.classList.contains('e-img-caption')
      ) {
        n = n.parentElement;
        if (p(n.previousSibling)) {
          if (!p(n.nextSibling)) {
            for (var o = n.nextSibling; o.nodeName !== '#text' && o.nodeName !== 'BR'; ) o = o.firstChild;
            this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.contentModule.getDocument(), o, 0);
          }
        } else {
          for (var r = n.previousSibling; r.nodeName !== '#text' && r.nodeName !== 'BR'; ) r = r.lastChild;
          this.parent.formatter.editorManager.nodeSelection.setCursorPoint(
            this.contentModule.getDocument(),
            r,
            r.nodeName !== 'BR' ? r.textContent.length : 0,
          );
        }
      } else e.selection.restore();
      if (this.contentModule.getEditPanel().querySelector('.e-img-resize')) {
        this.removeResizeEle();
      }
      this.parent.formatter.process(this.parent, e.args, e.args, {
        selectNode: e.selectNode,
        captionClass: ye,
        subCommand: e.args.item.subCommand,
      });
      if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {
        this.quickToolObj.imageQTBar.hidePopup();
      }
      this.cancelResizeAction();
      if (p(t)) {
        this.parent.trigger(hi, i);
      }
    }
  };
  s.prototype.caption = function (e) {
    var t = e.selectNode[0];
    if (e.selectNode[0].nodeName === 'IMG') {
      e.selection.restore();
      if (this.parent.formatter.getUndoRedoStack().length === 0) {
        this.parent.formatter.saveData();
      }
      this.cancelResizeAction();
      B([e.selectNode[0]], 'e-rte-image');
      var i = e.args.item ? e.args.item.subCommand : 'Caption';
      if (!p(v(e.selectNode[0], '.' + ye))) {
        y(v(e.selectNode[0], '.' + ye));
        if (M.isIE) {
          this.contentModule.getEditPanel().focus();
          e.selection.restore();
        }
        e.selectNode[0].parentElement.tagName === 'A'
          ? this.parent.formatter.process(this.parent, e.args, e.args, {
              insertElement: e.selectNode[0].parentElement,
              selectNode: e.selectNode,
              subCommand: i,
            })
          : this.parent.formatter.process(this.parent, e.args, e.args, {
              insertElement: e.selectNode[0],
              selectNode: e.selectNode,
              subCommand: i,
            });
      } else {
        this.captionEle = this.parent.createElement('span', {
          className: ye + ' ' + No + this.parent.getCssClass(true),
          attrs: {
            contenteditable: 'false',
            draggable: 'false',
            style: 'width:' + this.parent.insertImageSettings.width,
          },
        });
        var n = this.parent.createElement('span', { className: 'e-img-wrap' + this.parent.getCssClass(true) });
        var r = this.parent.createElement('span', {
          className: 'e-img-inner' + this.parent.getCssClass(true),
          attrs: { contenteditable: 'true' },
        });
        var o = e.selectNode[0].parentElement;
        if (e.selectNode[0].parentElement.tagName === 'A') {
          e.selectNode[0].parentElement.setAttribute('contenteditable', 'true');
        }
        n.appendChild(e.selectNode[0].parentElement.tagName === 'A' ? e.selectNode[0].parentElement : e.selectNode[0]);
        n.appendChild(r);
        var a = this.i10n.getConstant('imageCaption');
        r.innerHTML = a;
        this.captionEle.appendChild(n);
        if (e.selectNode[0].classList.contains(ot)) {
          B([this.captionEle], bt);
        }
        if (e.selectNode[0].classList.contains(Re)) {
          B([this.captionEle], Re);
        }
        if (e.selectNode[0].classList.contains(xn)) {
          B([this.captionEle], xn);
        }
        if (e.selectNode[0].classList.contains(In)) {
          B([this.captionEle], In);
        }
        if (e.selectNode[0].classList.contains(Pn)) {
          B([this.captionEle], Pn);
        }
        this.parent.formatter.process(this.parent, e.args, e.args, {
          insertElement: this.captionEle,
          selectNode: e.selectNode,
          subCommand: i,
        });
        this.parent.formatter.editorManager.nodeSelection.setSelectionText(
          this.contentModule.getDocument(),
          r.childNodes[0],
          r.childNodes[0],
          0,
          r.childNodes[0].textContent.length,
        );
      }
      if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {
        this.quickToolObj.imageQTBar.hidePopup();
        x([e.selectNode[0]], 'e-img-focus');
      }
    }
  };
  s.prototype.imageSize = function (e) {
    var t = this;
    if (e.selectNode[0].nodeName === 'IMG' && (this.imagDialog(e), !p(this.dialogObj))) {
      var i = this.i10n.getConstant('imageSizeHeader');
      var n = this.i10n.getConstant('dialogUpdate');
      this.changedHeightValue = null;
      this.changedWidthValue = null;
      var r = this.imgsizeInput(e);
      var o = {
        args: e.args,
        selfImage: this,
        selection: e.selection,
        selectNode: e.selectNode,
      };
      this.dialogObj.setProperties({
        width: '290px',
        header: i,
        content: r,
        buttons: [
          {
            click: function (a) {
              t.insertSize(o);
            },
            buttonModel: {
              content: n,
              cssClass: 'e-flat e-update-size' + this.parent.getCssClass(true),
              isPrimary: true,
            },
          },
        ],
        cssClass: this.dialogObj.cssClass + ' e-rte-img-size-dialog',
      });
      if (!p(this.parent.cssClass)) {
        this.dialogObj.setProperties({ cssClass: this.parent.cssClass });
      }
      this.dialogObj.element.style.maxHeight = 'inherit';
      this.dialogObj.content.querySelector('input').focus();
    }
  };
  s.prototype.break = function (e) {
    if (e.selectNode[0].nodeName === 'IMG') {
      var t = e.args.item.subCommand;
      this.parent.formatter.process(this.parent, e.args, e.args, {
        selectNode: e.selectNode,
        subCommand: e.args.item.subCommand,
      });
    }
  };
  s.prototype.inline = function (e) {
    if (e.selectNode[0].nodeName === 'IMG') {
      var t = e.args.item.subCommand;
      this.parent.formatter.process(this.parent, e.args, e.args, {
        selectNode: e.selectNode,
        subCommand: e.args.item.subCommand,
      });
    }
  };
  s.prototype.alignImage = function (e) {
    var t = e.args.item.subCommand;
    this.parent.formatter.process(this.parent, e.args, e.args, {
      selectNode: e.selectNode,
      subCommand: e.args.item.subCommand,
    });
  };
  s.prototype.clearDialogObj = function () {
    if (this.uploadObj && !this.uploadObj.isDestroyed) {
      this.uploadObj.destroy();
      y(this.uploadObj.element);
      this.uploadObj = null;
    }
    if (this.checkBoxObj && !this.checkBoxObj.isDestroyed) {
      this.checkBoxObj.destroy();
      y(this.checkBoxObj.element);
      this.checkBoxObj = null;
    }
    if (this.popupObj && !this.popupObj.isDestroyed) {
      this.popupObj.destroy();
      y(this.popupObj.element);
      this.popupObj = null;
    }
    if (this.widthNum && !this.widthNum.isDestroyed) {
      this.widthNum.destroy();
      y(this.widthNum.element);
      this.widthNum = null;
    }
    if (this.heightNum && !this.heightNum.isDestroyed) {
      this.heightNum.destroy();
      y(this.heightNum.element);
      this.heightNum = null;
    }
    if (this.browseButton && !this.browseButton.isDestroyed) {
      this.browseButton.destroy();
      y(this.browseButton.element);
      this.browseButton = null;
    }
    if (this.dialogObj && !this.dialogObj.isDestroyed) {
      if (
        this.dialogObj.element &&
        this.dialogObj.element.querySelector('.e-img-link') &&
        this.dialogObj.element.querySelector('.e-img-link') !== null
      ) {
        D.remove(this.dialogObj.element.querySelector('.e-img-link'), 'input', this.handleKeyDown);
      }
      this.dialogObj.destroy();
      y(this.dialogObj.element);
      this.dialogObj = null;
    }
  };
  s.prototype.imagDialog = function (e) {
    var t = this;
    if (this.dialogObj) {
      this.dialogObj.hide({ returnValue: true });
      return;
    }
    var i = this.parent.createElement('div', {
      className: 'e-rte-img-dialog' + this.parent.getCssClass(true),
      id: this.rteID + '_image',
    });
    this.parent.rootContainer.appendChild(i);
    var n = this.i10n.getConstant('dialogInsert');
    var r = this.i10n.getConstant('dialogCancel');
    var o = this.i10n.getConstant('imageHeader');
    var a = e.selection;
    var l = {
      selfImage: this,
      selection: e.selection,
      args: e.args,
      selectParent: e.selectParent,
    };
    var h = {
      header: o,
      cssClass: Be + this.parent.getCssClass(true),
      enableRtl: this.parent.enableRtl,
      locale: this.parent.locale,
      showCloseIcon: true,
      closeOnEscape: true,
      width: M.isDevice ? '290px' : '340px',
      isModal: M.isDevice,
      position: {
        X: 'center',
        Y: M.isDevice ? 'center' : 'top',
      },
      buttons: [
        {
          click: this.insertImageUrl.bind(l),
          buttonModel: {
            content: n,
            cssClass: 'e-flat e-insertImage' + this.parent.getCssClass(true),
            isPrimary: true,
            disabled: this.parent.editorMode !== 'Markdown',
          },
        },
        {
          click: this.cancelDialog.bind(this),
          buttonModel: {
            cssClass: 'e-flat e-cancel' + this.parent.getCssClass(true),
            content: r,
          },
        },
      ],
      target: M.isDevice ? document.body : this.parent.element,
      animationSettings: { effect: 'None' },
      close: function (f) {
        if (f && f.closedBy !== 'user action' && t.uploadObj && t.uploadObj.filesData.length > 0) {
          t.uploadObj.remove();
        }
        t.parent.isBlur = false;
        if (f && !p(f.event) && f.event.returnValue) {
          t.parent.editorMode === 'HTML'
            ? e.selection.restore()
            : t.parent.formatter.editorManager.markdownSelection.restore(t.parent.contentModule.getEditPanel());
        }
        t.clearDialogObj();
        t.dialogRenderObj.close(f);
      },
    };
    var c = this.parent.createElement('div', { className: 'e-img-content' + this.parent.getCssClass(true) });
    if (
      (!p(this.parent.insertImageSettings.path) && this.parent.editorMode === 'Markdown') ||
      this.parent.editorMode === 'HTML'
    ) {
      c.appendChild(this.imgUpload(e));
    }
    var d = this.parent.createElement('div', { className: 'e-linkheader' + this.parent.getCssClass(true) });
    var u = this.i10n.getConstant('imageLinkHeader');
    this.parent.editorMode === 'HTML' ? (d.innerHTML = u) : (d.innerHTML = this.i10n.getConstant('mdimageLink'));
    c.appendChild(d);
    c.appendChild(this.imageUrlPopup(e));
    e.selectNode && e.selectNode[0].nodeName === 'IMG'
      ? ((h.header = this.parent.localeObj.getConstant('editImageHeader')),
        (h.content = c),
        (h.buttons[0].buttonModel.cssClass = h.buttons[0].buttonModel.cssClass + ' e-updateImage'))
      : (h.content = c);
    this.dialogObj = this.dialogRenderObj.render(h);
    this.dialogObj.createElement = this.parent.createElement;
    this.dialogObj.appendTo(i);
    if (!p(this.dialogObj)) {
      if (e.selectNode && e.selectNode[0].nodeName === 'IMG' && e.name === 'insertImage') {
        this.dialogObj.element.querySelector('.e-insertImage').textContent =
          this.parent.localeObj.getConstant('dialogUpdate');
      }
      i.style.maxHeight = 'inherit';
      if (this.quickToolObj) {
        if (this.quickToolObj.imageQTBar && document.body.contains(this.quickToolObj.imageQTBar.element)) {
          this.quickToolObj.imageQTBar.hidePopup();
          if (!p(e.selectParent)) {
            x([e.selectParent[0]], 'e-img-focus');
          }
        }
        if (this.quickToolObj.inlineQTBar && document.body.contains(this.quickToolObj.inlineQTBar.element)) {
          this.quickToolObj.inlineQTBar.hidePopup();
        }
        if (
          this.quickToolObj.textQTBar &&
          this.parent.element.ownerDocument.body.contains(this.quickToolObj.textQTBar.element)
        ) {
          this.quickToolObj.textQTBar.hidePopup();
        }
      }
    }
  };
  s.prototype.cancelDialog = function () {
    this.parent.isBlur = false;
    if (!p(this.uploadObj) && this.uploadObj.filesData.length > 0) {
      this.uploadObj.remove();
    }
    this.dialogObj.hide({ returnValue: true });
  };
  s.prototype.onDocumentClick = function (e) {
    var t = e.target;
    if (!p(this.contentModule.getEditPanel()) && (e.target.nodeName === 'IMG' && (this.imgEle = e.target), false)) {
      if (e.target.nodeName !== '#document') {
        this.parent.currentTarget = e.target;
      }
      if (
        !p(this.dialogObj) &&
        ((!v(e.target, "[id='" + this.dialogObj.element.id + "']") &&
          this.parent.toolbarSettings.enable &&
          this.parent.getToolbarElement() &&
          !this.parent.getToolbarElement().contains(e.target)) ||
          (this.parent.getToolbarElement() &&
            this.parent.getToolbarElement().contains(e.target) &&
            !v(e.target, '#' + this.parent.getID() + '_toolbar_Image') &&
            !e.target.querySelector('#' + this.parent.getID() + '_toolbar_Image')))
      ) {
        if (!(e.offsetX > e.target.clientWidth || e.offsetY > e.target.clientHeight)) {
          this.parent.notify(Hr, { closedBy: 'outside click' });
          this.dialogObj.hide({ returnValue: true });
          this.parent.isBlur = true;
          qr(this.parent.element, 'focusout');
        }
      }
      if (
        !(
          this.parent.iframeSettings.enable &&
          !p(this.parent.currentTarget) &&
          this.parent.currentTarget.nodeName === 'IMG'
        ) &&
        e.target.tagName !== 'IMG' &&
        this.imgResizeDiv &&
        !(
          this.quickToolObj &&
          this.quickToolObj.imageQTBar &&
          this.quickToolObj.imageQTBar.element.contains(e.target)
        ) &&
        this.contentModule.getEditPanel().contains(this.imgResizeDiv)
      ) {
        this.cancelResizeAction();
      }
      if (
        this.contentModule.getEditPanel().querySelector('.e-img-resize') &&
        !(this.parent.iframeSettings.enable && this.parent.currentTarget.nodeName === 'IMG')
      ) {
        if (e.target.tagName !== 'IMG') {
          this.removeResizeEle();
        }
        e.target.tagName !== 'IMG' && !p(this.imgEle)
          ? (this.imgEle.style.outline = '')
          : !p(this.prevSelectedImgEle) &&
            this.prevSelectedImgEle !== e.target &&
            (this.prevSelectedImgEle.style.outline = '');
      }
      if (e.target.tagName !== 'IMG')
        for (var i = this.contentModule.getEditPanel().querySelectorAll('img'), n = 0; n < i.length; n++) {
          x([i[n]], 'e-img-focus');
          x([i[n]], 'e-resize');
        }
      if (
        this.parent.inlineMode.enable &&
        e.target &&
        this.dialogObj &&
        !v(e.target, '#' + this.dialogObj.element.id)
      ) {
        this.dialogObj.hide();
      }
    }
  };
  s.prototype.removeResizeEle = function () {
    D.remove(this.contentModule.getDocument(), M.touchMoveEvent, this.resizing);
    D.remove(this.contentModule.getDocument(), M.touchEndEvent, this.resizeEnd);
    y(this.contentModule.getEditPanel().querySelector('.e-img-resize'));
  };
  s.prototype.onWindowResize = function () {
    if (!p(this.contentModule) && !p(this.contentModule.getEditPanel().querySelector('.e-img-resize'))) {
      this.cancelResizeAction();
    }
  };
  s.prototype.imageUrlPopup = function (e) {
    var t = this;
    var i = this.parent.createElement('div', { className: 'imgUrl' + this.parent.getCssClass(true) });
    var n = this.i10n.getConstant('imageUrl');
    this.inputUrl = this.parent.createElement('input', {
      className: 'e-input e-img-url' + this.parent.getCssClass(true),
      attrs: {
        placeholder: n,
        spellcheck: 'false',
        'aria-label': this.i10n.getConstant('imageLinkHeader'),
      },
    });
    this.inputUrl.addEventListener('input', function () {
      if (!p(t.inputUrl)) {
        t.inputUrl.value.length === 0
          ? (t.dialogObj.getButtons(0).element.disabled = true)
          : t.dialogObj.getButtons(0).element.removeAttribute('disabled');
      }
    });
    if (e.selectNode && e.selectNode[0].nodeName === 'IMG') {
      var r = new RegExp(/([^\S]|^)(((https?:\/\/)|(www\.))(\S+))/gi);
      this.inputUrl.value = e.selectNode[0].src.match(r) ? e.selectNode[0].src : '';
    }
    i.appendChild(this.inputUrl);
    return i;
  };
  s.prototype.insertImageUrl = function (e) {
    var t = this.selfImage;
    t.isImgUploaded = false;
    var i = t.inputUrl.value;
    if (e.target && e.target.nodeName === 'BUTTON' && e.target.classList.contains('e-updateImage')) {
      var n =
        this.selectNode && this.selectNode[0] && this.selectNode[0].nodeName === 'IMG' ? this.selectNode[0] : null;
      var r = {
        element: n,
        src: i,
      };
      t.parent.trigger(hi, r);
    }
    if (t.parent.editorMode === 'Markdown' && i === '') {
      i = 'http://';
    }
    if (t.parent.formatter.getUndoRedoStack().length === 0) {
      t.parent.formatter.saveData();
    }
    var o = this.args.item.subCommand;
    this.args.item.subCommand = e.target.innerHTML === 'Update' ? 'Replace' : this.args.item.subCommand;
    if (!p(t.uploadUrl) && t.uploadUrl.url !== '') {
      t.uploadUrl.cssClass =
        this.selectParent &&
        this.selectParent[0].classList &&
        this.selectParent[0].classList.contains('e-imgbreak') === true
          ? Re
          : t.parent.insertImageSettings.display === 'inline'
            ? ot
            : Re;
      t.dialogObj.hide({ returnValue: false });
      if (t.dialogObj !== null) return;
      t.parent.formatter.process(t.parent, this.args, this.args.originalEvent, t.uploadUrl);
      t.uploadUrl.url = '';
      if (t.contentModule.getEditPanel().querySelector('.e-img-resize')) {
        t.imgEle.style.outline = '';
        t.removeResizeEle();
      }
    } else if (i !== '') {
      if (
        t.parent.editorMode === 'HTML' &&
        p(v(this.selection.range.startContainer.parentNode, "[id='" + t.contentModule.getPanel().id + "']"))
      ) {
        t.contentModule.getPanel().tagName === 'IFRAME' && this.args.item.subCommand === 'Replace'
          ? t.contentModule.getPanel()
          : t.contentModule.getEditPanel();
        var a = t.parent.formatter.editorManager.nodeSelection.getRange(t.contentModule.getDocument());
        this.selection = t.parent.formatter.editorManager.nodeSelection.save(a, t.contentModule.getDocument());
        this.selectParent = t.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(a);
      }
      var l = /[\w-]+.(jpg|png|jpeg|gif)/g;
      var h = !p(i.match(l)) && t.parent.editorMode === 'HTML' ? i.match(l)[0] : '';
      var c = {
        cssClass:
          this.selectParent &&
          this.selectParent[0].classList &&
          this.selectParent[0].classList.contains('e-imgbreak') === true
            ? Re
            : t.parent.insertImageSettings.display === 'inline'
              ? ot
              : Re,
        url: i,
        selection: this.selection,
        altText: h,
        selectParent: this.selectParent,
        width: {
          width: t.parent.insertImageSettings.width,
          minWidth: t.parent.insertImageSettings.minWidth,
          maxWidth: t.parent.getInsertImgMaxWidth(),
        },
        height: {
          height: t.parent.insertImageSettings.height,
          minHeight: t.parent.insertImageSettings.minHeight,
          maxHeight: t.parent.insertImageSettings.maxHeight,
        },
      };
      t.dialogObj.hide({ returnValue: false });
      if (t.dialogObj !== null) return;
      t.parent.formatter.process(t.parent, this.args, this.args.originalEvent, c);
    }
    this.args.item.subCommand = this.args.item.subCommand;
  };
  s.prototype.imgsizeInput = function (e) {
    var t = this;
    var i = e.selectNode[0];
    var n = this.i10n.getConstant('imageHeight');
    var r = this.i10n.getConstant('imageWidth');
    var o = this.parent.createElement('div', { className: 'e-img-sizewrap' + this.parent.getCssClass(true) });
    var a =
      p(this.changedWidthValue) &&
      (e.selectNode[0].style.width.toString() === 'auto' || e.selectNode[0].style.width !== '')
        ? e.selectNode[0].style.width
        : p(this.changedWidthValue)
          ? parseInt(e.selectNode[0].getClientRects()[0].width.toString(), 10).toString()
          : this.changedWidthValue;
    var l =
      p(this.changedHeightValue) &&
      (e.selectNode[0].style.height.toString() === 'auto' || e.selectNode[0].style.height !== '')
        ? e.selectNode[0].style.height
        : p(this.changedHeightValue)
          ? parseInt(e.selectNode[0].getClientRects()[0].height.toString(), 10).toString()
          : this.changedHeightValue;
    if (e.selectNode[0].style.width === '' && a === '') {
      a = 'auto';
    }
    if (e.selectNode[0].style.height === '' && l === '') {
      l = 'auto';
    }
    this.changedWidthValue = null;
    this.changedHeightValue = null;
    var h =
      '<div class="e-rte-label' +
      this.parent.getCssClass(true) +
      '"><label>' +
      r +
      '</label></div><div class="e-rte-field' +
      this.parent.getCssClass(true) +
      '"><input type="text" id="imgwidth" class="e-img-width' +
      this.parent.getCssClass(true) +
      '"/></div><div class="e-rte-label' +
      this.parent.getCssClass(true) +
      '"><label>' +
      n +
      '</label></div><div class="e-rte-field' +
      this.parent.getCssClass(true) +
      '"> <input type="text" id="imgheight" class="e-img-height' +
      this.parent.getCssClass(true) +
      '"/></div>';
    var c = Et(h);
    c.getElementById('imgwidth').setAttribute('value', a);
    c.getElementById('imgheight').setAttribute('value', l);
    o.appendChild(c);
    this.widthNum = new Hn({
      value: dt(a),
      enableRtl: this.parent.enableRtl,
      cssClass: this.parent.getCssClass(),
      input: function (d) {
        t.inputWidthValue = dt(t.inputValue(d.value));
      },
    });
    this.widthNum.createElement = this.parent.createElement;
    this.widthNum.appendTo(o.querySelector('#imgwidth'));
    this.heightNum = new Hn({
      value: dt(l),
      enableRtl: this.parent.enableRtl,
      cssClass: this.parent.getCssClass(),
      input: function (d) {
        t.inputHeightValue = dt(t.inputValue(d.value));
      },
    });
    this.heightNum.createElement = this.parent.createElement;
    this.heightNum.appendTo(o.querySelector('#imgheight'));
    return o;
  };
  s.prototype.inputValue = function (e) {
    return e === 'auto' || e.indexOf('%') !== -1 || e.indexOf('px') !== -1 || e.match(/(\d+)/) ? e : 'auto';
  };
  s.prototype.insertSize = function (e) {
    e.selection.restore();
    var t = e.selfImage;
    if (e.selfImage.parent.formatter.getUndoRedoStack().length === 0) {
      e.selfImage.parent.formatter.saveData();
    }
    var i = e.selfImage.dialogObj.element;
    this.changedWidthValue = this.inputWidthValue;
    this.changedHeightValue = this.inputHeightValue;
    var n = e.selfImage.dialogObj.element.querySelector('.e-img-width').value;
    var r = e.selfImage.dialogObj.element.parentElement.querySelector('.e-img-height').value;
    e.selfImage.parent.formatter.process(this.parent, e.args, e.args, {
      width: e.selfImage.dialogObj.element.querySelector('.e-img-width').value,
      height: e.selfImage.dialogObj.element.parentElement.querySelector('.e-img-height').value,
      selectNode: e.selectNode,
      subCommand: e.args.item.subCommand,
    });
    if (this.imgResizeDiv) {
      e.selfImage.imgResizePos(e.selectNode[0], this.imgResizeDiv);
    }
    e.selfImage.dialogObj.hide({ returnValue: true });
    e.selfImage.parent.inputElement.focus({ preventScroll: true });
  };
  s.prototype.insertImage = function (e) {
    this.imagDialog(e);
    if (!p(this.dialogObj)) {
      this.dialogObj.element.style.maxHeight = 'inherit';
      var t = this.dialogObj.element.querySelector('.e-img-content');
      (!p(this.parent.insertImageSettings.path) && this.parent.editorMode === 'Markdown') ||
      this.parent.editorMode === 'HTML'
        ? document.getElementById(this.rteID + '_insertImage').focus()
        : t.querySelector('.e-img-url').focus();
    }
  };
  s.prototype.imgUpload = function (e) {
    var t = this;
    var i;
    var n;
    var r = this;
    var o = r.parent.iframeSettings.enable;
    if (
      r.parent.editorMode === 'HTML' &&
      ((!r.parent.iframeSettings.enable &&
        p(v(e.selection.range.startContainer.parentNode, "[id='" + this.parent.contentModule.getPanel().id + "']"))) ||
        (r.parent.iframeSettings.enable &&
          !de(e.selection.range.startContainer.parentNode.ownerDocument.querySelector('body'), 'e-lib')))
    ) {
      this.contentModule.getEditPanel().focus();
      var a = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());
      i = this.parent.formatter.editorManager.nodeSelection.save(a, this.parent.contentModule.getDocument());
      n = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(a);
    } else {
      i = e.selection;
      n = e.selectParent;
    }
    var l = this.parent.createElement('div', {
      className: 'e-img-uploadwrap e-droparea' + this.parent.getCssClass(true),
    });
    var h = this.i10n.getConstant('imageDeviceUploadMessage');
    var c = this.i10n.getConstant('imageUploadMessage');
    var d = this.parent.createElement('span', { className: 'e-droptext' + this.parent.getCssClass(true) });
    var u = this.parent.createElement('span', {
      className: 'e-rte-upload-text' + this.parent.getCssClass(true),
      innerHTML: M.isDevice ? h : c,
    });
    d.appendChild(u);
    var f = this.parent.createElement('button', {
      className: 'e-browsebtn' + this.parent.getCssClass(true),
      id: this.rteID + '_insertImage',
      attrs: {
        autofocus: 'true',
        type: 'button',
      },
    });
    d.appendChild(f);
    l.appendChild(d);
    var m = this.i10n.getConstant('browse');
    this.browseButton = new Fr({
      content: m,
      enableRtl: this.parent.enableRtl,
    });
    this.browseButton.isStringTemplate = true;
    this.browseButton.createElement = this.parent.createElement;
    this.browseButton.appendTo(f);
    var g = M.isDevice ? d : f;
    D.add(g, 'click', this.fileSelect, this);
    var b = this.parent.createElement('input', {
      id: this.rteID + '_upload',
      attrs: {
        type: 'File',
        name: 'UploadFiles',
      },
      className: this.parent.getCssClass(),
    });
    l.appendChild(b);
    var C;
    var N;
    var w = null;
    this.uploadObj = new ko({
      asyncSettings: {
        saveUrl: this.parent.insertImageSettings.saveUrl,
        removeUrl: this.parent.insertImageSettings.removeUrl,
      },
      dropArea: d,
      multiple: false,
      enableRtl: this.parent.enableRtl,
      cssClass: this.parent.getCssClass(),
      allowedExtensions: this.parent.insertImageSettings.allowedTypes.toString(),
      maxFileSize: this.parent.insertImageSettings.maxFileSize,
      selected: function (T) {
        r.isImgUploaded = true;
        N = T;
        T.filesData;
        t.parent.trigger(Ao, N, function (S) {
          if (!S.cancel) {
            if (p(S.filesData[0])) return;
            t.checkExtension(S.filesData[0]);
            C = S.filesData[0].name.replace(/\.[a-zA-Z0-9]+$/, '');
            if (t.parent.editorMode === 'HTML' && p(t.parent.insertImageSettings.path)) {
              var O = new FileReader();
              O.addEventListener('load', function (L) {
                var A =
                  t.parent.insertImageSettings.saveFormat === 'Base64' ? O.result : URL.createObjectURL(pi(O.result));
                r.uploadUrl = {
                  url: A,
                  selection: i,
                  altText: C,
                  selectParent: n,
                  width: {
                    width: r.parent.insertImageSettings.width,
                    minWidth: r.parent.insertImageSettings.minWidth,
                    maxWidth: r.parent.getInsertImgMaxWidth(),
                  },
                  height: {
                    height: r.parent.insertImageSettings.height,
                    minHeight: r.parent.insertImageSettings.minHeight,
                    maxHeight: r.parent.insertImageSettings.maxHeight,
                  },
                };
                r.inputUrl.setAttribute('disabled', 'true');
                if (!p(t.dialogObj)) {
                  var k = t.dialogObj.getButtons(0);
                  if (!p(k)) {
                    p(r.parent.insertImageSettings.saveUrl) &&
                    t.isAllowedTypes &&
                    S.filesData[0].size <= t.uploadObj.maxFileSize
                      ? k.element.removeAttribute('disabled')
                      : k.element.setAttribute('disabled', 'true');
                  }
                }
              });
              O.readAsDataURL(S.filesData[0].rawFile);
            }
          }
        });
      },
      beforeUpload: function (T) {
        t.parent.trigger(Ro, T);
      },
      uploading: function (T) {
        if (!t.parent.isServerRendered) {
          t.parent.trigger(Bo, T);
        }
      },
      success: function (T) {
        T.detectImageSource = Oo.Uploaded;
        t.parent.trigger(Mo, T, function (S) {
          var O = false;
          if (!p(w) && w.name !== S.file.name && S.operation.toLocaleLowerCase() === 'remove') {
            O = true;
          }
          if (!p(t.parent.insertImageSettings.path) && !O) {
            var L = t.parent.insertImageSettings.path + S.file.name;
            if (!p(w) && S.operation === 'upload') {
              t.uploadObj.remove(w);
            }
            r.uploadUrl = {
              url: L,
              selection: i,
              altText: C,
              selectParent: n,
              width: {
                width: r.parent.insertImageSettings.width,
                minWidth: r.parent.insertImageSettings.minWidth,
                maxWidth: r.parent.getInsertImgMaxWidth(),
              },
              height: {
                height: r.parent.insertImageSettings.height,
                minHeight: r.parent.insertImageSettings.minHeight,
                maxHeight: r.parent.insertImageSettings.maxHeight,
              },
            };
            if (S && S.operation && S.operation.toLocaleUpperCase() !== 'REMOVE') {
              r.inputUrl.setAttribute('disabled', 'true');
            }
            w = S.file;
          }
          if (S.operation === 'upload' && !p(t.dialogObj)) {
            t.dialogObj.getButtons(0).element.removeAttribute('disabled');
          }
        });
      },
      failure: function (T) {
        t.parent.trigger(Do, T);
      },
      removing: function (T) {
        t.parent.trigger(wo, T, function (S) {
          r.isImgUploaded = false;
          t.dialogObj.getButtons(0).element.disabled = true;
          r.inputUrl.removeAttribute('disabled');
          if (r.uploadUrl) {
            r.uploadUrl.url = '';
          }
        });
      },
    });
    this.uploadObj.isStringTemplate = true;
    this.uploadObj.createElement = this.parent.createElement;
    this.uploadObj.appendTo(b);
    return l;
  };
  s.prototype.checkExtension = function (e) {
    if (this.uploadObj.allowedExtensions && e.type) {
      this.uploadObj.allowedExtensions.toLocaleLowerCase().indexOf(('.' + e.type).toLocaleLowerCase()) === -1
        ? (this.dialogObj.getButtons(0).element.setAttribute('disabled', 'disabled'), (this.isAllowedTypes = false))
        : (this.isAllowedTypes = true);
    }
  };
  s.prototype.fileSelect = function () {
    this.dialogObj.element.getElementsByClassName('e-file-select-wrap')[0].querySelector('button').click();
    return false;
  };
  s.prototype.dragStart = function (e) {
    if (e.target.nodeName === 'IMG') {
      e.dataTransfer.effectAllowed = 'copyMove';
      e.target.classList.add(Rt);
    } else return true;
  };
  s.prototype.dragEnter = function (e) {
    e.dataTransfer.dropEffect = 'copy';
    e.preventDefault();
  };
  s.prototype.dragOver = function (e) {
    if (
      (M.info.name === 'edge' && e.dataTransfer.items[0].type.split('/')[0].indexOf('image') > -1) ||
      (M.isIE && e.dataTransfer.types[0] === 'Files')
    )
      e.preventDefault();
    else return true;
  };
  s.prototype.dragDrop = function (e) {
    var t = this;
    this.parent.trigger(xo, e, function (i) {
      var n = t.parent.inputElement.ownerDocument.querySelector('.' + Rt);
      var r = (n && n.tagName === 'IMG') || i.dataTransfer.files.length > 0;
      if (!i.cancel && r) {
        if (v(i.target, '#' + t.parent.getID() + '_toolbar') || t.parent.inputElement.contentEditable === 'false') {
          i.preventDefault();
          return;
        }
        if (t.parent.element.querySelector('.' + Io)) {
          y(t.imgResizeDiv);
        }
        i.preventDefault();
        var o = void 0;
        t.contentModule.getDocument().caretRangeFromPoint
          ? (o = t.contentModule.getDocument().caretRangeFromPoint(i.clientX, i.clientY))
          : i.rangeParent
            ? ((o = t.contentModule.getDocument().createRange()), o.setStart(i.rangeParent, i.rangeOffset))
            : (o = t.getDropRange(i.clientX, i.clientY));
        t.parent.notify(en, { range: o });
        var a = t.parent.element.querySelector('.' + Po);
        if (a) return;
        t.insertDragImage(i);
      } else if (r) {
        i.preventDefault();
      }
    });
  };
  s.prototype.getDropRange = function (e, t) {
    var i = this.contentModule.getDocument().createRange();
    this.parent.formatter.editorManager.nodeSelection.setRange(this.contentModule.getDocument(), i);
    var n = this.contentModule.getDocument().elementFromPoint(e, t);
    var r = n.childNodes.length > 0 ? n.childNodes[0] : n;
    var o = 0;
    if (this.parent.inputElement.firstChild.innerHTML === '<br>') {
      i.setStart(r, o);
      i.setEnd(r, o);
    } else {
      var a = void 0;
      do {
        o++;
        i.setStart(r, o);
        i.setEnd(r, o + 1);
        a = i.getBoundingClientRect();
      } while (a.left < e && o < r.length - 1);
    }
    return i;
  };
  s.prototype.insertDragImage = function (e) {
    var t = this;
    e.preventDefault();
    var i = this.parent.element.querySelector('' + jr);
    this.parent.notify(tn, { args: e });
    if (i) {
      i.classList.add(Ht);
    }
    var n = this.parent.inputElement.ownerDocument.querySelector('.' + Rt);
    var r = {
      requestType: 'Images',
      name: 'ImageDragAndDrop',
      cancel: false,
      originalEvent: e,
    };
    if (e.dataTransfer.files.length > 0 && n === null) {
      if (e.dataTransfer.files.length > 1) return;
      for (
        var o = e.dataTransfer.files,
          a = o[0].name,
          l = a.substring(a.lastIndexOf('.')),
          h = this.parent.insertImageSettings.allowedTypes,
          c = 0;
        c < h.length;
        c++
      )
        if (l.toLocaleLowerCase() === h[c].toLowerCase()) {
          this.parent.insertImageSettings.saveUrl
            ? this.onSelect(e)
            : this.parent.trigger(ze, r, function (d) {
                if (d.cancel) d.originalEvent.preventDefault();
                else {
                  var u = {
                    args: e,
                    text: '',
                    file: o[0],
                  };
                  e.preventDefault();
                  t.imagePaste(u);
                }
              });
        }
    } else
      this.parent.trigger(ze, r, function (d) {
        if (d.cancel) d.originalEvent.preventDefault();
        else {
          var u = t.parent.formatter.editorManager.nodeSelection.getRange(t.parent.contentModule.getDocument());
          if (n && n.tagName === 'IMG') {
            var f = n.closest('.e-rte-img-caption');
            if (!p(f)) u.insertNode(f);
            else {
              var m = n.closest('a');
              var g = m && m.tagName === 'A' && t.hasOnlyImage(m);
              g ? u.insertNode(m) : n.parentNode && (n.parentNode.removeChild(n), u.insertNode(n));
            }
            n.classList.remove(Rt);
            var b = { elements: [n] };
            n.addEventListener('load', function () {
              t.parent.trigger(Ge, b);
            });
            t.parent.formatter.editorManager.nodeSelection.Clear(t.contentModule.getDocument());
            var C = e;
            if (t.parent.insertImageSettings.resize) {
              t.resizeStart(e, n);
            }
            t.hideImageQuickToolbar();
          }
        }
      });
  };
  s.prototype.hasOnlyImage = function (e) {
    for (var t = false, i = 0; i < e.childNodes.length; i++) {
      var n = e.childNodes[i];
      if (e.childNodes[i].nodeType === Node.TEXT_NODE) {
        var r = e.childNodes[i].textContent.replace(/[\u200B\u200C\u200D]/g, '').trim();
        if (r !== '') return false;
      } else if (e.childNodes[i].nodeType === Node.ELEMENT_NODE)
        if (e.childNodes[i].tagName === 'IMG') {
          if (t) return false;
          t = true;
        } else return false;
    }
    return t;
  };
  s.prototype.onSelect = function (e) {
    var t = this;
    var i = this;
    var n = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());
    var r = this.parent.createElement('ul', { className: Ho });
    this.parent.rootContainer.appendChild(r);
    var o = {
      name: e.dataTransfer.files[0].name,
      size: e.dataTransfer.files[0].size,
      type: e.dataTransfer.files[0].type,
      rawFile: e.dataTransfer.files[0],
    };
    var a;
    var l = this.parent.createElement('IMG');
    l.style.opacity = '0.5';
    l.classList.add(qn);
    l.classList.add(ot);
    l.classList.add(Fn);
    var h = o.rawFile;
    var c = new FileReader();
    c.addEventListener('load', function () {
      var m = URL.createObjectURL(pi(c.result));
      if (p(i.parent.insertImageSettings.path) && !a) {
        l.src = i.parent.insertImageSettings.saveFormat === 'Blob' ? m : c.result;
      }
    });
    if (o.rawFile) {
      c.readAsDataURL(o.rawFile);
    }
    var d = this.parent.formatter.editorManager.nodeSelection.save(n, this.parent.contentModule.getDocument());
    var u = {
      cssClass: this.parent.insertImageSettings.display === 'inline' ? ot : Re,
      url: p(i.parent.insertImageSettings.path) ? '' : this.parent.insertImageSettings.path + o.rawFile.name,
      selection: d,
      altText: o.rawFile.name.replace(/\.[a-zA-Z0-9]+$/, ''),
      width: {
        width: this.parent.insertImageSettings.width,
        minWidth: this.parent.insertImageSettings.minWidth,
        maxWidth: this.parent.getInsertImgMaxWidth(),
      },
      height: {
        height: this.parent.insertImageSettings.height,
        minHeight: this.parent.insertImageSettings.minHeight,
        maxHeight: this.parent.insertImageSettings.maxHeight,
      },
    };
    var f = {
      requestType: 'Image',
      name: 'ImageDragAndDrop',
      cancel: false,
      originalEvent: e,
      itemCollection: u,
    };
    this.parent.trigger(ze, f, function (m) {
      if (m.cancel) m.originalEvent.preventDefault();
      else {
        var g = m.itemCollection;
        a = m.itemCollection.url !== '';
        l.className = m.itemCollection.cssClass;
        l.alt = m.itemCollection.altText;
        l.src = m.itemCollection.url;
        l.classList.add(qn);
        l.classList.add(Fn);
        n.insertNode(l);
        t.uploadMethod(e, l);
        l.addEventListener('load', function (b) {
          var C = {
            requestType: 'Image',
            name: 'InsertDropImage',
            elements: [l],
            event: b,
            editorMode: 'HTML',
          };
          t.parent.trigger(Ge, C);
        });
        y(r);
      }
    });
  };
  s.prototype.uploadMethod = function (e, t) {
    var i = this;
    this.popupObj = this.popupUploaderObj.renderPopup('Images', t);
    var n = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());
    var r = e.dataTransfer.files[0].size > 1000000 ? 300 : 100;
    this.imageDragPopupTime = setTimeout(function () {
      i.popupUploaderObj.refreshPopup(t);
    }, r);
    this.uploadObj = this.popupUploaderObj.createUploader('Images', e, t, this.popupObj.element.childNodes[0]);
    this.popupObj.element.querySelector('.e-rte-dialog-upload .e-file-select-wrap').style.display = 'none';
    n.selectNodeContents(t);
    this.parent.formatter.editorManager.nodeSelection.setRange(this.contentModule.getDocument(), n);
  };
  s.prototype.imagePaste = function (e) {
    var t = this;
    if (e.text.length === 0 && !p(e.file)) {
      var i = this;
      var n = new FileReader();
      e.args.preventDefault();
      n.addEventListener('load', function (r) {
        var o = {
          cssClass: i.parent.insertImageSettings.display === 'inline' ? ot : Re,
          url:
            t.parent.insertImageSettings.saveFormat === 'Base64' || !p(e.callBack)
              ? n.result
              : URL.createObjectURL(pi(n.result)),
          width: {
            width: i.parent.insertImageSettings.width,
            minWidth: i.parent.insertImageSettings.minWidth,
            maxWidth: i.parent.getInsertImgMaxWidth(),
          },
          height: {
            height: i.parent.insertImageSettings.height,
            minHeight: i.parent.insertImageSettings.minHeight,
            maxHeight: i.parent.insertImageSettings.maxHeight,
          },
        };
        if (p(e.callBack)) {
          i.parent.formatter.process(
            i.parent,
            {
              item: {
                command: 'Images',
                subCommand: 'Image',
              },
            },
            e.args,
            o,
          );
          t.showPopupToolBar(e, o);
        } else {
          e.callBack(o);
          return;
        }
      });
      n.readAsDataURL(e.file);
    }
  };
  s.prototype.showPopupToolBar = function (e, t) {
    var i = this;
    var n = 'img[src="' + t.url + '"]';
    var r = this.parent.inputElement.querySelector(n);
    this.parent.quickToolbarModule.createQTBar(
      'Image',
      'MultiRow',
      this.parent.quickToolbarSettings.image,
      te.ImageToolbar,
    );
    var o = {
      args: e.args,
      type: 'Images',
      isNotify: void 0,
      elements: r,
    };
    if (r) {
      this.showImageQTbarTime = setTimeout(function () {
        i.showImageQuickToolbar(o);
        if (i.parent.insertImageSettings.resize) {
          i.resizeStart(e.args, r);
        }
      }, 0);
    }
  };
  s.prototype.destroy = function () {
    if (!this.isDestroyed) {
      this.prevSelectedImgEle = void 0;
      if (!p(this.imageQTPopupTime)) {
        clearTimeout(this.imageQTPopupTime);
        this.imageQTPopupTime = null;
      }
      if (!p(this.imageDragPopupTime)) {
        clearTimeout(this.imageDragPopupTime);
        this.imageDragPopupTime = null;
      }
      if (!p(this.uploadCancelTime)) {
        clearTimeout(this.uploadCancelTime);
        this.uploadCancelTime = null;
      }
      if (!p(this.uploadFailureTime)) {
        clearTimeout(this.uploadFailureTime);
        this.uploadFailureTime = null;
      }
      if (!p(this.showImageQTbarTime)) {
        clearTimeout(this.showImageQTbarTime);
        this.showImageQTbarTime = null;
      }
      if (!p(this.uploadSuccessTime)) {
        clearTimeout(this.uploadSuccessTime);
        this.uploadSuccessTime = null;
      }
      this.removeEventListener();
      this.clearDialogObj();
      this.cancelResizeAction();
      this.isDestroyed = true;
    }
  };
  s.prototype.getModuleName = function () {
    return 'image';
  };
  return s;
})();
var ms = (function () {
  function s() {
    this.allCells = [];
    this.hasCellsUpdated = false;
    this.preventOverflowCells = false;
  }
  s.prototype.handleTablePaste = function (e, t) {
    if (!(!e || !t || t.length < 1)) {
      this.hasCellsUpdated = false;
      var i = t[0];
      this.preventOverflowCells = t.length > 1;
      var n = this.getClosestTable(t[0]);
      if (n) {
        var r = this.getTableRows(e);
        var o = this.getRowIndex(t[0]);
        this.allCells = ie(n);
        var a = this.getCellIndex(t[0], o);
        var l = ie(e);
        this.pasteMultipleRows(n, r, o, a, l);
        if (this.hasCellsUpdated) {
          pt(n, true);
        }
      }
    }
  };
  s.prototype.getClosestTable = function (e) {
    return v(e, 'table');
  };
  s.prototype.getTableRows = function (e) {
    for (var t = [], i = e.rows.length, n = 0; n < i; n++) {
      var r = e.rows.item(n);
      if (r !== null) {
        t.push(r);
      }
    }
    return t;
  };
  s.prototype.getRowIndex = function (e) {
    var t = e.parentElement;
    return e.parentElement !== null ? e.parentElement.rowIndex : 0;
  };
  s.prototype.getCellIndex = function (e, t) {
    if (t === void 0) {
      t = 0;
    }
    for (var i = t; i < this.allCells.length; i++)
      for (var n = this.allCells[i], r = 0; r < n.length; r++) if (this.allCells[i][r] === e) return r;
    return e.cellIndex >= 0 ? e.cellIndex : 0;
  };
  s.prototype.pasteMultipleRows = function (e, t, i, n, r) {
    for (var o = 0; o < t.length; o++) {
      var a = t[o];
      this.pasteRowContent(e, t[o], n, i, r);
    }
  };
  s.prototype.ensureCellCount = function (e, t, i) {
    if (i < t)
      for (this.hasCellsUpdated = true; i < t; ) {
        var n = e.insertCell();
        n.innerHTML = '<br>';
        i++;
      }
  };
  s.prototype.getOrCreateRow = function (e, t) {
    if (t < e.rows.length) return e.rows.item(t);
    if (!this.preventOverflowCells) {
      var i = e.insertRow();
      this.fillRowWithEmptyCells(i, this.getMaxColumnCount(e.rows[0].cells));
      this.allCells = ie(e);
      return i;
    }
    return null;
  };
  s.prototype.fillRowWithEmptyCells = function (e, t) {
    for (var i = 0; i < t; i++) {
      var n = e.insertCell();
      n.innerHTML = '<br>';
    }
  };
  s.prototype.getMaxColumnCount = function (e) {
    for (var t = 0, i = 0; i < e.length; i++) t += e[i].colSpan;
    return t;
  };
  s.prototype.pasteRowContent = function (e, t, i, n, r) {
    var o = this.getRowCells(t);
    this.allCells = ie(e);
    if (!this.preventOverflowCells) {
      this.ensureTargetTableCapacity(e, i, r);
    }
    for (var a = 0; a < o.length; a++) {
      var l = o[a];
      this.allCells = ie(e);
      var h = Oe(o[a], r);
      var c = n + h[0];
      var d = i + h[1];
      if (this.preventOverflowCells) {
        this.adjustCellSpans(o[a], c, d, e);
      }
      var u = this.getOrCreateRow(e, c);
      if (u) {
        var f = this.allCells[c][d];
        if (!(!this.allCells[c][d] || this.shouldSkipCell(this.allCells[c][d]))) {
          this.copyCellAttributes(this.allCells[c][d], o[a], c, d, e, u);
        }
      }
    }
  };
  s.prototype.adjustCellSpans = function (e, t, i, n) {
    var r = parseInt(e.getAttribute('rowspan') || '1', 10);
    var o = parseInt(e.getAttribute('colspan') || '1', 10);
    if (r > 1) {
      var a = this.calculateAdjustedRowSpan(e, t, i, r, n);
      e.setAttribute('rowspan', a.toString());
    }
    if (o > 1) {
      var l = this.calculateAdjustedColSpan(t, i, o);
      e.setAttribute('colspan', l.toString());
    }
  };
  s.prototype.calculateAdjustedRowSpan = function (e, t, i, n, r) {
    for (var o = n, a = 1; a < n; a++) {
      var l = t + a;
      var h = this.getOrCreateRow(r, l);
      if (!h) --o;
      else {
        var c = this.allCells[l][i];
        if (!this.allCells[l][i] || this.shouldSkipCell(this.allCells[l][i])) {
          --o;
        }
      }
    }
    var d = n - o;
    if (d > 0) {
      this.adjustCellHeights(e, null, o, d);
    }
    return o;
  };
  s.prototype.calculateAdjustedColSpan = function (e, t, i) {
    for (var n = i, r = 0; r < i; r++) {
      var o = t + r;
      var a = this.allCells[e][o];
      if (!this.allCells[e][o] || this.shouldSkipCell(this.allCells[e][o])) {
        --n;
      }
    }
    return n;
  };
  s.prototype.ensureTargetTableCapacity = function (e, t, i) {
    if (i[0])
      for (var n = 0; n < e.rows.length; n++) {
        var r = e.rows[n];
        var o = this.allCells[n].length;
        var a = t + i[0].length;
        this.ensureCellCount(e.rows[n], a, this.allCells[n].length);
      }
  };
  s.prototype.shouldSkipCell = function (e) {
    return (
      this.preventOverflowCells &&
      !(e.classList.contains('e-cell-select') && e.classList.contains('e-multi-cells-select'))
    );
  };
  s.prototype.getRowCells = function (e) {
    for (var t = [], i = e.cells.length, n = 0; n < i; n++) {
      var r = e.cells.item(n);
      if (r !== null) {
        t.push(r);
      }
    }
    return t;
  };
  s.prototype.copyCellAttributes = function (e, t, i, n, r, o) {
    if (t) {
      e = this.handleCellInsertLocation(e, o, i, n);
      e = this.handleInsertRowMismatch(e, o, i, n, r);
      var a = this.getCellSpanAttributes(e, t);
      e = this.handleColspanChanges(e, a.oldColSpan, a.newColSpan, i, n, o, r);
      e = this.handleRowspanChanges(e, a.oldRowSpan, a.newRowSpan, i, n, r, a.newColSpan);
      e.innerHTML = t.innerHTML;
      e.style.cssText = t.style.cssText;
    }
  };
  s.prototype.getCellSpanAttributes = function (e, t) {
    return {
      oldRowSpan: parseInt(e.getAttribute('rowspan') || '1', 10),
      oldColSpan: parseInt(e.getAttribute('colspan') || '1', 10),
      newRowSpan: parseInt(t.getAttribute('rowspan') || '1', 10),
      newColSpan: parseInt(t.getAttribute('colspan') || '1', 10),
    };
  };
  s.prototype.handleCellInsertLocation = function (e, t, i, n) {
    var r = this.getInsertionColIndex(n, t, i);
    if (r < n) {
      var o = parseInt(e.getAttribute('colspan') || '1', 10);
      var a = o - (n - r);
      if (a > 0) {
        var l = r + 1;
        var h = t.insertCell(l);
        h.innerHTML = '<br>';
        h.style.cssText = e.style.cssText;
        h.className = e.className;
        e.setAttribute('colspan', (o - a).toString());
        this.allCells[i][n] = h;
        h.setAttribute('colspan', a.toString());
        if (e.hasAttribute('rowspan')) {
          h.setAttribute('rowspan', e.getAttribute('rowspan'));
        }
        return h;
      }
    }
    return e;
  };
  s.prototype.handleInsertRowMismatch = function (e, t, i, n, r) {
    if (e.parentElement !== t) {
      var o = parseInt(e.getAttribute('rowspan') || '1', 10);
      var a = this.getRowIndex(e);
      var l = o - (i - a);
      var h = o - l;
      if (o > 1) {
        this.removeRowspanAttributes(r, i, n);
        var c = this.allCells[i][n];
        c.innerHTML = e.innerHTML;
        c.style.cssText = e.style.cssText;
        c.className = e.className;
        if (e.hasAttribute('colspan')) {
          c.setAttribute('colspan', e.getAttribute('colspan'));
        }
        l === 1 ? c.removeAttribute('rowspan') : c.setAttribute('rowspan', l.toString());
        h > 1 ? e.setAttribute('rowspan', h.toString()) : e.removeAttribute('rowspan');
        this.adjustCellHeights(e, c, h, l);
        return c;
      }
    }
    return e;
  };
  s.prototype.adjustCellHeights = function (e, t, i, n) {
    if (e.style.height) {
      var r = e.style.height;
      var o = parseFloat(e.style.height);
      if (!isNaN(o) && o > 0) {
        var a = i + n;
        var l = o / a;
        e.style.height = i * l + 'px';
        if (t) {
          t.style.height = n * l + 'px';
        }
      }
    }
  };
  s.prototype.handleRowspanChanges = function (e, t, i, n, r, o, a) {
    if (t > 1 && i <= 1) {
      var l = t - i;
      var h = n + 1;
      this.removeRowspanAttributes(o, h, r);
      var c = this.allCells[h][r];
      c.innerHTML = e.innerHTML;
      c.style.cssText = e.style.cssText;
      c.className = e.className;
      if (e.hasAttribute('colspan')) {
        c.setAttribute('colspan', e.getAttribute('colspan'));
      }
      l === 1 ? c.removeAttribute('rowspan') : c.setAttribute('rowspan', l.toString());
      e.removeAttribute('rowspan');
      this.adjustCellHeights(e, c, i, l);
    } else if (t > 1 && i > 1) {
      var d = i - t;
      if (d > 0) {
        this.applyRowspanAttributes(o, n, r, i, a);
        e.setAttribute('rowspan', i.toString());
      } else if (d < 0) {
        var h = n + i;
        this.removeRowspanAttributes(o, h, r);
        var c = this.allCells[h][r];
        c.innerHTML = e.innerHTML;
        c.style.cssText = e.style.cssText;
        c.className = e.className;
        if (e.hasAttribute('colspan')) {
          c.setAttribute('colspan', e.getAttribute('colspan'));
        }
        -d === 1 ? c.removeAttribute('rowspan') : c.setAttribute('rowspan', (-d).toString());
        e.setAttribute('rowspan', i.toString());
        this.adjustCellHeights(e, c, i, -d);
      }
    } else if (i > 1 && t <= 1) {
      this.applyRowspanAttributes(o, n, r, i, a);
      e.setAttribute('rowspan', i.toString());
    }
    return e;
  };
  s.prototype.handleColspanChanges = function (e, t, i, n, r, o, a) {
    if (t > 1 && i <= 1) {
      var l = t - i;
      this.insertFollowingSiblings(o, r, n, i);
      l === 1 ? e.removeAttribute('colspan') : e.setAttribute('colspan', l.toString());
      e.innerHTML = '';
      var h = this.allCells[n][r];
      h.className = e.className;
      e = h;
    } else if (i > 1 && t <= 1) {
      var c = i - t;
      if (c > 0) {
        this.removeFollowingSiblings(this.allCells[n], r + t, c, a, o, n);
        e.setAttribute('colspan', i.toString());
      }
    } else if (i > 1 && t > 1) {
      var d = i - t;
      if (d > 0) {
        this.removeFollowingSiblings(this.allCells[n], r + t, d, a, o, n);
        e.setAttribute('colspan', i.toString());
      } else if (d < 0) {
        this.insertFollowingSiblings(o, r, n, 1);
        e.setAttribute('colspan', (-d).toString());
        e.innerHTML = '';
        var h = this.allCells[n][r];
        h.className = e.className;
        e = h;
        e.setAttribute('colspan', i.toString());
      }
    }
    return e;
  };
  s.prototype.applyRowspanAttributes = function (e, t, i, n, r) {
    for (var o = 1; o < n; o++)
      for (var a = t + o, l = 0; l < r; l++) {
        var h = i + l;
        this.processRowspanCell(e, a, h);
      }
  };
  s.prototype.processRowspanCell = function (e, t, i) {
    var n = this.getOrCreateRow(e, t);
    var r = this.allCells[t][i];
    var o = Array.prototype.indexOf.call(n.cells, this.allCells[t][i]);
    if (!(!this.allCells[t][i] || !this.allCells[t][i].parentElement || o === -1)) {
      var a = parseInt(this.allCells[t][i].getAttribute('colspan') || '1', 10);
      var l = parseInt(this.allCells[t][i].getAttribute('rowspan') || '1', 10);
      var h = a <= 1 && l <= 1;
      if (!h) {
        this.handleComplexCellRemoval(e, n, this.allCells[t][i], t, i, a, l);
      }
      n.removeChild(this.allCells[t][i]);
      this.allCells[t][i] = null;
    }
  };
  s.prototype.handleComplexCellRemoval = function (e, t, i, n, r, o, a) {
    if (o > 1) {
      this.handleColspanCellRemoval(t, i, n, r, o);
    }
    if (a > 1) {
      this.handleRowspanCellRemoval(e, i, n, r, a);
    }
  };
  s.prototype.handleColspanCellRemoval = function (e, t, i, n, r) {
    this.insertFollowingSiblings(e, n, i, 1);
    var o = r - 1;
    var a = this.allCells[i][n];
    a.innerHTML = '<br>';
    a.style.cssText = t.style.cssText;
    a.className = t.className;
    o === 1 ? a.removeAttribute('colspan') : a.setAttribute('colspan', o.toString());
  };
  s.prototype.handleRowspanCellRemoval = function (e, t, i, n, r) {
    this.removeRowspanAttributes(e, i + 1, n);
    var o = this.allCells[i + 1][n];
    var a = r - 1;
    o.innerHTML = t.innerHTML;
    o.style.cssText = t.style.cssText;
    o.className = t.className;
    a === 1 ? o.removeAttribute('rowspan') : o.setAttribute('rowspan', a.toString());
    this.adjustCellHeights(t, o, r, a);
  };
  s.prototype.removeRowspanAttributes = function (e, t, i) {
    var n = this.getOrCreateRow(e, t);
    var r = this.getInsertionColIndex(i, n, t);
    var o = n.insertCell(r);
    this.allCells[t][i] = o;
  };
  s.prototype.getInsertionColIndex = function (e, t, i) {
    if (!t || t.cells.length === 0) return 0;
    var n = e;
    var r = this.allCells[i] || [];
    n = this.findMatchingCellIndex(r, t, n, true);
    var o = r.indexOf(t.cells[0]);
    if (r.length <= n || (t.cells.length <= e && o !== -1 && o < n)) {
      n = e;
      n = this.findMatchingCellIndex(r, t, n, false);
    }
    if (r[n]) {
      var a = r[n];
      n = r[n].cellIndex;
      if (t.cells.length <= e && o !== -1 && e > o) {
        n++;
      }
    } else n = e;
    return n;
  };
  s.prototype.findMatchingCellIndex = function (e, t, i, n) {
    for (var r = i; e && r >= 0 && e[r] && t && Array.prototype.indexOf.call(t.cells, e[r]) === -1; )
      r = n ? r + 1 : r - 1;
    return r;
  };
  s.prototype.removeFollowingSiblings = function (e, t, i, n, r, o) {
    for (var a = 0; a < i; a++) {
      var l = e[t];
      if (e[t] && e[t].parentElement) {
        var h = parseInt(e[t].getAttribute('colspan') || '1', 10);
        var c = parseInt(e[t].getAttribute('rowspan') || '1', 10);
        var d = h <= 1 && c <= 1;
        if (!d) {
          this.handleComplexCellRemoval(n, r, e[t], o, t, h, c);
        }
        e[t].parentElement.removeChild(e[t]);
        e[t] = null;
      }
    }
  };
  s.prototype.insertFollowingSiblings = function (e, t, i, n) {
    for (var r = this.getInsertionColIndex(t, e, i), o = 0; o < n; o++) {
      var a = e.insertCell(r);
      a.innerHTML = '<br>';
      this.allCells[i][t] = a;
    }
  };
  s.prototype.getValidTableFromPaste = function (e) {
    if (e.nodeName.toLowerCase() === 'table') return e;
    var t = e.querySelector('table');
    return t ? this.getWrapperNodeForTable(e, t) : null;
  };
  s.prototype.getWrapperNodeForTable = function (e, t) {
    for (var i = e; i !== t; ) {
      var n = Array.from(i.childNodes).filter(function (r) {
        return r.nodeType !== Node.COMMENT_NODE && !(r.nodeType === Node.TEXT_NODE && r.textContent.trim() === '');
      });
      if (n.length !== 1) return null;
      i = n[0];
    }
    return i;
  };
  return s;
})();
var gs = (function () {
  function s(e, t, i) {
    this.isTableMoveActive = false;
    this.pageX = null;
    this.pageY = null;
    this.isResizeBind = true;
    this.currentColumnResize = '';
    this.resizeEndTime = 0;
    this.ensureInsideTableList = true;
    this.parent = e;
    this.tablePastingObj = new ms();
    this.tableModel = t;
    this.iframeSettings = i;
    this.addEventListener();
  }
  s.prototype.addEventListener = function () {
    this.parent.observer.on(Vi, this.createTable, this);
    this.parent.observer.on(Wi, this.insertRow, this);
    this.parent.observer.on(Qi, this.insertColumn, this);
    this.parent.observer.on(Ui, this.deleteRow, this);
    this.parent.observer.on(_i, this.deleteColumn, this);
    this.parent.observer.on(zi, this.removeTable, this);
    this.parent.observer.on(ji, this.tableHeader, this);
    this.parent.observer.on(Fi, this.tableVerticalAlign, this);
    this.parent.observer.on(qi, this.cellMerge, this);
    this.parent.observer.on(Hi, this.horizontalSplit, this);
    this.parent.observer.on(Pi, this.verticalSplit, this);
    this.parent.observer.on(Ii, this.tableStyles, this);
    this.parent.observer.on(xi, this.setBGColor, this);
    this.parent.observer.on(jn, this.tableMove, this);
    this.parent.observer.on(J, this.destroy, this);
  };
  s.prototype.removeEventListener = function () {
    this.parent.observer.off(Vi, this.createTable);
    this.parent.observer.off(Wi, this.insertRow);
    this.parent.observer.off(Qi, this.insertColumn);
    this.parent.observer.off(Ui, this.deleteRow);
    this.parent.observer.off(_i, this.deleteColumn);
    this.parent.observer.off(zi, this.removeTable);
    this.parent.observer.off(ji, this.tableHeader);
    this.parent.observer.off(Fi, this.tableVerticalAlign);
    this.parent.observer.off(qi, this.cellMerge);
    this.parent.observer.off(Hi, this.horizontalSplit);
    this.parent.observer.off(Pi, this.verticalSplit);
    this.parent.observer.off(Ii, this.tableStyles);
    this.parent.observer.off(xi, this.setBGColor);
    this.parent.observer.off(jn, this.tableMove);
    this.parent.observer.off(J, this.destroy);
    if (!M.isDevice && this.tableModel.tableSettings.resize) {
      D.remove(this.tableModel.getEditPanel(), 'mouseover', this.resizeHelper);
      D.remove(this.tableModel.getEditPanel(), M.touchStartEvent, this.resizeStart);
    }
    if (this.curTable) {
      D.remove(this.curTable, 'mouseleave', this.tableMouseLeave);
    }
    D.remove(this.tableModel.getDocument(), 'selectionchange', this.tableCellsKeyboardSelection);
  };
  s.prototype.copy = function (e) {
    var t = this.extractSelectedTable(this.curTable, e);
    if (t) {
      var i = qo(t.outerHTML, this.tableModel.editorMode);
      try {
        var n = new Blob([i], { type: 'text/html' });
        var r = new window.ClipboardItem({ 'text/html': n });
        navigator.clipboard.write([r]);
      } catch {
        console.error('Clipboard API not supported in this browser');
      }
    }
  };
  s.prototype.updateTableModel = function (e) {
    this.tableModel = e;
  };
  s.prototype.extractSelectedTable = function (e, t) {
    var i = e.querySelectorAll('.e-cell-select.e-multi-cells-select');
    if (!i || i.length === 0) return null;
    var n = e.cloneNode(true);
    var r = this.buildSelectionMap(e, i, t);
    this.cleanTableToSelection(n, r);
    this.removeColGroup(n);
    return n;
  };
  s.prototype.buildSelectionMap = function (e, t, i) {
    for (var n = new Map(), r = 0; r < t.length; r++) {
      for (
        var o = t[r],
          a = o.parentElement,
          l = Array.prototype.indexOf.call(e.rows, a),
          h = Array.prototype.indexOf.call(a.cells, o),
          c = parseInt(o.getAttribute('rowspan') || '1', 10),
          d = 0;
        d < c;
        d++
      ) {
        var u = d + l;
        if (!n.has(u)) {
          n.set(u, new Set());
        }
        if (d === 0) {
          n.get(u).add(h);
        }
      }
      if (i) {
        var f = e.rows[l].cells[h];
        f.innerHTML = '<br>';
      }
    }
    return n;
  };
  s.prototype.cleanTableToSelection = function (e, t) {
    for (var i = e.rows.length - 1; i >= 0; i--) {
      var n = e.rows[i];
      if (!t.has(i)) {
        y(e.rows[i]);
        continue;
      }
      for (var r = t.get(i), o = e.rows[i].cells.length - 1; o >= 0; o--)
        if (!r.has(o)) {
          e.rows[i].deleteCell(o);
        }
    }
  };
  s.prototype.removeColGroup = function (e) {
    var t = Ct(e);
    if (t) {
      y(t);
    }
  };
  s.prototype.createTable = function (e) {
    var t = this.createTableStructure(e);
    this.insertTableInDocument(t, e);
    this.handlePostTableInsertion(t, e);
    return t;
  };
  s.prototype.createTableStructure = function (e) {
    var t = E('table', { className: 'e-rte-table' });
    this.applyTableDimensions(t, e.item.width);
    var i = this.calculateCellWidth(e.item.width.width, e.item.columns);
    var n = this.createInitialColgroup(e.item.columns, i);
    t.appendChild(n);
    var r = E('tbody');
    this.createRowsAndCells(r, e.item.rows, e.item.columns);
    t.appendChild(r);
    return t;
  };
  s.prototype.createInitialColgroup = function (e, t) {
    for (var i = E('colgroup'), n = 0; n < e; n++) {
      var r = E('col');
      r.appendChild(E('br'));
      r.style.width = t + '%';
      i.appendChild(r);
    }
    return i;
  };
  s.prototype.applyTableDimensions = function (e, t) {
    if (!p(t.width)) {
      e.style.width = this.calculateStyleValue(t.width);
    }
    if (!p(t.minWidth)) {
      e.style.minWidth = this.calculateStyleValue(t.minWidth);
    }
    if (!p(t.maxWidth)) {
      e.style.maxWidth = this.calculateStyleValue(t.maxWidth);
    }
  };
  s.prototype.calculateCellWidth = function (e, t) {
    return parseInt(e, 10) > 100 ? 100 / t : parseInt(e, 10) / t;
  };
  s.prototype.createRowsAndCells = function (e, t, i) {
    for (var n = 0; n < t; n++) {
      for (var r = E('tr'), o = 0; o < i; o++) {
        var a = E('td');
        a.appendChild(E('br'));
        r.appendChild(a);
      }
      e.appendChild(r);
    }
  };
  s.prototype.insertTableInDocument = function (e, t) {
    t.item.selection.restore();
    Pe.Insert(this.tableModel.getDocument(), e, this.tableModel.getEditPanel());
    t.item.selection.setSelectionText(
      this.tableModel.getDocument(),
      e.querySelector('td'),
      e.querySelector('td'),
      0,
      0,
    );
  };
  s.prototype.handlePostTableInsertion = function (e, t) {
    this.insertElementAfterTableIfNeeded(e, t.enterAction);
    if (e.classList.contains('ignore-table')) {
      Y([e], ['ignore-table']);
    }
    var i = this.getOffsetParent(e, this.tableModel.getDocument());
    if (i) {
      var n = i && (i.nodeName === 'TD' || i.nodeName === 'TH');
      var r = !!(i.classList && i.classList.contains('e-multi-cells-select'));
      if (n && !r) {
        Y([i], ['e-cell-select']);
      }
    }
    e.querySelector('td').classList.add('e-cell-select');
    if (t.callBack) {
      t.callBack({
        requestType: 'Table',
        editorMode: 'HTML',
        event: t.event,
        range: this.parent.nodeSelection.getRange(this.tableModel.getDocument()),
        elements: [e],
      });
    }
  };
  s.prototype.insertElementAfterTableIfNeeded = function (e, t) {
    if (e.nextElementSibling === null && !e.classList.contains('ignore-table')) {
      var i = void 0;
      t === 'DIV'
        ? ((i = E('div')), i.appendChild(E('br')))
        : t === 'BR'
          ? (i = E('br'))
          : ((i = E('p')), i.appendChild(E('br')));
      this.insertAfter(i, e);
    }
  };
  s.prototype.calculateStyleValue = function (e) {
    var t;
    typeof e == 'string' && (e.indexOf('px') >= 0 || e.indexOf('%') >= 0 || e.indexOf('auto') >= 0)
      ? (t = e)
      : (t = e + 'px');
    return t;
  };
  s.prototype.insertAfter = function (e, t) {
    if (t.parentNode) {
      t.parentNode.insertBefore(e, t.nextSibling);
    }
  };
  s.prototype.getSelectedCellMinMaxIndex = function (e) {
    for (
      var t = this.curTable.querySelectorAll('.e-cell-select'), i = e.length, n = 0, r = e[0].length, o = 0, a = 0;
      a < t.length;
      a++
    ) {
      var l = Oe(t[a], e);
      var h = this.FindIndex(l[0], l[1], e);
      i = Math.min(l[0], i);
      n = Math.max(h[0], n);
      r = Math.min(l[1], r);
      o = Math.max(h[1], o);
    }
    return {
      startRow: i,
      endRow: n,
      startColumn: r,
      endColumn: o,
    };
  };
  s.prototype.insertRow = function (e) {
    var t = e.item.subCommand !== 'InsertRowBefore';
    this.curTable = v(this.parent.nodeSelection.range.startContainer.parentElement, 'table');
    var i = null;
    this.curTable.querySelectorAll('.e-cell-select').length === 0
      ? (i = this.addRowWithoutCellSelection())
      : (i = this.addRowWithCellSelection(e, t));
    this.updateSelectionAfterRowInsertion(i, e);
    this.executeCallback(e);
  };
  s.prototype.addRowWithoutCellSelection = function () {
    var e = this.curTable.rows[this.curTable.rows.length - 1];
    var t = this.curTable.rows[this.curTable.rows.length - 1].cloneNode(true);
    t.removeAttribute('rowspan');
    this.insertAfter(t, this.curTable.rows[this.curTable.rows.length - 1]);
    var i = t.cells;
    return t.cells && t.cells.length > 0 ? t.cells[0] : null;
  };
  s.prototype.addRowWithCellSelection = function (e, t) {
    var i = ie(this.curTable);
    var n = this.getSelectedCellMinMaxIndex(i);
    var r = t ? n.endRow : n.startRow;
    var o = E('tr');
    var a = this.curTable.querySelectorAll('th.e-cell-select').length > 0;
    this.createCellsForNewRow(i, r, t, a, o);
    this.insertNewRowAtPosition(e, t, a, r, o);
    var l = o.cells;
    return o.cells && o.cells.length > 0 && n.endColumn < o.cells.length ? o.cells[n.endColumn] : null;
  };
  s.prototype.createCellsForNewRow = function (e, t, i, n, r) {
    for (var o = 0; o < e[t].length; o++)
      this.isCellAffectedByRowspan(e, t, o, i)
        ? this.isFirstCellInSpan(e, t, o) && this.incrementRowspan(e[t][o])
        : this.createNewCellForRow(e, t, o, n, i, r);
  };
  s.prototype.isCellAffectedByRowspan = function (e, t, i, n) {
    return (n && t < e.length - 1 && e[t][i] === e[t + 1][i]) || (!n && 0 < t && e[t][i] === e[t - 1][i]);
  };
  s.prototype.isFirstCellInSpan = function (e, t, i) {
    return i === 0 || (0 < i && e[t][i] !== e[t][i - 1]);
  };
  s.prototype.incrementRowspan = function (e) {
    var t = parseInt(e.getAttribute('rowspan'), 10) || 1;
    e.setAttribute('rowspan', (t + 1).toString());
  };
  s.prototype.createNewCellForRow = function (e, t, i, n, r, o) {
    var a = E('td');
    a.appendChild(E('br'));
    o.appendChild(a);
    var l = this.getReferenceRowIndex(e, t, n, r);
    var h = e[l][i].getAttribute('style');
    if (h) {
      var c = this.cellStyleCleanup(h);
      a.style.cssText = c;
    }
  };
  s.prototype.getReferenceRowIndex = function (e, t, i, n) {
    return i && n && t + 1 < e.length ? t + 1 : t;
  };
  s.prototype.insertNewRowAtPosition = function (e, t, i, n, r) {
    var o;
    i && t ? (o = this.curTable.querySelector('tbody').childNodes[0]) : (o = this.curTable.rows[n]);
    e.item.subCommand === 'InsertRowBefore' || i ? o.parentElement.insertBefore(r, o) : this.insertAfter(r, o);
  };
  s.prototype.updateSelectionAfterRowInsertion = function (e, t) {
    if (e) {
      this.clearTableSelections();
      B([e], ne);
      t.item.selection.setSelectionText(this.tableModel.getDocument(), e, e, 0, 0);
    }
  };
  s.prototype.clearTableSelections = function () {
    var e = this.tableModel.getEditPanel().querySelectorAll('.e-cell-select');
    Y(e, ne);
    this.removeTableSelection();
  };
  s.prototype.executeCallback = function (e) {
    if (e.callBack) {
      e.callBack({
        requestType: e.item.subCommand,
        editorMode: 'HTML',
        event: e.event,
        range: this.parent.nodeSelection.getRange(this.tableModel.getDocument()),
        elements: this.parent.nodeSelection.getSelectedNodes(this.tableModel.getDocument()),
      });
    }
  };
  s.prototype.insertColumn = function (e) {
    var t = e.item.selection.range.startContainer;
    if (!(t.nodeName === 'TH' || t.nodeName === 'TD')) {
      t = v(t.parentElement, 'td,th');
    }
    var i = v(t, 'tr');
    var n = v(i, 'table').rows;
    var r = Array.prototype.slice.call(i.querySelectorAll(':scope > td, :scope > th')).indexOf(t);
    var o = v(i, 'table');
    this.prepareTableForColumnInsertion(e, o);
    this.insertCellsInAllRows(e, v(i, 'table').rows, r, o);
    var a = e.item.subCommand === 'InsertColumnRight' ? r + 1 : r;
    var l = i.cells[a];
    this.clearTableSelections();
    B([i.cells[a]], ne);
    this.finalizeColumnInsertion(e, i.cells[a]);
  };
  s.prototype.prepareTableForColumnInsertion = function (e, t) {
    for (var i = t.querySelectorAll('th,td'), n = 0; n < i.length; n++)
      i[n].dataset.oldWidth = (i[n].offsetWidth / t.offsetWidth) * 100 + '%';
    if (p(t.style.width) || t.style.width === '') {
      t.style.width = t.offsetWidth + 'px';
    }
  };
  s.prototype.insertCellsInAllRows = function (e, t, i, n) {
    for (
      var r = n.querySelectorAll('th,td'),
        o = t[0].querySelectorAll(':scope > td, :scope > th').length,
        a = parseInt(e.item.width, 10) / (o + 1),
        l = parseInt(e.item.width, 10) / o,
        h = this.updateColumnGroup(n, i, e.item.subCommand, a),
        c = 0;
      c < t.length;
      c++
    ) {
      var d = t[c].querySelectorAll(':scope > td, :scope > th')[i];
      var u = this.createColumnCell(t[c].querySelectorAll(':scope > td, :scope > th')[i]);
      e.item.subCommand === 'InsertColumnLeft'
        ? t[c]
            .querySelectorAll(':scope > td, :scope > th')
            [i].parentElement.insertBefore(u, t[c].querySelectorAll(':scope > td, :scope > th')[i])
        : this.insertAfter(u, t[c].querySelectorAll(':scope > td, :scope > th')[i]);
      delete u.dataset.oldWidth;
    }
    this.redistributeCellWidths(r, l, a, h);
  };
  s.prototype.updateColumnGroup = function (e, t, i, n) {
    pt(e);
    var r = Ct(e);
    var o = E('col');
    o.appendChild(E('br'));
    o.style.width = n.toFixed(4) + '%';
    var a = r.querySelectorAll('col');
    if (a.length > 0 && t < a.length) {
      var l = a[t];
      i === 'InsertColumnLeft' ? r.insertBefore(o, a[t]) : this.insertAfter(o, a[t]);
    } else r.appendChild(o);
    return r.querySelectorAll('col');
  };
  s.prototype.createColumnCell = function (e) {
    var t = e.cloneNode(true);
    var i = t.getAttribute('style');
    if (i) {
      var n = this.cellStyleCleanup(i);
      t.style.cssText = n;
    }
    t.innerHTML = '';
    t.appendChild(E('br'));
    t.removeAttribute('class');
    t.removeAttribute('colspan');
    t.removeAttribute('rowspan');
    return t;
  };
  s.prototype.redistributeCellWidths = function (e, t, i, n) {
    for (var r = 0; r < e.length; r++)
      if (e[r].dataset.oldWidth) {
        var o = Number(e[r].dataset.oldWidth.split('%')[0]);
        var a = Array.prototype.slice
          .call(e[r].parentElement.querySelectorAll(':scope > td, :scope > th'))
          .indexOf(e[r]);
        n[a].style.width = ((o * i) / t).toFixed(4) + '%';
        delete e[r].dataset.oldWidth;
      }
  };
  s.prototype.finalizeColumnInsertion = function (e, t) {
    e.item.selection.setSelectionText(this.tableModel.getDocument(), t, t, 0, 0);
    this.executeCallback(e);
  };
  s.prototype.setBGColor = function (e) {
    var t = this.parent.nodeSelection.getRange(this.tableModel.getDocument());
    var i = t.startContainer.nodeType === 3 ? t.startContainer.parentNode : t.startContainer;
    this.curTable = i.closest('table');
    for (var n = this.curTable.querySelectorAll('.e-cell-select'), r = 0; r < n.length; r++)
      n[r].style.backgroundColor = e.value.toString();
    this.parent.undoRedoManager.saveData();
    this.parent.observer.notify(Kt, {});
    this.executeBgColorCallback(e);
  };
  s.prototype.executeBgColorCallback = function (e) {
    if (e.callBack) {
      e.callBack({
        requestType: e.subCommand,
        editorMode: 'HTML',
        event: e.event,
        range: this.parent.nodeSelection.getRange(this.tableModel.getDocument()),
        elements: this.parent.nodeSelection.getSelectedNodes(this.tableModel.getDocument()),
      });
    }
  };
  s.prototype.tableStyles = function (e) {
    var t = e.event;
    var i = e.item.subCommand;
    var n = v(e.event.selectParent[0], 'table');
    this.applyTableStyleCommand(e.item.subCommand, n);
    this.applyCustomCssClasses(e.event, n);
    this.parent.undoRedoManager.saveData();
    this.parent.observer.notify(Kt, {});
    this.parent.nodeSelection.restore();
    if (e.callBack) {
      e.callBack({
        requestType: e.item.subCommand,
        editorMode: 'HTML',
        event: e.event.args,
        range: this.parent.nodeSelection.getRange(this.parent.currentDocument),
        elements: this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument),
      });
    }
  };
  s.prototype.applyTableStyleCommand = function (e, t) {
    if (e === 'Dashed') {
      var i = this.parent.editableElement.classList.contains(at);
      i ? Y([this.parent.editableElement], at) : this.parent.editableElement.classList.add(at);
      var n = t.classList.contains(at);
      n ? Y([t], at) : t.classList.add(at);
    } else if (e === 'Alternate') {
      var i = this.parent.editableElement.classList.contains(st);
      i ? Y([this.parent.editableElement], st) : this.parent.editableElement.classList.add(st);
      var n = t.classList.contains(st);
      n ? Y([t], st) : t.classList.add(st);
    }
  };
  s.prototype.applyCustomCssClasses = function (e, t) {
    var i = e.args;
    if (e.args && e.args.item.cssClass)
      for (var n = e.args.item.cssClass.split(' '), r = 0; r < n.length; r++) {
        var o = n[r];
        t.classList.contains(n[r]) ? Y([t], n[r]) : t.classList.add(n[r]);
      }
  };
  s.prototype.deleteColumn = function (e) {
    var t = e.item.selection.range.startContainer;
    if (t.nodeType === 3) {
      t = v(t.parentElement, 'td,th');
    }
    this.curTable = v(t, 'table');
    var i = v(t, 'tr');
    if (i.querySelectorAll('th,td').length === 1) this.removeEntireTable(e);
    else {
      pt(this.curTable);
      var n = this.removeSelectedColumns(e);
      this.updateColgroupAfterColumnDeletion(this.curTable, n.startColumn, n.endColumn);
    }
    this.executeDeleteColumnCallback(e);
  };
  s.prototype.updateColgroupAfterColumnDeletion = function (e, t, i) {
    for (var n = Ct(e), r = n.querySelectorAll('col'), o = i - t + 1, a = 0; a < o; a++)
      if (t < r.length) {
        n.removeChild(r[t]);
        r = n.querySelectorAll('col');
      }
    for (var l = r.length, h = e.offsetWidth, c = new Array(l), a = 0; a < l; a++) c[a] = r[a].offsetWidth;
    for (var a = 0; a < l; a++) r[a].style.width = oe(c[a], h).toFixed(4) + '%';
  };
  s.prototype.removeEntireTable = function (e) {
    var t = e.item.selection.range.startContainer;
    y(v(e.item.selection.range.startContainer.parentElement, 'table'));
    e.item.selection.restore();
  };
  s.prototype.removeSelectedColumns = function (e) {
    for (
      var t = -1,
        i = ie(this.curTable),
        n = this.getSelectedCellMinMaxIndex(i),
        r = n.startColumn,
        o = n.endColumn,
        a = 0;
      a < i.length;
      a++
    )
      for (var l = i[a], h = 0; h < l.length; h++) {
        var c = l[h];
        if (l[h].dataset.processed !== 'true') {
          var d = Oe(l[h], i);
          var u = parseInt(l[h].getAttribute('colspan'), 10) || 1;
          if (this.isCellAffectedByDeletedColumns(d[1], u, r, o)) {
            l[h].dataset.processed = 'true';
            u > 1 ? this.adjustColspan(l[h], u) : (y(l[h]), (t = h), this.handleIESpecificSelection(e, M.isIE));
          }
        }
      }
    this.cleanupProcessedCells();
    this.updateSelectionAfterColumnDelete(e, n.startRow, t);
    return n;
  };
  s.prototype.cleanupProcessedCells = function () {
    var e = this.curTable.querySelectorAll('td, th');
    Array.from(e).forEach(function (t) {
      delete t.dataset.processed;
    });
  };
  s.prototype.isCellAffectedByDeletedColumns = function (e, t, i, n) {
    return e + (t - 1) >= i && e <= n;
  };
  s.prototype.adjustColspan = function (e, t) {
    e.setAttribute('colspan', (t - 1).toString());
  };
  s.prototype.handleIESpecificSelection = function (e, t) {
    if (t) {
      var i = this.curTable.querySelector('td');
      e.item.selection.setSelectionText(this.tableModel.getDocument(), i, i, 0, 0);
      i.classList.add('e-cell-select');
    }
  };
  s.prototype.updateSelectionAfterColumnDelete = function (e, t, i) {
    if (i > -1) {
      var n = this.curTable && this.curTable.rows[t];
      var r = i <= (n && this.curTable.rows[t].cells.length - 1) ? i : i - 1;
      var o = this.curTable.rows[t].cells[r];
      if (this.curTable.rows[t].cells[r]) {
        e.item.selection.setSelectionText(
          this.tableModel.getDocument(),
          this.curTable.rows[t].cells[r],
          this.curTable.rows[t].cells[r],
          0,
          0,
        );
        this.curTable.rows[t].cells[r].classList.add('e-cell-select');
      }
    }
  };
  s.prototype.executeDeleteColumnCallback = function (e) {
    if (e.callBack) {
      var t = this.parent.nodeSelection.getRange(this.tableModel.getDocument()).startContainer;
      if (this.parent.nodeSelection.getRange(this.tableModel.getDocument()).startContainer.nodeName !== 'TD') {
        var i = this.parent.nodeSelection.getRange(this.tableModel.getDocument()).startOffset;
        var n = this.parent.nodeSelection.getRange(this.tableModel.getDocument()).startContainer.children[
          this.parent.nodeSelection.getRange(this.tableModel.getDocument()).startOffset
        ];
        if (
          this.parent.nodeSelection.getRange(this.tableModel.getDocument()).startContainer.children[
            this.parent.nodeSelection.getRange(this.tableModel.getDocument()).startOffset
          ]
        ) {
          this.parent.nodeSelection.setCursorPoint(
            this.tableModel.getDocument(),
            this.parent.nodeSelection.getRange(this.tableModel.getDocument()).startContainer.children[
              this.parent.nodeSelection.getRange(this.tableModel.getDocument()).startOffset
            ],
            0,
          );
        }
      }
      this.executeCallback(e);
    }
  };
  s.prototype.deleteRow = function (e) {
    var t = e.item.selection.range.startContainer;
    if (t.nodeType === 3) {
      t = v(t.parentElement, 'td,th');
    }
    var i = Array.prototype.indexOf.call(t.parentNode.childNodes, t);
    this.curTable = v(t, 'table');
    var n = ie(this.curTable);
    var r = this.getSelectedCellMinMaxIndex(n);
    this.curTable.rows.length === 1 ? this.removeEntireTable(e) : this.deleteSelectedRows(e, r, n, i);
    this.executeCallback(e);
  };
  s.prototype.deleteSelectedRows = function (e, t, i, n) {
    for (var r = t.endRow; r >= t.startRow; r--) {
      var o = this.curTable.rows[r];
      this.adjustRowSpans(r, i);
      this.repositionSpannedCells(r, i);
      var a = this.curTable.rows[r].rowIndex;
      this.curTable.deleteRow(this.curTable.rows[r].rowIndex);
      this.restoreFocusAfterRowDeletion(e, this.curTable.rows[r].rowIndex, n);
    }
  };
  s.prototype.adjustRowSpans = function (e, t) {
    for (var i = 0; i < t[e].length; i++)
      if (!(i !== 0 && t[e][i] === t[e][i - 1])) {
        var n = t[e][i];
        var r = t[e][i].getAttribute('rowspan');
        if (r && parseInt(r, 10) > 1) {
          var o = parseInt(r, 10) - 1;
          o === 1
            ? (t[e][i].removeAttribute('rowspan'), this.createReplacementCellIfNeeded(i))
            : t[e][i].setAttribute('rowspan', o.toString());
        }
      }
  };
  s.prototype.createReplacementCellIfNeeded = function (e) {
    var t = this.getMergedRow(ie(this.curTable));
    if (t && e < t.length) {
      var i = t[e];
      if (t[e]) {
        var n = t[e].cloneNode(true);
        n.innerHTML = '<br>';
        if (t[e].parentElement) {
          t[e].parentElement.insertBefore(n, t[e]);
        }
      }
    }
  };
  s.prototype.repositionSpannedCells = function (e, t) {
    for (var i = 0; i < t[e].length; i++) {
      var n = t[e][i];
      var r = e < t.length - 1 && t[e][i] === t[e + 1][i];
      var o = e === 0 || t[e][i] !== t[e - 1][i];
      if (r && o)
        for (var a = i; a > 0 && t[e][i] === t[e][a - 1]; ) {
          if (a === 0) this.curTable.rows[e + 1].prepend(t[e][i]);
          else {
            var l = t[e + 1][a - 1];
            t[e + 1][a - 1].insertAdjacentElement('afterend', t[e][i]);
          }
          a--;
        }
    }
  };
  s.prototype.restoreFocusAfterRowDeletion = function (e, t, i) {
    var n = p(this.curTable.rows[t]) ? this.curTable.rows[t - 1] : this.curTable.rows[t];
    var r = n && n.querySelectorAll('td')[i];
    if (r) {
      e.item.selection.setSelectionText(this.tableModel.getDocument(), r, r, 0, 0);
      r.classList.add('e-cell-select');
    } else {
      var o = this.curTable.querySelector('td');
      e.item.selection.setSelectionText(this.tableModel.getDocument(), o, o, 0, 0);
      o.classList.add('e-cell-select');
    }
  };
  s.prototype.getMergedRow = function (e) {
    for (var t, i = this.curTable.rows[0].childNodes.length, n = 0; n < e.length; n++)
      if (e[n].length !== i) {
        t = e[n];
        break;
      }
    return t;
  };
  s.prototype.removeTable = function (e) {
    var t = e.item.selection.range.startContainer;
    t = t.nodeType === 3 ? t.parentNode : t;
    var i = v(t.parentElement, 'table');
    if (i) {
      var n = i.nextSibling;
      y(i);
      e.item.selection.restore();
      this.focusAfterTableDeletion(i.nextSibling);
    }
    this.executeCallback(e);
  };
  s.prototype.focusAfterTableDeletion = function (e) {
    if (e) {
      var t = this.parent.nodeSelection.findFirstContentNode(e);
      if (!(!t || !t.node))
        if (t.node.nodeName === 'BR') {
          var i = this.parent.editableElement.ownerDocument.createRange();
          i.setStartBefore(t.node);
          i.setEndBefore(t.node);
          this.parent.nodeSelection.setRange(this.parent.currentDocument, i);
        } else this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, t.node, 0);
    }
  };
  s.prototype.tableHeader = function (e) {
    var t = this.getTableFromSelection(e);
    var i = this.checkIfTableHasHeader(t);
    t && !i ? this.createTableHeader(t) : t.deleteTHead();
    this.executeCallback(e);
  };
  s.prototype.getTableFromSelection = function (e) {
    var t = e.item.selection.range.startContainer;
    return t.nodeName === 'TABLE' ? t : (t.nodeType === 3 && (t = t.parentNode), v(t.parentElement, 'table'));
  };
  s.prototype.checkIfTableHasHeader = function (e) {
    var t = false;
    Array.prototype.slice.call(e.childNodes).forEach(function (i) {
      if (i.nodeName === 'THEAD') {
        t = true;
      }
    });
    return t;
  };
  s.prototype.createTableHeader = function (e) {
    for (var t = e.querySelector('tr'), i = t.childElementCount, n = 0, r = 0; r < i; r++) {
      var o = parseInt(t.children[r].getAttribute('colspan'), 10) || 1;
      n += o;
    }
    var a = e.createTHead();
    var l = a.insertRow(0);
    this.createHeaderCells(l, n);
  };
  s.prototype.createHeaderCells = function (e, t) {
    for (var i = 0; i < t; i++) {
      var n = E('th');
      n.appendChild(E('br'));
      e.appendChild(n);
    }
  };
  s.prototype.tableVerticalAlign = function (e) {
    var t = this.getVerticalAlignmentValue(e.item.subCommand);
    this.applyVerticalAlignment(e.item.tableCell, t);
    this.executeCallback(e);
  };
  s.prototype.getVerticalAlignmentValue = function (e) {
    switch (e) {
      case 'AlignTop':
        return 'top';
      case 'AlignMiddle':
        return 'middle';
      case 'AlignBottom':
        return 'bottom';
      default:
        return '';
    }
  };
  s.prototype.applyVerticalAlignment = function (e, t) {
    var i = this.curTable && this.curTable.querySelectorAll('.e-cell-select');
    if (i && i.length > 0) for (var n = 0; n < i.length; n++) i[n].style.verticalAlign = t;
    else e.style.verticalAlign = t;
    if (t && t !== '' && e.getAttribute('valign')) {
      e.removeAttribute('valign');
    }
  };
  s.prototype.cellMerge = function (e) {
    this.curTable = v(this.parent.nodeSelection.range.startContainer.parentElement, 'table');
    var t = this.curTable.querySelectorAll('.e-cell-select');
    if (!(t.length < 2)) {
      pt(this.curTable);
      var i = At(this.curTable);
      this.mergeCellContent();
      var n = this.getSelectedMinMaxIndexes(ie(this.curTable));
      this.configureFirstCellForMerge(t, n);
      this.cleanupAfterMerge(t);
      this.updateTableStructureAfterMerge(n);
      this.updateColgroupAfterMerge(n.startColumn, n.endColumn, i);
      this.updateSelectionAfterMerge(e, t[0]);
      this.executeCallback(e);
    }
  };
  s.prototype.configureFirstCellForMerge = function (e, t) {
    var i = e[0];
    var n = e[0].parentElement.querySelectorAll('.e-cell-select');
    if (t.startColumn < t.endColumn) {
      e[0].setAttribute('colspan', (t.endColumn - t.startColumn + 1).toString());
    }
    if (t.startRow < t.endRow) {
      e[0].setAttribute('rowspan', (t.endRow - t.startRow + 1).toString());
    }
    var r = this.calculateMaxCellHeight(n);
    e[0].style.height = r + 'px';
  };
  s.prototype.updateColgroupAfterMerge = function (e, t, i) {
    var n = Ct(this.curTable);
    var r = this.isEntireColumnsMerged(i);
    if (e < t && r > 0) {
      var o = n.querySelectorAll('col');
      var a = parseFloat(o[e].style.width) || 0;
      if (e < o.length)
        for (var l = 0; l < r; l++) {
          var h = e + 1;
          if (h < o.length) {
            a += parseFloat(o[h].style.width);
            n.removeChild(o[h]);
            o = n.querySelectorAll('col');
          }
        }
      o[e].style.width = a + '%';
    }
  };
  s.prototype.isEntireColumnsMerged = function (e) {
    var t = At(this.curTable);
    var i = e - t;
    return i;
  };
  s.prototype.calculateMaxCellHeight = function (e) {
    for (var t = 0, i = 0; i < e.length; i++) {
      var n = e[i].offsetHeight;
      if (e[i].offsetHeight > t) {
        t = e[i].offsetHeight;
      }
    }
    return t;
  };
  s.prototype.cleanupAfterMerge = function (e) {
    for (var t = [], i = 1; i < e.length; i++) t.push(e[i]);
    t.forEach(function (r) {
      return y(r);
    });
    for (var n = [], i = 0; i < this.curTable.rows.length; i++)
      if (this.curTable.rows[i].innerHTML.trim() === '') {
        n.push(this.curTable.rows[i]);
      }
    n.forEach(function (r) {
      return y(r);
    });
    Y(this.curTable.querySelectorAll('table td, table th'), 'e-multi-cells-select');
    Y(this.curTable.querySelectorAll('table td, table th'), 'e-cell-select-end');
  };
  s.prototype.updateTableStructureAfterMerge = function (e) {
    this.updateRowSpanStyle(e.startRow, e.endRow, ie(this.curTable));
    this.updateColSpanStyle(e.startColumn, e.endColumn, ie(this.curTable));
  };
  s.prototype.updateSelectionAfterMerge = function (e, t) {
    e.item.selection.setSelectionText(
      this.tableModel.getDocument(),
      e.item.selection.range.startContainer,
      e.item.selection.range.startContainer,
      0,
      0,
    );
    if (this.parent.nodeSelection && t) {
      this.parent.nodeSelection.setCursorPoint(this.tableModel.getDocument(), t, 0);
    }
  };
  s.prototype.updateColSpanStyle = function (e, t, i) {
    var n;
    var r = 0;
    var o = 0;
    var a = i;
    t = Math.min(t, i[0].length - 1);
    if (e < t) {
      for (
        n = e;
        n <= t &&
        ((r = this.getEffectiveColspan(i[0][n], t - e + 1)),
        !(this.isValidColspanStart(i[0], e, n, r) && ((o = this.processRowsForColspan(i, n, r)), !o)));
        n++
      );
      if (o) {
        this.updateCellAttribute(i, o, 'colspan', 0, i.length - 1, e, t);
      }
    }
  };
  s.prototype.getEffectiveColspan = function (e, t) {
    var i = e.getAttribute('colspan');
    var n = i ? parseInt(i, 10) : 1;
    return Math.min(n, t);
  };
  s.prototype.isValidColspanStart = function (e, t, i, n) {
    var r = t < i && e[i] === e[i - 1];
    var o = n > 1 && e[i] === e[i + 1];
    return !r && o;
  };
  s.prototype.processRowsForColspan = function (e, t, i) {
    for (
      var n = i - 1, r = 1;
      r < e.length && !(e[r][t] !== e[r - 1][t] && ((n = this.processRowCells(e, r, t, i, n)), !n));
      r++
    );
    return n;
  };
  s.prototype.processRowCells = function (e, t, i, n, r) {
    for (var o = r, a = i; a < i + n; a++) {
      var l = parseInt(e[t][a].getAttribute('colspan'), 10) || 1;
      if (l > 1 && e[t][a] === e[t][a + 1]) a += o = Math.min(o, l - 1);
      else {
        o = Math.max(0, o - 1);
        if (o === 0) break;
      }
    }
    return o;
  };
  s.prototype.updateRowSpanStyle = function (e, t, i) {
    var n = i;
    var r = 0;
    t = Math.min(t, i.length - 1);
    if (e < t) {
      for (var o = e; o <= t; o++)
        if (this.isValidRowspanStart(i, e, o, t)) {
          var a = this.getEffectiveRowspan(i[o][0], t - e + 1);
          r = this.processColumnsForRowspan(i, o, a);
          if (!r) break;
        }
      if (r) {
        this.updateCellAttribute(i, r, 'rowspan', e, t, 0, i[0].length - 1);
      }
    }
  };
  s.prototype.isValidRowspanStart = function (e, t, i, n) {
    var r = !(t < i && e[i][0] === e[i - 1][0]);
    var o = !!e[i][0];
    var a = 0;
    if (o) {
      var l = e[i][0].getAttribute('rowspan');
      a = l ? parseInt(l, 10) : 1;
      a = Math.min(a, n - t + 1);
    }
    var h = a > 1 && i + 1 <= n && e[i][0] === e[i + 1][0];
    return r && o && a > 1 && h;
  };
  s.prototype.getEffectiveRowspan = function (e, t) {
    var i = e.getAttribute('rowspan');
    var n = i ? parseInt(i, 10) : 1;
    return Math.min(n, t);
  };
  s.prototype.processColumnsForRowspan = function (e, t, i) {
    for (
      var n = i - 1, r = 1;
      r < e[0].length && !(e[t][r] !== e[t][r - 1] && ((n = this.processColumnCells(e, t, r, i, n)), !n));
      r++
    );
    return n;
  };
  s.prototype.processColumnCells = function (e, t, i, n, r) {
    for (var o = r, a = t; a < t + n; a++) {
      var l = parseInt(e[a][i].getAttribute('rowspan'), 10) || 1;
      if (l > 1 && a + 1 < e.length && e[a][i] === e[a + 1][i]) a += o = Math.min(o, l - 1);
      else {
        o = Math.max(0, o - 1);
        if (o === 0) break;
      }
    }
    return o;
  };
  s.prototype.updateCellAttribute = function (e, t, i, n, r, o, a) {
    for (var l = n; l <= r; l++)
      for (var h = o; h <= a; h++)
        if (e[l][h]) {
          if (e[l][h].dataset.processed === 'true') continue;
          var c = parseInt(e[l][h].getAttribute(i), 10) || 1;
          if (this.shouldUpdateCellAttribute(e, l, h, n, o, c)) {
            var d = c - t;
            this.updateSpanAttribute(e[l][h], i, d);
            e[l][h].dataset.processed = 'true';
          }
        }
    this.cleanupProcessedCells();
  };
  s.prototype.shouldUpdateCellAttribute = function (e, t, i, n, r, o) {
    var a = n < t && e[t][i] === e[t - 1][i];
    var l = r < i && e[t][i] === e[t][i - 1];
    var h = o > 1;
    return a || l || h;
  };
  s.prototype.updateSpanAttribute = function (e, t, i) {
    i > 1 ? e.setAttribute(t, i.toString()) : e.removeAttribute(t);
  };
  s.prototype.mergeCellContent = function () {
    for (
      var e = this.curTable.querySelectorAll('.e-cell-select'), t = this.isCellEmpty(e[0]) ? '' : e[0].innerHTML, i = 1;
      i < e.length;
      i++
    ) {
      var n = e[i];
      if (!this.isCellEmpty(e[i])) {
        t = this.appendCellContent(t, e[i].innerHTML);
      }
    }
    e[0].innerHTML = t;
  };
  s.prototype.isCellEmpty = function (e) {
    return e.innerHTML === '<br>' || e.innerHTML === '';
  };
  s.prototype.appendCellContent = function (e, t) {
    return e ? e + '<br>' + t : t;
  };
  s.prototype.getSelectedMinMaxIndexes = function (e) {
    var t = this.curTable.querySelectorAll('.e-cell-select');
    if (t.length > 0) {
      for (var i = this.initializeMinMaxData(e), n = 0; n < t.length; n++) i = this.updateMinMaxWithCell(i, t[n], e);
      return i;
    }
    return null;
  };
  s.prototype.initializeMinMaxData = function (e) {
    return {
      startRow: e.length,
      endRow: 0,
      startColumn: e[0].length,
      endColumn: 0,
    };
  };
  s.prototype.updateMinMaxWithCell = function (e, t, i) {
    var n = Oe(t, i);
    var r = this.FindIndex(n[0], n[1], i);
    return {
      startRow: Math.min(n[0], e.startRow),
      endRow: Math.max(r[0], e.endRow),
      startColumn: Math.min(n[1], e.startColumn),
      endColumn: Math.max(r[1], e.endColumn),
    };
  };
  s.prototype.horizontalSplit = function (e) {
    var t = e.item.selection.range.startContainer;
    this.curTable = v(e.item.selection.range.startContainer.parentElement, 'table');
    if (!(this.curTable.querySelectorAll('.e-cell-select').length > 1)) {
      this.activeCell = this.curTable.querySelector('.e-cell-select');
      var i = this.prepareNewCellForSplit();
      var n = Oe(this.activeCell, ie(this.curTable));
      var r = ie(this.curTable);
      var o = this.getRowSpanValue(this.activeCell);
      o > 1 ? this.splitCellWithRowspan(o, n, r, i) : this.splitCellWithoutRowspan(n, r, i);
      this.executeCallback(e);
    }
  };
  s.prototype.prepareNewCellForSplit = function () {
    var e = this.activeCell.cloneNode(true);
    e.removeAttribute('class');
    e.innerHTML = '<br>';
    return e;
  };
  s.prototype.getRowSpanValue = function (e) {
    return e.getAttribute('rowspan') ? parseInt(e.getAttribute('rowspan'), 10) : 1;
  };
  s.prototype.splitCellWithRowspan = function (e, t, i, n) {
    var r = Math.ceil(e / 2);
    var o = e - r;
    if (this.activeCell.style && this.activeCell.style.height) {
      var a = this.activeCell.offsetHeight;
      var l = this.activeCell.offsetHeight / e;
      this.activeCell.style.height = l * r + 'px';
      n.style.height = l * o + 'px';
    }
    this.updateRowspanAttributes(this.activeCell, n, r, o);
    var h = t[0] + r;
    var c = this.findInsertionColumnIndex(i, h, t[1]);
    this.insertNewCellIntoRow(i, h, c, n);
  };
  s.prototype.updateRowspanAttributes = function (e, t, i, n) {
    i > 1 ? e.setAttribute('rowspan', i.toString()) : e.removeAttribute('rowspan');
    n > 1 ? t.setAttribute('rowspan', n.toString()) : t.removeAttribute('rowspan');
  };
  s.prototype.findInsertionColumnIndex = function (e, t, i) {
    for (var n = i === 0 ? i : i - 1; n >= 0; ) {
      var r = e[t][n] === e[t][n - 1];
      var o = t > 0 && e[t][n] === e[t - 1][n];
      if (!(r || o)) break;
      n--;
    }
    return n;
  };
  s.prototype.insertNewCellIntoRow = function (e, t, i, n) {
    if (i === -1) {
      var r = this.curTable.rows[t];
      this.curTable.rows[t].firstChild ? this.curTable.rows[t].prepend(n) : this.curTable.appendChild(n);
    } else e[t][i].insertAdjacentElement('afterend', n);
  };
  s.prototype.splitCellWithoutRowspan = function (e, t, i) {
    if (this.activeCell.style && this.activeCell.style.height) {
      var n = this.activeCell.offsetHeight / 2;
      this.activeCell.style.height = n + 'px';
      i.style.height = n + 'px';
    }
    var r = E('tr');
    r.appendChild(i);
    var o = t[e[0]];
    this.adjustRowspansInRow(t[e[0]]);
    if (this.activeCell.parentNode.style && this.activeCell.parentNode.style.height) {
      var a = parseFloat(this.activeCell.parentNode.style.height) / 2;
      r.style.height = a + '%';
      this.activeCell.parentNode.style.height = a + '%';
    }
    this.activeCell.parentNode.insertAdjacentElement('afterend', r);
  };
  s.prototype.adjustRowspansInRow = function (e) {
    for (var t = 0; t <= e.length - 1; t++)
      if (e[t] !== e[t - 1] && e[t] !== this.activeCell) {
        var i = parseInt(e[t].getAttribute('rowspan'), 10) || 1;
        e[t].setAttribute('rowspan', (i + 1).toString());
      }
  };
  s.prototype.verticalSplit = function (e) {
    var t = e.item.selection.range.startContainer;
    this.curTable = v(e.item.selection.range.startContainer.parentElement, 'table');
    if (!(this.curTable.querySelectorAll('.e-cell-select').length > 1)) {
      pt(this.curTable);
      var i = At(this.curTable);
      this.activeCell = this.curTable.querySelector('.e-cell-select');
      var n = this.prepareNewCellForVerticalSplit();
      var r = Oe(this.activeCell, ie(this.curTable));
      var o = ie(this.curTable);
      var a = this.getColSpanValue(this.activeCell);
      var l = {
        leftCellWidth: 0,
        rightCellWidth: 0,
      };
      a > 1 ? (l = this.splitCellWithColspan(a, r, n)) : (l = this.splitCellWithoutColspan(r, o));
      this.activeCell.parentNode.insertBefore(n, this.activeCell.nextSibling);
      this.updateColgroupAfterVerticalSplit(this.curTable, r[1], l, i);
      this.executeCallback(e);
    }
  };
  s.prototype.updateColgroupAfterVerticalSplit = function (e, t, i, n) {
    var r = Ct(e);
    var o = At(e);
    var a = r.querySelectorAll('col');
    if (t < a.length && n < o) {
      a[t].style.width = i.leftCellWidth + '%';
      var l = E('col');
      l.appendChild(E('br'));
      l.style.width = i.rightCellWidth + '%';
      a[t].parentNode.insertBefore(l, a[t].nextSibling);
    }
  };
  s.prototype.prepareNewCellForVerticalSplit = function () {
    var e = this.activeCell.cloneNode(true);
    e.removeAttribute('class');
    e.innerHTML = '<br>';
    return e;
  };
  s.prototype.getColSpanValue = function (e) {
    return parseInt(e.getAttribute('colspan'), 10) || 1;
  };
  s.prototype.splitCellWithColspan = function (e, t, i) {
    var n = Math.ceil(e / 2);
    var r = e - n;
    var o = this.getColSizes(this.curTable);
    var a = this.calculateLeftCellWidth(t[1], n, o);
    var l = this.calculateRightCellWidth(t[1], n, e, o, a);
    this.updateColspanAttributes(this.activeCell, i, n, r);
    return {
      leftCellWidth: a,
      rightCellWidth: l,
    };
  };
  s.prototype.calculateLeftCellWidth = function (e, t, i) {
    return this.getSplitColWidth(e, e + t - 1, i);
  };
  s.prototype.calculateRightCellWidth = function (e, t, i, n, r) {
    var o = this.getSplitColWidth(e + t, e + i - 1, n);
    var a = oe(this.activeCell.offsetWidth, this.curTable.offsetWidth);
    return a - r < o ? a - r : o;
  };
  s.prototype.updateColspanAttributes = function (e, t, i, n) {
    i > 1 ? e.setAttribute('colspan', i.toString()) : e.removeAttribute('colspan');
    n > 1 ? t.setAttribute('colspan', n.toString()) : t.removeAttribute('colspan');
  };
  s.prototype.splitCellWithoutColspan = function (e, t) {
    var i = oe(this.activeCell.offsetWidth, this.curTable.offsetWidth) / 2;
    this.adjustColspansInColumn(t, e);
    return {
      leftCellWidth: i,
      rightCellWidth: i,
    };
  };
  s.prototype.adjustColspansInColumn = function (e, t) {
    for (var i = this.curTable.rows, n = 0; n <= i.length - 1; n++)
      if (this.shouldAdjustColspanForCell(n, e, t)) {
        var r = e[n][t[1]];
        this.incrementColspan(e[n][t[1]]);
      }
  };
  s.prototype.shouldAdjustColspanForCell = function (e, t, i) {
    return (e === 0 || t[e][i[1]] !== t[e - 1][i[1]]) && t[e][i[1]] !== this.activeCell;
  };
  s.prototype.incrementColspan = function (e) {
    var t = parseInt(e.getAttribute('colspan'), 10) || 1;
    e.setAttribute('colspan', (t + 1).toString());
  };
  s.prototype.getSplitColWidth = function (e, t, i) {
    for (var n = 0, r = e; r <= t; r++) n += i[r];
    return oe(n, this.curTable.offsetWidth);
  };
  s.prototype.getColSizes = function (e) {
    for (var t = e.rows[0].cells, i = 0, n = 0; n < t.length; n++) i = i + t[n].colSpan;
    for (var r = new Array(i), o = new Map(), a = 0; a < e.rows.length; a++)
      for (var l = 0, h = 0; h < e.rows[a].cells.length; h++) {
        this.mapRowspanCells(e, o, a, h, l);
        var c = zn(o, a, h);
        if (c > l) {
          l = c;
        }
        this.storeCellWidth(e, r, l, a, h);
        l += 1 + e.rows[a].cells[h].colSpan - 1;
      }
    return r;
  };
  s.prototype.mapRowspanCells = function (e, t, i, n, r) {
    for (var o = 1; o < e.rows[i].cells[n].rowSpan; o++) {
      var a = '' + (i + o) + r;
      t.set(a, e.rows[i].cells[n]);
    }
  };
  s.prototype.storeCellWidth = function (e, t, i, n, r) {
    var o = e.rows[n].cells[r].offsetWidth;
    if (!t[i] || e.rows[n].cells[r].offsetWidth < t[i]) {
      t[i] = e.rows[n].cells[r].offsetWidth;
    }
  };
  s.prototype.FindIndex = function (e, t, i) {
    for (var n = e + 1, r = t + 1; n < i.length; ) {
      if (i[n][t] !== i[e][t]) {
        n--;
        break;
      }
      n++;
    }
    for (n === i.length && n--; r < i[e].length; ) {
      if (i[e][r] !== i[e][t]) {
        r--;
        break;
      }
      r++;
    }
    if (r === i[e].length) {
      r--;
    }
    return [n, r];
  };
  s.prototype.isMergedCell = function (e) {
    return parseInt(e.getAttribute('rowspan') || '1', 10) > 1 || parseInt(e.getAttribute('colspan') || '1', 10) > 1;
  };
  s.prototype.adjustBoundary = function (e, t, i, n, r, o, a) {
    var l = Oe(i[e][t], i);
    var h = this.FindIndex(l[0], l[1], i);
    if (h) {
      n = Math.min(l[0], n);
      r = Math.max(h[0], r);
      o = Math.min(l[1], o);
      a = Math.max(h[1], a);
    }
    return [n, r, o, a];
  };
  s.prototype.highlightCells = function (e, t, i, n, r) {
    for (var o, a, l, h, c = e, d = t, u = i, f = n, m = c; m <= d; m++) {
      if (this.isMergedCell(r[m][u])) {
        o = this.adjustBoundary(m, u, r, c, d, u, f);
        c = o[0];
        d = o[1];
        u = o[2];
        f = o[3];
      }
      if (this.isMergedCell(r[m][f])) {
        a = this.adjustBoundary(m, f, r, c, d, u, f);
        c = a[0];
        d = a[1];
        u = a[2];
        f = a[3];
      }
      for (var g = u; g <= f; g++) {
        if (this.isMergedCell(r[c][g])) {
          l = this.adjustBoundary(c, g, r, c, d, u, f);
          c = l[0];
          d = l[1];
          u = l[2];
          f = l[3];
        }
        if (this.isMergedCell(r[d][g])) {
          h = this.adjustBoundary(d, g, r, c, d, u, f);
          c = h[0];
          d = h[1];
          u = h[2];
          f = h[3];
        }
      }
    }
    return c === e && d === t && u === i && f === n
      ? {
          startRow: e,
          endRow: t,
          startColumn: i,
          endColumn: n,
        }
      : this.highlightCells(c, d, u, f, r);
  };
  s.prototype.restoreRange = function (e) {
    if (this.parent.userAgentData.isSafari()) {
      this.parent.nodeSelection.Clear(this.tableModel.getDocument());
      return;
    }
    var t = e.nodeName === 'TD' || e.nodeName === 'TH';
    var i = this.tableModel.getDocument().getSelection().rangeCount > 0;
    if (i && t) {
      this.parent.nodeSelection.setCursorPoint(this.tableModel.getDocument(), e, 0);
    }
  };
  s.prototype.tableStyle = function (e) {
    this.executeCallback(e);
  };
  s.prototype.tableMove = function (e) {
    this.activeCell = e.selectNode[0];
    if (false) {
      var t = e.event.target;
      if (!this.isValidCellTarget(t)) {
        var i = null;
        t.nodeType !== Node.ELEMENT_NODE ? (i = t.parentElement) : (i = t);
        if (i && i.tagName !== 'TD' && i.tagName !== 'TH') {
          i = v(i, 'TD') || v(i, 'TH');
        }
        if (i) t = i;
        else return;
      }
      this.curTable = v(t, 'table');
      var n = v(this.activeCell, 'table');
      if (n.contains(this.curTable)) {
        var r = this.findContainingCell(n, this.curTable);
        if (r) {
          this.curTable = n;
          t = r;
        }
      }
      if (this.areCellsInSameTable(this.curTable, n)) {
        var o = ie(this.curTable);
        var a = Oe(this.activeCell, o);
        var l = Oe(t, o);
        var h = this.clearPreviousSelection();
        if (!this.isSameCellSelected(a, l, h)) {
          this.selectCellRange(a, l, o);
          t.classList.add('e-cell-select-end');
          if (e.event.type) {
            e.event.preventDefault();
          }
          this.restoreRange(t);
        }
      }
    }
  };
  s.prototype.findContainingCell = function (e, t) {
    for (var i = e.rows, n = 0; n < i.length; n++)
      for (var r = i[n].cells, o = 0; o < r.length; o++) {
        var a = r[o];
        if (r[o].contains(t)) return r[o];
      }
    return null;
  };
  s.prototype.isValidCellTarget = function (e) {
    if (!this.activeCell || !e) return false;
    var t = this.activeCell.tagName;
    var i = e.tagName;
    var n = e.tagName === 'TD' || e.tagName === 'TH';
    return n || this.activeCell.tagName === e.tagName;
  };
  s.prototype.areCellsInSameTable = function (e, t) {
    return !p(e) && !p(t) && e === t;
  };
  s.prototype.clearPreviousSelection = function () {
    for (
      var e = this.curTable.querySelectorAll('.e-cell-select, .e-multi-cells-select, .e-cell-select-end'),
        t = e.length - 1;
      t >= 0;
      t--
    ) {
      var i = t;
      if (this.activeCell !== e[t]) {
        Y([e[t]], ['e-cell-select']);
      }
      Y([e[t]], ['e-multi-cells-select']);
      Y([e[t]], ['e-cell-select-end']);
    }
    return e;
  };
  s.prototype.isSameCellSelected = function (e, t, i) {
    var n = e[0] === t[0] && e[1] === t[1];
    return n ? (i.length > 1 && this.restoreRange(this.activeCell), true) : false;
  };
  s.prototype.selectCellRange = function (e, t, i) {
    for (
      var n = this.highlightCells(
          Math.min(e[0], t[0]),
          Math.max(e[0], t[0]),
          Math.min(e[1], t[1]),
          Math.max(e[1], t[1]),
          i,
        ),
        r = n.startRow;
      r <= n.endRow;
      r++
    )
      for (var o = r, a = n.startColumn; a <= n.endColumn; a++) {
        var l = a;
        i[o][a].classList.add('e-cell-select');
        i[o][a].classList.add('e-multi-cells-select');
      }
  };
  s.prototype.destroy = function () {
    this.removeEventListener();
    if (this.resizeIconPositionTime) {
      clearTimeout(this.resizeIconPositionTime);
      this.resizeIconPositionTime = null;
    }
  };
  s.prototype.cellStyleCleanup = function (e) {
    for (
      var t = e.split(';'), i = [], n = ['background-color', 'vertical-align', 'text-align'], r = 0;
      r < t.length;
      r++
    ) {
      for (var o = r, a = t[o], l = true, h = 0; h < n.length; h++) {
        var c = h;
        var d = n[h];
        if (a.indexOf(n[h]) > -1) {
          l = false;
          break;
        }
      }
      if (l) {
        i.push(a);
      }
    }
    return i.join(';');
  };
  s.prototype.calMaxCol = function (e) {
    if (!e || !e.rows || e.rows.length === 0 || !e.rows[0] || !e.rows[0].cells) return [];
    for (var t = e.rows[0].cells, i = 0, n = 0; n < t.length; n++) i = i + t[n].colSpan;
    for (var r = new Array(i), o = new Map(), a = 0; a < e.rows.length; a++)
      for (var l = 0, h = 0; h < e.rows[a].cells.length; h++) {
        for (var c = 1; c < e.rows[a].cells[h].rowSpan; c++) {
          var d = '' + (a + c) + l;
          o.set(d, e.rows[a].cells[h]);
        }
        var u = zn(o, a, h);
        if (u > l) {
          l = u;
        }
        var f = e.rows[a].cells[h].offsetWidth;
        if (!r[l] || e.rows[a].cells[h].offsetWidth < r[l].offsetWidth) {
          r[l] = e.rows[a].cells[h];
        }
        l += 1 + e.rows[a].cells[h].colSpan - 1;
      }
    return r;
  };
  s.prototype.resizeBtnInit = function () {
    return (this.resizeBtnStat = {
      column: false,
      row: false,
      tableBox: false,
    });
  };
  s.prototype.calcPos = function (e) {
    var t = {
      top: 0,
      left: 0,
    };
    if (!e) return t;
    var i = e.getBoundingClientRect();
    var n = e.ownerDocument;
    var r = this.getOffsetParent(e, e.ownerDocument);
    var o = false;
    if (r && r.nodeName === 'TD' && e.nodeName === 'TABLE') {
      r = v(r, '.e-rte-content');
      o = true;
    }
    if (r && r !== e && r.nodeType === 1) {
      t = r.getBoundingClientRect();
    }
    if (o) {
      o = false;
      var a = this.iframeSettings.enable ? e.ownerDocument.documentElement : this.tableModel.getEditPanel();
      var l = (a && a.scrollTop) || 0;
      var h = (a && a.scrollLeft) || 0;
      var c = l > 0 ? l + i.top - 0 : i.top - 0;
      var d = h > 0 ? h + i.left - 0 : i.left - 0;
      return {
        top: c,
        left: d,
      };
    } else if (r !== this.tableModel.getEditPanel() && e.nodeName === 'TABLE') {
      for (var u = e; u && u.parentElement !== this.tableModel.getEditPanel(); ) u = u.parentElement;
      var f = u.getBoundingClientRect();
      return {
        top: this.iframeSettings.enable ? i.top : u.offsetTop + i.top - f.top,
        left: i.left - f.left + 1,
      };
    } else
      return {
        top: e.offsetTop,
        left: e.offsetLeft,
      };
  };
  s.prototype.getOffsetParent = function (e, t) {
    for (
      var i = e.offsetParent || t.documentElement;
      i && (i === t.body || i === t.documentElement) && i.style.position === 'static';

    )
      i = i.parentNode;
    return i;
  };
  s.prototype.getPointX = function (e) {
    var t = e;
    var i = e;
    return e.touches && e.touches.length > 0 ? e.touches[0].pageX : e.pageX;
  };
  s.prototype.getPointY = function (e) {
    var t = e;
    var i = e;
    return e.touches && e.touches.length > 0 ? e.touches[0].pageY : e.pageY;
  };
  s.prototype.getCurrentColWidth = function (e, t) {
    var i = 0;
    if (e && e.style && e.style.width !== '') {
      var n = e.style.width;
      e.style.width.indexOf('%') !== -1 ? (i = parseFloat(e.style.width.split('%')[0])) : (i = oe(e.offsetWidth, t));
    } else if (e && t > 0) {
      i = oe(e.offsetWidth, t);
    }
    return i;
  };
  s.prototype.resetResizeHelper = function (e) {
    var t = this.tableModel.rteElement.querySelectorAll('.e-table-rhelper.e-column-helper');
    Array.from(t).forEach(function (n) {
      if (n.parentNode) {
        n.parentNode.removeChild(n);
      }
    });
    var i = this.tableModel.rteElement.querySelectorAll('.e-table-rhelper.e-row-helper');
    Array.from(i).forEach(function (n) {
      if (n.parentNode) {
        n.parentNode.removeChild(n);
      }
    });
    if (parseInt(e.style.width, 10) === 0) {
      e.style.width = e.offsetWidth + 'px';
    }
  };
  s.prototype.resizeStart = function (e) {
    if (!(!this.parent || !this.tableModel || this.tableModel.readonly)) {
      if (M.isDevice) {
        this.resizeHelper(e);
      }
      var t = e.target;
      if (
        !(
          !e.target ||
          !(e.target.classList.contains(qt) || e.target.classList.contains(Ft) || e.target.classList.contains(Tt))
        )
      ) {
        this.resetResizeHelper(this.curTable);
        e.preventDefault();
        this.tableModel.preventDefaultResize(e);
        if (!e.target.classList.contains(Tt)) {
          var i = this.tableModel.getEditPanel().querySelector('.e-table-box');
          if (!p(i) && parseInt(e.target.getAttribute('data-col'), 10) !== this.calMaxCol(this.curTable).length) {
            i.classList.add('e-hide');
          }
        }
        Y(this.curTable.querySelectorAll('td,th'), ne);
        this.removeTableSelection();
        this.pageX = this.getPointX(e);
        this.pageY = this.getPointY(e);
        this.resizeBtnStat = this.resizeBtnInit();
        this.tableModel.hideTableQuickToolbar();
        e.target.classList.contains(qt)
          ? this.handleColumnResize(e.target)
          : e.target.classList.contains(Ft)
            ? this.handleRowResize(e.target)
            : e.target.classList.contains(Tt) && (this.resizeBtnStat.tableBox = true);
        if (M.isDevice && this.helper && !this.helper.classList.contains('e-reicon')) {
          this.helper.classList.add('e-reicon');
          D.add(document, M.touchStartEvent, this.removeHelper, this);
          D.add(this.helper, M.touchStartEvent, this.resizeStart, this);
        } else {
          var n = {
            event: e,
            requestType: 'Table',
          };
          this.tableModel.resizeStart(n);
        }
        if (this.isResizeBind) {
          D.add(this.tableModel.getDocument(), M.touchMoveEvent, this.resizing, this);
          D.add(this.tableModel.getDocument(), M.touchEndEvent, this.resizeEnd, this);
          this.isResizeBind = false;
        }
      }
    }
  };
  s.prototype.handleColumnResize = function (e) {
    this.resizeBtnStat.column = true;
    pt(this.curTable);
    var t = e.getAttribute('data-col') || '0';
    var i = parseInt(t, 10);
    i === this.calMaxCol(this.curTable).length
      ? ((this.currentColumnResize = 'last'),
        (this.colIndex = i - 1),
        (this.columnEle = this.calMaxCol(this.curTable)[this.colIndex]))
      : ((this.currentColumnResize = i === 0 ? 'first' : 'middle'),
        (this.colIndex = i),
        (this.columnEle = this.calMaxCol(this.curTable)[this.colIndex]));
    this.appendHelper(e);
  };
  s.prototype.appendHelper = function (e) {
    var t = 'e-table-rhelper' + this.tableModel.getCssClass(true);
    this.helper = E('div', { className: t });
    if (M.isDevice) {
      this.helper.classList.add('e-reicon');
    }
    this.tableModel.getEditPanel().appendChild(this.helper);
    this.setHelperHeight(e);
    this.hideRowColumnAddIcons(e);
  };
  s.prototype.setHelperHeight = function (e) {
    if (this.resizeBtnStat && this.resizeBtnStat.column) {
      this.helper.classList.add('e-column-helper');
      var t = e.style.height;
      var i = parseFloat(e.style.left) + 0.5;
      var n = e.style.top;
      this.helper.style.cssText = 'height: ' + e.style.height + '; top: ' + e.style.top + '; left: ' + i + 'px;';
    } else {
      this.helper.classList.add('e-row-helper');
      var r = e.style.width;
      var o = parseFloat(e.style.top) - 0.5;
      var a = e.style.left;
      this.helper.style.cssText = 'width: ' + e.style.width + '; top: ' + o + 'px; left: ' + e.style.left + ';';
    }
  };
  s.prototype.updateHelper = function () {
    if (this.helper) {
      var e = this.calcPos(this.curTable);
      e = this.adjustPositionForScrollbar(e, this.curTable);
      if (this.resizeBtnStat && this.resizeBtnStat.column) {
        var t =
          e.left +
          this.calcPos(this.columnEle).left +
          (this.tableModel.enableRtl ? this.columnEle.getBoundingClientRect().width : 0);
        var i = this.currentColumnResize === 'last' && !this.tableModel.enableRtl ? this.columnEle.offsetWidth : 0;
        var n = t + i - 1;
        this.helper.style.left = n + 'px';
        this.helper.style.height = this.curTable.offsetHeight + 'px';
      } else {
        var r = this.calcPos(this.rowEle).top + e.top + this.rowEle.offsetHeight - 1;
        this.helper.style.top = r + 'px';
        this.helper.style.width = this.curTable.offsetWidth + 'px';
      }
    }
  };
  s.prototype.handleRowResize = function (e) {
    var t = e.getAttribute('data-row') || '0';
    var i = parseInt(t, 10);
    this.rowEle = this.curTable.rows[i];
    this.resizeBtnStat.row = true;
    this.appendHelper(e);
  };
  s.prototype.addResizeEventHandlers = function () {
    if (this.tableModel.tableSettings.resize) {
      D.add(this.tableModel.getEditPanel(), M.touchStartEvent, this.resizeStart, this);
    }
    if (!M.isDevice) {
      D.add(this.tableModel.getEditPanel(), 'mouseover', this.resizeHelper, this);
    }
  };
  s.prototype.removeResizeEventHandlers = function () {
    D.remove(this.tableModel.getEditPanel(), M.touchStartEvent, this.resizeStart);
    this.cancelResizeAction();
  };
  s.prototype.resizeHelper = function (e) {
    if (
      !(!this.parent || !this.tableModel || this.tableModel.readonly) &&
      !this.isTableMoveActive &&
      !(e && e.buttons && e.buttons > 0)
    ) {
      var t = null;
      e && e.targetTouches && e.targetTouches.length > 0
        ? (t = e.targetTouches[0].target)
        : e && e.target && (t = e.target);
      if (!!t) {
        var i = v(t, 'table.e-rte-table, table.e-rte-paste-table, table.e-rte-custom-table');
        var n = this.tableModel.getEditPanel();
        var r =
          n.querySelectorAll(
            '.e-table-box.e-rbox-select, .e-table-rhelper.e-column-helper, .e-table-rhelper.e-row-helper',
          ).length > 0;
        if (!r && !p(this.curTable) && !p(i) && i !== this.curTable && n.contains(i)) {
          this.removeResizeElement();
          this.removeHelper(e);
          this.cancelResizeAction();
        }
        if (!this.isTableNode(t)) {
          var o = v(t, 'td, th');
          if (o) {
            t = o;
          }
        }
        !r && this.isTableNode(t)
          ? (i && n.contains(i) && (t.nodeName === 'TD' || t.nodeName === 'TH')
              ? (this.curTable = i)
              : (this.curTable = t),
            this.removeResizeElement(),
            this.tableResizeEleCreation(this.curTable, e),
            this.handleRowColumnAddIcon(t, this.curTable))
          : this.hideRowColumnAddIcons(t);
      }
    }
  };
  s.prototype.isTableNode = function (e) {
    return e.nodeName === 'TABLE' || e.nodeName === 'TD' || e.nodeName === 'TH';
  };
  s.prototype.handleRowColumnAddIcon = function (e, t) {
    if (!(!e || e.nodeName === 'TABLE')) {
      var i = this.getAttributeValue(e, 'rowspan', 1);
      var n = this.getAttributeValue(e, 'colspan', 1);
      var r = ie(t);
      var o = Oe(e, r);
      if (!(o.length < 2)) {
        var a = o[0] + (i - 1);
        var l = o[1];
        if (!(a !== 0 && o[1] !== 0)) {
          this.updateRowInsertIcons(a, i);
          this.updateColumnInsertIcons(o[1], n);
        }
      }
    }
  };
  s.prototype.getAttributeValue = function (e, t, i) {
    if (!e.hasAttribute(t)) return i;
    var n = e.getAttribute(t);
    return n ? parseInt(n, 10) : i;
  };
  s.prototype.createIcon = function (e) {
    var t = E('span', {
      attrs: {
        unselectable: 'on',
        contenteditable: 'false',
      },
      className: 'e-icons ' + e,
    });
    return t;
  };
  s.prototype.updateRowInsertIcons = function (e, t) {
    for (var i = this.tableModel.getEditPanel(), n = 0; n <= t; n++) {
      var r = '.e-rte-table-resize.e-tb-row-insert[data-row="' + (e - n) + '"]';
      var o = i.querySelector(r);
      this.updateInsertIcon(o);
    }
  };
  s.prototype.updateColumnInsertIcons = function (e, t) {
    for (var i = this.tableModel.getEditPanel(), n = 0; n <= t; n++) {
      var r = '.e-rte-table-resize.e-tb-col-insert[data-col="' + (e + n) + '"]';
      var o = i.querySelector(r);
      this.updateInsertIcon(o);
    }
  };
  s.prototype.updateInsertIcon = function (e) {
    if (e) {
      var t = this.tableModel.enableRtl ? 'e-circle e-insert-cell-rtl' : 'e-circle';
      var i = this.createIcon(t);
      e.appendChild(i);
      e.style.opacity = '1';
    }
  };
  s.prototype.hideRowColumnAddIcons = function (e) {
    if (
      !(
        !e ||
        !e.classList ||
        e.classList.contains('e-circle-add') ||
        (e.classList.contains('e-rte-table-resize') && !this.tableModel.getEditPanel().contains(this.helper))
      )
    ) {
      var t = this.tableModel.getEditPanel();
      if (t.querySelectorAll('.e-rte-table-resize .e-icons.e-circle-add').length > 0) this.removeResizeElement();
      else {
        var i = t.querySelectorAll('.e-rte-table-resize .e-icons.e-circle');
        i.forEach(function (n) {
          var r = n.parentElement;
          if (n.parentElement) {
            n.parentElement.style.opacity = '0';
            y(n);
          }
        });
      }
    }
  };
  s.prototype.resizeEnd = function (e) {
    if (this.parent) {
      this.resizeBtnInit();
      this.isResizeBind = true;
      D.remove(this.tableModel.getDocument(), M.touchMoveEvent, this.resizing);
      D.remove(this.tableModel.getDocument(), M.touchEndEvent, this.resizeEnd);
      if (
        this.tableModel.getEditPanel().querySelector('.e-table-box') &&
        this.tableModel.getEditPanel().contains(this.tableModel.getEditPanel().querySelector('.e-table-box'))
      ) {
        var t = this.tableModel.getEditPanel().querySelector('.e-table-box');
        if (!p(t)) {
          t.classList.remove('e-hide');
        }
        if (!M.isDevice) {
          D.remove(this.tableModel.getEditPanel(), 'mouseover', this.resizeHelper);
          D.add(this.tableModel.getEditPanel(), 'mouseover', this.resizeHelper, this);
        }
        this.removeResizeElement();
      }
      if (this.helper && this.tableModel.getEditPanel().contains(this.helper)) {
        y(this.helper);
        this.helper = null;
      }
      this.resetResizeHelper(this.curTable);
      this.pageX = null;
      this.pageY = null;
      for (var i = this.curTable.querySelectorAll('tr'), n = [], r = 0; r < i.length; r++) {
        var o = (parseFloat(i[r].clientHeight.toString()) / parseFloat(this.curTable.clientHeight.toString())) * 100;
        n[r] = o;
      }
      for (var r = 0; r < i.length; r++)
        if (i[r].style.height) {
          if (i[r].parentElement.nodeName === 'THEAD') {
            i[r].parentElement.style.height = n[r] + '%';
          }
          i[r].style.height = n[r] + '%';
        }
      var a = {
        event: e,
        requestType: 'table',
      };
      this.tableModel.resizeEnd(a);
      this.resizeEndTime = new Date().getTime();
    }
  };
  s.prototype.cancelResizeAction = function () {
    this.isResizeBind = true;
    D.remove(this.tableModel.getEditPanel(), M.touchMoveEvent, this.resizing);
    D.remove(this.tableModel.getEditPanel(), M.touchEndEvent, this.resizeEnd);
    this.removeResizeElement();
  };
  s.prototype.removeResizeElement = function () {
    var e = '.e-column-resize, .e-row-resize, .e-table-box, .e-table-rhelper, .e-tb-col-insert, .e-tb-row-insert';
    var t = this.tableModel.getEditPanel();
    var i = t.querySelectorAll(
      '.e-column-resize, .e-row-resize, .e-table-box, .e-table-rhelper, .e-tb-col-insert, .e-tb-row-insert',
    );
    if (i && i.length > 0)
      for (var n = 0; n < i.length; n++) {
        var r = i[n];
        if (i[n]) {
          if (
            i[n].classList &&
            (i[n].classList.contains('e-tb-col-insert') || i[n].classList.contains('e-tb-row-insert'))
          ) {
            var o = i[n].querySelector('.e-circle-add');
            if (o) {
              D.remove(o, 'mousedown', this.handleIconMouseDown);
            }
            this.removeInsertIconEvents(i[n]);
          }
          y(i[n]);
        }
      }
    var a = this.parent.editableElement ? this.parent.editableElement.lastChild : null;
    if (a && a.nodeName === 'P') {
      x([a], ['e-rte-last-paragraph']);
      if (a.classList.length === 0) {
        a.removeAttribute('class');
      }
    }
  };
  s.prototype.removeHelper = function (e) {
    var t = e ? e.target : null;
    var i = t ? t.classList : null;
    if (i && !i.contains('e-reicon') && this.helper) {
      D.remove(document, M.touchStartEvent, this.removeHelper);
      D.remove(this.helper, M.touchStartEvent, this.resizeStart);
      if (this.tableModel.getEditPanel().contains(this.helper)) {
        y(this.helper);
      }
      this.pageX = null;
      this.helper = null;
    }
  };
  s.prototype.tableResizeEleCreation = function (e, t) {
    if (!(!e || !t)) {
      this.tableModel.preventDefaultResize(t);
      var i = this.calMaxCol(this.curTable);
      var n = this.getTableRowsWithoutRowspan(e);
      var r = parseFloat(getComputedStyle(e).height) || 0;
      var o = parseFloat(getComputedStyle(e).width) || 0;
      var a = this.parent.editableElement ? this.parent.editableElement.lastChild : null;
      if (a && a.nodeName === 'P') {
        B([a], ['e-rte-last-paragraph']);
      }
      var l = this.calcPos(e);
      l = this.adjustPositionForScrollbar(l, e);
      var h = ie(e);
      this.createColumnResizers(i, r, l, h);
      this.createRowResizers(n, e, o, l, h);
      if (this.tableModel.tableSettings.resize) {
        this.createResizeBox(i.length, l, o, r);
      }
    }
  };
  s.prototype.adjustPositionForScrollbar = function (e, t) {
    if (!this.tableModel.enableRtl) return e;
    if (this.iframeSettings.enable) {
      var i = this.tableModel.getDocument();
      if (!i || !i.defaultView || !i.body || !i.body.id) return e;
      var n = this.getOffsetParent(t, i);
      var r = n && n.nodeName === 'TD' && t.nodeName === 'TABLE';
      if (!r) return e;
      var o = i.defaultView.parent && i.defaultView.parent.window;
      var a = o && o.document;
      var l = i.body.id.replace('-edit', '');
      if (a && l) {
        var h = a.querySelector('#' + l);
        if (h) {
          var c = h.clientWidth - i.body.clientWidth;
          if (c > 0) {
            e.left -= c;
          }
        }
      }
    } else {
      var d = this.tableModel.getEditPanel();
      if (d) {
        var c = d.offsetWidth - d.clientWidth;
        if (c > 0 && this.tableModel.enableRtl) {
          e.left -= c;
        }
      }
    }
    return e;
  };
  s.prototype.resizing = function (e) {
    if (!(!this.parent || !this.tableModel)) {
      var t = {
        event: e,
        requestType: 'table',
      };
      this.tableModel.resizing(t);
    }
  };
  s.prototype.perfomResizing = function (e) {
    var t = this.getPointX(e);
    var i = this.getPointY(e);
    var n = this.tableModel.enableRtl ? -(t - this.pageX) : t - this.pageX;
    var r = this.tableModel.enableRtl ? -(i - this.pageY) : i - this.pageY;
    this.pageX = t;
    this.pageY = i;
    var o;
    var a = this.curTable.closest('td');
    var l = this.tableModel.getEditPanel().querySelector('.e-table-box');
    var h = parseInt(getComputedStyle(this.curTable).width, 10);
    var c = isNaN(parseInt(this.curTable.style.height, 10))
      ? parseInt(getComputedStyle(this.curTable).height, 10)
      : parseInt(this.curTable.style.height, 10);
    var d = +getComputedStyle(this.tableModel.getEditPanel()).paddingRight.match(/\d/g).join('');
    var u =
      this.tableModel.getEditPanel().offsetWidth -
      (this.tableModel.getEditPanel().offsetWidth - this.tableModel.getEditPanel().clientWidth) -
      d * 2;
    var f;
    var m = this.curTable && this.curTable.parentElement;
    if (
      !p(this.curTable.parentElement.closest('table')) &&
      !p(this.curTable.closest('td')) &&
      this.tableModel.getEditPanel().contains(this.curTable.closest('td'))
    ) {
      var g = this.curTable.closest('td');
      var b = +getComputedStyle(g).paddingRight.match(/\d/g).join('');
      f = g.offsetWidth - (g.offsetWidth - g.clientWidth) - b * 2;
    } else
      m && m !== this.tableModel.getEditPanel() && m.clientWidth !== u
        ? (f = m.clientWidth - +getComputedStyle(m).paddingRight.match(/\d/g).join('') * 2)
        : (f = u);
    if (this.resizeBtnStat.column) {
      if (this.curTable.closest('li')) {
        f = this.curTable.closest('li').offsetWidth;
      }
      var C = this.curTable.querySelectorAll('colgroup > col');
      var N = void 0;
      this.curTable.style.width !== '' && this.curTable.style.width.includes('%')
        ? (N = parseFloat(this.curTable.style.width.split('%')[0]))
        : (N = this.getCurrentTableWidth(this.curTable.offsetWidth, this.tableModel.getEditPanel().offsetWidth));
      var w = C[this.colIndex];
      var T = this.getCurrentColWidth(C[this.colIndex], h);
      if (this.currentColumnResize === 'first') {
        n = n - 0.75;
        this.removeResizeElement();
        if (a) {
          o = this.curTable.getBoundingClientRect().right - this.calcPos(a).left;
          this.curTable.style.maxWidth = o + 'px';
        }
        if (((n !== 0 && 5 < T) || n < 0) && N <= 100 && oe(h - n, f) <= 100) {
          var S = C[this.colIndex];
          this.curTable.style.width = oe(h - n, f) > 100 ? '100%' : oe(h - n, f) + '%';
          var O = N - oe(h - n, f);
          var L = 0;
          var A = this.curTable.style.width.indexOf('%') > -1;
          if (!A && this.curTable.offsetWidth > this.tableModel.getEditPanel().offsetWidth) {
            this.curTable.style.width = u + 'px';
            return;
          }
          if (A && parseFloat(this.curTable.style.width.split('%')[0]) > 100) {
            this.curTable.style.width = '100%';
            return;
          }
          if (!p(this.curTable.style.marginLeft) && this.curTable.style.marginLeft !== '') {
            var k = /[-+]?\d*\.\d+|\d+/;
            var P = this.curTable.style.marginLeft.match(k);
            if (!p(P)) {
              L = parseFloat(P[0]);
            }
          }
          var I = L + O;
          if (I && I > 100) {
            var H = parseFloat(this.curTable.style.width);
            I = 100 - H;
          }
          if (!this.curTable.classList.contains('e-rte-paste-table') && I && I < 1) {
            this.curTable.style.marginLeft = null;
            this.curTable.style.width = '100%';
            return;
          }
          this.curTable.style.marginLeft = 'calc(' + (this.curTable.style.width === '100%' ? 0 : I) + '%)';
          var U = this.getCurrentColWidth(C[this.colIndex], h);
          C[this.colIndex].style.width = U - O + '%';
        }
      } else if (this.currentColumnResize === 'last') {
        n = n + 0.75;
        this.removeResizeElement();
        if (a) {
          o = a.getBoundingClientRect().right - this.curTable.getBoundingClientRect().left;
          this.curTable.style.maxWidth = o + 'px';
        }
        if (((n !== 0 && 5 < T) || n > 0) && N <= 100 && oe(h + n, f) <= 100) {
          var Q = C[this.colIndex];
          this.curTable.style.width = oe(h + n, f) > 100 ? '100%' : oe(h + n, f) + '%';
          var O = N - oe(h + n, f);
          var U = this.getCurrentColWidth(C[this.colIndex], h);
          C[this.colIndex].style.width = U - O + '%';
        }
      } else {
        var K = C[this.colIndex].offsetWidth - n;
        var Z = C[this.colIndex].offsetWidth + C[this.colIndex - 1].offsetWidth;
        if (Z - K > 20 && K > 20) {
          var G = Z - K;
          var j = K;
          C[this.colIndex - 1].style.width = oe(G, h) + '%';
          C[this.colIndex].style.width = oe(K, h) + '%';
        }
      }
      this.updateHelper();
    } else if (this.resizeBtnStat.row) {
      this.tableModel.preventDefaultResize(e);
      for (var $ = [], R = this.curTable.querySelectorAll('tr'), z = 0; z < R.length; z++)
        if (this.rowEle !== R[z]) {
          $[z] = parseFloat(R[z].clientHeight.toString());
        }
      this.curTable.style.height = parseFloat(this.curTable.clientHeight.toString()) + (r > 0 ? 0 : r) + 'px';
      for (var z = 0; z < R.length; z++)
        this.rowEle === R[z]
          ? (R[z].style.height = parseFloat(R[z].clientHeight.toString()) + r + 'px')
          : (R[z].style.height = $[z] + 'px');
      if (!p(l)) {
        l.style.cssText =
          'top: ' +
          (this.calcPos(this.curTable).top + c - 4) +
          'px; left:' +
          (this.calcPos(this.curTable).left + (this.tableModel.enableRtl ? 0 : h) - 4) +
          'px;';
      }
      this.updateHelper();
    } else if (this.resizeBtnStat.tableBox) {
      if (a) {
        var ce = this.curTable.getBoundingClientRect().left - a.getBoundingClientRect().left;
        o = Math.abs(ce - a.getBoundingClientRect().width) - 5;
        this.curTable.style.maxWidth = o + 'px';
      }
      this.curTable.style.height = c + r + 'px';
      if (!p(l)) {
        l.classList.add('e-rbox-select');
        l.style.cssText =
          'top: ' +
          (this.calcPos(this.curTable).top + parseInt(getComputedStyle(this.curTable).height, 10) - 4) +
          'px; left:' +
          (this.calcPos(this.curTable).left + (this.tableModel.enableRtl ? 0 : h) - 4) +
          'px;';
      }
      if (this.curTable.closest('li')) {
        f = this.curTable.closest('li').offsetWidth;
      }
      var A = this.curTable.style.width.indexOf('%') > -1;
      if (A && parseFloat(this.curTable.style.width.split('%')[0]) > 100) {
        this.curTable.style.width = '100%';
        return;
      }
      if (!A && this.curTable.offsetWidth > this.tableModel.getEditPanel().offsetWidth) {
        this.curTable.style.width = u + 'px';
        return;
      }
      this.curTable.style.width = A ? oe(h + n, f) + '%' : h + n + 'px';
    }
  };
  s.prototype.getCurrentTableWidth = function (e, t) {
    if (t === 0) return 0;
    var i = (e / t) * 100;
    return i;
  };
  s.prototype.getTableRowsWithoutRowspan = function (e) {
    for (var t = [], i = 0; i < e.rows.length; i++)
      for (var n = 0; n < e.rows[i].cells.length; n++)
        if (!e.rows[i].cells[n].hasAttribute('rowspan')) {
          t.push(e.rows[i].cells[n]);
          break;
        }
    return t;
  };
  s.prototype.createColumnResizers = function (e, t, i, n) {
    var r = e.filter(function (d) {
      return d != null;
    });
    var o = this.tableModel.enableRtl;
    var a = i.left;
    if (this.tableModel.enableRtl) for (var l = 0; l < r.length; l++) a = a + r[l].getBoundingClientRect().width;
    for (var l = 0; l <= r.length; l++) {
      if (l !== 0) {
        var h = r[l - 1];
        a =
          a +
          (this.tableModel.enableRtl
            ? -r[l - 1].getBoundingClientRect().width
            : r[l - 1].getBoundingClientRect().width);
      }
      if (this.tableModel.tableSettings.resize) {
        var c = E('span', {
          attrs: {
            'data-col': l.toString(),
            unselectable: 'on',
            contenteditable: 'false',
          },
        });
        c.classList.add(ci, qt);
        c.style.cssText = 'height:' + t + 'px;width:4px;top:' + i.top + 'px;left:' + (a - 1.5) + 'px;';
        this.tableModel.getEditPanel().appendChild(c);
      }
      if (l !== 0 && (l === r.length || n[0][l] !== n[0][l - 1])) {
        this.createTableInsertIcon({
          index: l,
          top: i.top,
          left: a,
          cellType: 'column',
          allCells: n,
          isRTL: this.tableModel.enableRtl,
        });
      }
    }
  };
  s.prototype.createTableInsertIcon = function (e) {
    var t;
    var i = e.cellType === 'column';
    var n = i ? 'data-col' : 'data-row';
    var r = i ? Fo : jo;
    var o = i ? 'e-column-resize' : 'e-row-resize';
    var a = i ? 'e-column-helper' : 'e-row-helper';
    var l = E('span', {
      attrs: ((t = {}), (t[n] = e.index.toString()), (t.unselectable = 'on'), (t.contenteditable = 'false'), t),
    });
    l.classList.add(ci, r);
    if (e.isRTL) {
      l.classList.add('e-insert-cell-rtl');
    }
    var h = i ? e.left - 12.5 : e.left - 14.3;
    var c = i ? e.top - 14.3 : e.top - 11.5;
    var d = 'left:' + h + 'px;top:' + c + 'px;';
    l.style.cssText = l.style.cssText + d;
    this.attachInsertIconEvents(l, n, o, a, e.allCells, e.isRTL);
  };
  s.prototype.attachInsertIconEvents = function (e, t, i, n, r, o) {
    D.add(e, 'mouseover', this.handleIconMouseOver.bind(this, e, t, i, n, o, r), this);
    D.add(e, 'mouseout', this.handleIconMouseOut.bind(this, e), this);
    var a = this.tableModel.getEditPanel();
    if (a) {
      a.appendChild(e);
    }
  };
  s.prototype.handleIconMouseOver = function (e, t, i, n, r, o) {
    var a = e.querySelector('.e-circle');
    if (a && a.classList && a.classList.contains('e-circle')) {
      y(a);
      e.style.cursor = this.isResizeBind ? 'pointer' : '';
      if (this.isResizeBind) {
        this.handleInsertIconHover(e, t, i, n, r, o);
      }
    }
  };
  s.prototype.handleIconMouseOut = function (e, t) {
    var i = t.relatedTarget;
    if (t.relatedTarget && !e.contains(t.relatedTarget) && e.style.opacity === '1') {
      this.removeResizeElement();
    }
  };
  s.prototype.handleIconMouseDown = function (e, t, i, n) {
    if (!(!n || !this.parent || !this.parent.undoRedoManager)) {
      n.preventDefault();
      n.stopPropagation();
      this.removeResizeElement();
      this.parent.undoRedoManager.saveData();
      var r = t === 'data-col';
      var o = e.getAttribute(t);
      var a = o ? parseInt(o, 10) : -1;
      if (!(a < 0 || !i)) {
        var l = r ? 'column' : 'row';
        this.insertTableElement(l, a, i);
      }
    }
  };
  s.prototype.removeInsertIconEvents = function (e) {
    if (e) {
      D.remove(e, 'mouseover', this.handleIconMouseOver);
      D.remove(e, 'mouseout', this.handleIconMouseOut);
    }
  };
  s.prototype.handleInsertIconHover = function (e, t, i, n, r, o) {
    var a = r ? 'e-circle-add e-insert-cell-rtl' : 'e-circle-add';
    var l = this.createIcon(a);
    D.add(l, 'mousedown', this.handleIconMouseDown.bind(this, e, t, o), this);
    e.appendChild(l);
    e.style.opacity = '1';
    var h = e.getAttribute(t);
    var c = 'e-rte-table-resize.' + i;
    var d = 'span[' + t + '="' + h + '"].' + c;
    var u = this.tableModel.getEditPanel();
    var f = u.querySelector(d);
    if (f) {
      f.classList.add('e-table-rhelper', n);
      f.classList.remove('e-rte-table-resize', i);
      f.style.backgroundColor = '';
      t === 'data-row' ? this.applyRowResizeStyles(f, r) : this.applyColumnResizeStyles(f);
    }
  };
  s.prototype.applyRowResizeStyles = function (e, t) {
    e.style.height = '2px';
    if (!t) {
      var i = this.parseNumericStyle(e.style.width);
      e.style.width = i - 0.5 + 'px';
      var n = this.parseNumericStyle(e.style.left);
      e.style.left = n + 0.5 + 'px';
    }
    var r = this.parseNumericStyle(e.style.top);
    e.style.top = r + 1 + 'px';
  };
  s.prototype.applyColumnResizeStyles = function (e) {
    e.style.width = '2px';
    var t = this.parseNumericStyle(e.style.height);
    e.style.height = t - 0.5 + 'px';
    var i = this.parseNumericStyle(e.style.top);
    e.style.top = i + 0.5 + 'px';
    var n = this.parseNumericStyle(e.style.left);
    e.style.left = n + 1 + 'px';
  };
  s.prototype.parseNumericStyle = function (e) {
    if (!e) return 0;
    var t = parseFloat(e);
    return isNaN(t) ? 0 : t;
  };
  s.prototype.insertTableElement = function (e, t, i) {
    if (!(!this.curTable || t < 0)) {
      var n;
      e === 'column'
        ? ((n = 'InsertColumnLeft'), t === i[0].length && ((n = 'InsertColumnRight'), (t = t - 1)))
        : (n = 'InsertRowAfter');
      var r = this.tableModel.getDocument();
      var o = e === 'column' ? i[0][t] : i[t][0];
      this.parent.nodeSelection.setCursorPoint(r, o, 0);
      if (e === 'row') {
        this.clearTableSelections();
        B([o], ne);
      }
      var a = this.parent.nodeSelection.getRange(r);
      var l = this.parent.nodeSelection.save(a, r);
      var h = {
        item: {
          selection: l,
          subCommand: n,
          width: this.tableModel.tableSettings.width,
        },
        callBack: null,
        subCommand: '',
        value: '',
        selector: '',
      };
      e === 'column' ? this.insertColumn(h) : this.insertRow(h);
      this.parent.undoRedoManager.saveData();
      this.tableModel.enableUndo();
    }
  };
  s.prototype.createRowResizers = function (e, t, i, n, r) {
    for (var o = 0; o < e.length; o++) {
      var a = e[o];
      var l = !p(t.getAttribute('cellspacing')) || t.getAttribute('cellspacing') !== '';
      var h = l ? 0 : this.calcPos(e[o]).left;
      var c = !!(e[o].classList && e[o].classList.contains('e-multi-cells-select'));
      var d = this.calcPos(e[o]).top + (c ? 0 : n.top) + e[o].getBoundingClientRect().height - 1.5;
      if (this.tableModel.tableSettings.resize) {
        var u = E('span', {
          attrs: {
            'data-row': o.toString(),
            unselectable: 'on',
            contenteditable: 'false',
          },
        });
        u.classList.add(ci, Ft);
        u.style.cssText = 'width:' + i + 'px;height:4px;top:' + d + 'px;left:' + (h + n.left) + 'px; z-index: 2';
        u.style.cssText = 'width:' + i + 'px;height:4px;top:' + d + 'px;left:' + (h + n.left) + 'px;';
        this.tableModel.getEditPanel().appendChild(u);
      }
      if (o + 1 === e.length || r[o][0] !== r[o + 1][0]) {
        this.createTableInsertIcon({
          index: o,
          top: d,
          left: this.tableModel.enableRtl ? i + h + n.left : h + n.left,
          cellType: 'row',
          allCells: r,
          isRTL: this.tableModel.enableRtl,
        });
      }
    }
  };
  s.prototype.createResizeBox = function (e, t, i, n) {
    var r = E('span', {
      className: Tt + this.tableModel.getCssClass(true),
      attrs: {
        'data-col': e.toString(),
        unselectable: 'on',
        contenteditable: 'false',
      },
    });
    i = this.tableModel.enableRtl ? 0 : i;
    r.style.cssText = 'top:' + (t.top + n - 4) + 'px;left:' + (t.left + i - 4) + 'px;';
    if (M.isDevice) {
      r.classList.add('e-rmob');
    }
    this.tableModel.getEditPanel().appendChild(r);
  };
  s.prototype.removeTableSelection = function () {
    var e = this.tableModel.getEditPanel().querySelector('table.e-cell-select');
    if (e) {
      Y([e], ne);
    }
    this.removeAllFakeSelectionEles();
  };
  s.prototype.removeAllFakeSelectionEles = function () {
    var e = this.tableModel.getEditPanel().querySelectorAll('.e-table-fake-selection');
    if (e && e.length > 0) {
      e.forEach(function (t) {
        y(t);
      });
    }
  };
  s.prototype.tableArrowNavigation = function (e, t, i) {
    this.previousTableElement = i;
    if (!this.shouldSkipArrowNavigation(e, t)) {
      e.preventDefault();
      this.clearSelectionState(i);
      var n = this.getTargetCellForArrowNavigation(e, i);
      if (n) {
        t.setSelectionText(this.tableModel.getDocument(), n, n, 0, 0);
      }
    }
  };
  s.prototype.shouldSkipArrowNavigation = function (e, t) {
    var i = t.range.startContainer;
    return !!(
      (e.keyCode === 40 &&
        t.range.startContainer.nodeType === 3 &&
        ((t.range.startContainer.nextSibling && t.range.startContainer.nextSibling.nodeName === 'BR') ||
          (t.range.startContainer.parentNode && !t.range.startContainer.parentNode.closest('td')))) ||
      (e.keyCode === 38 &&
        t.range.startContainer.nodeType === 3 &&
        ((t.range.startContainer.previousSibling && t.range.startContainer.previousSibling.nodeName === 'BR') ||
          (t.range.startContainer.parentNode && !t.range.startContainer.parentNode.closest('td'))))
    );
  };
  s.prototype.clearSelectionState = function (e) {
    Y([e], ne);
    this.removeCellSelectClasses();
    this.removeTableSelection();
  };
  s.prototype.getTargetCellForArrowNavigation = function (e, t) {
    return e.keyCode === 40 ? this.getNextRowCell(t) : this.getPreviousRowCell(t);
  };
  s.prototype.getNextRowCell = function (e) {
    var t = v(e, 'tr');
    var i = v(e, 'table');
    if (t && t.nextElementSibling) {
      var n = e.cellIndex;
      return t.nextElementSibling.children[e.cellIndex];
    }
    return i.tHead && e.nodeName === 'TH' && i.rows.length > 1
      ? i.rows[1].cells[e.cellIndex]
      : i.nextSibling
        ? i.nextSibling
        : e;
  };
  s.prototype.getPreviousRowCell = function (e) {
    var t = v(e, 'tr');
    var i = v(e, 'table');
    if (t && t.previousElementSibling) {
      var n = e.cellIndex;
      return t.previousElementSibling.children[e.cellIndex];
    }
    return i.tHead && e.nodeName !== 'TH'
      ? i.tHead.rows[0].cells[e.cellIndex]
      : i.previousSibling
        ? i.previousSibling
        : e;
  };
  s.prototype.tabSelection = function (e, t, i) {
    this.cleanTableRows(i);
    this.previousTableElement = i;
    var n = this.insideList(t.range);
    if (!n) {
      this.clearSelectionState(i);
    }
    if (!(this.shouldSkipTabNavigation(e) || n)) {
      e.preventDefault();
      !e.shiftKey && e.keyCode !== 37
        ? this.handleForwardTabNavigation(i, t, e)
        : this.handleBackwardTabNavigation(i, t, e);
    }
  };
  s.prototype.cleanTableRows = function (e) {
    var t = e.closest('table');
    if (t)
      for (var i = t.querySelectorAll('thead, tbody, tr'), n = 0; n < i.length; n++) this.removeEmptyTextNodes(i[n]);
  };
  s.prototype.removeEmptyTextNodes = function (e) {
    for (var t = e.childNodes, i = t.length - 1; i >= 0; i--) {
      var n = t[i];
      if (t[i].nodeType === Node.TEXT_NODE && t[i].nodeValue.trim() === '') {
        e.removeChild(t[i]);
      }
    }
  };
  s.prototype.shouldSkipTabNavigation = function (e) {
    return e.keyCode === 37 || e.keyCode === 39;
  };
  s.prototype.insideList = function (e) {
    var t = this.getBlockNodesInSelection(e);
    var i = this.getListNodesFromBlocks(t);
    return i.length > 1 || (i.length && e.startOffset === 0 && e.endOffset === 0)
      ? ((this.ensureInsideTableList = true), true)
      : ((this.ensureInsideTableList = false), false);
  };
  s.prototype.getListNodesFromBlocks = function (e) {
    for (var t = [], i = 0; i < e.length; i++) {
      var n = e[i];
      var r = e[i].parentNode;
      e[i].parentNode.tagName === 'LI'
        ? t.push(e[i].parentNode)
        : e[i].tagName === 'LI' && this.isSimpleListItem(e[i]) && t.push(e[i]);
    }
    return t;
  };
  s.prototype.isSimpleListItem = function (e) {
    if (!e.childNodes.length) return false;
    var t = e.childNodes[0];
    return e.childNodes[0].tagName !== 'P' && e.childNodes[0].tagName !== 'OL' && e.childNodes[0].tagName !== 'UL';
  };
  s.prototype.getBlockNodesInSelection = function (e) {
    var t = [
      'DIV',
      'SECTION',
      'HEADER',
      'FOOTER',
      'ARTICLE',
      'NAV',
      'P',
      'H1',
      'H2',
      'H3',
      'BLOCKQUOTE',
      'LI',
      'PRE',
      'TD',
      'TH',
      'FORM',
      'FIELDSET',
      'LEGEND',
      'LABEL',
      'TEXTAREA',
    ];
    var i = new Set();
    e.collapsed ? this.handleCollapsedRangeBlockNodes(e, t, i) : this.handleExpandedRangeBlockNodes(e, t, i);
    return Array.from(i);
  };
  s.prototype.handleCollapsedRangeBlockNodes = function (e, t, i) {
    var n = this.getImmediateBlockNode(e.startContainer, t);
    if (n) {
      i.add(n);
    }
  };
  s.prototype.handleExpandedRangeBlockNodes = function (e, t, i) {
    for (
      var n = this.tableModel.getDocument().createTreeWalker(e.commonAncestorContainer, NodeFilter.SHOW_TEXT, {
        acceptNode: function (o) {
          return e.intersectsNode(o) ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_REJECT;
        },
      });
      n.nextNode();

    ) {
      var r = this.getImmediateBlockNode(n.currentNode, t);
      if (r) {
        i.add(r);
      }
    }
  };
  s.prototype.getImmediateBlockNode = function (e, t) {
    for (var i = e.nodeType === Node.TEXT_NODE ? e.parentNode : e; i && i.nodeType === Node.ELEMENT_NODE; ) {
      var n = i;
      if (t.indexOf(i.tagName) > -1) return i;
      i = i.parentNode;
    }
    return null;
  };
  s.prototype.handleForwardTabNavigation = function (e, t, i) {
    var n = this.findNextElementForward(e);
    if (e === n && e.nodeName === 'TH') {
      n = v(e, 'table').rows[1].cells[0];
    }
    if (i.keyCode === 39 && e === n) {
      n = v(e, 'table').nextSibling;
    }
    if (n) {
      this.setSelectionForElement(n, t);
    }
    if (e === n && i.keyCode !== 39 && n) {
      this.addNewRowAndNavigate(e, n, t, i);
    }
  };
  s.prototype.findNextElementForward = function (e) {
    if (!p(e.nextSibling)) return e.nextSibling;
    var t = v(e, 'tr').nextSibling;
    if (!p(v(e, 'tr').nextSibling)) return v(e, 'tr').nextSibling.childNodes[0];
    var i = v(e, 'table').nextSibling;
    return p(v(e, 'table').nextSibling)
      ? e
      : v(e, 'table').nextSibling.nodeName.toLowerCase() === 'td'
        ? v(e, 'table').nextSibling
        : e;
  };
  s.prototype.addNewRowAndNavigate = function (e, t, i, n) {
    e.classList.add(ne);
    this.tableModel.addRow(i, n, true);
    this.clearSelectionState(e);
    var r = t.parentElement;
    t = t.parentElement.nextSibling ? t.parentElement.nextSibling.firstChild : t.parentElement.firstChild;
    this.setSelectionForElement(t, i);
  };
  s.prototype.removeCellSelectClasses = function () {
    Y(this.tableModel.getEditPanel().querySelectorAll('table td, table th'), zr);
    Y(this.tableModel.getEditPanel().querySelectorAll('table td, table th'), _r);
    Y(this.tableModel.getEditPanel().querySelectorAll('table td, table th'), ne);
  };
  s.prototype.handleBackwardTabNavigation = function (e, t, i) {
    var n = this.findPreviousElementBackward(e);
    if (this.shouldNavigateToTableHeader(e, n)) {
      var r = v(e, 'table');
      n = r.rows[0].cells[r.rows[0].cells.length - 1];
    }
    if (e === n && i.keyCode === 37) {
      n = v(e, 'table').previousSibling;
    }
    n = this.handleNestedTableNavigation(n);
    if (n) {
      this.setSelectionForElement(n, t);
    }
  };
  s.prototype.findPreviousElementBackward = function (e) {
    if (!p(e.previousSibling)) return e.previousSibling;
    var t = v(e, 'tr').previousSibling;
    if (!p(v(e, 'tr').previousSibling))
      return v(e, 'tr').previousSibling.childNodes[v(e, 'tr').previousSibling.childNodes.length - 1];
    var i = v(e, 'table').previousSibling;
    return p(v(e, 'table').previousSibling)
      ? e
      : v(e, 'table').previousSibling.nodeName.toLowerCase() === 'td'
        ? v(e, 'table').previousSibling
        : e;
  };
  s.prototype.shouldNavigateToTableHeader = function (e, t) {
    return e === t && e.cellIndex === 0 && v(e, 'table').tHead && e.nodeName !== 'TH';
  };
  s.prototype.handleNestedTableNavigation = function (e) {
    if (!p(e) && e.firstChild && e.firstChild.nodeName === 'TABLE') {
      for (
        var t = e;
        !p(t.firstChild) &&
        t.firstChild.nodeName === 'TABLE' &&
        t.firstChild.rows.length > 0 &&
        t.firstChild.rows[0].cells.length > 0;

      )
        t = t.firstChild.rows[0].cells[0];
      return t;
    }
    return e;
  };
  s.prototype.setSelectionForElement = function (e, t) {
    e.textContent.trim() !== '' && v(e, 'td')
      ? t.setSelectionNode(this.tableModel.getDocument(), e)
      : t.setSelectionText(this.tableModel.getDocument(), e, e, 0, 0);
  };
  s.prototype.resetTableSelection = function () {
    var e = this.tableModel.getEditPanel().querySelectorAll('.e-cell-select-end');
    if (!p(e) && e.length > 0) {
      this.parent.nodeSelection.setSelectionNode(this.tableModel.getDocument(), this.curTable);
    }
    this.removeCellSelectClasses();
    this.removeTableSelection();
  };
  s.prototype.handleShiftKeyTableSelection = function (e) {
    var t = e.keyCode === 39 || e.keyCode === 37 || e.keyCode === 38 || e.keyCode === 40;
    if (e.shiftKey && t) {
      this.keyDownEventInstance = e;
      D.add(this.tableModel.getDocument(), 'selectionchange', this.tableCellsKeyboardSelection, this);
    }
  };
  s.prototype.tableCellsKeyboardSelection = function (e) {
    D.remove(this.tableModel.getDocument(), 'selectionchange', this.tableCellsKeyboardSelection);
    this.setupSelectionState();
    var t = this.tableModel.getEditPanel().querySelectorAll('.e-cell-select-end');
    var i = this.isTableMultiSelectActive();
    if (i || (!p(t) && t.length > 0)) this.handleTableCellArrowNavigation(t);
    else {
      if (!this.curTable || !this.parent || !this.tableModel) return;
      var n = this.curTable.querySelectorAll('.e-cell-select');
      if (!n || n.length < 1) {
        var r = this.parent.nodeSelection.getRange(this.tableModel.getDocument());
        if (!r) return;
        var o = null;
        r.endContainer.nodeType === Node.ELEMENT_NODE
          ? (o = r.endContainer)
          : (o = r.endContainer.parentElement || null);
        if (o && o.tagName !== 'TD' && o.tagName !== 'TH') {
          o = v(o, 'TD') || v(o, 'TH') || null;
        }
        if (o && this.curTable.contains(o)) {
          this.moveToTargetCell(o);
        }
      }
    }
    if (t.length > 0) {
      this.keyDownEventInstance.preventDefault();
      e.preventDefault();
    }
  };
  s.prototype.handleTableCellArrowNavigation = function (e) {
    var t = ie(this.curTable);
    var i = !p(e) && e.length > 0 ? e[0] : this.activeCell;
    var n = Oe(i, t);
    var r = n[0];
    var o = n[1];
    var a;
    switch (this.keyDownEventInstance.keyCode) {
      case 39:
        a = this.handleRightArrowNavigation(t, n[0], n[1], e);
        break;
      case 37:
        a = this.handleLeftArrowNavigation(t, n[0], n[1], e);
        break;
      case 38:
        a = this.handleUpArrowNavigation(t, n[0], n[1]);
        break;
      case 40:
        a = this.handleDownArrowNavigation(t, n[0], n[1]);
        break;
    }
    if (a) {
      this.moveToTargetCell(a);
    }
  };
  s.prototype.moveToTargetCell = function (e) {
    this.parent.observer.notify('TABLE_MOVE', {
      event: { target: e },
      selectNode: [this.activeCell],
    });
  };
  s.prototype.setupSelectionState = function () {
    var e = this.tableModel.getEditPanel().querySelectorAll('.e-cell-select-end');
    if (!p(e) && e.length > 0) {
      this.parent.nodeSelection.Clear(this.tableModel.getDocument());
      this.parent.nodeSelection.setSelectionText(this.tableModel.getDocument(), e[0], e[0], 0, 0);
      this.parent.nodeSelection.setCursorPoint(this.tableModel.getDocument(), e[0], 0);
    }
  };
  s.prototype.isTableMultiSelectActive = function () {
    var e = this.parent.nodeSelection.getRange(this.tableModel.getDocument());
    if (p(e) || p(e.commonAncestorContainer) || p(this.activeCell)) return false;
    var t = e.commonAncestorContainer;
    if (e.commonAncestorContainer.nodeType !== Node.ELEMENT_NODE) return false;
    var i = e.commonAncestorContainer;
    var n = e.commonAncestorContainer.tagName;
    var r =
      e.commonAncestorContainer.tagName === 'TR' ||
      e.commonAncestorContainer.tagName === 'TBODY' ||
      e.commonAncestorContainer.tagName === 'THEAD' ||
      e.commonAncestorContainer.tagName === 'TABLE';
    if (e.commonAncestorContainer.tagName === 'TABLE') {
      var o = e.commonAncestorContainer.querySelectorAll('.e-cell-select, .e-multi-cells-select');
      if (o.length > 1) return true;
      var a = this.activeCell;
      var l = e.startContainer;
      var h = null;
      e.startContainer.nodeType === Node.ELEMENT_NODE ? (h = e.startContainer) : (h = e.startContainer.parentElement);
      if (h && h.tagName !== 'TD' && h.tagName !== 'TH') {
        h = v(h, 'td,th');
      }
      if (h && h !== this.activeCell) return true;
      var c = e.endContainer;
      var d = null;
      e.endContainer.nodeType === Node.ELEMENT_NODE ? (d = e.endContainer) : (d = e.endContainer.parentElement);
      if (d && d.tagName !== 'TD' && d.tagName !== 'TH') {
        d = v(d, 'td,th');
      }
      return d !== null && d !== this.activeCell;
    }
    return r;
  };
  s.prototype.handleRightArrowNavigation = function (e, t, i, n) {
    return i < e[0].length - 1
      ? e[t][i + 1]
      : t < e.length - 1
        ? (n.length === 0 && t < e.length - 1 && (this.activeCell = e[t][0]), e[t + 1][i])
        : (this.resetTableSelection(), null);
  };
  s.prototype.handleLeftArrowNavigation = function (e, t, i, n) {
    return 0 < i
      ? e[t][i - 1]
      : 0 < t
        ? (n.length === 0 && 0 < t && (this.activeCell = e[t][e[t].length - 1]), e[t - 1][i])
        : (this.resetTableSelection(), null);
  };
  s.prototype.handleUpArrowNavigation = function (e, t, i) {
    return 0 < t ? e[t - 1][i] : (this.resetTableSelection(), null);
  };
  s.prototype.handleDownArrowNavigation = function (e, t, i) {
    return t < e.length - 1 ? e[t + 1][i] : (this.resetTableSelection(), null);
  };
  s.prototype.isTableInteractionPossible = function (e) {
    return !p(this.parent.nodeSelection) && this.tableModel.getEditPanel() && e.code !== 'KeyK';
  };
  s.prototype.handleTableKeyboardInteractions = function (e) {
    var t = this.parent.nodeSelection.getRange(this.tableModel.getDocument());
    var i = this.parent.nodeSelection.getParentNodeCollection(t)[0];
    i = i && i.tagName !== 'TD' && i.tagName !== 'TH' ? i.parentElement : i;
    this.handleTableDeleteOperations(e, t, i);
    i = this.findClosestTableCell(i);
    this.handleTableCellNavigation(e, t, i);
  };
  s.prototype.handleTableDeleteOperations = function (e, t, i) {
    var n = e.keyCode === 8 || e.keyCode === 46;
    var r = e.ctrlKey && e.keyCode === 88;
    if (n || r)
      if (i && i.tagName === 'TBODY') {
        if (!p(this.parent) && this.tableModel.getDocument() && this.tableModel.getDocument()) {
          var o = this.parent.nodeSelection.save(t, this.tableModel.getDocument());
          e.preventDefault();
          this.tableModel.removeTable(o, e, true);
        }
      } else if (i && i.querySelectorAll('table').length > 0) {
        this.removeResizeElement();
        this.tableModel.hideTableQuickToolbar();
      }
  };
  s.prototype.findClosestTableCell = function (e) {
    if (e && e.tagName !== 'TD' && e.tagName !== 'TH') {
      var t = v(e, 'td');
      return !p(t) && this.tableModel.getEditPanel().contains(t) ? t : e;
    }
    return e;
  };
  s.prototype.handleTableCellNavigation = function (e, t, i) {
    if (i && (i.tagName === 'TD' || i.tagName === 'TH')) {
      var n = this.tableModel.getEditPanel().querySelectorAll('.e-cell-select-end');
      if (
        (p(this.activeCell) || this.activeCell !== i) &&
        !p(n) &&
        n.length === 0 &&
        (t.collapsed || e.keyCode === 9)
      ) {
        this.activeCell = i;
      }
      var r = void 0;
      if (!p(this.parent.nodeSelection)) {
        r = this.parent.nodeSelection.save(t, this.tableModel.getDocument());
      }
      if (!e.shiftKey || (e.shiftKey && e.keyCode === 9))
        switch (e.keyCode) {
          case 9:
          case 37:
          case 39:
            this.tabSelection(e, r, i);
            break;
          case 40:
          case 38:
            this.tableArrowNavigation(e, r, i);
            break;
        }
    }
  };
  s.prototype.handleGlobalKeyboardShortcuts = function (e) {
    if (e.ctrlKey && e.key === 'a') {
      this.handleSelectAll();
    }
  };
  s.prototype.handleSelectAll = function () {
    this.cancelResizeAction();
    var e = this.tableModel.getEditPanel().querySelectorAll('.' + ne);
    Y(e, ne);
    this.removeTableSelection();
  };
  s.prototype.handleTableDeletion = function (e) {
    var t = e.code === 'Delete' && e.which === 46;
    var i = e.code === 'Backspace' && e.which === 8;
    if ((t || i) && this.tableModel.editorMode === 'HTML') {
      var n = this.parent.nodeSelection.getRange(this.tableModel.getDocument());
      if (this.isFakeTableSelectionElement(n.startContainer)) {
        this.deleteTable();
        e.preventDefault();
        return;
      }
      var r = this.getAdjacentTableElement(n, t);
      if (r) {
        this.updateTableSelection(r);
        e.preventDefault();
      }
    }
  };
  s.prototype.updateTableSelection = function (e) {
    B([e], 'e-cell-select');
  };
  s.prototype.getAdjacentTableElement = function (e, t) {
    if (!e.collapsed || (!t && this.tableModel.isTableQuickToolbarVisible())) return null;
    var i = this.getNodeCollection(e);
    var n =
      e.collapsed && this.tableModel.getEditPanel() === e.startContainer && i && i.length > 0 && i[0]
        ? i[0]
        : e.startContainer;
    var r = this.getSelectedTableEle(i);
    var o = this.getBrElement(e, i);
    if (this.shouldSkipForMediaElement(n, e, t) || this.shouldSkipForTextNode(n, e, t)) return null;
    if (n && n.nodeType === Node.ELEMENT_NODE && n.tagName === 'TABLE') {
      r = n;
    }
    if (r) {
      var a = this.parent.nodeSelection.getIndex(r);
      if (!((e.startOffset === a && t) || (e.startOffset !== a && !t))) {
        r = null;
      }
    }
    if (!r && n) {
      r = this.getAdjacentElementFromDom(n, o, t);
    }
    return r && r.nodeType === Node.ELEMENT_NODE && r.tagName === 'TABLE' ? (this.setSelection(r, o), r) : null;
  };
  s.prototype.shouldSkipForMediaElement = function (e, t, i) {
    if (e && e.nodeType === Node.ELEMENT_NODE) {
      var n =
        e.tagName === 'IMG' ||
        !!e.querySelector('img') ||
        e.tagName === 'AUDIO' ||
        !!e.querySelector('audio') ||
        e.tagName === 'VIDEO' ||
        !!e.querySelector('video') ||
        !!e.querySelector('.e-video-clickelem');
      if (n) {
        var r = this.tableModel.getDocument().createRange();
        r.collapse(true);
        r.selectNodeContents(e);
        var o = this.parent.nodeSelection.getIndex(e);
        return (
          (i && r.startOffset >= t.startOffset) ||
          (!i &&
            ((e.tagName !== 'IMG' && r.startOffset !== t.startOffset) || (e.tagName === 'IMG' && o !== t.startOffset)))
        );
      }
    }
    return false;
  };
  s.prototype.shouldSkipForTextNode = function (e, t, i) {
    if (e && e.nodeType === Node.TEXT_NODE) {
      if (i) {
        if (
          t.endOffset !== t.endContainer.textContent.length &&
          t.endOffset !== t.endContainer.textContent.trim().length
        )
          return true;
      } else if (t.startOffset !== 0) return true;
    }
    return false;
  };
  s.prototype.getAdjacentElementFromDom = function (e, t, i) {
    for (var n, r = t || e.parentNode, o = e; r && !n && r.parentNode; ) {
      var a = Array.from(r.childNodes);
      var l = a.indexOf(o);
      l !== -1 && ((i && l < a.length - 1) || (!i && l > 0))
        ? (n = a[i ? l + 1 : l - 1])
        : ((n = i ? r.nextSibling : r.previousSibling), (o = r));
      if (this.isBrElement(t, e, n)) {
        t = o = r = n;
        n = null;
        continue;
      }
      if (this.isEmptyTextNode(t, n)) {
        o = r = n.parentNode;
        n = null;
        continue;
      }
      if (this.isListElement(n) && ((n = this.getAdjacentElementFromList(n, i)), !n)) return null;
      if (this.isLiElement(r, i)) {
        n = r;
      }
      r = r.parentNode;
    }
    return n;
  };
  s.prototype.isBrElement = function (e, t, i) {
    return !e && t.nodeType === Node.TEXT_NODE && i && i.tagName && i.tagName.toUpperCase() === 'BR';
  };
  s.prototype.isEmptyTextNode = function (e, t) {
    return (
      !e &&
      t &&
      !(t.nodeType === Node.ELEMENT_NODE && t.tagName === 'TABLE') &&
      !p(t.textContent) &&
      !t.textContent.trim()
    );
  };
  s.prototype.isListElement = function (e) {
    return e && e.tagName && ['UL', 'OL', 'LI'].indexOf(e.tagName.toUpperCase()) !== -1;
  };
  s.prototype.isLiElement = function (e, t) {
    return e && e.tagName && e.tagName.toUpperCase() === 'LI' && !t;
  };
  s.prototype.getAdjacentElementFromList = function (e, t) {
    for (; e; ) {
      if (e.tagName && ['UL', 'OL', 'LI'].indexOf(e.tagName.toUpperCase()) === -1) {
        if (!(e.nodeType === Node.ELEMENT_NODE && e.tagName === 'TABLE')) {
          e = t ? e.firstChild : e.lastChild;
        }
        break;
      }
      e = t ? e.firstChild : e.lastChild;
    }
    return e;
  };
  s.prototype.getNodeCollection = function (e) {
    var t = [];
    if (e.collapsed && this.tableModel.getEditPanel() === e.startContainer && e.startContainer.childNodes.length > 0) {
      var i = Math.max(0, Math.min(e.startContainer.childNodes.length - 1, e.endOffset - 1));
      t.push(e.startContainer.childNodes[i]);
    } else t = this.parent.nodeSelection.getNodeCollection(e);
    return t;
  };
  s.prototype.getSelectedTableEle = function (e) {
    if (e && e.length > 0)
      for (var t = 0, i = Array.from(e); t < i.length; t++) {
        var n = i[t];
        if (i[t] && i[t].tagName === 'TABLE') return i[t];
      }
    return null;
  };
  s.prototype.getBrElement = function (e, t) {
    return e.endContainer.tagName === 'BR'
      ? e.endContainer
      : t.length === 1 && t[0] && t[0].tagName === 'BR'
        ? t[0]
        : null;
  };
  s.prototype.setSelection = function (e, t) {
    if (!e.classList.contains('e-cell-select')) {
      this.parent.nodeSelection.Clear(this.tableModel.getDocument());
      if (t) {
        t.parentNode && t.parentNode.childNodes.length === 1 && t.parentNode.firstChild.nodeName === 'BR'
          ? y(t.parentNode)
          : y(t);
      }
      var i = E('div', { className: 'e-table-fake-selection' });
      i.setAttribute('contenteditable', 'false');
      this.tableModel.getEditPanel().appendChild(i);
      this.parent.nodeSelection.setSelectionNode(this.tableModel.getDocument(), i);
    }
  };
  s.prototype.deleteTable = function () {
    var e = this.tableModel.getEditPanel().querySelector('table.e-cell-select');
    this.removeResizeElement();
    if (e) {
      var t = document.createElement('br');
      var i = t;
      this.tableModel.enterKey === 'DIV'
        ? ((i = document.createElement('div')), i.appendChild(t))
        : this.tableModel.enterKey === 'P' && ((i = document.createElement('p')), i.appendChild(t));
      e.parentNode.replaceChild(i, e);
      this.parent.nodeSelection.setSelectionText(this.tableModel.getDocument(), i, i, 0, 0);
      this.removeTableSelection();
    }
  };
  s.prototype.isFakeTableSelectionElement = function (e) {
    return e.nodeType === Node.ELEMENT_NODE && e.nodeName === 'DIV' && e.classList.contains('e-table-fake-selection');
  };
  s.prototype.handleDeselectionOnTyping = function (e) {
    var t = e.shiftKey && e.key === 'Enter';
    var i = zo.indexOf(e.key) !== -1;
    var n = e.key && e.key.length === 1;
    if (t || i || n) {
      var r = this.tableModel.getEditPanel().querySelector('table.e-cell-select');
      if (r) {
        if (e.keyCode === 39 || e.keyCode === 37)
          this.parent.nodeSelection.setCursorPoint(this.tableModel.getDocument(), r, 0);
        else {
          var o = r.querySelector('tr').cells[0];
          this.parent.nodeSelection.setSelectionText(
            this.tableModel.getDocument(),
            r.querySelector('tr').cells[0],
            r.querySelector('tr').cells[0],
            0,
            0,
          );
        }
        this.removeTableSelection();
      }
    }
  };
  s.prototype.setDefaultEmptyContent = function () {
    if (this.tableModel.getEditPanel().innerHTML === null || this.tableModel.getEditPanel().innerHTML === '') {
      var e = this.tableModel.getEditPanel();
      this.tableModel.enterKey === 'DIV'
        ? (e.innerHTML = '<div><br/></div>')
        : this.tableModel.enterKey === 'BR'
          ? (e.innerHTML = '<br/>')
          : (e.innerHTML = '<p><br/></p>');
    }
  };
  s.prototype.tableModulekeyUp = function (e) {
    if (!p(this.parent.nodeSelection) && this.tableModel.getEditPanel()) {
      var t = this.parent.nodeSelection.getRange(this.tableModel.getDocument());
      var i = this.getSelectedElementFromRange(t);
      if (
        i &&
        (i.tagName === 'TD' || i.tagName === 'TH') &&
        !i.classList.contains(ne) &&
        (t.collapsed || e.args.keyCode === 9)
      ) {
        i.classList.add(ne);
      }
      this.handleTableElementTransition(i, e.args);
    }
  };
  s.prototype.getSelectedElementFromRange = function (e) {
    var t = this.parent.nodeSelection.getParentNodeCollection(e)[0];
    t = t && t.tagName !== 'TD' && t.tagName !== 'TH' ? t.parentElement : t;
    if (t && t.tagName !== 'TD' && t.tagName !== 'TH') {
      var i = v(t, 'td');
      t = !p(i) && this.tableModel.getEditPanel().contains(i) ? i : t;
    }
    return t;
  };
  s.prototype.handleTableElementTransition = function (e, t) {
    var i = this.previousTableElement !== e;
    var n = !p(this.previousTableElement);
    var r = !t.shiftKey && (t.keyCode === 39 || t.keyCode === 37 || t.keyCode === 38 || t.keyCode === 40);
    if (i && n && r) {
      Y([this.previousTableElement], ne);
      this.removeTableSelection();
    }
    if ((t.which === 8 && t.code === 'Backspace') || (t.which === 46 && t.code === 'Delete')) {
      this.tableModel.hideTableQuickToolbar();
    }
  };
  s.prototype.cellSelect = function (e) {
    if (!(!e || !e.args)) {
      var t = this.getTargetCell(e);
      if (this.isShiftKeyTableMove(e, t)) {
        this.handleShiftKeyTableMove(e);
        return;
      }
      this.resetTableSelectionState(e, t);
      if (this.isValidTableCell(t)) {
        this.setActiveCell(t);
      }
    }
  };
  s.prototype.resetTableSelectionState = function (e, t) {
    var i = e.args;
    var n = this.tableModel.quickToolbarSettings.showOnRightClick && e.args.which === 3 && t.classList.contains(ne);
    if (!n) {
      if (this && this.isTableMoveActive) {
        this.unwireTableSelectionEvents();
        this.isTableMoveActive = false;
        this.activeCell = null;
      }
      this.heightcheck();
      if (this) {
        this.removeCellSelectClasses();
        this.removeTableSelection();
      }
    }
  };
  s.prototype.unwireTableSelectionEvents = function () {
    if (this.curTable) {
      D.remove(this.curTable, 'mousemove', this.tableMouseMove);
      D.remove(this.tableModel.getDocument(), 'mouseup', this.tableMouseUp);
      D.remove(this.tableModel.getDocument(), 'dragend', this.tableMouseUp);
      D.remove(this.curTable, 'mouseleave', this.tableMouseLeave);
    }
  };
  s.prototype.tableMouseMove = function (e) {
    this.parent.observer.notify('TABLE_MOVE', {
      event: e,
      selectNode: [this.activeCell],
    });
  };
  s.prototype.tableMouseUp = function () {
    this.unwireTableSelectionEvents();
    this.handleTableSelectionEnd();
    this.isTableMoveActive = false;
  };
  s.prototype.handleTableSelectionEnd = function () {
    if (this.activeCell && !this.activeCell.classList.contains(ne) && this.isTableMoveActive) {
      this.activeCell = null;
    }
  };
  s.prototype.tableMouseLeave = function () {
    if (!M.isDevice) {
      this.resetTableSelection();
    }
  };
  s.prototype.getTargetCell = function (e) {
    var t = e.args;
    var i = e.args.target;
    var n = v(e.args.target, 'td,th');
    var r = e.args.target.nodeName !== 'TD';
    var o = n != null;
    var a = o && this.tableModel.getEditPanel().contains(n);
    return r && o && a ? n : e.args.target;
  };
  s.prototype.isShiftKeyTableMove = function (e, t) {
    var i = e.args;
    return (
      this &&
      !p(this.activeCell) &&
      e.args.shiftKey &&
      !p(t) &&
      !p(t.tagName) &&
      (t.tagName === 'TD' || t.tagName === 'TH') &&
      this.activeCell !== t
    );
  };
  s.prototype.handleShiftKeyTableMove = function (e) {
    this.parent.observer.notify('TABLE_MOVE', {
      event: e.args,
      selectNode: [this.activeCell],
    });
    e.args.preventDefault();
  };
  s.prototype.isValidTableCell = function (e) {
    return e && e.tagName && (e.tagName === 'TD' || e.tagName === 'TH');
  };
  s.prototype.setActiveCell = function (e) {
    B([e], ne);
    this.activeCell = e;
    if (!this.curTable) {
      this.curTable = v(e, 'table');
    }
    this.wireTableSelectionEvents();
    this.isTableMoveActive = true;
    this.removeResizeElement();
    if (this.helper && this.tableModel.getEditPanel().contains(this.helper)) {
      y(this.helper);
    }
  };
  s.prototype.heightcheck = function () {
    var e = this.tableModel.getEditPanel();
    var t = e.querySelector('td.e-cell-select');
    if (t) {
      var i = t.querySelector('img');
      if (!(!i || !i.style || typeof i.style.height != 'string')) {
        if (i.style.height.indexOf('%') !== -1) {
          t.style.height = 'inherit';
        }
      }
    }
  };
  s.prototype.wireTableSelectionEvents = function () {
    if (this.curTable) {
      D.add(this.curTable, 'mousemove', this.tableMouseMove, this);
      D.add(this.tableModel.getDocument(), 'mouseup', this.tableMouseUp, this);
      D.add(this.tableModel.getDocument(), 'dragend', this.tableMouseUp, this);
      D.add(this.curTable, 'mouseleave', this.tableMouseLeave, this);
    }
  };
  s.prototype.tableCellSelect = function (e) {
    if (e) {
      var t = e.target;
      if (e.target) {
        var i = e.target.parentElement;
        var n = e.target.parentElement ? e.target.parentElement.parentElement : null;
        if (!(!e.target.parentElement || !n)) {
          var r = Array.prototype.slice.call(n.children).indexOf(e.target.parentElement);
          var o = Array.prototype.slice.call(e.target.parentElement.children).indexOf(e.target);
          var a = this.dlgDiv.querySelectorAll('.e-rte-tablecell');
          Array.prototype.forEach.call(a, function (l) {
            var h = l.parentElement;
            var c = l.parentElement ? l.parentElement.parentElement : null;
            if (!(!l.parentElement || !c)) {
              var d = Array.prototype.slice.call(c.children).indexOf(l.parentElement);
              var u = Array.prototype.slice.call(l.parentElement.children).indexOf(l);
              Y([l], 'e-active');
              if (d <= r && u <= o) {
                B([l], 'e-active');
              }
            }
          });
          this.tblHeader.innerHTML = o + 1 + 'x' + (r + 1);
        }
      }
    }
  };
  s.prototype.tableCellLeave = function () {
    Y(this.dlgDiv.querySelectorAll('.e-rte-tablecell'), 'e-active');
    var e = this.dlgDiv.querySelector('.e-rte-tablecell');
    if (e) {
      B([e], 'e-active');
    }
    this.tblHeader.innerHTML = '1x1';
  };
  s.prototype.afterKeyDown = function () {
    var e = this;
    if (this.curTable) {
      this.resizeIconPositionTime = setTimeout(function () {
        e.updateResizeIconPosition();
      }, 1);
    }
  };
  s.prototype.updateResizeIconPosition = function () {
    if (this.curTable) {
      var e = this.tableModel.getEditPanel().querySelector('.e-table-box');
      if (!p(e)) {
        var t = this.calcPos(this.curTable);
        e.style.cssText =
          'top: ' +
          (t.top + parseInt(getComputedStyle(this.curTable).height, 10) - 4) +
          'px; left:' +
          (t.left + (this.tableModel.enableRtl ? 0 : parseInt(getComputedStyle(this.curTable).width, 10)) - 4) +
          'px;';
      }
    }
  };
  return s;
})();
var ti = (function () {
  function s(e, t) {
    this.tools = {};
    this.parent = e;
    this.locator = t;
    this.renderFactory = this.locator.getService('rendererFactory');
    this.addEventListener();
    this.parent.toolbarSettings && Object.keys(this.parent.toolbarSettings.itemConfigs).length > 0
      ? ut(this.tools, ft, bn(this.parent.toolbarSettings.itemConfigs), true)
      : (this.tools = ft);
  }
  s.prototype.initializeInstance = function () {
    this.toolbarRenderer = this.renderFactory.getRenderer(te.Toolbar);
  };
  s.prototype.renderColorPickerInput = function (e, t) {
    var i = this;
    this.initializeInstance();
    var n = e.containerType;
    var r = e.container;
    var o;
    var a;
    Cn.forEach(function (l) {
      if (Ur(l, e.items) !== -1)
        switch (l) {
          case 'fontcolor': {
            a = {
              cssClass:
                Be +
                ' ' +
                Ve +
                ' ' +
                Wo +
                ' ' +
                i.tools[l.toLocaleLowerCase()].icon +
                ' ' +
                Gt +
                i.parent.getCssClass(true),
              value: i.tools[l.toLocaleLowerCase()].value,
              command: i.tools[l.toLocaleLowerCase()].command,
              subCommand: i.tools[l.toLocaleLowerCase()].subCommand,
              element: _('#' + i.parent.getID() + '_' + e.containerType + '_FontColor', e.container),
              target: o,
            };
            if (!p(a.element.nextElementSibling) && a.element.nextElementSibling.classList.contains(Ve)) return;
            i.fontColorPicker = i.toolbarRenderer.renderColorPicker(a, 'fontcolor', e.containerType);
            break;
          }
          case 'backgroundcolor': {
            a = {
              cssClass:
                Be +
                ' ' +
                Ve +
                ' ' +
                Qo +
                ' ' +
                i.tools[l.toLocaleLowerCase()].icon +
                ' ' +
                Gt +
                i.parent.getCssClass(true),
              value: i.tools[l.toLocaleLowerCase()].value,
              command: i.tools[l.toLocaleLowerCase()].command,
              subCommand: i.tools[l.toLocaleLowerCase()].subCommand,
              element: _('#' + i.parent.getID() + '_' + e.containerType + '_BackgroundColor', e.container),
              target: o,
            };
            if (!p(a.element.nextElementSibling) && a.element.nextElementSibling.classList.contains(Ve)) return;
            i.backgroundColorPicker = i.toolbarRenderer.renderColorPicker(a, 'backgroundcolor', e.containerType);
            break;
          }
          case 'bordercolor': {
            var h = t.style.borderColor;
            if (h.match(/\d+/g)) {
              var c =
                '#' +
                h
                  .match(/\d+/g)
                  .slice(0, 3)
                  .map(function (u) {
                    var f = parseInt(u, 10).toString(16);
                    return f.length === 1 ? '0' + f : f;
                  })
                  .join('');
              h = c;
            }
            a = {
              cssClass: Be + ' ' + Ve + ' ' + Uo + i.parent.getCssClass(true),
              value: h || i.tools[l.toLocaleLowerCase()].value,
              command: i.tools[l.toLocaleLowerCase()].command,
              subCommand: i.tools[l.toLocaleLowerCase()].subCommand,
              element: e.container,
              target: o,
            };
            i.borderColorPicker = i.toolbarRenderer.renderColorPicker(a, 'bordercolor', e.containerType);
            break;
          }
          case 'tablebackgroundcolor': {
            var d = t.style.backgroundColor;
            if (d.match(/\d+/g)) {
              var c =
                '#' +
                d
                  .match(/\d+/g)
                  .slice(0, 3)
                  .map(function (f) {
                    var m = parseInt(f, 10).toString(16);
                    return m.length === 1 ? '0' + m : m;
                  })
                  .join('');
              d = c;
            }
            a = {
              cssClass: Be + ' ' + Ve + ' ' + _o + i.parent.getCssClass(true),
              value: d || i.tools[l.toLocaleLowerCase()].value,
              command: i.tools[l.toLocaleLowerCase()].command,
              subCommand: i.tools[l.toLocaleLowerCase()].subCommand,
              element: e.container,
              target: o,
            };
            i.tableBackgroundColorPicker = i.toolbarRenderer.renderColorPicker(
              a,
              'tablebackgroundcolor',
              e.containerType,
            );
            break;
          }
        }
    });
    if (this.parent.inlineMode.enable) {
      this.setCssClass({ cssClass: this.parent.getCssClass() });
    }
  };
  s.prototype.destroy = function () {
    this.removeEventListener();
    this.destroyColorPicker();
    this.fontColorPicker = null;
    this.backgroundColorPicker = null;
    this.borderColorPicker = null;
    this.tableBackgroundColorPicker = null;
    this.tools = {};
  };
  s.prototype.destroyColorPicker = function () {
    if (this.fontColorPicker && !this.fontColorPicker.isDestroyed) {
      this.fontColorPicker.destroy();
    }
    if (this.backgroundColorPicker && !this.backgroundColorPicker.isDestroyed) {
      this.backgroundColorPicker.destroy();
    }
    if (this.borderColorPicker && !this.borderColorPicker.isDestroyed) {
      this.borderColorPicker.destroy();
    }
    if (this.tableBackgroundColorPicker && !this.tableBackgroundColorPicker.isDestroyed) {
      this.tableBackgroundColorPicker.destroy();
    }
  };
  s.prototype.setRtl = function (e) {
    if (this.fontColorPicker) {
      this.fontColorPicker.setProperties({ enableRtl: e.enableRtl });
    }
    if (this.backgroundColorPicker) {
      this.backgroundColorPicker.setProperties({ enableRtl: e.enableRtl });
    }
    if (this.borderColorPicker) {
      this.borderColorPicker.setProperties({ enableRtl: e.enableRtl });
    }
    if (this.tableBackgroundColorPicker) {
      this.tableBackgroundColorPicker.setProperties({ enableRtl: e.enableRtl });
    }
  };
  s.prototype.setCssClass = function (e) {
    this.updateCss(this.fontColorPicker, e);
    this.updateCss(this.backgroundColorPicker, e);
    this.updateCss(this.borderColorPicker, e);
    this.updateCss(this.tableBackgroundColorPicker, e);
  };
  s.prototype.updateCss = function (e, t) {
    if (e && t.cssClass) {
      p(t.oldCssClass)
        ? e.setProperties({ cssClass: (e.cssClass + ' ' + t.cssClass).trim() })
        : e.setProperties({
            cssClass: (e.cssClass.replace(t.oldCssClass, '').replace('  ', ' ').trim() + ' ' + t.cssClass).trim(),
          });
    }
  };
  s.prototype.addEventListener = function () {
    this.parent.on(_n, this.renderColorPickerInput, this);
    this.parent.on(Je, this.setRtl, this);
    this.parent.on(pe, this.onPropertyChanged, this);
    this.parent.on(he, this.setCssClass, this);
    this.parent.on(Xt, this.showColorPicker, this);
  };
  s.prototype.showColorPicker = function (e) {
    !p(this.fontColorPicker) && e.toolbarClick === 'fontcolor'
      ? this.fontColorPicker.toggle()
      : !p(this.backgroundColorPicker) && e.toolbarClick === 'backgroundcolor' && this.backgroundColorPicker.toggle();
  };
  s.prototype.onPropertyChanged = function (e) {
    for (var t = e.newProp, i = 0, n = Object.keys(t); i < n.length; i++) {
      var r = n[i];
      switch (n[i]) {
        case 'fontColor':
          if (this.fontColorPicker)
            for (var o = 0, a = Object.keys(t.fontColor); o < a.length; o++) {
              var l = a[o];
              switch (a[o]) {
                case 'default': {
                  this.fontColorPicker.setProperties({ value: t.fontColor.default });
                  break;
                }
                case 'mode':
                  this.fontColorPicker.setProperties({ mode: t.fontColor.mode });
                  break;
                case 'columns':
                  this.fontColorPicker.setProperties({ columns: t.fontColor.columns });
                  break;
                case 'colorCode':
                  this.fontColorPicker.setProperties({ presetColors: t.fontColor.colorCode });
                  break;
                case 'modeSwitcher':
                  this.fontColorPicker.setProperties({ modeSwitcher: t.fontColor.modeSwitcher });
                  break;
                case 'showRecentColors':
                  this.fontColorPicker.setProperties({ showRecentColors: t.fontColor.showRecentColors });
                  break;
              }
            }
          break;
        case 'backgroundColor':
          if (this.backgroundColorPicker)
            for (var h = 0, c = Object.keys(t.backgroundColor); h < c.length; h++) {
              var d = c[h];
              switch (c[h]) {
                case 'default': {
                  this.backgroundColorPicker.setProperties({ value: t.backgroundColor.default });
                  break;
                }
                case 'mode':
                  this.backgroundColorPicker.setProperties({ mode: t.backgroundColor.mode });
                  break;
                case 'columns':
                  this.backgroundColorPicker.setProperties({ columns: t.backgroundColor.columns });
                  break;
                case 'colorCode':
                  this.backgroundColorPicker.setProperties({ presetColors: t.backgroundColor.colorCode });
                  break;
                case 'modeSwitcher':
                  this.backgroundColorPicker.setProperties({ modeSwitcher: t.backgroundColor.modeSwitcher });
                  break;
                case 'showRecentColors':
                  this.backgroundColorPicker.setProperties({ showRecentColors: t.backgroundColor.showRecentColors });
                  break;
              }
            }
          break;
      }
    }
  };
  s.prototype.removeEventListener = function () {
    this.parent.off(_n, this.renderColorPickerInput);
    this.parent.off(Je, this.setRtl);
    this.parent.off(pe, this.onPropertyChanged);
    this.parent.off(he, this.setCssClass);
    this.parent.off(Xt, this.showColorPicker);
  };
  return s;
})();
var Bs = (function () {
  function s(e, t) {
    this.tableCellPaddingValue = '';
    this.tableStyles = {};
    this.parent = e;
    this.rteID = e.element.id;
    this.l10n = t.getService('rteLocale');
    this.tableBorderStyle = new yn(this.parent, t);
    this.tableBorderColor = new ti(this.parent, t);
    this.tableBackgroundColor = new ti(this.parent, t);
    this.rendererFactory = t.getService('rendererFactory');
    this.dialogRenderObj = t.getService('dialogRenderObject');
    this.addEventListener();
    this.isDestroyed = false;
  }
  s.prototype.addEventListener = function () {
    if (!this.parent.isDestroyed) {
      this.parent.on(nn, this.renderDlgContent, this);
      this.parent.on(Le, this.afterRender, this);
      this.parent.on(Ot, this.afterRender, this);
      this.parent.on(Un, this.showDialog, this);
      this.parent.on(Qn, this.closeDialog, this);
      this.parent.on(Qt, this.clearDialogObj, this);
      this.parent.on(rt, this.bindOnEnd, this);
      this.parent.on(Wn, this.updateTableProperty, this);
      this.parent.on(Vn, this.docClick, this);
      this.parent.on(Ye, this.onIframeMouseDown, this);
      this.parent.on(Wt, this.editAreaClickHandler, this);
      this.parent.on(rn, this.onToolbarAction, this);
      this.parent.on(it, this.dropdownSelect, this);
      this.parent.on(Dt, this.tableColorHandler, this);
      this.parent.on(Ie, this.keyDown, this);
      this.parent.on(Kn, this.tableModulekeyUp, this);
      this.parent.on(Gn, this.afterKeyDown, this);
      this.parent.on(he, this.setCssClass, this);
      this.parent.on(ee, this.destroy, this);
      this.parent.on(pe, this.onPropertyChanged, this);
    }
  };
  s.prototype.removeEventListener = function () {
    this.parent.off(nn, this.renderDlgContent);
    this.parent.off(Le, this.afterRender);
    this.parent.off(Ot, this.afterRender);
    this.parent.off(Un, this.showDialog);
    this.parent.off(Qn, this.closeDialog);
    this.parent.off(Qt, this.clearDialogObj);
    this.parent.off(rt, this.bindOnEnd);
    this.parent.off(Wn, this.updateTableProperty);
    this.parent.off(Vn, this.docClick);
    this.parent.off(Ye, this.onIframeMouseDown);
    this.parent.off(Wt, this.editAreaClickHandler);
    if (this.tableObj) {
      this.parent.off(Te, this.tableObj.cellSelect);
    }
    this.parent.off(rn, this.onToolbarAction);
    this.parent.off(it, this.dropdownSelect);
    this.parent.off(Dt, this.tableColorHandler);
    this.parent.off(Ie, this.keyDown);
    this.parent.off(Kn, this.tableModulekeyUp);
    this.parent.off(Gn, this.afterKeyDown);
    this.parent.off(he, this.setCssClass);
    this.parent.off(ee, this.destroy);
    if (this.parent.editorMode !== 'Markdown' && this.parent.formatter) {
      this.parent.formatter.editorManager.observer.off(Kt, this.hideTableQuickToolbar);
    }
    this.parent.off(pe, this.onPropertyChanged);
  };
  s.prototype.bindOnEnd = function () {
    if (
      this.parent.editorMode === 'HTML' &&
      this.parent.formatter &&
      this.parent.formatter.editorManager &&
      this.contentModule
    ) {
      var e = this.getTableModelProperty();
      this.parent.formatter.editorManager.tableObj = this.tableObj = new gs(
        this.parent.formatter.editorManager,
        e,
        this.parent.iframeSettings,
      );
      if (this.tableObj) {
        this.tableObj.addResizeEventHandlers();
        this.parent.off(Te, this.tableObj.cellSelect);
        this.parent.on(Te, this.tableObj.cellSelect, this.tableObj);
      }
      if (this.parent.formatter) {
        this.parent.formatter.editorManager.observer.on(Kt, this.hideTableQuickToolbar, this);
      }
    }
  };
  s.prototype.onPropertyChanged = function (e) {
    for (var t = 0, i = Object.keys(e.newProp); t < i.length; t++) {
      var n = i[t];
      if (i[t] === 'tableSettings')
        switch (Object.keys(e.newProp.tableSettings)[0]) {
          case 'resize':
            this.parent.tableSettings.resize === false
              ? this.tableObj.removeResizeEventHandlers()
              : this.tableObj.addResizeEventHandlers();
            break;
        }
    }
  };
  s.prototype.getTableModelProperty = function () {
    var e = this;
    var t = {
      tableSettings: this.parent.tableSettings,
      rteElement: this.parent.element,
      readonly: this.parent.readonly,
      enableRtl: this.parent.enableRtl,
      enterKey: this.parent.enterKey,
      editorMode: this.parent.editorMode,
      quickToolbarSettings: this.parent.quickToolbarSettings,
      getCssClass: function (i) {
        return e.parent.getCssClass(i);
      },
      preventDefaultResize: function (i) {
        e.parent.preventDefaultResize(i);
      },
      getDocument: function () {
        return e.contentModule ? e.contentModule.getDocument() : e.parent.contentModule.getDocument();
      },
      getEditPanel: function () {
        return e.contentModule ? e.contentModule.getEditPanel() : e.parent.contentModule.getEditPanel();
      },
      resizeStart: function (i) {
        e.resizeStart(i);
      },
      resizing: function (i) {
        e.resizing(i);
      },
      resizeEnd: function (i) {
        e.resizeEnd(i);
      },
      addRow: function (i, n, r) {
        e.addRow(i, n, r);
      },
      hideTableQuickToolbar: function () {
        e.hideTableQuickToolbar();
      },
      removeTable: function (i, n, r) {
        e.removeTable(i, n, r);
      },
      isTableQuickToolbarVisible: function () {
        return e.isTableQuickToolbarVisible();
      },
      enableUndo: function () {
        e.enableUndo();
      },
    };
    return t;
  };
  s.prototype.updateTableProperty = function () {
    var e = this.getTableModelProperty();
    if (!p(this.tableObj)) {
      this.tableObj.updateTableModel(e);
    }
  };
  s.prototype.resizeStart = function (e) {
    var t = this;
    if (this.parent.contentModule.getDocument().activeElement !== this.parent.inputElement) {
      this.parent.inputElement.focus({ preventScroll: true });
    }
    this.parent.trigger(xr, e, function (i) {
      if (i.cancel && t.tableObj) {
        t.tableObj.cancelResizeAction();
      }
    });
  };
  s.prototype.enableUndo = function () {
    if (this.parent.formatter) {
      this.parent.formatter.enableUndo(this.parent);
    }
  };
  s.prototype.resizing = function (e) {
    var t = this;
    this.parent.trigger(Ir, e, function (i) {
      if (t.tableObj) {
        i.cancel ? t.tableObj.cancelResizeAction() : t.tableObj.perfomResizing(e.event);
      }
    });
  };
  s.prototype.isTableQuickToolbarVisible = function () {
    return (
      this.quickToolObj && this.quickToolObj.tableQTBar && document.body.contains(this.quickToolObj.tableQTBar.element)
    );
  };
  s.prototype.resizeEnd = function (e) {
    this.parent.trigger(Ar, e);
  };
  s.prototype.afterRender = function () {
    if (p(this.contentModule)) {
      this.contentModule = this.rendererFactory.getRenderer(te.Content);
      this.bindOnEnd();
    }
  };
  s.prototype.updateCss = function (e, t) {
    if (e && t.cssClass) {
      p(t.oldCssClass)
        ? e.setProperties({ cssClass: (e.cssClass + ' ' + t.cssClass).trim() })
        : e.setProperties({ cssClass: (e.cssClass.replace(t.oldCssClass, '').trim() + ' ' + t.cssClass).trim() });
    }
  };
  s.prototype.setCssClass = function (e) {
    if (this.popupObj && e.cssClass) {
      p(e.oldCssClass)
        ? B([this.popupObj.element], e.cssClass)
        : (Y([this.popupObj.element], e.oldCssClass), B([this.popupObj.element], e.cssClass));
    }
    this.updateCss(this.createTableButton, e);
    this.updateCss(this.editdlgObj, e);
    for (
      var t = [
          this.columnTextBox,
          this.rowTextBox,
          this.tableWidthNum,
          this.tableCellPadding,
          this.tableCellSpacing,
          this.tableBorderWidth,
        ],
        i = 0;
      i < t.length;
      i++
    )
      if (t[i]) {
        this.updateCss(t[i], e);
      }
  };
  s.prototype.dropdownSelect = function (e) {
    var t = this;
    var i = e.item;
    if (e.item.command === 'BorderStyle') {
      var n = {
        cancel: false,
        requestType: 'BorderStyle',
      };
      this.parent.trigger(ze, n, function (a) {
        if (!a.cancel) {
          var l = t.parent.contentModule.getPanel().ownerDocument.getElementById(t.parent.getID() + '_borderStyle');
          l.firstChild.innerHTML = '<span class="e-rte-dropdown-btn-text" >' + e.item.text + '</span>';
          t.tableElement.style.cssText += 'border-style: ' + e.item.subCommand.toLowerCase() + ';';
          t.parent.trigger(Ge, { requestType: 'BorderStyle' });
        }
      });
    }
    if (!(!document.body.contains(document.body.querySelector('.e-rte-quick-toolbar')) || e.item.command !== 'Table')) {
      var r = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());
      var o = {
        args: e,
        selection: this.parent.formatter.editorManager.nodeSelection.save(r, this.contentModule.getDocument()),
        selectParent: this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(r),
      };
      switch (e.item.subCommand) {
        case 'InsertRowBefore':
        case 'InsertRowAfter':
          this.addRow(o.selection, e);
          break;
        case 'InsertColumnLeft':
        case 'InsertColumnRight':
          this.addColumn(o.selection, e);
          break;
        case 'DeleteColumn':
        case 'DeleteRow':
          this.removeRowColumn(o.selection, e);
          break;
        case 'AlignTop':
        case 'AlignMiddle':
        case 'AlignBottom':
          this.verticalAlign(o, e);
          break;
        case 'Dashed':
        case 'Alternate':
        case 'Custom':
          this.parent.formatter.process(this.parent, e, o, {
            command: e.item.command,
            subCommand: e.item.subCommand,
          });
          break;
        case 'Merge':
        case 'VerticalSplit':
        case 'HorizontalSplit':
          this.UpdateCells(o.selection, e);
          break;
      }
    }
  };
  s.prototype.UpdateCells = function (e, t) {
    this.parent.formatter.process(this.parent, t, t, {
      selection: e,
      subCommand: t.item.subCommand,
    });
    this.hideTableQuickToolbar();
  };
  s.prototype.keyDown = function (e) {
    var t = e.args;
    this.handleSpecialActions(e.args, e);
    if (this.tableObj) {
      if (this.tableObj.isTableInteractionPossible(e.args)) {
        this.tableObj.handleTableKeyboardInteractions(e.args);
      }
      if (this.parent.editorMode === 'HTML') {
        this.tableObj.handleShiftKeyTableSelection(e.args);
      }
      this.tableObj.handleGlobalKeyboardShortcuts(e.args);
      this.tableObj.handleTableDeletion(e.args);
      this.tableObj.handleDeselectionOnTyping(e.args);
    }
  };
  s.prototype.handleSpecialActions = function (e, t) {
    switch (e.action) {
      case 'escape':
        break;
      case 'insert-table':
        {
          this.parent.editorMode === 'HTML'
            ? this.openDialog(true, t)
            : this.parent.editorMode === 'Markdown' && this.parent.formatter.process(this.parent, null, e);
          e.preventDefault();
        }
        break;
    }
  };
  s.prototype.selectionEventTriggers = function () {
    var e = this.parent.contentModule.getDocument().getSelection();
    var t = e && e.rangeCount !== 0 && e.getRangeAt(0);
    if (t) {
      var i = t.startContainer.nodeName === '#text' ? t.startContainer.parentElement : t.startContainer;
      if (i.closest('table')) {
        var n = i.closest('.e-multi-cells-select');
        if (!p(n)) {
          var r = i.closest('table');
          var o = this.tableObj.extractSelectedTable(r, false);
          var a = {
            selectedContent: o ? o.outerHTML : null,
            selection: e,
            editorMode: this.parent.editorMode,
          };
          this.parent.trigger(Vo, a);
        }
      }
    }
  };
  s.prototype.tableModulekeyUp = function (e) {
    var t = this;
    if (this.tableObj) {
      this.tableObj.tableModulekeyUp(e);
    }
    if (this.selectionTimeout) {
      clearTimeout(this.selectionTimeout);
      this.selectionTimeout = null;
    }
    var i = this.parent.element && this.parent.element.dataset && this.parent.element.dataset.rteUnitTesting === 'true';
    i
      ? this.selectionEventTriggers()
      : (this.selectionTimeout = window.setTimeout(function () {
          t.selectionEventTriggers();
        }, 600));
  };
  s.prototype.openDialog = function (e, t) {
    if (!e) {
      this.parent.contentModule.getEditPanel().focus();
    }
    if (this.parent.editorMode === 'HTML') {
      var i = this.parent.contentModule.getDocument();
      var n = this.parent.formatter.editorManager.nodeSelection.getRange(i);
      var r = this.parent.formatter.editorManager.nodeSelection.save(n, i);
      var o = {
        originalEvent: t ? t.args : { action: 'insert-table' },
        item: {
          command: 'Table',
          subCommand: 'CreateTable',
        },
        name: e ? null : 'showDialog',
      };
      this.insertTableDialog({
        self: this,
        args: o,
        selection: r,
      });
    }
  };
  s.prototype.showDialog = function () {
    this.openDialog(false);
    this.setCssClass({ cssClass: this.parent.getCssClass() });
  };
  s.prototype.closeDialog = function () {
    if (this.editdlgObj) {
      this.editdlgObj.hide({ returnValue: true });
    }
  };
  s.prototype.onToolbarAction = function (e) {
    var t = e.args.item;
    switch (e.args.item.subCommand) {
      case 'TableHeader':
        this.tableHeader(e.selection, e.args);
        break;
      case 'TableRemove':
        this.removeTable(e.selection, e.args);
        break;
      case 'TableEditProperties':
        {
          this.tableElement = v(e.selectParent[0], 'table');
          if (this.tableElement) {
            var i = this.tableElement.style;
            this.tableCellPaddingValue = this.tableElement.querySelector('td')
              ? this.tableElement.querySelector('td').style.padding
              : '';
            this.tableStyles = {
              borderStyle: this.tableElement.style.borderStyle,
              borderColor: this.tableElement.style.borderColor,
              backgroundColor: this.tableElement.style.backgroundColor,
              borderWidth: this.tableElement.style.borderWidth,
              width: this.tableElement.style.width,
              borderSpacing: this.tableElement.style.borderSpacing,
              borderCollapse: this.tableElement.style.borderCollapse,
            };
            if (!this.tableElement.style.borderWidth) {
              this.tableElement.style.cssText += 'border-width: 1px;';
            }
            if (!this.tableElement.style.borderStyle) {
              this.tableElement.style.cssText += 'border-style: double;';
            }
          }
        }
        this.editTable(e);
        break;
    }
  };
  s.prototype.verticalAlign = function (e, t) {
    var i = v(e.selectParent[0], 'th') || v(e.selectParent[0], 'td');
    if (i) {
      this.parent.formatter.process(this.parent, t, t, {
        tableCell: i,
        subCommand: t.item.subCommand,
      });
    }
  };
  s.prototype.hideTableQuickToolbar = function () {
    if (
      this.quickToolObj &&
      typeof this.quickToolObj.tableQTBar < 'u' &&
      this.quickToolObj.tableQTBar &&
      typeof this.quickToolObj.tableQTBar.element < 'u' &&
      document.body.contains(this.quickToolObj.tableQTBar.element)
    ) {
      this.quickToolObj.tableQTBar.hidePopup();
    }
  };
  s.prototype.tableHeader = function (e, t) {
    if (!(!t || typeof t != 'object')) {
      this.parent.formatter.process(this.parent, t, t.originalEvent, {
        selection: e,
        subCommand: typeof t.item < 'u' ? t.item.subCommand : void 0,
      });
    }
  };
  s.prototype.getAnchorNode = function (e) {
    if (!e || typeof e != 'object') return e;
    var t = v(e, 'a');
    return t || e;
  };
  s.prototype.editAreaClickHandler = function (e) {
    if (!this.shouldSkipQuickToolbar(e)) {
      if (
        this.parent.editorMode === 'HTML' &&
        this.parent.quickToolbarModule &&
        this.parent.quickToolbarModule.tableQTBar
      ) {
        this.quickToolObj = this.parent.quickToolbarModule;
        var t = e.args;
        var i = e.args.target;
        this.contentModule = this.rendererFactory.getRenderer(te.Content);
        var n = this.parent.formatter.editorManager.nodeSelection.getRange(this.contentModule.getDocument());
        this.shouldShowQuickToolbar(e.args, e.args.target, n)
          ? this.showTableQuickToolbar(e, e.args, e.args.target, n)
          : this.hideTableQuickToolbar();
      }
      e.args;
      this.selectionEventTriggers();
    }
  };
  s.prototype.shouldSkipQuickToolbar = function (e) {
    if (this.parent.readonly) return true;
    var t = e.args.target;
    if (!p(v(e.args.target, '.e-img-caption'))) return true;
    var i = e.args;
    var n = this.parent.quickToolbarSettings.showOnRightClick;
    return (
      e.args.which === 2 ||
      (this.parent.quickToolbarSettings.showOnRightClick && e.args.which === 1) ||
      (!this.parent.quickToolbarSettings.showOnRightClick && e.args.which === 3)
    );
  };
  s.prototype.shouldShowQuickToolbar = function (e, t, i) {
    var n = v(t, 'table');
    var r = this.parent.getRange().startContainer.parentElement;
    var o = this.parent.getRange().endContainer.parentElement;
    var a = this.getAnchorNode(t);
    var l = this.parent.userAgentData.getPlatform() === 'macOS' && e.which === 3;
    var h = i.startContainer === i.endContainer && i.startOffset === i.endOffset;
    var c = new Date().getTime();
    return (
      t &&
      t.nodeName !== 'A' &&
      a.nodeName !== 'A' &&
      t.nodeName !== 'IMG' &&
      t.nodeName !== 'VIDEO' &&
      t.nodeName !== 'AUDIO' &&
      !t.classList.contains(Ko) &&
      (this.parent.getRange().startContainer.parentElement === this.parent.getRange().endContainer.parentElement ||
        l) &&
      (t.nodeName === 'TD' ||
        t.nodeName === 'TH' ||
        t.nodeName === 'TABLE' ||
        (n && this.parent.contentModule.getEditPanel().contains(n))) &&
      !(i.startContainer.nodeType === 3 && !(i.collapsed || l)) &&
      this.tableObj &&
      c - this.tableObj.resizeEndTime > 100 &&
      (h || n.querySelectorAll('.e-multi-cells-select').length > 0)
    );
  };
  s.prototype.showTableQuickToolbar = function (e, t, i, n) {
    this.parent.formatter.editorManager.nodeSelection.save(n, this.contentModule.getDocument());
    this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());
    this.parent.formatter.editorManager.nodeSelection.restore();
    this.quickToolObj.tableQTBar.showPopup(i, e.args);
  };
  s.prototype.tableCellClick = function (e) {
    var t = e.target;
    if (e.target) {
      var i = e.target.parentElement;
      var n = e.target.parentElement ? e.target.parentElement.parentElement : null;
      if (!(!e.target.parentElement || !n)) {
        var r = Array.prototype.slice.call(n.children).indexOf(e.target.parentElement) + 1;
        var o = Array.prototype.slice.call(e.target.parentElement.children).indexOf(e.target) + 1;
        var a = this.self;
        if (typeof this.self.tableInsert == 'function') {
          this.self.tableInsert(r, o, e, this);
        }
      }
    }
  };
  s.prototype.tableInsert = function (e, t, i, n) {
    var r = n && n.self ? n.self : this;
    var o = window.scrollX;
    var a = window.scrollY;
    this.prepareSelectionForTableInsert(n, r);
    this.cleanupTableCreationEvents(i, r);
    var l = this.createTableConfiguration(e, t, r, n);
    this.insertTableIntoEditor(l, n, r);
    window.scrollTo(window.scrollX, window.scrollY);
    this.setupTableCellSelection(r);
  };
  s.prototype.prepareSelectionForTableInsert = function (e, t) {
    if (!(!e || !e.selection || !e.selection.range)) {
      var i = e.selection.range.startContainer;
      if (i.nodeName === 'P' && i.textContent.trim() === '' && !(i.childNodes.length > 0)) {
        i.innerHTML = '<br>';
      }
      var n = i.parentNode;
      if (this.isHtmlEditorOutsideEditableRegion(t, i.parentNode)) {
        t.contentModule.getEditPanel().focus();
        var r = t.parent.formatter.editorManager.nodeSelection.getRange(t.contentModule.getDocument());
        e.selection = t.parent.formatter.editorManager.nodeSelection.save(r, t.contentModule.getDocument());
      }
    }
  };
  s.prototype.isHtmlEditorOutsideEditableRegion = function (e, t) {
    if (!e.parent || e.parent.editorMode !== 'HTML') return false;
    var i =
      e.parent.iframeSettings.enable &&
      t.ownerDocument &&
      t.ownerDocument.querySelector('body') &&
      !de(t.ownerDocument.querySelector('body'), 'e-lib');
    var n = e.contentModule.getPanel().id;
    var r = !e.parent.iframeSettings.enable && p(v(t, '[id="' + e.contentModule.getPanel().id + '"]'));
    return i || r;
  };
  s.prototype.cleanupTableCreationEvents = function (e, t) {
    if (t.popupObj) {
      var i = e.target;
      if (e.target && e.target.parentElement && e.target.parentElement.parentElement)
        for (
          var n = Array.prototype.slice.call(e.target.parentElement.parentElement.children), r = 0;
          r < n.length;
          r++
        ) {
          D.remove(n[r], 'mouseleave', this.tableObj.tableCellLeave);
          for (var o = Array.prototype.slice.call(n[r].children), a = 0; a < o.length; a++) {
            D.remove(o[a], 'mousemove', this.tableObj.tableCellSelect);
            D.remove(o[a], 'mouseup', this.tableCellClick);
            if (this.parent.toolbarSettings.type === me.Popup) {
              D.remove(o[a], 'click', this.tableCellClick);
            }
          }
        }
      t.popupObj.hide();
    }
    if (t.editdlgObj) {
      t.editdlgObj.hide();
    }
    if (!p(t.parent)) {
      if (t.parent.element.querySelector('.e-content')) {
        t.parent.element.querySelector('.e-content').focus();
      }
    }
  };
  s.prototype.createTableConfiguration = function (e, t, i, n) {
    return {
      rows: e,
      columns: t,
      width: {
        minWidth: i.parent.tableSettings.minWidth,
        maxWidth: i.parent.tableSettings.maxWidth,
        width: i.parent.tableSettings.width,
      },
      selection: n.selection,
    };
  };
  s.prototype.insertTableIntoEditor = function (e, t, i) {
    i.parent.formatter.process(i.parent, t.args, t.args.originalEvent, e);
    i.contentModule.getEditPanel().focus();
  };
  s.prototype.setupTableCellSelection = function (e) {
    if (e.tableObj) {
      e.parent.on(Te, e.tableObj.cellSelect, e.tableObj);
      var t = e.parent.formatter.editorManager.nodeSelection.get(e.contentModule.getDocument());
      if (!p(t) && !p(t.anchorNode) && t.anchorNode.nodeType === Node.ELEMENT_NODE) {
        var i = t.anchorNode;
        var n = t.anchorNode.tagName === 'TD' || t.anchorNode.tagName === 'TH';
        if (n) {
          e.tableObj.curTable = v(t.anchorNode, 'table');
          e.tableObj.activeCell = t.anchorNode;
        }
      }
    }
  };
  s.prototype.addRow = function (e, t, i) {
    var n;
    if (i) {
      n = {
        item: {
          command: 'Table',
          subCommand: 'InsertRowAfter',
        },
      };
    }
    var r = {
      selection: e,
      subCommand: i ? n.item.subCommand : t.item.subCommand,
    };
    this.parent.formatter.process(this.parent, i ? n : t, t, r);
  };
  s.prototype.addColumn = function (e, t) {
    this.parent.formatter.process(this.parent, t, t, {
      selection: e,
      width: this.parent.tableSettings.width,
      subCommand: t.item.subCommand,
    });
  };
  s.prototype.removeRowColumn = function (e, t) {
    this.parent.formatter.process(this.parent, t, t, {
      selection: e,
      subCommand: t.item.subCommand,
    });
    this.hideTableQuickToolbar();
  };
  s.prototype.removeTable = function (e, t, i) {
    var n;
    if (i) {
      n = {
        item: {
          command: 'Table',
          subCommand: 'TableRemove',
        },
      };
    }
    var r = {
      selection: e,
      subCommand: i ? n.item.subCommand : t.item.subCommand,
    };
    this.parent.formatter.process(this.parent, i ? n : t, t.originalEvent, r);
    this.contentModule.getEditPanel().focus();
    if (this.tableObj) {
      this.tableObj.setDefaultEmptyContent();
      this.tableObj.removeResizeElement();
    }
    this.hideTableQuickToolbar();
  };
  s.prototype.renderDlgContent = function (e) {
    var t = this;
    var i = e.args.originalEvent.target;
    if (M.isDevice || this.parent.inlineMode.enable || !p(v(e.args.originalEvent.target, '.e-text-quicktoolbar'))) {
      this.insertTableDialog(e);
      return;
    }
    if (this.popupObj) {
      this.popupObj.hide();
      return;
    }
    this.hideTableQuickToolbar();
    var n = '1X1';
    var r = this.l10n.getConstant('inserttablebtn');
    this.dlgDiv = this.parent.createElement('div', {
      className: 'e-rte-table-popup' + this.parent.getCssClass(true),
      id: this.rteID + '_table',
    });
    this.createTablePopupBoundFn = this.createTablePopupKeyDown.bind(this);
    this.dlgDiv.addEventListener('keydown', this.createTablePopupBoundFn);
    this.tblHeader = this.parent.createElement('div', {
      className: 'e-rte-popup-header' + this.parent.getCssClass(true),
    });
    this.tblHeader.innerHTML = '1X1';
    if (this.tableObj) {
      this.tableObj.tblHeader = this.tblHeader;
      this.tableObj.dlgDiv = this.dlgDiv;
    }
    this.dlgDiv.appendChild(this.tblHeader);
    var o = this.parent.createElement('div', { className: 'e-rte-table-span' + this.parent.getCssClass(true) });
    this.drawTable(o, e);
    this.dlgDiv.appendChild(o);
    this.dlgDiv.appendChild(
      this.parent.createElement('span', { className: 'e-span-border' + this.parent.getCssClass(true) }),
    );
    var a = this.parent.createElement('button', {
      className: 'e-insert-table-btn' + this.parent.getCssClass(true),
      id: this.rteID + '_insertTable',
      attrs: {
        type: 'button',
        tabindex: '0',
      },
    });
    if (!p(this.parent.getToolbarElement().querySelector('.e-expended-nav'))) {
      this.parent.getToolbarElement().querySelector('.e-expended-nav').setAttribute('tabindex', '1');
    }
    this.dlgDiv.appendChild(a);
    this.createTableButton = new Fr({
      iconCss: 'e-icons e-create-table',
      content: r,
      cssClass: 'e-flat' + this.parent.getCssClass(true),
      enableRtl: this.parent.enableRtl,
      locale: this.parent.locale,
    });
    this.createTableButton.isStringTemplate = true;
    this.createTableButton.appendTo(a);
    D.add(a, 'click', this.insertTableDialog, {
      self: this,
      args: e.args,
      selection: e.selection,
    });
    this.parent.getToolbar().parentElement.appendChild(this.dlgDiv);
    var l = e.args.originalEvent.target;
    l = l.classList.contains('e-toolbar-item') ? l.firstChild : l.parentElement;
    this.popupObj = new on(this.dlgDiv, {
      targetType: 'relative',
      relateTo: l,
      collision: {
        X: 'fit',
        Y: 'none',
      },
      offsetY: 8,
      viewPortElement: this.parent.element,
      position: {
        X: 'left',
        Y: 'bottom',
      },
      enableRtl: this.parent.enableRtl,
      zIndex: 10001,
      close: function () {
        D.remove(a, 'click', t.insertTableDialog);
        t.dlgDiv.removeEventListener('keydown', t.createTablePopupBoundFn);
        y(a);
        if (t.createTableButton && !t.createTableButton.isDestroyed) {
          t.createTableButton.destroy();
          t.createTableButton.element = null;
          t.createTableButton = null;
        }
        t.parent.isBlur = false;
        t.popupObj.element.parentElement.style.zIndex = '';
        t.popupObj.destroy();
        y(t.popupObj.element);
        t.popupObj = null;
      },
    });
    B([this.popupObj.element], 'e-popup-open');
    this.popupObj.element.parentElement.style.zIndex = '11';
    if (!p(this.parent.cssClass)) {
      B([this.popupObj.element], this.parent.getCssClass());
    }
    this.popupObj.refreshPosition(l);
    this.positionDialogue(l);
    a.focus();
  };
  s.prototype.positionDialogue = function (e) {
    var t = window.innerHeight;
    var i = this.popupObj.element.getBoundingClientRect().height;
    var n = window.innerHeight - e.getBoundingClientRect().bottom;
    var r;
    var o = e.closest('.e-toolbar-item');
    var a = this.parent.toolbarSettings.type === 'Popup';
    var l = this.parent.toolbarModule.getToolbarElement();
    var h = l && l.querySelector('.e-toolbar-extended');
    if (o)
      a
        ? ((r = o.getBoundingClientRect().height),
          o.parentElement.getBoundingClientRect().top < l.getBoundingClientRect().top &&
            (r = l.getBoundingClientRect().height + o.parentElement.getBoundingClientRect().height))
        : (r = o.parentElement.getBoundingClientRect().height);
    else {
      var c = this.parent.element.querySelector('.e-toolbar-item');
      if (c) {
        r = c.parentElement.getBoundingClientRect().height;
      }
    }
    if (h && o.parentElement !== h) {
      r += h.getBoundingClientRect().height;
    }
    if (n < this.popupObj.element.getBoundingClientRect().height) {
      this.popupObj.element.style.setProperty('top', 'auto');
      this.popupObj.element.style.setProperty('bottom', r + 'px');
    }
  };
  s.prototype.onIframeMouseDown = function (e) {
    if (this.popupObj) {
      this.popupObj.hide();
    }
    if (this.editdlgObj) {
      this.editdlgObj.hide();
    }
    if (
      !p(this.parent) &&
      !p(this.parent.contentModule) &&
      !p(this.parent.contentModule.getEditPanel()) &&
      this.tableObj
    ) {
      if (e && e.target) {
        var t = e.target;
        var i = e.target && e.target.classList && e.target.classList.contains('e-rte-table-resize');
        if (i) return;
      }
      this.tableObj.removeResizeElement();
    }
  };
  s.prototype.docClick = function (e) {
    var t = e.args.target;
    if (
      e.args.target &&
      e.args.target.classList &&
      ((this.popupObj && !v(e.args.target, "[id='" + this.popupObj.element.id + "']")) ||
        (this.editdlgObj && !v(e.args.target, '#' + this.editdlgObj.element.id))) &&
      !e.args.target.classList.contains('e-create-table') &&
      e.args.target.offsetParent &&
      !e.args.target.offsetParent.classList.contains('e-rte-backgroundcolor-dropdown')
    ) {
      if (this.popupObj) {
        this.popupObj.hide();
      }
      if (
        this.editdlgObj &&
        !e.args.target.closest('.e-border-style-btn') &&
        !e.args.target.closest('.e-rte-border-colorpicker') &&
        !e.args.target.closest('.e-rte-table-bg-colorpicker')
      ) {
        if (this.editdlgObj.element.querySelector('.e-rte-edit-table-content')) {
          for (var i in this.tableStyles)
            if (Object.prototype.hasOwnProperty.call(this.tableStyles, i)) {
              this.tableElement.style[i] = this.tableStyles[i];
            }
          for (var n = this.tableElement.querySelectorAll('td,th'), r = 0; r < n.length; r++)
            this.tableCellPaddingValue ? (n[r].style.padding = this.tableCellPaddingValue) : (n[r].style.padding = '');
        }
        var o = this.parent.contentModule.getDocument().querySelector('.e-colorpicker-popup.e-popup-open');
        if (o) {
          o.classList.remove('e-popup-open');
          o.classList.add('e-popup-close');
        }
        this.parent.notify(Hr, { closedBy: 'outside click' });
        this.editdlgObj.hide();
      }
      this.parent.isBlur = true;
      qr(this.parent.element, 'focusout');
    }
    var a = v(e.args.target, 'td') || v(e.args.target, 'th');
    var l = !!(a && this.parent.contentModule.getEditPanel().contains(a));
    if (
      e.args.target &&
      e.args.target.tagName !== 'TD' &&
      e.args.target.tagName !== 'TH' &&
      !l &&
      v(e.args.target, '.e-rte-quick-popup') === null &&
      e.args.target.offsetParent &&
      !e.args.target.offsetParent.classList.contains('e-quick-dropdown') &&
      !e.args.target.offsetParent.classList.contains('e-rte-backgroundcolor-dropdown') &&
      !v(e.args.target, '.e-rte-dropdown-popup') &&
      !v(e.args.target, '.e-rte-elements')
    ) {
      var h = !!(e.args.target.closest('.e-toolbar') || e.args.target.closest('.e-toolbar-wrapper'));
      var c = !!v(e.args.target, '#' + this.parent.element.id + '_pasteCleanupDialog');
      if (this.tableObj && !h && !c) {
        this.tableObj.removeCellSelectClasses();
        this.tableObj.removeTableSelection();
      }
      if (!M.isIE) {
        this.hideTableQuickToolbar();
      }
    }
    if (
      this.tableObj &&
      e.args.target &&
      e.args.target.classList &&
      !e.args.target.classList.contains(qt) &&
      !e.args.target.classList.contains(Ft) &&
      !e.args.target.classList.contains(Tt)
    ) {
      this.tableObj.removeResizeElement();
    }
  };
  s.prototype.drawTable = function (e, t) {
    for (var i, n, r = 0; r < 3; r++) {
      i = this.parent.createElement('div', {
        className: 'e-rte-table-row' + this.parent.getCssClass(true),
        attrs: { 'data-column': '' + r },
      });
      D.add(i, 'mouseleave', this.tableObj.tableCellLeave, this.tableObj);
      for (var o = 0; o < 10; o++) {
        n = this.parent.createElement('div', {
          className: 'e-rte-tablecell e-default' + this.parent.getCssClass(true),
          attrs: { 'data-cell': '' + o },
        });
        i.appendChild(n);
        n.style.display = 'inline-block';
        if (o === 0 && r === 0) {
          B([n], 'e-active');
        }
        D.add(n, 'mousemove', this.tableObj.tableCellSelect, this.tableObj);
        this.parent.toolbarSettings.type === me.Popup
          ? D.add(n, 'click', this.tableCellClick, {
              self: this,
              args: t.args,
              selection: t.selection,
            })
          : D.add(n, 'mouseup', this.tableCellClick, {
              self: this,
              args: t.args,
              selection: t.selection,
            });
      }
      e.appendChild(i);
    }
  };
  s.prototype.editTable = function (e) {
    var t = this;
    this.createDialog();
    var i = this.tableDlgContent(e);
    var n = this.l10n.getConstant('dialogUpdate');
    var r = this.l10n.getConstant('dialogCancel');
    var o = this.l10n.getConstant('tableEditHeader');
    this.editdlgObj.setProperties({
      height: 'initial',
      width: '390px',
      content: i,
      header: o,
      buttons: [
        {
          click: this.saveProperties.bind(this),
          buttonModel: {
            content: n,
            cssClass: 'e-flat e-size-update' + this.parent.getCssClass(true),
            isPrimary: true,
          },
        },
        {
          click: function () {
            t.cancelDialog(true);
          },
          buttonModel: {
            cssClass: 'e-flat e-cancel' + this.parent.getCssClass(true),
            content: r,
          },
        },
      ],
      cssClass: this.editdlgObj.cssClass + ' e-rte-edit-table-prop-dialog',
    });
    this.editdlgObj.element.style.maxHeight = 'none';
    this.editdlgObj.content.querySelector('input').focus();
    this.hideTableQuickToolbar();
  };
  s.prototype.insertTableDialog = function (e) {
    var t = this.self ? this.self : this;
    if (t.popupObj) {
      t.popupObj.hide();
    }
    t.createDialog();
    var i = t.tableCellDlgContent();
    var n = t.l10n.getConstant('dialogInsert');
    var r = t.l10n.getConstant('dialogCancel');
    if (!p(t.editdlgObj)) {
      t.editdlgObj.setProperties({
        height: 'initial',
        width: '290px',
        content: i,
        buttons: [
          {
            click: t.customTable.bind(this, e),
            buttonModel: {
              content: n,
              cssClass: 'e-flat e-insert-table ' + t.parent.cssClass,
              isPrimary: true,
            },
          },
          {
            click: function () {
              t.cancelDialog();
            },
            buttonModel: {
              cssClass: 'e-flat e-cancel ' + t.parent.cssClass,
              content: r,
            },
          },
        ],
      });
      if (!p(t.parent.cssClass)) {
        t.editdlgObj.setProperties({ cssClass: t.parent.cssClass });
      }
      t.editdlgObj.element.style.maxHeight = 'none';
      t.editdlgObj.content.querySelector('input').focus();
    }
  };
  s.prototype.tableCellDlgContent = function () {
    var e = this.l10n.getConstant('columns');
    var t = this.l10n.getConstant('rows');
    var i = this.parent.createElement('div', { className: 'e-cell-wrap' + this.parent.getCssClass(true) });
    var n =
      '<div id="tableColumn-parent" class="e-rte-field' +
      this.parent.getCssClass(true) +
      '"><input type="text"  data-role ="none" id="tableColumn" class="e-table-column' +
      this.parent.getCssClass(true) +
      '"/></div><div id="tableRow-parent" class="e-rte-field' +
      this.parent.getCssClass(true) +
      '"><input type="text" data-role ="none" id="tableRow" class="e-table-row' +
      this.parent.getCssClass(true) +
      '" /></div>';
    var r = Et(n);
    i.appendChild(r);
    this.columnTextBox = new lt({
      format: 'n0',
      min: 1,
      value: 3,
      placeholder: e,
      floatLabelType: 'Auto',
      max: 50,
      enableRtl: this.parent.enableRtl,
      locale: this.parent.locale,
      cssClass: this.parent.getCssClass(),
    });
    this.columnTextBox.isStringTemplate = true;
    this.columnTextBox.appendTo(i.querySelector('#tableColumn'));
    this.rowTextBox = new lt({
      format: 'n0',
      min: 1,
      value: 3,
      placeholder: t,
      floatLabelType: 'Auto',
      max: 100,
      enableRtl: this.parent.enableRtl,
      locale: this.parent.locale,
      cssClass: this.parent.getCssClass(),
    });
    this.rowTextBox.isStringTemplate = true;
    this.rowTextBox.appendTo(i.querySelector('#tableRow'));
    if (this.parent.showTooltip) {
      this.createTooltip(
        ['tableRow-parent', 'tableColumn-parent'],
        {
          'tableRow-parent': 'insertTableRowTitle',
          'tableColumn-parent': 'insertTableColumnTitle',
        },
        i,
      );
    }
    return i;
  };
  s.prototype.createTooltip = function (e, t, i) {
    var n = this;
    var r = e
      .map(function (a) {
        return '#' + a;
      })
      .join(',');
    var o = new vn({
      target: r,
      showTipPointer: true,
      openDelay: 400,
      opensOn: 'Hover',
      cssClass: this.parent.getCssClass(),
      windowCollision: true,
      position: 'BottomCenter',
      beforeRender: function (a) {
        var l = a.target.id;
        var h = t[a.target.id] || '';
        var c = n.l10n.getConstant(h);
        a.target.setAttribute('title', c);
      },
    });
    o.appendTo(i);
  };
  s.prototype.clearDialogObj = function () {
    if (this.editdlgObj) {
      this.editdlgObj.destroy();
      y(this.editdlgObj.element);
      this.editdlgObj = null;
    }
  };
  s.prototype.createDialog = function () {
    var e = this;
    if (this.editdlgObj) {
      this.editdlgObj.hide({ returnValue: true });
      return;
    }
    var t = this.parent.createElement('div', {
      className: 'e-rte-edit-table' + this.parent.getCssClass(true),
      id: this.rteID + '_tabledialog',
    });
    this.parent.rootContainer.appendChild(t);
    var i = this.l10n.getConstant('dialogInsert');
    var n = this.l10n.getConstant('dialogCancel');
    var r = this.l10n.getConstant('tabledialogHeader');
    var o = {
      header: r,
      cssClass: Be + this.parent.getCssClass(true),
      enableRtl: this.parent.enableRtl,
      locale: this.parent.locale,
      showCloseIcon: true,
      closeOnEscape: true,
      width: M.isDevice ? '290px' : '340px',
      height: 'initial',
      position: {
        X: 'center',
        Y: M.isDevice ? 'center' : 'top',
      },
      isModal: M.isDevice,
      buttons: [
        {
          buttonModel: {
            content: i,
            cssClass: 'e-flat e-insert-table' + this.parent.getCssClass(true),
            isPrimary: true,
          },
        },
        {
          click: function () {
            e.cancelDialog();
          },
          buttonModel: {
            cssClass: 'e-flat e-cancel' + this.parent.getCssClass(true),
            content: n,
          },
        },
      ],
      target: M.isDevice ? document.body : this.parent.element,
      animationSettings: { effect: 'None' },
      close: function (a) {
        e.parent.isBlur = false;
        if (
          e.editdlgObj.element.querySelector('.e-rte-edit-table-content') &&
          (a.closedBy.toString() === 'escape' || a.closedBy.toString() === 'close icon')
        ) {
          for (var l in e.tableStyles)
            if (Object.prototype.hasOwnProperty.call(e.tableStyles, l)) {
              e.tableElement.style[l] = e.tableStyles[l];
            }
          for (var h = e.tableElement.querySelectorAll('td,th'), c = 0; c < h.length; c++)
            e.tableCellPaddingValue ? (h[c].style.padding = e.tableCellPaddingValue) : (h[c].style.padding = '');
        }
        e.editdlgObj.destroy();
        y(e.editdlgObj.element);
        e.dialogRenderObj.close(a);
        e.editdlgObj = null;
      },
    };
    this.editdlgObj = this.dialogRenderObj.render(o);
    this.editdlgObj.appendTo(t);
    if (
      this.quickToolObj &&
      this.quickToolObj.inlineQTBar &&
      document.body.contains(this.quickToolObj.inlineQTBar.element)
    ) {
      this.quickToolObj.inlineQTBar.hidePopup();
    }
    if (
      this.quickToolObj &&
      this.quickToolObj.textQTBar &&
      this.parent.element.ownerDocument.body.contains(this.quickToolObj.textQTBar.element)
    ) {
      this.quickToolObj.textQTBar.hidePopup();
    }
  };
  s.prototype.customTable = function (e, t) {
    var i = this.self ? this.self : this;
    if (i && i.rowTextBox && i.rowTextBox.value && i.columnTextBox && i.columnTextBox.value) {
      var n =
        M.isDevice ||
        (!p(e.args) && !p(e.args.originalEvent) && e.args.originalEvent.action === 'insert-table') ||
        i.parent.inlineMode.enable ||
        (!p(i.parent.quickToolbarSettings.text) && !(e instanceof PointerEvent))
          ? e
          : this;
      i.tableInsert(i.rowTextBox.value, i.columnTextBox.value, t, n);
    }
  };
  s.prototype.cancelDialog = function (e) {
    if (e) {
      for (var t in this.tableStyles)
        if (Object.prototype.hasOwnProperty.call(this.tableStyles, t)) {
          this.tableElement.style[t] = this.tableStyles[t];
        }
      for (var i = this.tableElement.querySelectorAll('td,th'), n = 0; n < i.length; n++)
        this.tableCellPaddingValue ? (i[n].style.padding = this.tableCellPaddingValue) : (i[n].style.padding = '');
    }
    this.parent.isBlur = false;
    this.editdlgObj.hide({ returnValue: true });
  };
  s.prototype.tableColorHandler = function (e) {
    var t = this;
    if (e.item.subCommand === 'TableBackgroundColor') {
      var i = {
        cancel: false,
        requestType: 'TableBackgroundColor',
      };
      this.parent.trigger(ze, i, function (n) {
        if (!n.cancel) {
          if (e.value === '') {
            e.value = 'transparent';
          }
          t.tableElement.style.cssText += 'background-color: ' + e.value + ';';
          t.parent.trigger(Ge, { requestType: 'TableBackgroundColor' });
        }
      });
    } else if (e.item.subCommand === 'BorderColor') {
      var i = {
        cancel: false,
        requestType: 'BorderColor',
      };
      this.parent.trigger(ze, i, function (r) {
        if (!r.cancel) {
          if (e.value === '') {
            e.value = 'transparent';
          }
          t.tableElement.style.cssText += 'border-color: ' + e.value + ';';
          t.parent.trigger(Ge, { requestType: 'BorderColor' });
        }
      });
    }
  };
  s.prototype.saveProperties = function () {
    this.parent.formatter.saveData();
    this.editdlgObj.hide({ returnValue: true });
  };
  s.prototype.tableDlgContent = function (e) {
    var t = this;
    var i = e.selectParent[0];
    var n = this.l10n.getConstant('tableWidth');
    var r = this.l10n.getConstant('cellpadding');
    var o = this.l10n.getConstant('cellspacing');
    var a = this.l10n.getConstant('borderWidth');
    var l = this.l10n.getConstant('borderColor');
    var h = this.l10n.getConstant('borderLabel');
    var c = this.l10n.getConstant('tableBackgroundColor');
    var d = this.l10n.getConstant('borderStyle');
    var u = this.l10n.getConstant('borderWidthTooltip');
    var f = this.l10n.getConstant('borderColorTooltip');
    var m = this.l10n.getConstant('borderStyleTooltip');
    var g = this.parent.createElement('div', { className: 'e-table-sizewrap' + this.parent.getCssClass(true) });
    var b = v(e.selectParent[0], 'table').getClientRects()[0].width;
    var C = v(e.selectParent[0], 'td')
      ? v(e.selectParent[0], 'td').style.padding
      : v(e.selectParent[0], 'th').style.padding;
    var N = v(e.selectParent[0], 'table').style.borderSpacing;
    var w = v(e.selectParent[0], 'table').style.borderWidth;
    var T =
      '<div class="e-rte-edit-table-content' +
      this.parent.getCssClass(true) +
      '"><div class="e-rte-edit-table-cell' +
      this.parent.getCssClass(true) +
      '"><div class="e-rte-edit-table-tablewidth' +
      this.parent.getCssClass(true) +
      '"><div class="e-rte-edit-table-widthlabel' +
      this.parent.getCssClass(true) +
      '"><label>' +
      n +
      '</label></div><div class="e-rte-edit-table-field' +
      this.parent.getCssClass(true) +
      '" title="' +
      n +
      '"><input type="text" data-role ="none" id="' +
      this.parent.getID() +
      '_tableWidth" class="e-table-width' +
      this.parent.getCssClass(true) +
      '"  /></div></div><div class="e-rte-edit-table-bgcolor' +
      this.parent.getCssClass(true) +
      '"><div class="e-rte-edit-table-bgcolorlabel' +
      this.parent.getCssClass(true) +
      '"><label>' +
      c +
      '</label></div><div class="e-rte-edit-table-field' +
      this.parent.getCssClass(true) +
      '" title="' +
      c +
      '"><input type="color" data-role ="none" id="' +
      this.parent.getID() +
      '_backgroundColor" role="combobox" aria-label="Background Color Picker" data-testid="rte-bg-color-picker" class="e-background-color e-rte-bg-color-picker e-colorpicker' +
      this.parent.getCssClass(true) +
      '" /></div></div></div><div class="e-rte-edit-table-cell e-rte-edit-table-element' +
      this.parent.getCssClass(true) +
      '"><div class="e-rte-edit-table-cellpadding' +
      this.parent.getCssClass(true) +
      '"><div class="e-rte-edit-table-cellpaddinglabel' +
      this.parent.getCssClass(true) +
      '"><label>' +
      r +
      '</label></div><div class="e-rte-edit-table-field' +
      this.parent.getCssClass(true) +
      '" title="' +
      r +
      '"><input type="text" data-role ="none" id="' +
      this.parent.getID() +
      '_cellPadding" class="e-cell-padding' +
      this.parent.getCssClass(true) +
      '" /></div></div><div class="e-rte-edit-table-cellspacing' +
      this.parent.getCssClass(true) +
      '"><div class="e-rte-edit-table-cellspacinglabel' +
      this.parent.getCssClass(true) +
      '"><label>' +
      o +
      '</label></div><div class="e-rte-edit-table-field' +
      this.parent.getCssClass(true) +
      '" title="' +
      o +
      '"><input type="text" data-role ="none" id="' +
      this.parent.getID() +
      '_cellSpacing" class="e-cell-spacing' +
      this.parent.getCssClass(true) +
      '" /></div></div></div><div class="e-rte-edit-table-border e-rte-edit-table-element' +
      this.parent.getCssClass(true) +
      '"><div class="e-rte-edit-table-borderlabel' +
      this.parent.getCssClass(true) +
      '"><label>' +
      h +
      '</label></div><div class="e-rte-edit-table-borderfields e-rte-edit-table-element' +
      this.parent.getCssClass(true) +
      '"><div class="e-rte-edit-table-borderwidth' +
      this.parent.getCssClass(true) +
      '"><div class="e-rte-edit-table-borderwidthlabel' +
      this.parent.getCssClass(true) +
      '"><label>' +
      a +
      '</label></div><div class="e-rte-edit-table-field' +
      this.parent.getCssClass(true) +
      '" title="' +
      u +
      '"><input type="text" data-role ="none" id="' +
      this.parent.getID() +
      '_borderWidth" role="spinbutton" aria-label="Border Width in pixels" min="0" max="10" step="0.5" value="1" data-testid="rte-border-width-numeric" class="e-border-width e-rte-border-width-numeric e-numerictextbox' +
      this.parent.getCssClass(true) +
      '" /></div></div><div class="e-rte-edit-table-borderstyle' +
      this.parent.getCssClass(true) +
      '"><div class="e-rte-edit-table-borderstylelabel' +
      this.parent.getCssClass(true) +
      '"><label>' +
      d +
      '</label></div><div class="e-rte-edit-table-field' +
      this.parent.getCssClass(true) +
      '" title="' +
      m +
      '"><button role="group" aria-label="Table Styles Configuration" data-testid="rte-styles-section" class="e-border-style e-rte-table-styles" tabindex="0" id="' +
      this.parent.getID() +
      '_borderStyle"></button></div></div><div class="e-rte-edit-table-bordercolor' +
      this.parent.getCssClass(true) +
      '"><div class="e-rte-edit-table-borderwidthlabel' +
      this.parent.getCssClass(true) +
      '"><label>' +
      l +
      '</label></div><div class="e-rte-edit-table-field' +
      this.parent.getCssClass(true) +
      '" title="' +
      f +
      '"><input type="color" data-role ="none" id="' +
      this.parent.getID() +
      '_borderColor" role="combobox" aria-label="Border Color Picker" data-testid="rte-border-color-picker" class="e-border-color e-rte-border-color-picker e-colorpicker' +
      this.parent.getCssClass(true) +
      '" /></div></div></div></div></div>';
    var S = Et(T);
    g.appendChild(S);
    var O = g.querySelector('.e-border-style');
    var L = g.querySelector('.e-border-color');
    var A = g.querySelector('.e-background-color');
    this.tableWidthNum = new lt({
      format: 'n0',
      min: 0,
      value: v(e.selectParent[0], 'table').getClientRects()[0].width,
      floatLabelType: 'Auto',
      enableRtl: this.parent.enableRtl,
      locale: this.parent.locale,
      cssClass: this.parent.getCssClass(),
      change: function (k) {
        t.tableElement.style.cssText += 'width: ' + k.value + 'px;';
      },
    });
    this.tableWidthNum.isStringTemplate = true;
    this.tableWidthNum.appendTo(g.querySelector('#' + this.parent.getID() + '_tableWidth'));
    this.tableCellPadding = new lt({
      format: 'n0',
      min: 0,
      value: C !== '' ? parseInt(C, 10) : 0,
      floatLabelType: 'Auto',
      enableRtl: this.parent.enableRtl,
      locale: this.parent.locale,
      cssClass: this.parent.getCssClass(),
      change: function (k) {
        for (var P = t.tableElement.querySelectorAll('td,th'), I = 0; I < P.length; I++) {
          var H = '';
          P[I].style.padding === ''
            ? (H = (P[I].getAttribute('style') ? P[I].getAttribute('style') : '') + ' padding:' + k.value + 'px;')
            : ((P[I].style.padding = k.value + 'px'), (H = P[I].getAttribute('style')));
          P[I].style.cssText = H;
        }
      },
    });
    this.tableCellPadding.isStringTemplate = true;
    this.tableCellPadding.appendTo(g.querySelector('#' + this.parent.getID() + '_cellPadding'));
    this.tableCellSpacing = new lt({
      format: 'n0',
      min: 0,
      value:
        v(e.selectParent[0], 'table').style.borderSpacing !== '' &&
        !p(v(e.selectParent[0], 'table').style.borderSpacing)
          ? parseInt(v(e.selectParent[0], 'table').style.borderSpacing, 10)
          : 0,
      floatLabelType: 'Auto',
      enableRtl: this.parent.enableRtl,
      locale: this.parent.locale,
      cssClass: this.parent.getCssClass(),
      change: function (k) {
        if (k.value > 0 && t.tableElement.style.borderCollapse !== 'separate') {
          t.tableElement.style.cssText = t.tableElement.style.cssText.replace(/border-collapse\s*:\s*[^;]+;?/gi, '');
          t.tableElement.style.cssText += 'border-collapse: separate;';
        }
        t.tableElement.style.cssText += 'border-spacing: ' + k.value + 'px;';
      },
    });
    this.tableCellSpacing.isStringTemplate = true;
    this.tableCellSpacing.appendTo(g.querySelector('#' + this.parent.getID() + '_cellSpacing'));
    this.tableBorderWidth = new lt({
      format: 'n1',
      min: 0,
      max: 10,
      step: 0.5,
      value:
        v(e.selectParent[0], 'table').style.borderWidth !== '' && !p(v(e.selectParent[0], 'table').style.borderWidth)
          ? parseInt(v(e.selectParent[0], 'table').style.borderWidth, 10)
          : 1,
      floatLabelType: 'Auto',
      enableRtl: this.parent.enableRtl,
      locale: this.parent.locale,
      cssClass: this.parent.getCssClass(),
      change: function (k) {
        t.tableElement.style.cssText += 'border-width: ' + k.value + 'px;';
      },
    });
    this.tableBorderWidth.isStringTemplate = true;
    this.tableBorderWidth.appendTo(g.querySelector('#' + this.parent.getID() + '_borderWidth'));
    this.tableBorderColor.renderColorPickerInput(
      {
        container: L,
        containerType: 'quick',
        items: ['bordercolor'],
      },
      v(e.selectParent[0], 'table'),
    );
    L.setAttribute('aria-label', 'Border Color Picker');
    this.tableBackgroundColor.renderColorPickerInput(
      {
        container: A,
        containerType: 'quick',
        items: ['tablebackgroundcolor'],
      },
      v(e.selectParent[0], 'table'),
    );
    A.setAttribute('aria-label', 'Background Color Picker');
    this.tableBorderStyle.renderDropDowns(
      {
        container: O,
        containerType: 'quick',
        items: ['borderstyle'],
      },
      v(e.selectParent[0], 'table'),
    );
    O.setAttribute('aria-label', 'Table Styles Configuration');
    O.setAttribute('tabindex', '0');
    return g;
  };
  s.prototype.destroy = function () {
    if (!this.isDestroyed) {
      this.removeEventListener();
      if (this.tableCellSpacing && !this.tableCellSpacing.isDestroyed) {
        this.tableCellSpacing.destroy();
        this.tableCellSpacing = null;
      }
      if (this.tableCellPadding && !this.tableCellPadding.isDestroyed) {
        this.tableCellPadding.destroy();
        this.tableCellPadding = null;
      }
      if (this.tableWidthNum && !this.tableWidthNum.isDestroyed) {
        this.tableWidthNum.destroy();
        this.tableWidthNum = null;
      }
      if (this.rowTextBox && !this.rowTextBox.isDestroyed) {
        this.rowTextBox.destroy();
        this.rowTextBox = null;
      }
      if (this.columnTextBox && !this.columnTextBox.isDestroyed) {
        this.columnTextBox.destroy();
        this.columnTextBox = null;
      }
      if (this.createTableButton && !this.createTableButton.isDestroyed) {
        this.createTableButton.destroy();
        this.createTableButton = null;
      }
      if (this.tableBorderWidth && !this.tableBorderWidth.isDestroyed) {
        this.tableBorderWidth.destroy();
        this.tableBorderWidth = null;
      }
      if (this.tableBackgroundColor) {
        this.tableBackgroundColor.destroyColorPicker();
        this.tableBackgroundColor = null;
      }
      if (this.tableBorderColor) {
        this.tableBorderColor.destroyColorPicker();
        this.tableBorderColor = null;
      }
      if (this.tableBorderStyle) {
        this.tableBorderStyle.destroyDropDowns();
        this.tableBorderStyle = null;
      }
      this.createTablePopupBoundFn = null;
      this.isDestroyed = true;
    }
  };
  s.prototype.getModuleName = function () {
    return 'table';
  };
  s.prototype.afterKeyDown = function () {
    if (this.tableObj) {
      this.tableObj.afterKeyDown();
    }
  };
  s.prototype.createTablePopupKeyDown = function (e) {
    if (e.key === 'Escape') {
      var t = e.target.closest('.e-rte-table-popup');
      var i = Go(t, 'popup');
      var n = i.relateTo;
      i.hide();
      i.relateTo.focus({ preventScroll: true });
    }
  };
  return s;
})();
var vs = `
@charset "UTF-8";

* {
    box-sizing: border-box;
}

html {
    height: auto;
}

html, body {
    margin: 0;
}

body {
    color: #333;
    word-wrap: break-word;
}

.e-content {
    background: unset;
    min-height: 100px;
    outline: 0 solid transparent;
    padding: 16px;
    position: relative;
    overflow-x: auto;
    font-weight: normal;
    line-height: 1.5;
    font-size: 14px;
    text-align: inherit;
    font-family: "Roboto", "Segoe UI", "GeezaPro", "DejaVu Serif", "sans-serif", "-apple-system", "BlinkMacSystemFont";
}

.e-content p {
    margin: 0 0 10px;
    margin-bottom: 10px;
}
.e-rte-checklist > li:not(.e-rte-checklist-hidden) {
    list-style: none;
    position: relative;
}
.e-rte-checklist > li::before {
    content: '';
    position: absolute;
    top: 2px;
    box-sizing: content-box;
    left: -25px;
    width: 16px;
    height: 16px;
    border-radius: 2px;
    cursor: pointer;
}
.e-rte-checklist li.e-rte-checklist-checked::after {
    border-style: solid;
    border-width: 0 calc(16px / 8) calc(16px / 8) 0;
    box-sizing: content-box;
    content: '';
    display: block;
    height: 8px;
    width: 4px;
    left: -19px;
    position: absolute;
    top: 4.5px;
    transform: rotate(45deg);
    cursor: pointer;
}
.e-rtl {
    .e-rte-checklist li.e-rte-checklist-checked::after {
        right: -19px;
    }
    .e-rte-checklist > li::before {
        right: -25px;
    }
}
.e-content h1 {
    font-size: 2.857em;
    font-weight: 600;
    line-height: 1.2;
    margin: 10px 0;
}

.e-content h2 {
    font-size: 2.285em;
    font-weight: 600;
    line-height: 1.2;
    margin: 10px 0;
}

.e-content h3 {
    font-size: 2em;
    font-weight: 600;
    line-height: 1.2;
    margin: 10px 0;
}

.e-content h4 {
    font-size: 1.714em;
    font-weight: 600;
    line-height: 1.2;
    margin: 10px 0;
}

.e-content h5 {
    font-size: 1.428em;
    font-weight: 600;
    line-height: 1.2;
    margin: 10px 0;
}

.e-content h6 {
    font-size: 1.142em;
    font-weight: 600;
    line-height: 1.5;
    margin: 10px 0;
}

.e-content blockquote {
    margin: 10px 0;
    padding-left: 12px;
    border-left: 2px solid #5c5c5c;
}

.e-rtl.e-content blockquote {
    padding-left: 0;
    padding-right: 12px;
}

.e-content pre {
    border: 0;
    border-radius: 0;
    color: #333;
    font-size: inherit;
    line-height: inherit;
    margin: 0 0 10px;
    overflow: visible;
    padding: 0;
    white-space: pre-wrap;
    word-break: inherit;
    word-wrap: break-word;
}

.e-content code {
    background: #9d9d9d26;
    color: #ed484c;
}

.e-content strong,
.e-content b {
    font-weight: bold;
}

.e-content hr {
    margin: 10px 0;
    border: 2px solid rgba(176, 179, 184, 1);
}

.e-content hr:hover {
    cursor: default;
}

hr.e-rte-hr-focus {
    outline: 2px solid rgba(33, 150, 243, .3);
    outline-offset: 3px;
}

.e-content a {
    text-decoration: none;
    user-select: auto;
}

.e-content a:hover {
    text-decoration: underline;
}

.e-content li {
    margin-bottom: 10px;
}

.e-content li ol,
.e-content li ul {
    margin-block-start: 10px;
}

.e-content ul {
    list-style-type: disc;
}

.e-content ul ul,
.e-content ol ul {
    list-style-type: circle;
}

.e-content ul ul ul,
.e-content ol ul ul,
.e-content ul ol ul,
.e-content ol ol ul {
    list-style-type: square;
}

.e-content p:last-child,
.e-content pre:last-child,
.e-content blockquote:last-child {
    margin-bottom: 0;
}

.e-content h3 + h4,
.e-content h4 + h5,
.e-content h5 + h6 {
    margin-top: 0.6em;
}

.e-content ul:last-child {
    margin-bottom: 0;
}

.e-content table {
    margin-bottom: 10px;
    border-collapse: collapse;
    border-spacing: 0;
    empty-cells: show;
}

.e-content table.e-cell-select {
    position: relative;
}

.e-content table.e-cell-select::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    border: 2px double #4a90e2;
    pointer-events: none;
}

table .e-cell-select {
    border: 1px double #4a90e2 !important;
}

.e-content table.e-rte-table th {
    background-color: rgba(157, 157, 157, .15);
}

.e-rte-table td,
.e-rte-table th {
    border: 1px solid #BDBDBD;
    height: 20px;
    min-width: 20px;
    padding: 2px 5px;
}

.e-rte-table td.e-cell-select.e-multi-cells-select,
.e-rte-table th.e-cell-select.e-multi-cells-select {
    position: relative;
}

.e-rte-table td.e-cell-select.e-multi-cells-select::after,
.e-rte-table th.e-cell-select.e-multi-cells-select::after {
    background-color: rgba(13, 110, 253, 0.08);
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    bottom: 0;
    pointer-events: none;
    right: 0;
}

table td.e-multi-cells-select ::selection,
table th.e-multi-cells-select ::selection {
    background-color: transparent;
}

td.e-multi-cells-select,
th.e-multi-cells-select {
    user-select: none !important;
}

.e-rte-table.e-dashed-border > tbody > tr > td,
.e-rte-table.e-dashed-border > tbody > tr > th {
    border-style: dashed;
}

.e-rte-table.e-alternate-border > tbody > tr:nth-child(2n),
.e-rte-table.e-alternate-border > tbody > tr:nth-child(2n) > td,
.e-rte-table.e-alternate-border > tbody > tr:nth-child(2n) > th {
    background-color: #F5F5F5;
}

.e-rte-image,
.e-rte-audio,
.e-rte-video  {
    border: 0;
    cursor: pointer;
    display: block;
    float: none;
    margin: auto;
    max-width: 100%;
    position: relative;
}

.e-rte-image.e-imginline,
.e-rte-audio.e-audio-inline,
.e-rte-video.e-video-inline {
    margin-left: 5px;
    margin-right: 5px;
    display: inline-block;
    float: none;
    max-width: 100%;
    padding: 1px;
    vertical-align: bottom;
}

.e-rte-image.e-imgcenter,
.e-rte-video.e-video-center {
    cursor: pointer;
    display: block;
    float: none;
    margin: 5px auto;
    max-width: 100%;
    position: relative;
}

.e-rte-image.e-imgright,
.e-rte-video.e-video-right {
    float: right;
    margin: 0 auto;
    margin-left: 5px;
    text-align: right;
}

.e-rte-image.e-imgleft,
.e-rte-video.e-video-left {
    float: left;
    margin: 0 auto;
    margin-right: 5px;
    text-align: left;
}

.e-rte-img-caption {
    display: inline-block;
    margin: 5px auto;
    max-width: 100%;
    position: relative;
}

.e-rte-img-caption.e-caption-inline {
    display: inline-block;
    margin: 5px auto;
    margin-left: 5px;
    margin-right: 5px;
    max-width: calc(100% - (2 * 5px));
    position: relative;
    text-align: center;
    vertical-align: bottom;
}

.e-rte-img-caption.e-imgcenter {
    display: contents;
    margin-left: auto;
    margin-right: auto;
}

.e-rte-img-caption.e-imgright {
    display: contents;
    margin-left: auto;
    margin-right: 0;
}

.e-rte-img-caption.e-imgleft {
    display: contents;
    margin-left: 0;
    margin-right: auto;
}

.e-img-caption.e-rte-img-caption.e-imgbreak {
    display: contents;
}

.e-rte-img-caption .e-img-inner {
    display: block;
    font-size: 16px;
    font-weight: initial;
    margin: auto;
    opacity: .9;
    position: relative;
    text-align: center;
    width: 100%;
}

.e-img-wrap {
    display: inline-block;
    margin: auto;
    padding: 0;
    text-align: center;
    width: 100%;
}

.e-imgleft,
.e-video-left {
    float: left;
    margin: 0 5px 0 0;
    text-align: left;
}

.e-imgright,
.e-video-right {
    float: right;
    margin: 0 0 0 5px;
    text-align: right;
}

.e-imgcenter,
.e-video-center {
    cursor: pointer;
    display: block;
    float: none;
    height: auto;
    margin: 5px auto;
    max-width: 100%;
    position: relative;
}

.e-control img:not(.e-resize) {
    border: 2px solid transparent;
    z-index: 1000
}

.e-imginline,
.e-audio-inline,
.e-video-inline {
    display: inline-block;
    float: none;
    margin-left: 5px;
    margin-right: 5px;
    vertical-align: bottom;
}

.e-imgbreak,
.e-audio-break,
.e-video-break {
    border: 0;
    cursor: pointer;
    display: block;
    float: none;
    margin: 5px auto;
    max-width: 100%;
    position: relative;
}

.e-rte-image.e-img-focus:not(.e-resize),
.e-audio-focus:not(.e-resize),
.e-video-focus:not(.e-resize) {
    border: solid 2px #4a90e2;
}

img.e-img-focus::selection,
audio.e-audio-focus::selection,
.e-video-focus::selection {
    background: transparent;
    color: transparent;
}

span.e-rte-imageboxmark,
span.e-rte-videoboxmark {
    width: 10px;
    height: 10px;
    position: absolute;
    display: block;
    background: #4a90e2;
    border: 1px solid #fff;
    z-index: 1000;
}

.e-mob-rte.e-mob-span span.e-rte-imageboxmark,
.e-mob-rte.e-mob-span span.e-rte-videoboxmark {
    background: #4a90e2;
    border: 1px solid #fff;
}

.e-mob-rte span.e-rte-imageboxmark,
.e-mob-rte span.e-rte-videoboxmark {
    background: #fff;
    border: 1px solid #4a90e2;
    border-radius: 15px;
    height: 20px;
    width: 20px;
}

.e-mob-rte.e-mob-span span.e-rte-imageboxmark,
.e-mob-rte.e-mob-span span.e-rte-videoboxmark {
    background: #4a90e2;
    border: 1px solid #fff;
}

.e-content img.e-resize,
.e-content video.e-resize {
    z-index: 1000;
}

.e-img-caption .e-img-inner {
    outline: 0;
}

.e-rte-img-caption.e-imgleft .e-img-inner {
    float: left;
    text-align: left;
}

.e-rte-img-caption.e-imgright .e-img-inner {
    float: right;
    text-align: right;
}

.e-rte-img-caption.e-imgleft .e-img-wrap,
.e-rte-img-caption.e-imgright .e-img-wrap {
    display: contents;
}

.e-img-caption a:focus-visible {
    outline: none;
}

.e-rte-img-caption .e-rte-image.e-imgright {
    margin-left: auto;
    margin-right: 0;
}

.e-rte-img-caption .e-rte-image.e-imgleft {
    margin: 0;
}

.e-content {
    .e-clickelem::after {
        left: 0;
        right: 0;
        z-index: 1;
    }
    .e-clickelem::before {
        left: 0;
        right: 0;
        z-index: 1;
    }
    .e-clickelem::before {
        bottom: 70%;
        top: 0;
    }
    .e-clickelem::after {
        bottom: 0;
        top: 70%;
    }

    .e-audio-wrap {
        display: inline-block;
    }

    .e-clickelem {
        display: block;
        margin: 0;
        outline: none;
        padding: 0;
        position: relative;
    }

    .e-clickelem::after {
        background: transparent;
        content: '';
        cursor: default;
        display: block;
        position: absolute;
    }

    .e-clickelem::before {
        background: transparent;
        content: '';
        cursor: default;
        display: block;
        position: absolute;
    }
}

span.e-table-box {
    cursor: nwse-resize;
    display: block;
    height: 10px;
    position: absolute;
    width: 10px;
    background-color: #ffffff;
    border: 1px solid #BDBDBD;
}

span.e-table-box.e-rmob {
    height: 14px;
    width: 14px;
    background-color: #BDBDBD;
    border: 1px solid #BDBDBD;
}

.e-rte-table-resize.e-tb-col-insert,
.e-rte-table-resize.e-tb-row-insert {
  position: absolute;
  background-color: transparent;
  text-align: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  opacity: 0;
  color: #0F6CBD;
}

.e-rte-table-resize.e-tb-col-insert {
  width: 26px;
  height: 22px;
}

.e-rte-table-resize.e-tb-row-insert {
  width: 22px;
  height: 26px;
}

.e-rte-table-resize.e-tb-row-insert.e-insert-cell-rtl {
  right: 2px;
}

.e-rte-table-resize.e-tb-col-insert .e-icons.e-circle-add,
.e-rte-table-resize.e-tb-row-insert .e-icons.e-circle-add {
  font-size: 16px;
  line-height: 16px;
  border: 1px;
  position: absolute;
}

.e-rte-table-resize.e-tb-col-insert .e-icons.e-circle-add {
  top: -1px;
  left: 5px;
}

.e-rte-table-resize.e-tb-row-insert .e-icons.e-circle-add {
  top: 5.5px;
  left: -0.8px;
}

.e-rte-table-resize.e-tb-row-insert .e-icons.e-circle-add.e-insert-cell-rtl {
  left: 7px;
}

.e-rte-table-resize.e-tb-col-insert .e-icons.e-circle,
.e-rte-table-resize.e-tb-row-insert .e-icons.e-circle {
  font-size: 8px;
  line-height: 8px;
  border: 1px;
  position: absolute;
}

.e-rte-table-resize.e-tb-row-insert .e-icons.e-circle {
  top: 9px;
  left: 4px;
}

.e-rte-table-resize.e-tb-col-insert .e-icons.e-circle {
  top: 4px;
  left: 9px;
}

.e-rte-table-resize.e-tb-row-insert .e-icons.e-circle.e-insert-cell-rtl {
  left: 10px;
}

.e-row-resize,
.e-column-resize {
    background-color: transparent;
    background-repeat: repeat;
    bottom: 0;
    cursor: col-resize;
    height: 1px;
    overflow: visible;
    position: absolute;
    width: 1px;
}

.e-row-resize {
    cursor: row-resize;
    height: 1px;
}

.e-table-rhelper {
    cursor: col-resize;
    opacity: .87;
    position: absolute;
}

.e-table-rhelper.e-column-helper {
    width: 1px;
}

.e-table-rhelper.e-row-helper {
    height: 1px;
}

.e-icons.e-circle::before {
  content: '';
  display: inline-block;
  width: 8px;
  height: 8px;
  background-image: url('data:image/svg+xml,%3Csvg%20width%3D%228%22%20height%3D%228%22%20viewBox%3D%220%200%208%208%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%20%20%3Cg%20clip-path%3D%22url(%23clip0_circle_8)%22%3E%0A%20%20%20%20%3Crect%20width%3D%228%22%20height%3D%228%22%20fill%3D%22black%22%20fill-opacity%3D%220.01%22%2F%3E%0A%20%20%20%20%3Cpath%20d%3D%22M3.82767%200.571429L3.64626%200.589569L3.47392%200.60771L3.14739%200.680273L2.98413%200.725627L2.82086%200.780047L2.51247%200.907027L2.22222%201.07029L1.95011%201.25837L1.82313%201.35147L1.69615%201.46032L1.46032%201.69615L1.35147%201.82313L1.25837%201.95011L1.07029%202.22222L0.907027%202.51247L0.780047%202.82086L0.725627%202.98413L0.680273%203.14739L0.60771%203.47392L0.589569%203.64626L0.571429%203.82767V4.17233L0.589569%204.35374L0.60771%204.52608L0.680273%204.85261L0.725627%205.01587L0.780047%205.17914L0.907027%205.48753L1.07029%205.77778L1.25837%206.04989L1.35147%206.17687L1.46032%206.30385L1.69615%206.53968L1.82313%206.64853L1.95011%206.74163L2.22222%206.92971L2.51247%207.09297L2.82086%207.21995L2.98413%207.27437L3.14739%207.31973L3.47392%207.39229L3.64626%207.41043L3.82767%207.42857H4.17233L4.35374%207.41043L4.52608%207.39229L4.85261%207.31973L5.01587%207.27437L5.17914%207.21995L5.48753%207.09297L5.77778%206.92971L6.04989%206.74163L6.17687%206.64853L6.30385%206.53968L6.53968%206.30385L6.64853%206.17687L6.74163%206.04989L6.92971%205.77778L7.09297%205.48753L7.21995%205.17914L7.27437%205.01587L7.31973%204.85261L7.39229%204.52608L7.41043%204.35374L7.42857%204.17233V3.82767L7.41043%203.64626L7.39229%203.47392L7.31973%203.14739L7.27437%202.98413L7.21995%202.82086L7.09297%202.51247L6.92971%202.22222L6.74163%201.95011L6.64853%201.82313L6.53968%201.69615L6.30385%201.46032L6.17687%201.35147L6.04989%201.25837L5.77778%201.07029L5.48753%200.907027L5.17914%200.780047L5.01587%200.725627L4.85261%200.680273L4.52608%200.60771L4.35374%200.589569L4.17233%200.571429H3.82767ZM4%200L4.20862%200.00907027L4.41149%200.0181405L4.60771%200.0453515L4.80392%200.0816327L4.9977%200.126984L5.18821%200.181405L5.37869%200.244898L5.56009%200.317461L5.73242%200.390023L5.90476%200.480726L6.07709%200.580499L6.24036%200.680273L6.39456%200.798187L6.53968%200.916102L6.82993%201.17007L6.95691%201.30612L7.08389%201.45125L7.31973%201.75964L7.41953%201.9229L7.51934%202.0951L7.61014%202.26757L7.68254%202.43991L7.75514%202.62131L7.81859%202.81179L7.87301%203.0056L7.8844%203.19274L7.95467%203.39229L7.98186%203.5885L7.99093%203.79138L8%204L7.99093%204.20862L7.98186%204.41149L7.95467%204.60771L7.8844%204.80392L7.87301%204.9977L7.81859%205.18821L7.75514%205.37869L7.68254%205.56009L7.61014%205.73242L7.51934%205.90476L7.41953%206.07709L7.31973%206.24036L7.08389%206.54875L6.95691%206.69388L6.82993%206.82993L6.69388%206.95691L6.54875%207.08389L6.24036%207.31973L6.07709%207.41953L5.90476%207.51934L5.73242%207.61014L5.56009%207.68254L5.37869%207.75514L5.18821%207.81859L4.9977%207.87301L4.80392%207.8844L4.60771%207.95467L4.41149%207.98186L4.20862%207.99093L4%208L3.79138%207.99093L3.5885%207.98186L3.39229%207.95467L3.19274%207.8844L3.0056%207.87301L2.81179%207.81859L2.62131%207.75514L2.43991%207.68254L2.26757%207.61014L2.0951%207.51934L1.9229%207.41953L1.75964%207.31973L1.45125%207.08389L1.30612%206.95691L1.17007%206.82993L0.916102%206.53968L0.798187%206.39456L0.680273%206.24036L0.580499%206.07709L0.480726%205.90476L0.390023%205.73242L0.317461%205.56009L0.244898%205.37869L0.181405%205.18821L0.126984%204.9977L0.0816327%204.80392L0.0453515%204.60771L0.0181405%204.41149L0.00907027%204.20862L0%204L0.00907027%203.79138L0.0181405%203.5885L0.0453515%203.39229L0.0816327%203.19274L0.126984%203.0056L0.181405%202.81179L0.244898%202.62131L0.317461%202.43991L0.390023%202.26757L0.480726%202.0951L0.580499%201.9229L0.680273%201.75964L0.798187%201.60544L0.916102%201.46032L1.17007%201.17007L1.30612%201.04309L1.45125%200.916102L1.75964%200.680273L1.9229%200.580499L2.0951%200.480726L2.26757%200.390023L2.43991%200.317461L2.62131%200.244898L2.81179%200.181405L3.0056%200.126984L3.19274%200.0816327L3.39229%200.0453515L3.5885%200.0181405L3.79138%200.00907027L4%200Z%22%20fill%3D%22%230F6CBD%22%2F%3E%0A%20%20%3C%2Fg%3E%0A%20%20%3Cdefs%3E%0A%20%20%20%20%3CclipPath%20id%3D%22clip0_circle_8%22%3E%0A%20%20%20%20%20%20%3Crect%20width%3D%228%22%20height%3D%228%22%20fill%3D%22white%22%2F%3E%0A%20%20%20%20%3C%2FclipPath%3E%0A%20%20%3C%2Fdefs%3E%0A%3C%2Fsvg%3E');
}

.e-icons.e-circle-add::before {
  content: '';
  display: inline-block;
  width: 16px;
  height: 16px;
  background-image: url('data:image/svg+xml,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Cg%20clip-path%3D%22url(%23clip0_1124_24361)%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22black%22%20fill-opacity%3D%220.01%22%2F%3E%0A%3Cpath%20d%3D%22M8.10169%204.27119L8.20339%204.30508L8.30508%204.35593L8.44068%204.49153L8.49153%204.59322L8.52542%204.69492L8.54237%204.79661V7.45763H11.2034L11.3051%207.47458L11.4068%207.50847L11.5085%207.55932L11.6441%207.69492L11.6949%207.79661L11.7288%207.89831V8.10169L11.6949%208.20339L11.6441%208.30508L11.5085%208.44068L11.4068%208.49153L11.3051%208.52542L11.2034%208.54237H8.54237V11.2034L8.52542%2011.3051L8.49153%2011.4068L8.44068%2011.5085L8.30508%2011.6441L8.20339%2011.6949L8.10169%2011.7288H7.89831L7.79661%2011.6949L7.69492%2011.6441L7.55932%2011.5085L7.50847%2011.4068L7.47458%2011.3051L7.45763%2011.2034V8.54237H4.79661L4.69492%208.52542L4.59322%208.49153L4.49153%208.44068L4.35593%208.30508L4.30508%208.20339L4.27119%208.10169V7.89831L4.30508%207.79661L4.35593%207.69492L4.49153%207.55932L4.59322%207.50847L4.69492%207.47458L4.79661%207.45763H7.45763V4.79661L7.47458%204.69492L7.50847%204.59322L7.55932%204.49153L7.69492%204.35593L7.79661%204.30508L7.89831%204.27119H8.10169ZM8%201.05085L7.64407%201.0678L7.28814%201.10169L6.94915%201.13559L6.59322%201.20339L6.27119%201.27119L5.9322%201.37288L5.61017%201.47458L5.30508%201.61017L4.98305%201.74576L4.69492%201.89831L4.11864%202.23729L3.84746%202.44068L3.59322%202.64407L3.08475%203.08475L2.64407%203.59322L2.44068%203.84746L2.23729%204.11864L1.89831%204.69492L1.74576%204.98305L1.61017%205.30508L1.47458%205.61017L1.37288%205.9322L1.27119%206.27119L1.20339%206.59322L1.13559%206.94915L1.10169%207.28814L1.0678%207.64407L1.05085%208L1.0678%208.35593L1.10169%208.71186L1.13559%209.05085L1.20339%209.40678L1.27119%209.72881L1.37288%2010.0678L1.47458%2010.3898L1.61017%2010.6949L1.74576%2011.0169L1.89831%2011.3051L2.23729%2011.8814L2.44068%2012.1525L2.64407%2012.4068L3.08475%2012.9153L3.59322%2013.3559L3.84746%2013.5593L4.11864%2013.7627L4.69492%2014.1017L4.98305%2014.2542L5.30508%2014.3898L5.61017%2014.5254L5.9322%2014.6271L6.27119%2014.7288L6.59322%2014.7966L6.94915%2014.8644L7.28814%2014.8983L7.64407%2014.9322L8%2014.9492L8.35593%2014.9322L8.71186%2014.8983L9.05085%2014.8644L9.40678%2014.7966L9.72881%2014.7288L10.0678%2014.6271L10.3898%2014.5254L10.6949%2014.3898L11.0169%2014.2542L11.3051%2014.1017L11.8814%2013.7627L12.1525%2013.5593L12.4068%2013.3559L12.9153%2012.9153L13.3559%2012.4068L13.5593%2012.1525L13.7627%2011.8814L14.1017%2011.3051L14.2542%2011.0169L14.3898%2010.6949L14.5254%2010.3898L14.6271%2010.0678L14.7288%209.72881L14.7966%209.40678L14.8644%209.05085L14.8983%208.71186L14.9322%208.35593L14.9492%208L14.9322%207.64407L14.8983%207.28814L14.8644%206.94915L14.7966%206.59322L14.7288%206.27119L14.6271%205.9322L14.5254%205.61017L14.3898%205.30508L14.2542%204.98305L14.1017%204.69492L13.7627%204.11864L13.5593%203.84746L13.3559%203.59322L12.9153%203.08475L12.4068%202.64407L12.1525%202.44068L11.8814%202.23729L11.3051%201.89831L11.0169%201.74576L10.6949%201.61017L10.3898%201.47458L10.0678%201.37288L9.72881%201.27119L9.40678%201.20339L9.05085%201.13559L8.71186%201.10169L8.35593%201.0678L8%201.05085ZM8.40678%200L8.81356%200.0338983L9.22034%200.0847458L9.61017%200.152542L10%200.237288L10.7458%200.474576L11.1186%200.627119L11.4746%200.779661L12.1525%201.15254L12.4746%201.35593L12.7966%201.57627L13.1017%201.81356L13.3898%202.0678L13.9322%202.61017L14.1864%202.89831L14.4237%203.20339L14.6441%203.52542L14.8475%203.84746L15.2203%204.52542L15.3729%204.88136L15.5254%205.25424L15.6441%205.61017L15.7627%206L15.8475%206.38983L15.9153%206.77966L15.9661%207.18644L16%207.59322V8.40678L15.9661%208.81356L15.9153%209.22034L15.8475%209.61017L15.7627%2010L15.6441%2010.3898L15.5254%2010.7458L15.3729%2011.1186L15.2203%2011.4746L14.8475%2012.1525L14.6441%2012.4746L14.4237%2012.7966L14.1864%2013.1017L13.9322%2013.3898L13.3898%2013.9322L13.1017%2014.1864L12.7966%2014.4237L12.4746%2014.6441L12.1525%2014.8475L11.4746%2015.2203L11.1186%2015.3729L10.7458%2015.5254L10%2015.7627L9.61017%2015.8475L9.22034%2015.9153L8.81356%2015.9661L8.40678%2016H7.59322L7.18644%2015.9661L6.77966%2015.9153L6.38983%2015.8475L6%2015.7627L5.25424%2015.5254L4.88136%2015.3729L4.52542%2015.2203L3.84746%2014.8475L3.52542%2014.6441L3.20339%2014.4237L2.89831%2014.1864L2.61017%2013.9322L2.0678%2013.3898L1.81356%2013.1017L1.57627%2012.7966L1.35593%2012.4746L1.15254%2012.1525L0.779661%2011.4746L0.627119%2011.1186L0.474576%2010.7458L0.237288%2010L0.152542%209.61017L0.0847458%209.22034L0.0338983%208.81356L0%208.40678V7.59322L0.0338983%207.18644L0.0847458%206.77966L0.152542%206.38983L0.237288%206L0.474576%205.25424L0.627119%204.88136L0.779661%204.52542L1.15254%203.84746L1.35593%203.52542L1.57627%203.20339L1.81356%202.89831L2.0678%202.61017L2.61017%202.0678L2.89831%201.81356L3.20339%201.57627L3.52542%201.35593L3.84746%201.15254L4.52542%200.779661L4.88136%200.627119L5.25424%200.474576L6%200.237288L6.38983%200.152542L6.77966%200.0847458L7.18644%200.0338983L7.59322%200H8.40678Z%22%20fill%3D%22%230F6CBD%22%2F%3E%0A%3C%2Fg%3E%0A%3Cdefs%3E%0A%3CclipPath%20id%3D%22clip0_1124_24361%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22white%22%2F%3E%0A%3C%2FclipPath%3E%0A%3C%2Fdefs%3E%0A%3C%2Fsvg%3E%20%20%0A');
}

.e-reicon::before {
    border-bottom: 6px solid transparent;
    border-right: 6px solid;
    border-top: 6px solid transparent;
    content: '';
    display: block;
    height: 0;
    position: absolute;
    right: 4px;
    top: 4px;
    width: 20px;
}

.e-reicon::after {
    border-bottom: 6px solid transparent;
    border-left: 6px solid;
    border-top: 6px solid transparent;
    content: '';
    display: block;
    height: 0;
    left: 4px;
    position: absolute;
    top: 4px;
    width: 20px;
    z-index: 3;
}

.e-row-helper.e-reicon::after {
    top: 10px;
    transform: rotate(90deg);
}

.e-row-helper.e-reicon::before {
    left: 4px;
    top: -20px;
    transform: rotate(90deg);
}

.e-table-rhelper {
    background-color: #0F6CBD;
}

.e-rtl {
    direction: rtl;
}

.e-rte-placeholder::before {
    content: attr(placeholder);
    opacity: 0.54;
    overflow: hidden;
    padding-top: 16px;
    position: absolute;
    text-align: start;
    top: 0;
    z-index: 1;
}

.e-resize-enabled,
.e-count-enabled {
    padding-bottom: 0px;
}
pre[data-language] {
    font-family: Space Mono;
    border-radius: 6px;
    padding: 20px 16px 16px;
    position: relative;
}
pre[data-language] code{
    background: none;
    color: #645454;
}
pre[data-language]::before {
    content: attr(data-language);
    font-family: 'Helvetica Neue';
    font-weight: 500;
    font-size: 12px;
    line-height: 18px;
    right: 8px;
    padding: 2px 4px;
    top: -1px;
    border-radius: 0px 0px 4px 4px;
    position: absolute;
}
`;
var bs = `
pre[data-language] {
    background-color: rgba(157, 157, 157, 0.08);
    color: rgba(46, 46, 46, 1);
    border: 1px solid rgba(229, 231, 235, 1);
}
pre[data-language]::before {
    background-color: rgba(105, 105, 105, 1);
    color: rgba(249, 250, 251, 1);
}
.e-rte-checklist > li::before {
   border: 1px solid rgba(97, 97, 97, 1);
}
.e-rte-checklist li.e-rte-checklist-checked::before {
  background: rgba(15, 108, 189, 1);
  border: 1px solid rgba(15, 108, 189, 1);
}
.e-rte-checklist li.e-rte-checklist-checked::after {
  border-color: rgba(255, 255, 255, 1);
}
`;
var Cs = `
pre[data-language] {
    background-color: rgba(157, 157, 157, 0.08);
    color: rgba(245, 245, 245, 1);
    border: 1px solid rgba(40, 47, 60, 1);
}
pre[data-language]::before {
    background-color: rgba(189, 186, 186, 1);
    color: rgba(29, 36, 50, 1);
}
.e-rte-checklist > li::before {
   border: 1px solid rgba(173, 173, 173, 1);
}
.e-rte-checklist li.e-rte-checklist-checked::before {
  background: rgba(17, 94, 163, 1);
  border: 1px solid rgba(17, 94, 163, 1);
}
.e-rte-checklist li.e-rte-checklist-checked::after {
  border-color: rgba(255, 255, 255, 1);
}
`;
var ys = (function () {
  var s = function (e, t) {
    s =
      Object.setPrototypeOf ||
      ({ __proto__: [] } instanceof Array &&
        function (i, n) {
          i.__proto__ = n;
        }) ||
      function (i, n) {
        for (var r in n)
          if (n.hasOwnProperty(r)) {
            i[r] = n[r];
          }
      };
    return s(e, t);
  };
  return function (e, t) {
    s(e, t);
    function i() {
      this.constructor = e;
    }
    e.prototype = t === null ? Object.create(t) : ((i.prototype = t.prototype), new i());
  };
})();
var Ts = (function (s) {
  ys(e, s);
  function e() {
    var t = (s !== null && s()) || this;
    t.styles = t.getEditorStyles();
    t.IFRAMEHEADER =
      `
    <!DOCTYPE html> 
    <html>
         <head>
            <meta charset='utf-8' /> 
            <style>` +
      t.styles +
      `
            </style>
        </head>
    `;
    return t;
  }
  e.prototype.getEditorStyles = function () {
    var t = vs.replace(/[\n\t]/g, '');
    var i = window.getComputedStyle(this.parent.element.querySelector('.e-rte-container'));
    var n = i.content.includes('dark-theme');
    var r = (n ? Cs : bs).replace(/[\n\t]/g, '');
    return t + r;
  };
  e.prototype.renderPanel = function () {
    var t = this.parent;
    var i = Or(this.parent.value, this.parent);
    var n =
      '<body contenteditable="true" aria-label="Rich Text Editor" role="textbox" lang="' +
      this.parent.locale.slice(0, 2) +
      '" dir="' +
      (this.parent.enableRtl ? 'rtl' : 'ltr') +
      '">' +
      i +
      '</body></html>';
    var r = this.IFRAMEHEADER + n;
    var o = this.parent.createElement('iframe', {
      id: this.parent.getID() + '_rte-view',
      className: 'e-rte-content',
      attrs: { srcdoc: r },
    });
    o.setAttribute('role', 'none');
    this.setPanel(o);
    if (!p(this.parent.iframeSettings.sandbox)) {
      var a = this.parent.iframeSettings.sandbox
        .map(function (u) {
          return u.toLocaleLowerCase().trim();
        })
        .join(' ');
      if (!a.includes('allow-same-origin')) {
        a += ' allow-same-origin';
      }
      o.setAttribute('sandbox', a.trim());
    }
    var l = E('div', { className: Qr });
    this.parent.rootContainer.appendChild(l);
    l.appendChild(o);
    o.contentDocument.body.setAttribute('aria-owns', this.parent.getID());
    o.contentDocument.open();
    r = this.setThemeColor(r, { color: '#333' });
    o.contentDocument.write(r);
    o.contentDocument.close();
    var h = o.contentDocument.body;
    h.className = 'e-content';
    if (this.parent.height === 'auto') {
      h.style.overflowY = 'hidden';
    }
    if (!p(this.parent.fontFamily.default)) {
      h.style.fontFamily = this.parent.fontFamily.default;
    }
    if (!p(this.parent.fontSize.default)) {
      h.style.fontSize = this.parent.fontSize.default;
    }
    h.id = this.parent.getID() + '_rte-edit-view';
    if (this.parent.enableRtl) {
      this.contentPanel.contentDocument.body.classList.add('e-rtl');
    }
    if (!p(o.contentDocument.head) && this.parent.iframeSettings.metaTags.length > 0) {
      var c = o.contentDocument.head;
      var d = this.parent.iframeSettings.metaTags;
      d.forEach(function (u) {
        var f = document.createElement('meta');
        for (var m in u)
          if (!p(u[m])) {
            f.setAttribute(m === 'httpEquiv' ? 'http-equiv' : m, u[m]);
          }
        o.contentDocument.head.appendChild(f);
      });
    }
  };
  e.prototype.setThemeColor = function (t, i) {
    var n = getComputedStyle(this.parent.element, '.e-richtexteditor').getPropertyValue('color');
    return t.replace(i.color, n);
  };
  e.prototype.getEditPanel = function () {
    var t;
    p(this.contentPanel.contentDocument)
      ? (t = this.parent.inputElement)
      : (t = this.contentPanel.contentDocument.body);
    return t;
  };
  e.prototype.getDocument = function () {
    return this.getEditPanel().ownerDocument;
  };
  return e;
})(Vr);
var Ss = (function () {
  function s(e) {
    this.parent = e;
  }
  s.prototype.renderPopup = function (e) {
    this.type = e;
    var t = this.type === 'Inline' ? Xn + ' ' + Xo : Xn;
    var i = this.type === 'Inline' ? '_Inline_Quick_Popup' : '_Quick_Popup';
    var n = Yo(this.parent.getID() + '_' + e + i);
    this.popupElement = this.parent.createElement('div', { className: t + ' ' + Be });
    this.popupElement.setAttribute('aria-owns', this.parent.getID());
    this.popupElement.id = n;
    var r = this.parent.createElement('div', { className: Wr });
    this.popupElement.appendChild(r);
    this.popup = this.createPopup(this.type, this.popupElement);
    return this.popup;
  };
  s.prototype.quickToolbarOpen = function () {
    var e = this.popup;
    this.parent.trigger(Jo, this.popup);
  };
  s.prototype.createPopup = function (e, t) {
    var i;
    switch (e) {
      case 'Inline':
      case 'Text':
      case 'Link':
      case 'Audio':
        i = new on(t, {
          viewPortElement: this.parent.iframeSettings.enable ? null : this.parent.contentModule.getEditPanel(),
          zIndex: 9,
          collision: {
            X: 'fit',
            Y: 'flip',
          },
          position: {
            X: 'left',
            Y: 'top',
          },
          actionOnScroll: 'none',
          open: this.quickToolbarOpen.bind(this),
        });
        break;
      case 'Video':
      case 'Image':
      case 'Table':
        i = new on(t, {
          viewPortElement: this.parent.iframeSettings.enable ? null : this.parent.contentModule.getEditPanel(),
          zIndex: 9,
          collision: {
            X: 'fit',
            Y: 'flip',
          },
          position: {
            X: 'left',
            Y: 'top',
          },
          actionOnScroll: 'none',
          open: this.quickToolbarOpen.bind(this),
        });
        break;
    }
    return i;
  };
  return s;
})();
var gn = (function () {
  function s(e, t) {
    this.tools = {};
    this.parent = e;
    this.locator = t;
    this.isDestroyed = false;
    this.renderFactory = this.locator.getService('rendererFactory');
    this.addEventListener();
    this.parent.toolbarSettings && Object.keys(this.parent.toolbarSettings.itemConfigs).length > 0
      ? ut(this.tools, ft, bn(this.parent.toolbarSettings.itemConfigs), true)
      : (this.tools = ft);
    if (this.parent.toolbarSettings.enable || this.parent.quickToolbarSettings.enable) {
      this.toolbarRenderer = new wr(this.parent, this.locator);
      this.renderFactory.addRenderer(te.Toolbar, this.toolbarRenderer);
    }
  }
  s.prototype.addEventListener = function () {
    this.parent.on(Je, this.setRtl, this);
    this.parent.on(he, this.setCssClass, this);
  };
  s.prototype.removeEventListener = function () {
    this.parent.off(Je, this.setRtl);
    this.parent.off(he, this.setCssClass);
  };
  s.prototype.setCssClass = function (e) {
    if (!p(this.toolbarObj)) {
      p(e.oldCssClass)
        ? this.toolbarObj.setProperties({ cssClass: (this.toolbarObj.cssClass + ' ' + e.cssClass).trim() })
        : this.toolbarObj.setProperties({
            cssClass: (this.toolbarObj.cssClass.replace(e.oldCssClass, '').trim() + ' ' + e.cssClass).trim(),
          });
    }
  };
  s.prototype.setRtl = function (e) {
    if (!p(this.toolbarObj)) {
      this.toolbarObj.setProperties({ enableRtl: e.enableRtl });
    }
  };
  s.prototype.getClass = function (e) {
    var t;
    switch (e) {
      case 'fontsize':
        t = 'e-rte-inline-size-template';
        break;
      case 'fontcolor':
      case 'backgroundcolor':
        t = 'e-rte-inline-color-template';
        break;
      default:
        t = 'e-rte-inline-template';
        break;
    }
    return t;
  };
  s.prototype.getTemplateObject = function (e, t) {
    var i;
    switch (e) {
      case 'fontcolor':
      case 'backgroundcolor':
        i = 'span';
        break;
      default:
        i = 'button';
        break;
    }
    return {
      command: this.tools[e.toLocaleLowerCase()].command,
      subCommand: this.tools[e.toLocaleLowerCase()].subCommand,
      template: this.parent.createElement(i, {
        id: this.parent.getID() + '_' + t + '_' + this.tools[e.toLocaleLowerCase()].id,
      }).outerHTML,
      cssClass: this.parent.inlineMode.enable ? this.getClass(e) : '',
      tooltipText: this.parent.enabled ? Nt(e, this.locator) : '',
    };
  };
  s.prototype.getObject = function (e, t) {
    var i = e.toLowerCase();
    if (Cn.indexOf(i) !== -1) return this.getTemplateObject(i, t);
    switch (i) {
      case '|':
        return { type: 'Separator' };
      case '-':
        return {
          type: 'Separator',
          cssClass: $o,
        };
      default:
        return {
          id: this.parent.getID() + '_' + t + '_' + this.tools[i.toLocaleLowerCase()].id,
          prefixIcon: this.tools[i.toLocaleLowerCase()].icon,
          tooltipText: this.parent.enabled ? Nt(i, this.locator) : '',
          command: this.tools[i.toLocaleLowerCase()].command,
          subCommand: this.tools[i.toLocaleLowerCase()].subCommand,
        };
    }
  };
  s.prototype.getItems = function (e, t) {
    var i = this;
    if (this.parent.toolbarSettings.items.length < 1) return [];
    for (
      var n = [],
        r = function (f) {
          switch (typeof f) {
            case 'string': {
              var m = o.getObject(f, t);
              var g = f.toLowerCase().indexOf('imagelink') > -1;
              if (g) {
                m.cssClass = 'e-link-groups';
              }
              n.push(m);
              break;
            }
            default:
              if (!p(f.click)) {
                var b = f;
                var C = b.click;
                b.click = function () {
                  if (b.undo && i.parent.formatter.getUndoRedoStack().length === 0) {
                    i.parent.formatter.saveData();
                  }
                  b.click.call(i);
                  if (i.parent.formatter.getUndoRedoStack().length > 0) {
                    var N = i.parent.createElement('div');
                    var w = i.parent.formatter.getUndoRedoStack()[i.parent.formatter.getUndoRedoStack().length - 1];
                    var T = i.parent.formatter
                      .getUndoRedoStack()
                      [i.parent.formatter.getUndoRedoStack().length - 1].text.cloneNode(true);
                    N.appendChild(T);
                    if (N.innerHTML.trim() === i.parent.inputElement.innerHTML.trim()) return;
                  }
                  if (b.undo) {
                    i.parent.formatter.saveData();
                  }
                };
              }
              n.push(f);
          }
        },
        o = this,
        a = 0,
        l = e;
      a < l.length;
      a++
    ) {
      var h = l[a];
      r(l[a]);
    }
    if (this.parent.showTooltip && this.parent.enabled)
      for (
        var c = function (f) {
            var m = n[f].tooltipText;
            var g = void 0;
            var b = d.parent.userAgentData.getPlatform() === 'macOS';
            if (Yn['' + n[f].subCommand] && (!p(n[f].id) || !p(n[f].cssClass))) {
              var C = Yn['' + n[f].subCommand].split(',');
              g = C.map(function (N) {
                return b ? N.replace('Ctrl+', '\u2318').replace('Shift+', '\u21E7').replace('Alt+', '\u2325') : N;
              }).join(', ');
            } else g = n[f].tooltipText;
            if (g) {
              if (!(n[f].command === 'Images' && n[f].subCommand === 'InsertLink')) {
                n[f].tooltipText = n[f].tooltipText !== g ? n[f].tooltipText + ' (' + g + ')' : n[f].tooltipText;
              }
            }
          },
          d = this,
          u = 0;
        u < n.length;
        u++
      )
        c(u);
    return n;
  };
  s.prototype.getToolbarOptions = function (e) {
    return {
      target: e.target,
      rteToolbarObj: this,
      items: this.getItems(e.items, e.container),
      overflowMode: e.mode,
      enablePersistence: this.parent.enablePersistence,
      enableRtl: this.parent.enableRtl,
      cssClass: e.cssClass,
      type: e.container,
    };
  };
  s.prototype.render = function (e) {
    this.toolbarRenderer = this.renderFactory.getRenderer(te.Toolbar);
    if (this.toolbarRenderer && this.toolbarRenderer.isDestroyed) {
      this.toolbarRenderer = new wr(this.parent, this.locator);
    }
    this.toolbarRenderer.renderToolbar(this.getToolbarOptions(e));
  };
  s.prototype.destroy = function () {
    if (!this.isDestroyed) {
      this.removeEventListener();
      if (this.toolbarObj && !this.toolbarObj.isDestroyed) {
        this.toolbarObj.destroy();
        this.toolbarObj = null;
      }
      this.toolbarRenderer.destroy();
      this.toolbarRenderer = null;
      this.tools = {};
      this.isDestroyed = true;
    }
  };
  return s;
})();
var yn = (function () {
  function s(e, t) {
    this.parent = e;
    this.locator = t;
    this.i10n = t.getService('rteLocale');
    this.renderFactory = this.locator.getService('rendererFactory');
    this.addEventListener();
  }
  s.prototype.initializeInstance = function () {
    this.toolbarRenderer = this.renderFactory.getRenderer(te.Toolbar);
  };
  s.prototype.beforeRender = function (e) {
    var t = e.item;
    if (e.item.cssClass) {
      B([e.element], e.item.cssClass);
    }
  };
  s.prototype.dropdownContent = function (e, t, i) {
    return (
      '<span class="e-rte-dropdown-btn-text-wrapper" style="width:' +
      (t === 'quick' ? 'auto' : e) +
      '" ><span class="e-rte-dropdown-btn-text">' +
      i +
      '</span></span>'
    );
  };
  s.prototype.renderDropDowns = function (e, t) {
    var i = this;
    this.initializeInstance();
    var n = e.containerType;
    var r = e.container;
    Cn.forEach(function (o) {
      var a = void 0;
      if (Ur(o, e.items) !== -1)
        switch (o) {
          case 'numberformatlist': {
            a = _('#' + i.parent.getID() + '_' + e.containerType + '_NumberFormatList', e.container);
            if (p(a) || a.classList.contains(se)) return;
            var l = i.parent.numberFormatList.types.slice();
            l.forEach(function (O) {
              Object.defineProperties(O, {
                command: {
                  value: 'Lists',
                  enumerable: true,
                },
                subCommand: {
                  value: 'NumberFormatList',
                  enumerable: true,
                },
              });
            });
            i.numberFormatListDropDown = i.toolbarRenderer.renderSplitButton({
              cssClass: la + ' ' + Be + ' ' + Ve,
              itemName: 'NumberFormatList',
              items: l,
              element: a,
              iconCss: 'e-order-list ' + Gt,
            });
            break;
          }
          case 'bulletformatlist': {
            a = _('#' + i.parent.getID() + '_' + e.containerType + '_BulletFormatList', e.container);
            if (p(a) || a.classList.contains(se)) return;
            var h = i.parent.bulletFormatList.types.slice();
            h.forEach(function (O) {
              Object.defineProperties(O, {
                command: {
                  value: 'Lists',
                  enumerable: true,
                },
                subCommand: {
                  value: 'BulletFormatList',
                  enumerable: true,
                },
              });
            });
            i.bulletFormatListDropDown = i.toolbarRenderer.renderSplitButton({
              cssClass: sa + ' ' + Be + ' ' + Ve,
              itemName: 'BulletFormatList',
              items: h,
              element: a,
              iconCss: 'e-unorder-list ' + Gt,
            });
            break;
          }
          case 'codeblock': {
            a = _('#' + i.parent.getID() + '_' + e.containerType + '_codeBlock', e.container);
            if (p(a) || a.classList.contains(se)) return;
            var c = (p(i.parent.codeBlockSettings.languages) ? [] : i.parent.codeBlockSettings.languages).slice();
            c.forEach(function (O) {
              Object.defineProperties(O, {
                command: {
                  value: 'CodeBlock',
                  enumerable: true,
                },
                subCommand: {
                  value: 'CodeBlock',
                  enumerable: true,
                },
                text: {
                  value: O.label,
                  enumerable: true,
                },
                value: {
                  value: O.language,
                  enumerable: true,
                },
              });
            });
            i.codeBlockSplitButton = i.toolbarRenderer.renderSplitButton({
              cssClass: 'e-code-block ' + aa + ' ' + Be + ' e-rte-dropdown',
              itemName: 'CodeBlock',
              items: c,
              element: a,
              iconCss: oa + ' e-icons',
            });
            break;
          }
          case 'formats': {
            a = _('#' + i.parent.getID() + '_' + e.containerType + '_Formats', e.container);
            if (p(a) || a.classList.contains(se)) return;
            var d = i.parent.format.types.slice();
            d.forEach(function (O) {
              Object.defineProperties(O, {
                command: {
                  value: 'Formats',
                  enumerable: true,
                },
                subCommand: {
                  value: O.value,
                  enumerable: true,
                },
              });
            });
            var u = p(i.parent.format.default) ? d[0].text : i.parent.format.default;
            i.formatDropDown = i.toolbarRenderer.renderDropDownButton({
              content: i.dropdownContent(
                i.parent.format.width,
                e.containerType,
                e.containerType === 'quick' ? '' : Ae(d, u, 'text', 'text'),
              ),
              cssClass: fe + ' ' + ke + ' ' + ra,
              itemName: 'Formats',
              items: d,
              element: a,
            });
            break;
          }
          case 'fontname': {
            a = _('#' + i.parent.getID() + '_' + e.containerType + '_FontName', e.container);
            if (p(a) || a.classList.contains(se)) return;
            var f = i.parent.fontFamily.items.slice();
            f.forEach(function (O) {
              Object.defineProperties(O, {
                command: {
                  value: 'Font',
                  enumerable: true,
                },
                subCommand: {
                  value: 'FontName',
                  enumerable: true,
                },
              });
            });
            var m = p(i.parent.fontFamily.default) ? (f.length === 0 ? '' : f[0].text) : i.parent.fontFamily.default;
            i.fontNameDropDown = i.toolbarRenderer.renderDropDownButton({
              content: i.dropdownContent(
                i.parent.fontFamily.width,
                e.containerType,
                f.length === 0
                  ? i.i10n.getConstant('fontName')
                  : e.containerType === 'quick'
                    ? ''
                    : Ae(f, m, 'text', 'text') === 'Default'
                      ? i.i10n.getConstant('fontName')
                      : Ae(f, m, 'text', 'text'),
              ),
              cssClass: fe + ' ' + ke + ' ' + na,
              itemName: 'FontName',
              items: f,
              element: a,
            });
            break;
          }
          case 'fontsize': {
            a = _('#' + i.parent.getID() + '_' + e.containerType + '_FontSize', e.container);
            if (p(a) || a.classList.contains(se)) return;
            var g =
              !p(i.fontSizeDropDown) && !p(i.fontSizeDropDown.items) && i.fontSizeDropDown.items.length > 0
                ? i.fontSizeDropDown.items
                : JSON.parse(JSON.stringify(i.parent.fontSize.items.slice()));
            g.forEach(function (O) {
              Object.defineProperties(O, {
                command: {
                  value: 'Font',
                  enumerable: true,
                },
                subCommand: {
                  value: 'FontSize',
                  enumerable: true,
                },
              });
            });
            var b = p(i.parent.fontSize.default) ? (g.length === 0 ? '' : g[0].text) : i.parent.fontSize.default;
            var C =
              b === 'Default'
                ? Ae(g, b.replace(/\s/g, ''), 'text', 'text')
                : Ae(g, b.replace(/\s/g, ''), 'value', 'text');
            i.fontSizeDropDown = i.toolbarRenderer.renderDropDownButton({
              content: i.dropdownContent(
                i.parent.fontSize.width,
                e.containerType,
                g.length === 0
                  ? i.i10n.getConstant('fontSize')
                  : $n(C === 'Default' ? i.i10n.getConstant('fontSize') : C),
              ),
              cssClass: fe + ' ' + ke + ' ' + ia,
              itemName: 'FontSize',
              items: g,
              element: a,
            });
            break;
          }
          case 'alignments':
            {
              a = _('#' + i.parent.getID() + '_' + e.containerType + '_Alignments', e.container);
              if (p(a) || a.classList.contains(se)) return;
            }
            i.alignDropDown = i.toolbarRenderer.renderDropDownButton({
              iconCss: 'e-justify-left e-icons',
              cssClass: fe + ' ' + ke + ' ' + ta,
              itemName: 'Alignments',
              items: ea,
              element: a,
            });
            break;
          case 'align':
          case 'videoalign':
            i.renderAlignmentDropDown(e.containerType, e.container, t, o);
            break;
          case 'display':
          case 'audiolayoutoption':
          case 'videolayoutoption':
            i.renderDisplayDropDown(e.containerType, e.container, t, o);
            break;
          case 'tablerows':
            i.rowDropDown(e.containerType, e.container, a, t);
            break;
          case 'tablecolumns':
            i.columnDropDown(e.containerType, e.container, a);
            break;
          case 'tablecell':
            i.cellDropDown(e.containerType, e.container, a);
            break;
          case 'tablecellverticalalign':
            i.verticalAlignDropDown(e.containerType, e.container, a);
            break;
          case 'styles':
            i.tableStylesDropDown(e.containerType, e.container, a);
            break;
          case 'borderstyle': {
            a = e.container;
            for (var N = void 0, w = 0, T = Jn; w < T.length; w++) {
              var S = T[w];
              if (t.style.borderStyle === T[w].subCommand.toLowerCase()) {
                N = T[w].text;
                break;
              }
            }
            i.tableBorderStyleDropDown = i.toolbarRenderer.renderDropDownButton({
              content:
                '<span class="e-rte-dropdown-btn-text-wrapper"><span class="e-rte-dropdown-btn-text">' +
                N +
                '</span></span>',
              cssClass: fe + ' ' + ke + ' ' + Zo,
              itemName: 'BorderStyle',
              items: Jn,
              element: a,
            });
            break;
          }
        }
    });
    if (this.parent.inlineMode.enable) {
      this.setCssClass({ cssClass: this.parent.getCssClass() });
    }
  };
  s.prototype.getUpdateItems = function (e, t) {
    var i = e.slice();
    i.forEach(function (n) {
      Object.defineProperties(n, {
        command: {
          value: t === 'Format' ? 'Formats' : 'Font',
          enumerable: true,
        },
        subCommand: {
          value: t === 'Format' ? n.value : t,
          enumerable: true,
        },
      });
    });
    return i;
  };
  s.prototype.onPropertyChanged = function (e) {
    for (var t = e.newProp, i, n, r = 0, o = Object.keys(t); r < o.length; r++) {
      var a = o[r];
      switch (o[r]) {
        case 'fontFamily':
          if (this.fontNameDropDown)
            for (var l = 0, h = Object.keys(t.fontFamily); l < h.length; l++) {
              var c = h[l];
              switch (h[l]) {
                case 'default':
                case 'width': {
                  var d = this.fontNameDropDown.items;
                  i = p(v(this.fontNameDropDown.element, '.' + jt)) ? 'toolbar' : 'quick';
                  var u = p(this.parent.fontFamily.default)
                    ? this.fontNameDropDown.items[0].text
                    : this.parent.fontFamily.default;
                  n = this.dropdownContent(
                    this.parent.fontFamily.width,
                    i,
                    i === 'quick'
                      ? ''
                      : Ae(this.fontNameDropDown.items, u, 'text', 'text') === 'Default'
                        ? this.i10n.getConstant('fontName')
                        : Ae(this.fontNameDropDown.items, u, 'text', 'text'),
                  );
                  this.fontNameDropDown.setProperties({ content: n });
                  p(this.parent.fontFamily.default)
                    ? this.getEditNode().style.removeProperty('font-family')
                    : (this.getEditNode().style.fontFamily = this.parent.fontFamily.default);
                  break;
                }
                case 'items':
                  this.fontNameDropDown.setProperties({ items: this.getUpdateItems(t.fontFamily.items, 'FontName') });
                  break;
              }
            }
          break;
        case 'fontSize':
          if (this.fontSizeDropDown)
            for (var f = 0, m = Object.keys(t.fontSize); f < m.length; f++) {
              var g = m[f];
              switch (m[f]) {
                case 'default':
                case 'width': {
                  var b = this.fontSizeDropDown.items;
                  i = p(v(this.fontSizeDropDown.element, '.' + jt)) ? 'toolbar' : 'quick';
                  var C = p(this.parent.fontSize.default)
                    ? this.fontSizeDropDown.items[0].text
                    : this.parent.fontSize.default;
                  var N =
                    C === 'Default'
                      ? Ae(this.fontSizeDropDown.items, C.replace(/\s/g, ''), 'text', 'text')
                      : Ae(this.fontSizeDropDown.items, C.replace(/\s/g, ''), 'value', 'text');
                  n = this.dropdownContent(
                    this.parent.fontSize.width,
                    i,
                    $n(N === 'Default' ? this.i10n.getConstant('fontSize') : N),
                  );
                  this.fontSizeDropDown.setProperties({ content: n });
                  p(this.parent.fontSize.default)
                    ? this.getEditNode().style.removeProperty('font-size')
                    : (this.getEditNode().style.fontSize = this.parent.fontSize.default);
                  break;
                }
                case 'items':
                  this.fontSizeDropDown.setProperties({ items: this.getUpdateItems(t.fontSize.items, 'FontSize') });
                  break;
              }
            }
          break;
        case 'format':
          if (this.formatDropDown)
            for (var w = 0, T = Object.keys(t.format); w < T.length; w++) {
              var S = T[w];
              switch (T[w]) {
                case 'default':
                case 'width': {
                  var O = this.formatDropDown.items;
                  i = p(v(this.formatDropDown.element, '.' + jt)) ? 'toolbar' : 'quick';
                  var L = p(this.parent.format.default)
                    ? this.formatDropDown.items[0].text
                    : this.parent.format.default;
                  n = this.dropdownContent(
                    this.parent.format.width,
                    i,
                    i === 'quick' ? '' : Ae(this.formatDropDown.items, L, 'text', 'text'),
                  );
                  this.formatDropDown.setProperties({ content: n });
                  break;
                }
                case 'types':
                  this.formatDropDown.setProperties({ items: this.getUpdateItems(t.format.types, 'Format') });
                  break;
              }
            }
          break;
        case 'numberFormatList':
          if (this.numberFormatListDropDown)
            for (var A = 0, k = Object.keys(t.numberFormatList); A < k.length; A++) {
              var P = k[A];
              switch (k[A]) {
                case 'types':
                  this.numberFormatListDropDown.setProperties({
                    items: this.getUpdateItems(t.numberFormatList.types, 'NumberFormatList'),
                  });
                  break;
              }
            }
          break;
        case 'bulletFormatList':
          if (this.bulletFormatListDropDown)
            for (var I = 0, H = Object.keys(t.bulletFormatList); I < H.length; I++) {
              var U = H[I];
              switch (H[I]) {
                case 'types':
                  this.bulletFormatListDropDown.setProperties({
                    items: this.getUpdateItems(t.bulletFormatList.types, 'BulletFormatList'),
                  });
                  break;
              }
            }
          break;
      }
    }
  };
  s.prototype.getEditNode = function () {
    return this.parent.contentModule.getEditPanel();
  };
  s.prototype.rowDropDown = function (e, t, i, n) {
    i = _('#' + this.parent.getID() + '_' + e + '_TableRows', t);
    var r = Array.from(ha);
    if (!i.classList.contains(se)) {
      if (n.closest('th')) {
        r.shift();
      }
      this.tableRowsDropDown = this.toolbarRenderer.renderDropDownButton({
        iconCss: 'e-table-rows e-icons',
        cssClass: fe + ' ' + ke + ' ' + Ze,
        itemName: 'TableRows',
        items: r,
        element: i,
      });
    }
  };
  s.prototype.columnDropDown = function (e, t, i) {
    i = _('#' + this.parent.getID() + '_' + e + '_TableColumns', t);
    if (!i.classList.contains(se)) {
      this.tableColumnsDropDown = this.toolbarRenderer.renderDropDownButton({
        iconCss: 'e-table-columns e-icons',
        cssClass: fe + ' ' + ke + ' ' + Ze,
        itemName: 'TableColumns',
        items: pa,
        element: i,
      });
    }
  };
  s.prototype.cellDropDown = function (e, t, i) {
    i = _('#' + this.parent.getID() + '_' + e + '_TableCell', t);
    if (!i.classList.contains(se)) {
      this.tableCellDropDown = this.toolbarRenderer.renderDropDownButton({
        iconCss: 'e-table-cell e-icons',
        cssClass: fe + ' ' + ke + ' ' + Ze,
        itemName: 'TableCell',
        items: ca,
        element: i,
      });
    }
  };
  s.prototype.verticalAlignDropDown = function (e, t, i) {
    i = _('#' + this.parent.getID() + '_' + e + '_TableCellVerticalAlign', t);
    if (!i.classList.contains(se)) {
      this.tableCellVerticalAlignDropDown = this.toolbarRenderer.renderDropDownButton({
        iconCss: 'e-table-cell-ver-align e-icons',
        cssClass: fe + ' ' + ke + ' ' + Ze,
        itemName: 'TableCellVerticalAlign',
        items: da,
        element: i,
      });
    }
  };
  s.prototype.renderDisplayDropDown = function (e, t, i, n) {
    var r = i;
    i = _(
      '#' +
        this.parent.getID() +
        '_' +
        e +
        (n === 'display' ? '_Display' : n === 'videolayoutoption' ? '_VideoLayoutOption' : '_AudioLayoutOption'),
      t,
    );
    if (!i.classList.contains(se)) {
      this.displayDropDown = this.toolbarRenderer.renderDropDownButton({
        iconCss:
          n === 'display'
            ? 'e-display e-icons'
            : n === 'videolayoutoption'
              ? 'e-video-display e-icons'
              : 'e-audio-display e-icons',
        cssClass: fe + ' ' + ke + ' ' + Ze,
        itemName: n === 'display' ? 'Display' : n === 'videolayoutoption' ? 'VideoLayoutOption' : 'AudioLayoutOption',
        items: n === 'display' ? ua : n === 'videolayoutoption' ? fa : ma,
        element: i,
        activeElement: i,
      });
    }
  };
  s.prototype.renderAlignmentDropDown = function (e, t, i, n) {
    var r = i;
    i = _('#' + this.parent.getID() + '_' + e + (n === 'align' ? '_Align' : '_VideoAlign'), t);
    if (!i.classList.contains(se)) {
      this.imageAlignDropDown = this.toolbarRenderer.renderDropDownButton({
        iconCss: 'e-justify-left e-icons',
        cssClass: fe + ' ' + di + ' ' + Ze,
        itemName: n === 'align' ? 'Align' : 'VideoAlign',
        items: n === 'align' ? ga : va,
        element: i,
        activeElement: i,
      });
    }
  };
  s.prototype.tableStylesDropDown = function (e, t, i) {
    i = _('#' + this.parent.getID() + '_' + e + '_Styles', t);
    if (!i.classList.contains(se)) {
      this.imageAlignDropDown = this.toolbarRenderer.renderDropDownButton({
        iconCss: 'e-style e-icons',
        cssClass: fe + ' ' + di + ' ' + Ze,
        itemName: 'Styles',
        items: this.parent.tableSettings.styles,
        element: i,
      });
    }
  };
  s.prototype.removeDropDownClasses = function (e) {
    x([e], [se, fe, di, ke]);
  };
  s.prototype.destroyDropDowns = function () {
    if (this.formatDropDown) {
      this.removeDropDownClasses(this.formatDropDown.element);
      this.formatDropDown.destroy();
      this.formatDropDown = null;
    }
    if (this.fontNameDropDown) {
      this.removeDropDownClasses(this.fontNameDropDown.element);
      this.fontNameDropDown.destroy();
      this.fontNameDropDown = null;
    }
    if (this.fontSizeDropDown) {
      this.removeDropDownClasses(this.fontSizeDropDown.element);
      this.fontSizeDropDown.destroy();
      this.fontSizeDropDown = null;
    }
    if (this.alignDropDown) {
      this.removeDropDownClasses(this.alignDropDown.element);
      this.alignDropDown.destroy();
      this.alignDropDown = null;
    }
    if (this.imageAlignDropDown) {
      this.removeDropDownClasses(this.imageAlignDropDown.element);
      this.imageAlignDropDown.destroy();
      this.imageAlignDropDown = null;
    }
    if (this.displayDropDown) {
      this.removeDropDownClasses(this.displayDropDown.element);
      this.displayDropDown.destroy();
      this.displayDropDown = null;
    }
    if (this.tableRowsDropDown) {
      this.removeDropDownClasses(this.tableRowsDropDown.element);
      this.tableRowsDropDown.destroy();
      this.tableRowsDropDown = null;
    }
    if (this.tableColumnsDropDown) {
      this.removeDropDownClasses(this.tableColumnsDropDown.element);
      this.tableColumnsDropDown.destroy();
      this.tableColumnsDropDown = null;
    }
    if (this.tableCellDropDown) {
      this.removeDropDownClasses(this.tableCellDropDown.element);
      this.tableCellDropDown.destroy();
      this.tableCellDropDown = null;
    }
    if (this.tableCellVerticalAlignDropDown) {
      this.removeDropDownClasses(this.tableCellVerticalAlignDropDown.element);
      this.tableCellVerticalAlignDropDown.destroy();
      this.tableCellVerticalAlignDropDown = null;
    }
    if (this.numberFormatListDropDown) {
      this.removeDropDownClasses(this.numberFormatListDropDown.element);
      this.numberFormatListDropDown.destroy();
      this.numberFormatListDropDown = null;
    }
    if (this.bulletFormatListDropDown) {
      this.removeDropDownClasses(this.bulletFormatListDropDown.element);
      this.bulletFormatListDropDown.destroy();
      this.bulletFormatListDropDown = null;
    }
    if (this.codeBlockSplitButton) {
      this.removeDropDownClasses(this.codeBlockSplitButton.element);
      this.codeBlockSplitButton.destroy();
      this.codeBlockSplitButton = null;
    }
    if (this.tableBorderStyleDropDown) {
      this.removeDropDownClasses(this.tableBorderStyleDropDown.element);
      this.tableBorderStyleDropDown.destroy();
      this.tableBorderStyleDropDown = null;
    }
    this.toolbarRenderer = null;
  };
  s.prototype.showDropDown = function (e) {
    !p(this.numberFormatListDropDown) && e.toolbarClick === 'NumberFormatList'
      ? this.numberFormatListDropDown.toggle()
      : !p(this.bulletFormatListDropDown) && e.toolbarClick === 'BulletFormaList'
        ? this.bulletFormatListDropDown.toggle()
        : !p(this.codeBlockSplitButton) && e.toolbarClick === 'CodeBlock' && this.codeBlockSplitButton.toggle();
  };
  s.prototype.setRtl = function (e) {
    if (this.formatDropDown) {
      this.formatDropDown.setProperties({ enableRtl: e.enableRtl });
    }
    if (this.fontNameDropDown) {
      this.fontNameDropDown.setProperties({ enableRtl: e.enableRtl });
    }
    if (this.fontSizeDropDown) {
      this.fontSizeDropDown.setProperties({ enableRtl: e.enableRtl });
    }
    if (this.alignDropDown) {
      this.alignDropDown.setProperties({ enableRtl: e.enableRtl });
    }
    if (this.imageAlignDropDown) {
      this.imageAlignDropDown.setProperties({ enableRtl: e.enableRtl });
    }
    if (this.displayDropDown) {
      this.displayDropDown.setProperties({ enableRtl: e.enableRtl });
    }
    if (this.numberFormatListDropDown) {
      this.numberFormatListDropDown.setProperties({ enableRtl: e.enableRtl });
    }
    if (this.bulletFormatListDropDown) {
      this.bulletFormatListDropDown.setProperties({ enableRtl: e.enableRtl });
    }
    if (this.tableBorderStyleDropDown) {
      this.tableBorderStyleDropDown.setProperties({ enableRtl: e.enableRtl });
    }
  };
  s.prototype.updateCss = function (e, t) {
    if (e && t.cssClass) {
      p(t.oldCssClass)
        ? e.setProperties({ cssClass: (e.cssClass + ' ' + t.cssClass).trim() })
        : e.setProperties({ cssClass: (e.cssClass.replace(t.oldCssClass, '').trim() + ' ' + t.cssClass).trim() });
    }
  };
  s.prototype.setCssClass = function (e) {
    for (
      var t = [
          this.formatDropDown,
          this.fontNameDropDown,
          this.fontSizeDropDown,
          this.alignDropDown,
          this.imageAlignDropDown,
          this.displayDropDown,
          this.numberFormatListDropDown,
          this.bulletFormatListDropDown,
          this.tableRowsDropDown,
          this.tableColumnsDropDown,
          this.tableCellDropDown,
          this.tableCellVerticalAlignDropDown,
          this.tableBorderStyleDropDown,
        ],
        i = 0;
      i < t.length;
      i++
    )
      this.updateCss(t[i], e);
  };
  s.prototype.addEventListener = function () {
    if (!this.parent.isDestroyed) {
      this.parent.on(Gi, this.beforeRender, this);
      this.parent.on(Ye, this.onIframeMouseDown, this);
      this.parent.on(Je, this.setRtl, this);
      this.parent.on(pe, this.onPropertyChanged, this);
      this.parent.on(he, this.setCssClass, this);
      this.parent.on(Yt, this.showDropDown, this);
    }
  };
  s.prototype.onIframeMouseDown = function () {
    var e = this.parent.getToolbarElement();
    if (!p(e)) {
      var t = e.querySelectorAll('.e-dropdown-btn[aria-expanded="true"]');
      if (t && t.length > 0) {
        this.closeOpenDropdowns();
      }
      if (e.querySelector('.e-rte-dropdown.e-dropdown-btn.e-active')) {
        var i = e.querySelector('.e-rte-dropdown.e-dropdown-btn.e-active');
        var n = i.classList.contains('e-rte-font-colorpicker');
        if (n || i.classList.contains('e-rte-background-colorpicker')) {
          this.parent.notify(Xt, { toolbarClick: n ? 'fontcolor' : 'backgroundcolor' });
        }
      }
    }
  };
  s.prototype.closeOpenDropdowns = function () {
    var e = [
      this.formatDropDown,
      this.fontNameDropDown,
      this.fontSizeDropDown,
      this.alignDropDown,
      this.imageAlignDropDown,
      this.displayDropDown,
      this.numberFormatListDropDown,
      this.bulletFormatListDropDown,
      this.tableRowsDropDown,
      this.tableColumnsDropDown,
      this.tableCellDropDown,
      this.tableCellVerticalAlignDropDown,
      this.tableBorderStyleDropDown,
    ];
    e.forEach(function (t) {
      if (t && t.dropDown && t.dropDown.element && t.dropDown.element.classList.contains('e-popup-open')) {
        t.toggle();
      }
    });
  };
  s.prototype.removeEventListener = function () {
    this.parent.off(Ye, this.onIframeMouseDown);
    this.parent.off(Je, this.setRtl);
    this.parent.off(Gi, this.beforeRender);
    this.parent.off(pe, this.onPropertyChanged);
    this.parent.off(he, this.setCssClass);
    this.parent.off(Yt, this.showDropDown);
  };
  s.prototype.destroy = function () {
    this.removeEventListener();
    this.destroyDropDowns();
  };
  return s;
})();
var Ls = (function () {
  function s(e) {
    this.parent = e;
    this.addEventListener();
  }
  s.prototype.addEventListener = function () {
    this.parent.on(Ki, this.toolbarClick, this);
    this.parent.on(it, this.dropDownSelect, this);
    this.parent.on(Dt, this.renderSelection, this);
    this.parent.on(ee, this.removeEventListener, this);
  };
  s.prototype.toolbarClick = function (e) {
    if (
      this.parent.userAgentData.isSafari() &&
      this.parent.formatter.editorManager.nodeSelection &&
      !this.parent.inputElement.contains(this.parent.getRange().startContainer)
    ) {
      this.parent.notify(Me, {});
    }
    if (!p(e.item)) {
      if (!p(e.item.controlParent)) {
        var t = e.item.controlParent.activeEle;
        if (t) {
          t.tabIndex = -1;
        }
      }
      if (e.item.command === 'NumberFormatList' || e.item.command === 'BulletFormatList') {
        var i =
          e.originalEvent.target.nodeName === 'SPAN'
            ? e.originalEvent.target.closest('.e-rte-dropdown.e-split-btn')
            : e.originalEvent.target;
        if (i) {
          var n = i.classList.contains('e-rte-numberformatlist-dropdown');
          if (n || i.classList.contains('e-rte-bulletformatlist-dropdown')) {
            e.item.command = 'Lists';
            e.item.subCommand = e.item.subCommand === 'NumberFormatList' ? 'OL' : 'UL';
          }
        }
      }
      if (
        !(
          e.item.command === 'Lists' &&
          (((e.originalEvent.target.classList.contains('e-rte-numberformatlist-dropdown') ||
            e.originalEvent.target.classList.contains('e-rte-bulletformatlist-dropdown')) &&
            e.originalEvent.target.classList.contains('e-dropdown-btn')) ||
            e.originalEvent.target.classList.contains('e-caret'))
        )
      ) {
        if (e.item.subCommand === 'HorizontalLine') {
          e.item.value = '<hr/>';
        }
        this.parent.notify(an, e);
        this.parent.notify(ba, e);
      }
    }
  };
  s.prototype.dropDownSelect = function (e) {
    this.parent.notify(Me, {});
    if (
      !(
        document.body.contains(document.body.querySelector('.e-rte-quick-toolbar')) &&
        e.item &&
        (e.item.command === 'Images' ||
          e.item.command === 'Audios' ||
          e.item.command === 'Videos' ||
          e.item.command === 'VideoLayoutOption' ||
          e.item.command === 'Display' ||
          e.item.command === 'Table')
      )
    ) {
      var t =
        e.item.controlParent &&
        this.parent.quickToolbarModule &&
        this.parent.quickToolbarModule.tableQTBar &&
        this.parent.quickToolbarModule.tableQTBar.element.contains(e.item.controlParent.element)
          ? 'Table'
          : null;
      if (e.item.command === 'Lists' || e.item.command === 'Checklist') {
        var i = {
          listStyle: e.item.value,
          listImage: e.item.listImage,
          type: e.item.subCommand,
        };
        this.parent.formatter.process(this.parent, e, e.originalEvent, i);
      } else if (e.item.command === 'CodeBlock') {
        var n = {
          language: e.item.text,
          label: e.item.label,
          action: 'createCodeBlock',
        };
        this.parent.formatter.process(this.parent, e, e.originalEvent, n);
      } else this.parent.formatter.process(this.parent, e, e.originalEvent, t);
    }
    this.parent.notify(Fe, {});
  };
  s.prototype.renderSelection = function (e) {
    this.parent.notify(Me, {});
    this.parent.formatter.process(this.parent, e, e.originalEvent, null);
    this.parent.notify(Fe, {});
  };
  s.prototype.removeEventListener = function () {
    this.parent.off(Ki, this.toolbarClick);
    this.parent.off(it, this.dropDownSelect);
    this.parent.off(Dt, this.renderSelection);
    this.parent.off(ee, this.removeEventListener);
  };
  return s;
})();
var Rs = (function () {
  function s(e, t) {
    this.tools = {};
    this.parent = e;
    this.isDestroyed = false;
    this.isToolbar = false;
    this.locator = t;
    this.isTransformChild = false;
    this.renderFactory = this.locator.getService('rendererFactory');
    Ta(this.parent);
    Sa(this.parent);
    this.baseToolbar = new gn(this.parent, this.locator);
    this.addEventListener();
    this.parent.toolbarSettings && Object.keys(this.parent.toolbarSettings.itemConfigs).length > 0
      ? ut(this.tools, ft, bn(this.parent.toolbarSettings.itemConfigs), true)
      : (this.tools = ft);
  }
  s.prototype.initializeInstance = function () {
    this.contentRenderer = this.renderFactory.getRenderer(te.Content);
    this.editableElement = this.contentRenderer.getEditPanel();
    this.editPanel = this.contentRenderer.getPanel();
  };
  s.prototype.toolbarBindEvent = function () {
    if (!this.parent.inlineMode.enable && this.getToolbarElement()) {
      this.keyBoardModule = new Ca(this.getToolbarElement(), {
        keyAction: this.toolBarKeyDown.bind(this),
        keyConfigs: this.parent.formatter.keyConfig,
        eventName: 'keydown',
      });
    }
  };
  s.prototype.toolBarKeyDown = function (e) {
    var t;
    switch (e.action) {
      case 'escape':
        this.parent.contentModule.getEditPanel().focus();
        break;
      case 'enter': {
        t = e.target;
        if (!p(t)) {
          var i = t.nodeName === 'BUTTON' ? t.closest('.e-split-btn-wrapper.e-rte-dropdown') : t;
          if (i) {
            var n = i.querySelector('.e-rte-font-colorpicker');
            if (n || i.querySelector('.e-rte-background-colorpicker')) {
              this.parent.notify(Xt, { toolbarClick: n ? 'fontcolor' : 'backgroundcolor' });
              return;
            }
            var r = i.querySelector('.e-rte-numberformatlist-dropdown');
            if (r || i.querySelector('.e-rte-bulletformatlist-dropdown')) {
              this.parent.notify(Yt, { toolbarClick: r ? 'NumberFormatList' : 'BulletFormaList' });
              return;
            }
            var o = i.querySelector('.e-rte-codeblock-dropdown');
            if (o) {
              this.parent.notify(Yt, { toolbarClick: 'CodeBlock' });
              return;
            }
          }
        }
      }
    }
  };
  s.prototype.createToolbarElement = function () {
    this.tbElement = this.parent.createElement('div', { id: this.parent.getID() + '_toolbar' });
    if (!(!M.isDevice && this.parent.inlineMode.enable && W())) {
      this.parent.inlineMode.enable
        ? this.parent.iframeSettings.enable
          ? this.parent.rootContainer.prepend(this.tbElement)
          : this.parent.rootContainer.insertBefore(this.tbElement, this.editPanel)
        : ((this.tbWrapper = this.parent.createElement('div', {
            id: this.parent.getID() + '_toolbar_wrapper',
            innerHTML: this.tbElement.outerHTML,
            className: ui,
          })),
          (this.tbElement = this.tbWrapper.firstElementChild),
          this.parent.iframeSettings.enable
            ? this.parent.rootContainer.prepend(this.tbWrapper)
            : this.parent.rootContainer.insertBefore(this.tbWrapper, this.editPanel));
    }
  };
  s.prototype.getToolbarMode = function () {
    var e;
    switch (this.parent.toolbarSettings.type) {
      case me.Expand:
        e = 'Extended';
        break;
      case me.Scrollable:
        e = 'Scrollable';
        break;
      case me.Popup:
        e = 'Popup';
        break;
      default:
        e = 'MultiRow';
    }
    if (W() && this.parent.toolbarSettings.type === me.Expand) {
      e = me.Scrollable;
    }
    return e;
  };
  s.prototype.checkToolbarResponsive = function (e) {
    if (!M.isDevice || W()) return false;
    var t;
    this.parent.toolbarSettings.type === me.Expand ? (t = me.MultiRow) : (t = this.parent.toolbarSettings.type);
    this.baseToolbar.render({
      container: this.parent.inlineMode.enable ? 'quick' : 'toolbar',
      items: this.parent.toolbarSettings.items,
      mode: t,
      target: e,
      cssClass: this.parent.getCssClass(),
    });
    if (this.parent.toolbarSettings.type === me.Expand) {
      B([e], ['e-rte-tb-mobile']);
      this.parent.inlineMode.enable ? this.addFixedTBarClass() : B([e], [La]);
    }
    this.wireEvents();
    this.dropDownModule.renderDropDowns({
      container: e,
      containerType: this.parent.inlineMode.enable ? 'quick' : 'toolbar',
      items: this.parent.toolbarSettings.items,
    });
    this.renderColorPicker({
      container: this.tbElement,
      containerType: this.parent.inlineMode.enable ? 'quick' : 'toolbar',
      items: this.parent.toolbarSettings.items,
    });
    return true;
  };
  s.prototype.checkIsTransformChild = function () {
    this.isTransformChild = false;
    for (var e = Ke('[style*="transform"]', document), t = 0; t < e.length; t++)
      if (!p(e[t].contains) && e[t].contains(this.parent.element)) {
        this.isTransformChild = true;
        break;
      }
  };
  s.prototype.toggleFloatClass = function () {
    var e = this.parent.floatingToolbarOffset;
    this.parent.toolbarSettings.enableFloating
      ? (B([this.tbElement.parentElement], [Zn]),
        le(this.tbElement.parentElement, { top: this.parent.floatingToolbarOffset + 'px' }))
      : (x([this.tbElement.parentElement], [Zn]), le(this.tbElement.parentElement, { top: '' }));
  };
  s.prototype.renderToolbar = function () {
    this.initializeInstance();
    this.createToolbarElement();
    if (!this.checkToolbarResponsive(this.tbElement)) {
      this.parent.inlineMode.enable
        ? this.parent.notify(sn, {})
        : (this.baseToolbar.render({
            container: 'toolbar',
            items: this.parent.toolbarSettings.items,
            mode: this.getToolbarMode(),
            target: this.tbElement,
            cssClass: this.parent.getCssClass(),
          }),
          this.parent.element.classList.contains('e-rte-full-screen') &&
            this.updateItem({
              targetItem: 'Maximize',
              updateItem: 'Minimize',
              baseToolbar: this.parent.getBaseToolbarObject(),
            }),
          this.parent.inlineMode.enable ||
            (this.parent.toolbarSettings.enableFloating && (this.checkIsTransformChild(), this.toggleFloatClass()),
            B([this.parent.element], [or]),
            this.parent.toolbarSettings.type === me.Expand && B([this.parent.element], [ar])));
      this.wireEvents();
      if (this.parent.inlineMode.enable && !W()) {
        this.addFixedTBarClass();
      }
      if (!this.parent.inlineMode.enable) {
        this.dropDownModule.renderDropDowns({
          container: this.tbElement,
          containerType: 'toolbar',
          items: this.parent.toolbarSettings.items,
        });
        this.renderColorPicker({
          container: this.tbElement,
          containerType: 'toolbar',
          items: this.parent.toolbarSettings.items,
        });
        this.refreshToolbarOverflow();
      }
      if (this.parent.rootContainer && this.parent.rootContainer.classList.contains('e-source-code-enabled')) {
        this.parent.notify(fi, {
          targetItem: 'SourceCode',
          updateItem: 'Preview',
          baseToolbar: this.parent.getBaseToolbarObject(),
        });
        this.parent.disableToolbarItem(this.parent.toolbarSettings.items);
      }
    }
  };
  s.prototype.addFixedTBarClass = function () {
    B([this.tbElement], [er]);
  };
  s.prototype.removeFixedTBarClass = function () {
    x([this.tbElement], [er]);
  };
  s.prototype.showFixedTBar = function () {
    B([this.tbElement], [tr]);
    if (M.isIos) {
      B([this.tbElement], [ir]);
    }
  };
  s.prototype.hideFixedTBar = function () {
    this.isToolbar ? (this.isToolbar = false) : x([this.tbElement], [tr, ir]);
  };
  s.prototype.updateItem = function (e) {
    var t = this.tools[e.updateItem.toLocaleLowerCase()];
    if (
      this.parent.enabled &&
      ((Nt(e.updateItem.toLocaleLowerCase(), this.locator) !== 'Code View' &&
        Nt(e.updateItem.toLocaleLowerCase(), this.locator) !== 'Preview') ||
        this.parent.locale !== 'en-US')
    ) {
      t.tooltip = Nt(e.updateItem.toLocaleLowerCase(), this.locator);
    }
    var i = this.tools[e.targetItem.toLocaleLowerCase()];
    var n = xt(It(this.tools[e.targetItem.toLocaleLowerCase()].subCommand), e.baseToolbar.toolbarObj.items)[0];
    if (p(xt(It(this.tools[e.targetItem.toLocaleLowerCase()].subCommand), e.baseToolbar.toolbarObj.items)[0]))
      this.addTBarItem(e, 0);
    else {
      var r = this.parent.inlineMode.enable ? '_quick_' : '_toolbar_';
      e.baseToolbar.toolbarObj.items[
        xt(It(this.tools[e.targetItem.toLocaleLowerCase()].subCommand), e.baseToolbar.toolbarObj.items)[0]
      ].id = this.parent.getID() + r + t.id;
      e.baseToolbar.toolbarObj.items[
        xt(It(this.tools[e.targetItem.toLocaleLowerCase()].subCommand), e.baseToolbar.toolbarObj.items)[0]
      ].prefixIcon = t.icon;
      e.baseToolbar.toolbarObj.items[
        xt(It(this.tools[e.targetItem.toLocaleLowerCase()].subCommand), e.baseToolbar.toolbarObj.items)[0]
      ].tooltipText = t.tooltip;
      e.baseToolbar.toolbarObj.items[
        xt(It(this.tools[e.targetItem.toLocaleLowerCase()].subCommand), e.baseToolbar.toolbarObj.items)[0]
      ].subCommand = t.subCommand;
      e.baseToolbar.toolbarObj.dataBind();
      e.baseToolbar.toolbarObj.refreshOverflow();
    }
  };
  s.prototype.updateToolbarStatus = function (e) {
    if (!(!this.tbElement || (this.parent.inlineMode.enable && (W() || !M.isDevice)))) {
      var t = {
        args: e,
        dropDownModule: this.dropDownModule,
        parent: this.parent,
        tbElements: Ke('.' + et, this.tbElement),
        tbItems: this.baseToolbar.toolbarObj.items,
      };
      ln(t, !!this.parent.inlineMode.enable, this.parent);
    }
  };
  s.prototype.fullScreen = function (e) {
    this.parent.fullScreenModule.showFullScreen(e);
  };
  s.prototype.hideScreen = function (e) {
    this.parent.fullScreenModule.hideFullScreen(e);
  };
  s.prototype.getBaseToolbar = function () {
    return this.baseToolbar;
  };
  s.prototype.addTBarItem = function (e, t) {
    e.baseToolbar.toolbarObj.addItems([e.baseToolbar.getObject(e.updateItem, 'toolbar')], t);
  };
  s.prototype.enableTBarItems = function (e, t, i, n) {
    var r;
    var o;
    var a;
    this.parent.toolbarSettings.type === 'Popup' && typeof t != 'string'
      ? ((r = t.filter(function (c) {
          return c !== '|';
        })),
        (a = e.toolbarObj.items.filter(function (c) {
          return c.type !== 'Separator';
        })),
        (o = xt(It(r), a)),
        (this.tbItems = Ke('.' + et + ':not(.e-separator)', e.toolbarObj.element)))
      : ((o = xt(It(t), e.toolbarObj.items)), (this.tbItems = Ke('.' + et, e.toolbarObj.element)));
    for (var l = 0; l < o.length; l++) {
      var h = this.tbItems[o[l]];
      if (this.tbItems[o[l]]) {
        e.toolbarObj.enableItems(this.tbItems[o[l]], i);
      }
    }
    if (!_('.' + hn, this.parent.element) && !n) {
      mt(e, this.parent.formatter.editorManager.undoRedoManager.getUndoStatus());
    }
  };
  s.prototype.removeTBarItems = function (e) {
    if (p(this.baseToolbar.toolbarObj)) {
      this.baseToolbar = this.parent.getBaseToolbarObject();
    }
    var t = xt(It(e), this.baseToolbar.toolbarObj.items);
    this.tbItems = this.parent.inlineMode.enable
      ? Ke('.' + et, this.baseToolbar.toolbarObj.element)
      : Ke('.' + et, this.parent.element);
    for (var i = 0; i < t.length; i++) this.baseToolbar.toolbarObj.removeItems(this.tbItems[t[i]]);
  };
  s.prototype.getExpandTBarPopHeight = function () {
    var e = 0;
    if (this.parent.toolbarSettings.type === me.Expand && this.tbElement.classList.contains('e-extended-toolbar')) {
      var t = _('.e-toolbar-extended', this.tbElement);
      (t && this.tbElement.classList.contains('e-expand-open')) || (t && t.classList.contains('e-popup-open'))
        ? (B([t], [nr]), (e = e + t.offsetHeight), x([t], [nr]))
        : x([this.tbElement], [ya]);
    }
    return e;
  };
  s.prototype.getToolbarHeight = function () {
    return this.tbElement.offsetHeight;
  };
  s.prototype.getToolbarElement = function () {
    return this.parent && this.parent.element ? _('.' + Lt, this.parent.element) : null;
  };
  s.prototype.refreshToolbarOverflow = function () {
    this.parent.element.classList.remove(rr);
    this.baseToolbar.toolbarObj.refreshOverflow();
    if (this.parent.enableRtl) {
      this.parent.element.classList.add(rr);
    }
  };
  s.prototype.isToolbarDestroyed = function () {
    return false;
  };
  s.prototype.destroyToolbar = function () {
    if (!this.isToolbarDestroyed()) {
      this.parent.unWireScrollElementsEvents();
      this.unWireEvents();
      this.dropDownModule.destroy();
      if (this.parent.emojiPickerModule && !this.parent.emojiPickerModule.isPopupDestroyed) {
        this.parent.emojiPickerModule.childDestroy();
      }
      this.dropDownModule = null;
      this.colorPickerModule.destroy();
      this.colorPickerModule = null;
      if (this.keyBoardModule) {
        this.keyBoardModule.destroy();
        this.keyBoardModule = null;
      }
      this.baseToolbar.destroy();
      this.removeEventListener();
      x([this.parent.element], [or]);
      x([this.parent.element], [ar]);
      var e = _('.' + ui, this.parent.element);
      var t = _('.' + Lt, this.parent.element);
      if (!p(e)) {
        y(e);
      }
      if (!p(t)) {
        y(t);
      }
    }
  };
  s.prototype.destroy = function () {
    if (!this.isDestroyed) {
      if (!this.isToolbarDestroyed()) {
        this.destroyToolbar();
      }
      this.toolbarObj = null;
      this.editPanel = null;
      this.isToolbar = null;
      this.editableElement = null;
      this.tbItems = null;
      this.baseToolbar = null;
      this.tbElement = null;
      this.tbWrapper = null;
      this.isTransformChild = null;
      this.contentRenderer = null;
      this.dropDownModule = null;
      this.colorPickerModule = null;
      this.toolbarActionModule = null;
      this.tools = null;
      this.locator = null;
      this.renderFactory = null;
      this.isDestroyed = true;
    }
  };
  s.prototype.mouseDownHandler = function () {
    if (M.isDevice && this.parent.inlineMode.enable && !W()) {
      this.showFixedTBar();
    }
  };
  s.prototype.focusChangeHandler = function () {
    if (M.isDevice && this.parent.inlineMode.enable && !W()) {
      this.isToolbar = false;
      this.hideFixedTBar();
    }
  };
  s.prototype.dropDownBeforeOpenHandler = function () {
    this.isToolbar = true;
  };
  s.prototype.tbFocusHandler = function (e) {
    var t = document.activeElement;
    var i = v(document.activeElement, '.e-rte-toolbar');
    if (document.activeElement === this.parent.getToolbarElement() || i === this.parent.getToolbarElement())
      for (var n = this.parent.getToolbarElement().querySelectorAll('.e-expended-nav'), r = 0; r < n.length; r++)
        p(this.parent.getToolbarElement().querySelector('.e-insert-table-btn'))
          ? n[r].setAttribute('tabindex', '0')
          : n[r].setAttribute('tabindex', '1');
  };
  s.prototype.wireEvents = function () {
    if (!(this.parent.inlineMode.enable && W())) {
      D.add(this.tbElement, 'focusin', this.tbFocusHandler, this);
    }
  };
  s.prototype.unWireEvents = function () {
    D.remove(this.tbElement, 'focusin', this.tbFocusHandler);
  };
  s.prototype.addEventListener = function () {
    if (!this.parent.isDestroyed) {
      this.dropDownModule = new yn(this.parent, this.locator);
      this.toolbarActionModule = new Ls(this.parent);
      this.colorPickerModule = new ti(this.parent, this.locator);
      this.parent.on(Le, this.renderToolbar, this);
      this.parent.on(rt, this.toolbarBindEvent, this);
      this.parent.on(je, this.updateToolbarStatus, this);
      this.parent.on(pe, this.onPropertyChanged, this);
      this.parent.on(Jt, this.onRefresh, this);
      this.parent.on(ee, this.destroy, this);
      this.parent.on(pn, this.fullScreen, this);
      this.parent.on(cn, this.hideScreen, this);
      this.parent.on(fi, this.updateItem, this);
      this.parent.on(Yi, this.dropDownBeforeOpenHandler, this);
      this.parent.on($t, this.focusChangeHandler, this);
      this.parent.on(Te, this.mouseDownHandler, this);
      this.parent.on(Zt, this.mouseDownHandler, this);
      this.parent.on(he, this.setCssClass, this);
    }
  };
  s.prototype.removeEventListener = function () {
    this.parent.off(Le, this.renderToolbar);
    this.parent.off(rt, this.toolbarBindEvent);
    this.parent.off(je, this.updateToolbarStatus);
    this.parent.off(pe, this.onPropertyChanged);
    this.parent.off(Jt, this.onRefresh);
    this.parent.off(ee, this.destroy);
    this.parent.off(pn, this.parent.fullScreenModule.showFullScreen);
    this.parent.off(cn, this.parent.fullScreenModule.hideFullScreen);
    this.parent.off(fi, this.updateItem);
    this.parent.off(Yi, this.dropDownBeforeOpenHandler);
    this.parent.off($t, this.focusChangeHandler);
    this.parent.off(Te, this.mouseDownHandler);
    this.parent.off(Zt, this.mouseDownHandler);
    this.parent.off(he, this.setCssClass);
  };
  s.prototype.setCssClass = function (e) {
    if (this.toolbarObj && e.cssClass) {
      p(e.oldCssClass)
        ? this.toolbarObj.setProperties({ cssClass: (this.toolbarObj.cssClass + ' ' + e.cssClass).trim() })
        : this.toolbarObj.setProperties({
            cssClass: (this.toolbarObj.cssClass.replace(e.oldCssClass, '').trim() + ' ' + e.cssClass).trim(),
          });
    }
  };
  s.prototype.onRefresh = function () {
    if (!this.parent.inlineMode.enable) {
      this.refreshToolbarOverflow();
    }
    this.parent.autoResize();
  };
  s.prototype.onPropertyChanged = function (e) {
    if (!p(e.newProp.inlineMode))
      for (var t = 0, i = Object.keys(e.newProp.inlineMode); t < i.length; t++) {
        var n = i[t];
        switch (i[t]) {
          case 'enable':
            this.refreshToolbar();
            break;
        }
      }
    if (!(p(e.newProp.toolbarSettings) || p(e.newProp.toolbarSettings.enableFloating))) {
      this.toggleFloatClass();
    }
    if (e.module === this.getModuleName()) {
      this.refreshToolbar();
    }
  };
  s.prototype.refreshToolbar = function () {
    if (p(this.baseToolbar.toolbarObj)) {
      this.baseToolbar = this.parent.getBaseToolbarObject();
    }
    var e = _('.' + ui, this.parent.element);
    var t = _('.' + Lt, this.parent.element);
    if (t || e) {
      this.destroyToolbar();
    }
    if (this.parent.toolbarSettings.enable) {
      if (this.baseToolbar && this.baseToolbar.toolbarObj && !this.baseToolbar.toolbarObj.isDestroyed) {
        this.baseToolbar.destroy();
      }
      this.baseToolbar = new gn(this.parent, this.locator);
      this.addEventListener();
      this.renderToolbar();
      this.parent.wireScrollElementsEvents();
      if (!_('.' + hn, this.parent.element) && !this.parent.inlineMode.enable) {
        mt(this.baseToolbar, this.parent.formatter.editorManager.undoRedoManager.getUndoStatus());
      }
      this.parent.notify(Ot, {});
    }
  };
  s.prototype.getModuleName = function () {
    return 'toolbar';
  };
  s.prototype.renderColorPicker = function (e) {
    this.colorPickerModule.renderColorPickerInput(e);
  };
  return s;
})();
var Es = (function () {
  function s(e, t, i) {
    this.previousToolbarStatus = {};
    this.parent = t;
    this.locator = i;
    this.isRendered = false;
    this.isDestroyed = false;
    this.type = e;
    this.dropDownButtons = new yn(this.parent, this.locator);
    this.colorPickerObj = new ti(this.parent, this.locator);
    this.popupWidth = null;
    this.popupHeight = null;
    this.tipPointerHeight = this.parent.userAgentData.isMobileDevice() ? 16 : 10;
  }
  s.prototype.appendToolbarElement = function () {
    switch (((this.toolbarElement = this.parent.createElement('div', { className: jt })), this.type)) {
      case 'Image':
        this.toolbarElement.classList.add(Oa);
        break;
      case 'Link':
        this.toolbarElement.classList.add(Da);
        break;
      case 'Table':
        this.toolbarElement.classList.add(wa);
        break;
      case 'Audio':
        this.toolbarElement.classList.add(ka);
        break;
      case 'Video':
        this.toolbarElement.classList.add(Na);
        break;
      case 'Text':
        this.toolbarElement.classList.add(Ea);
        break;
      case 'Inline':
        {
          this.toolbarElement.classList.add(Lt);
          this.toolbarElement.classList.add(St);
        }
        break;
    }
    this.popupObj.element.appendChild(this.toolbarElement);
  };
  s.prototype.render = function (e) {
    this.stringItems = e.toolbarItems;
    var t = new Ss(this.parent);
    this.popupObj = t.renderPopup(e.popupType);
    this.element = this.popupObj.element;
    this.tipPointerElem = this.element.querySelector('.e-rte-tip-pointer');
    this.appendToolbarElement();
    this.createToolbar(e.toolbarItems, e.mode, e.cssClass);
    this.addEventListener();
    this.addCSSClass();
  };
  s.prototype.createToolbar = function (e, t, i) {
    this.quickTBarObj = new gn(this.parent, this.locator);
    this.quickTBarObj.render({
      container: 'quick',
      target: this.toolbarElement,
      items: e,
      mode: t,
      cssClass: i,
    });
  };
  s.prototype.showPopup = function (e, t) {
    var i = this;
    var n = this.parent.formatter.editorManager.nodeSelection.get(this.parent.inputElement.ownerDocument);
    var r;
    if (!(p(n) && n.rangeCount < 0)) {
      !p(n) && n.rangeCount === 0 && p(n.focusNode)
        ? ((r = this.parent.inputElement.ownerDocument.createRange()),
          r.setStart(this.parent.inputElement.firstChild, 0),
          r.collapse(true),
          n.removeAllRanges(),
          n.addRange(r))
        : (r = n.getRangeAt(0));
      this.renderSubComponents(e);
      var o = this.getRelativeElement(n, e);
      if (!p(o)) {
        var a;
        if (this.parent.iframeSettings.enable) {
          a = this.parent.contentModule.getPanel().getBoundingClientRect();
        }
        var l = r.getClientRects();
        var h = this.getSelectionDirection(n);
        var c = p(t) ? 'none' : t.type;
        if (c === 'mouseup' && t.detail && t.detail === 3) {
          c = 'trippleclick';
        }
        var d = l.length === 0 ? r.getBoundingClientRect() : h === 'Backward' ? l[0] : l[l.length - 1];
        var u = {
          blockElement: o,
          blockRect: o.getBoundingClientRect(),
          range: r,
          rangeRect: d,
          iframeRect: a,
          contentPanelElement: this.parent.contentModule.getPanel(),
          editPanelDomRect: this.parent.contentModule.getEditPanel().getBoundingClientRect(),
          direction: h,
          type: c,
        };
        this.popupWidth = this.getPopupDimension(this.popupObj, 'width');
        this.popupHeight = this.getPopupDimension(this.popupObj, 'height');
        this.toolbarHeight = this.parent.getToolbarElement().getBoundingClientRect().height;
        var f = this.calculateOffsetX(u);
        var m = this.calculateOffsetY(u);
        var g = {
          popup: this.popupObj,
          cancel: false,
          targetElement: o,
          type: c,
          positionX: f,
          positionY: m,
        };
        this.enableDisableToolbarItems();
        g = this.handleVerticalCollision(u, g);
        this.setTipPointerPostion(this.currentTipPosition);
        if (this.type === 'Audio' || this.type === 'Image' || this.type === 'Video') {
          this.currentTipPosition === 'Bottom-Center' ||
          this.currentTipPosition === 'Bottom-Left' ||
          this.currentTipPosition === 'Bottom-Right'
            ? (g.positionY = g.positionY - 2)
            : (this.currentTipPosition === 'Top-Center' ||
                this.currentTipPosition === 'Top-Left' ||
                this.currentTipPosition === 'Top-Right') &&
              (g.positionY = g.positionY + 2);
        }
        this.parent.trigger(Ma, g, function (b) {
          if (!b.cancel) {
            var C = {
              offsetX: b.positionX,
              offsetY: b.positionY,
              relateTo: b.targetElement,
            };
            i.popupObj.setProperties(C);
            i.popupObj.dataBind();
            x([i.element], [Ht, jr]);
            i.popupObj.show();
            i.isRendered = true;
            i.previousTarget = e;
          }
        });
      }
    }
  };
  s.prototype.renderSubComponents = function (e) {
    B([this.element], [Ht]);
    this.parent.iframeSettings.enable
      ? ue([this.element], this.parent.rootContainer.querySelector('.' + Qr))
      : ue([this.element], this.parent.contentModule.getPanel());
    this.dropDownButtons.renderDropDowns(
      {
        container: this.toolbarElement,
        containerType: 'quick',
        items: this.stringItems,
      },
      e,
    );
    if (this.type === 'Text' && this.dropDownButtons) {
      if (this.dropDownButtons.formatDropDown) {
        var t =
          '<span style="display: inline-flex;width:' +
          this.parent.format.width +
          '" ><span class="e-rte-dropdown-btn-text></span></span>';
        this.dropDownButtons.formatDropDown.setProperties({ content: t });
        this.dropDownButtons.formatDropDown.dataBind();
      }
      if (this.dropDownButtons.fontSizeDropDown) {
        var t =
          '<span style="display: inline-flex;width:' +
          this.parent.fontSize.width +
          '" ><span class="e-rte-dropdown-btn-text></span></span>';
        this.dropDownButtons.fontSizeDropDown.setProperties({ content: t });
        this.dropDownButtons.fontSizeDropDown.dataBind();
      }
      if (this.dropDownButtons.fontNameDropDown) {
        var t =
          '<span style="display: inline-flex;width:' +
          this.parent.fontFamily.width +
          '" ><span class="e-rte-dropdown-btn-text></span></span>';
        this.dropDownButtons.fontNameDropDown.setProperties({ content: t });
        this.dropDownButtons.fontNameDropDown.dataBind();
      }
    }
    this.colorPickerObj.renderColorPickerInput({
      container: this.toolbarElement,
      containerType: 'quick',
      items: this.stringItems,
    });
    if (this.parent.showTooltip) {
      this.tooltip = new vn({
        target: '#' + this.element.id + ' [title]',
        openDelay: 400,
        showTipPointer: true,
        beforeRender: this.tooltipBeforeRender.bind(this),
        windowCollision: true,
        position: 'BottomCenter',
        cssClass: this.parent.getCssClass(),
      });
      this.tooltip.appendTo(this.toolbarElement);
    }
    if (this.element.style.maxWidth !== '75%') {
      le(this.element, { maxWidth: '75%' });
    }
  };
  s.prototype.tooltipBeforeRender = function (e) {
    if (e.target.querySelector('.e-active')) {
      e.cancel = true;
      if (!p(e.target.getAttribute('title'))) {
        this.parent.notify(_t, {
          target: e.target,
          isTitle: true,
        });
      }
    }
  };
  s.prototype.hidePopup = function () {
    var e = !p(this.parent.rootContainer) && this.parent.rootContainer.classList.contains('e-source-code-enabled');
    if (M.isDevice && !W()) {
      x([this.parent.getToolbar()], [Ht]);
    }
    if (!p(this.element.querySelectorAll('[data-title]'))) {
      var t = this.element.querySelectorAll('[data-title]');
      t.forEach(function (a) {
        var l = new MouseEvent('mouseout', {
          bubbles: true,
          cancelable: true,
        });
        a.dispatchEvent(l);
      });
    }
    if (p(document.querySelector('.e-tooltip-wrap')))
      if (!p(this.tooltip)) {
        this.tooltip.destroy();
      } else {
        if (!p(document.querySelector('#' + this.element.id + ' [data-tooltip-id]'))) {
          var i = document.querySelector('#' + this.element.id + ' [data-tooltip-id]');
          var n = i.getAttribute('data-content');
          i.removeAttribute('data-content');
          i.setAttribute('title', n);
          i.removeAttribute('data-tooltip-id');
        }
        if (!p(this.tooltip)) {
          this.tooltip.destroy();
        }
      }
    var r = false;
    if (!p(this.parent.codeBlockModule)) {
      var o = this.parent.getRange();
      r =
        !p(this.parent.formatter.editorManager.codeBlockObj.isValidCodeBlockStructure(o.startContainer)) ||
        !p(this.parent.formatter.editorManager.codeBlockObj.isValidCodeBlockStructure(o.endContainer));
    }
    if (!p(this.parent.getToolbar()) && !r) {
      this.parent.inlineMode.enable
        ? e || this.parent.enableToolbarItem(this.parent.toolbarSettings.items)
        : !e &&
          !p(this.parent.toolbarModule.baseToolbar.toolbarObj) &&
          this.parent.enableToolbarItem(this.parent.toolbarSettings.items);
    }
    this.removeEleFromDOM();
    this.isRendered = false;
  };
  s.prototype.removeEleFromDOM = function () {
    var e = this.popupObj.element;
    if (this.isRendered) {
      this.dropDownButtons.destroyDropDowns();
      this.colorPickerObj.destroyColorPicker();
      y(this.popupObj.element);
      var t = this.popupObj;
      this.parent.trigger(Ba, this.popupObj);
    }
  };
  s.prototype.updateStatus = function (e) {
    var t = {
      args: e,
      dropDownModule: this.dropDownButtons,
      parent: this.parent,
      tbElements: Ke('.' + et, this.element),
      tbItems: this.quickTBarObj.toolbarObj.items,
    };
    ln(t, true, this.parent);
    if (
      this.type === 'Text' &&
      this.parent.quickToolbarSettings.text &&
      this.parent.quickToolbarSettings.text.length > 0 &&
      this.parent.quickToolbarModule.textQTBar
    ) {
      var i = {
        args: e,
        dropDownModule: this.parent.quickToolbarModule.textQTBar.dropDownButtons,
        parent: this.parent,
        tbElements: Ke('.' + et, this.parent.quickToolbarModule.textQTBar.element),
        tbItems: this.parent.quickToolbarModule.textQTBar.quickTBarObj.toolbarObj.items,
      };
      ln(i, true, this.parent);
      mt(
        this.parent.quickToolbarModule.textQTBar.quickTBarObj,
        this.parent.formatter.editorManager.undoRedoManager.getUndoStatus(),
      );
    }
    if (!_('.' + hn, this.parent.element)) {
      mt(this.parent.getBaseToolbarObject(), this.parent.formatter.editorManager.undoRedoManager.getUndoStatus());
    }
    this.previousToolbarStatus = e;
  };
  s.prototype.destroy = function () {
    if (!this.isDestroyed) {
      if (this.tooltip && !this.tooltip.isDestroyed) {
        this.tooltip.destroy();
        this.tooltip = null;
      }
      this.removeEventListener();
      this.quickTBarObj.destroy();
      this.quickTBarObj = null;
      if (this.popupObj && !this.popupObj.isDestroyed) {
        this.removeEleFromDOM();
        this.popupObj.destroy();
      }
      this.colorPickerObj = null;
      this.dropDownButtons = null;
      this.stringItems = null;
      this.dropDownButtons = null;
      this.colorPickerObj = null;
      this.toolbarElement = null;
      this.popupWidth = null;
      this.popupHeight = null;
      this.tipPointerElem = null;
      this.previousTarget = null;
      this.isDestroyed = true;
    }
  };
  s.prototype.addEventListener = function () {
    if (!this.parent.isDestroyed) {
      this.parent.on(ee, this.destroy, this);
      this.parent.on(pe, this.onPropertyChanged, this);
      if (
        this.parent.inlineMode.enable ||
        (this.type === 'Text' &&
          this.parent.quickToolbarSettings.text &&
          this.parent.quickToolbarSettings.text.length > 0)
      ) {
        this.parent.on(je, this.updateStatus, this);
      }
      this.parent.on(he, this.addCSSClass, this);
    }
  };
  s.prototype.onPropertyChanged = function (e) {
    if (!p(e.newProp.inlineMode))
      for (var t = 0, i = Object.keys(e.newProp.inlineMode); t < i.length; t++) {
        var n = i[t];
        switch (i[t]) {
          case 'enable':
            e.newProp.inlineMode.enable
              ? this.parent.on(je, this.updateStatus, this)
              : this.parent.off(je, this.updateStatus);
            break;
        }
      }
  };
  s.prototype.removeEventListener = function () {
    this.parent.off(ee, this.destroy);
    this.parent.off(pe, this.onPropertyChanged);
    if (
      this.parent.inlineMode.enable ||
      (this.type === 'Text' &&
        this.parent.quickToolbarSettings.text &&
        this.parent.quickToolbarSettings.text.length > 0)
    ) {
      this.parent.off(je, this.updateStatus);
    }
    this.parent.off(he, this.addCSSClass);
  };
  s.prototype.getPopupDimension = function (e, t) {
    var i = e.element;
    e.element.classList.remove(sr);
    var n = t === 'width' ? e.element.clientWidth : e.element.clientHeight;
    e.element.classList.add(sr);
    return n;
  };
  s.prototype.getRelativeElement = function (e, t) {
    var i = e.focusNode;
    var n;
    switch (this.type) {
      case 'Inline':
      case 'Text':
        {
          n = this.parent.formatter.editorManager.domTree.isBlockNode(e.focusNode)
            ? e.focusNode
            : this.parent.formatter.editorManager.domTree.getParentBlockNode(e.focusNode);
          if (n.nodeName === 'TD' || n.nodeName === 'TH') {
            n = v(t, 'table');
          }
        }
        break;
      case 'Link':
        {
          n = e.focusNode.nodeType === 3 ? e.focusNode.parentElement : e.focusNode;
          n = v(n, 'a');
        }
        break;
      case 'Image':
      case 'Audio':
      case 'Video':
        n = t;
        break;
      case 'Table':
        n = v(t, 'table');
        break;
    }
    return n;
  };
  s.prototype.calculateOffsetX = function (e) {
    var t = this.popupWidth;
    var i = 16.5;
    var n;
    switch (this.type) {
      case 'Text':
      case 'Inline': {
        var r = e.direction === 'Backward' ? e.rangeRect.left : e.rangeRect.right;
        var o = this.parent.iframeSettings.enable === false ? r - e.blockRect.left : r;
        o < this.popupWidth / 4
          ? ((n = o - 16.5), (this.currentTipPosition = 'Top-Left'))
          : o > this.popupWidth / 4 && o < this.popupWidth / 2
            ? ((n = o - this.popupWidth / 4), (this.currentTipPosition = 'Top-LeftMiddle'))
            : o > this.popupWidth / 2 && o < (this.popupWidth * 3) / 4
              ? ((n = o - this.popupWidth / 2), (this.currentTipPosition = 'Top-Center'))
              : o > (this.popupWidth * 3) / 4 && o < this.popupWidth
                ? ((n = o - (this.popupWidth * 3) / 4), (this.currentTipPosition = 'Top-RightMiddle'))
                : ((n = o - this.popupWidth + 16.5), (this.currentTipPosition = 'Top-Right'));
        break;
      }
      case 'Link':
      case 'Image':
      case 'Audio':
      case 'Video':
      case 'Table': {
        var a = e.blockRect.left - e.editPanelDomRect.left;
        var l = e.editPanelDomRect.right - e.blockRect.right;
        e.blockRect.width > this.popupWidth || (a > this.popupWidth / 2 && l > this.popupWidth / 2)
          ? ((n = e.blockRect.width / 2 - this.popupWidth / 2),
            this.type === 'Link'
              ? (this.currentTipPosition = 'Top-Center')
              : (this.currentTipPosition = 'Bottom-Center'))
          : l < this.popupWidth / 2
            ? ((n = -(this.popupWidth - e.blockRect.width)),
              this.type === 'Link'
                ? (this.currentTipPosition = 'Top-Right')
                : (this.currentTipPosition = 'Bottom-Right'))
            : a < this.popupWidth / 2 &&
              ((n = 0),
              this.type === 'Link'
                ? (this.currentTipPosition = 'Top-Left')
                : (this.currentTipPosition = 'Bottom-Left'));
        if (this.parent.iframeSettings.enable) {
          n = n + e.blockRect.left;
        }
        break;
      }
    }
    return n;
  };
  s.prototype.calculateOffsetY = function (e) {
    var t;
    switch (this.type) {
      case 'Text':
      case 'Inline':
      case 'Link':
        this.parent.iframeSettings.enable
          ? (t = e.rangeRect.bottom + this.tipPointerHeight)
          : (t = e.rangeRect.bottom - e.blockRect.top + this.tipPointerHeight);
        break;
      case 'Image':
      case 'Audio':
      case 'Video':
      case 'Table': {
        this.parent.iframeSettings.enable ? (t = -100) : (t = -(this.popupHeight + this.tipPointerHeight));
        break;
      }
    }
    return t;
  };
  s.prototype.setTipPointerPostion = function (e) {
    this.tipPointerElem.className = '';
    this.tipPointerElem.classList.add(Wr);
    if (e !== 'None') {
      var t = e.split('-');
      var i = t[0];
      var n = t[1];
      this.tipPointerElem.classList.add('e-rte-tip-' + t[0].toLowerCase());
      this.tipPointerElem.classList.add('e-rte-tip-' + t[1].toLowerCase());
    }
  };
  s.prototype.getSelectionDirection = function (e) {
    if (e && e.rangeCount > 0 && e.getRangeAt(0).collapsed) return 'Forward';
    var t = new Range();
    t.setStart(e.anchorNode, e.anchorOffset);
    t.setEnd(e.focusNode, e.focusOffset);
    return t.collapsed ? 'Backward' : 'Forward';
  };
  s.prototype.addCSSClass = function () {
    if (this.popupObj && this.parent.cssClass) {
      x([this.popupObj.element], this.parent.cssClass.replace(/\s+/g, ' ').trim().split(' '));
      B([this.popupObj.element], this.parent.cssClass.replace(/\s+/g, ' ').trim().split(' '));
    }
  };
  s.prototype.enableDisableToolbarItems = function () {
    if (this.type === 'Audio' || this.type === 'Image' || this.type === 'Video') {
      this.parent.disableToolbarItem(this.parent.toolbarSettings.items);
      this.parent.enableToolbarItem(['Undo', 'Redo']);
    }
  };
  s.prototype.handleVerticalCollision = function (e, t) {
    this.parent.iframeSettings.enable
      ? (this.type === 'Audio' || this.type === 'Image' || this.type === 'Table' || this.type === 'Video'
          ? (t = this.handleIFrameMediaCollision(e, t))
          : (t = this.handleIFrameTextVerticalCollision(e, t)),
        (t.targetElement = this.parent.contentModule.getPanel().parentElement))
      : this.type === 'Audio' || this.type === 'Image' || this.type === 'Table' || this.type === 'Video'
        ? (t = this.handleMediaVerticalCollision(e, t))
        : (t = this.handleTextVerticalCollision(e, t));
    return t;
  };
  s.prototype.handleMediaVerticalCollision = function (e, t) {
    var i =
      this.parent.scrollParentElements &&
      this.parent.scrollParentElements.length > 0 &&
      this.parent.scrollParentElements[0].nodeName !== '#document'
        ? this.parent.scrollParentElements[0]
        : this.parent.inputElement;
    var n = i.getBoundingClientRect();
    var r = e.blockRect;
    var o = this.parent.getToolbarElement().getBoundingClientRect();
    var a = this.parent.toolbarSettings.position === 'Bottom';
    var l = this.parent.toolbarSettings.enableFloating;
    var h = this.parent.toolbarSettings.enableFloating && this.parent.toolbarSettings.position === 'Top';
    var c = this.parent.toolbarSettings.enableFloating && this.parent.toolbarSettings.position === 'Bottom';
    var d = e.editPanelDomRect;
    var u = this.getSpaceAbove(e, h, o, n);
    var f = this.getSpaceBelow(e, c, o, n);
    var m;
    var g;
    var b = this.tipPointerHeight + this.popupHeight;
    var C = this.isElemVisible(e.blockRect, 'top', false) && u > b;
    var N = this.isElemVisible(e.blockRect, 'bottom', false) && f > b;
    if (C) {
      m = 'top';
      g = 'flip';
      this.currentTipPosition = this.currentTipPosition.replace('Top', 'Bottom');
      t.positionY = -(this.popupHeight + this.tipPointerHeight);
    } else if (N) {
      m = 'bottom';
      g = 'flip';
      this.currentTipPosition = this.currentTipPosition.replace('Bottom', 'Top');
      t.positionY = this.tipPointerHeight;
    } else if (u < b && f < b) {
      m = 'top';
      g = 'fit';
      var w = -e.blockRect.top + o.bottom;
      var T = i === this.parent.inputElement ? -e.blockRect.top : -e.blockRect.top + e.editPanelDomRect.top;
      a
        ? (t.positionY = T)
        : this.parent.toolbarSettings.enableFloating
          ? o.top < 0
            ? (t.positionY = -e.blockRect.top)
            : (t.positionY = w)
          : i === this.parent.inputElement
            ? (t.positionY = T)
            : e.editPanelDomRect.top < 0
              ? (t.positionY = -e.blockRect.top)
              : (t.positionY = -(e.blockRect.top - n.top));
      this.currentTipPosition = 'None';
    }
    var S = {
      position: {
        Y: m,
        X: this.popupObj.position.X,
      },
      collision: {
        Y: g,
        X: this.popupObj.collision.X,
      },
    };
    this.popupObj.setProperties(S);
    this.popupObj.dataBind();
    return t;
  };
  s.prototype.isElemVisible = function (e, t, i, n) {
    if (i) {
      var r = n.top + e.top;
      var o = n.top + e.bottom;
      return t === 'top' ? r >= 0 && r <= window.innerHeight : o <= window.innerHeight && o >= 0;
    } else
      return t === 'top' ? e.top >= 0 && e.top <= window.innerHeight : e.bottom <= window.innerHeight && e.bottom >= 0;
  };
  s.prototype.handleIFrameMediaCollision = function (e, t) {
    var i =
      this.parent.scrollParentElements &&
      this.parent.scrollParentElements.length > 0 &&
      this.parent.scrollParentElements[0].nodeName !== '#document'
        ? this.parent.scrollParentElements[0]
        : this.parent.inputElement;
    var n = i.getBoundingClientRect();
    var r = this.parent.toolbarSettings.enableFloating;
    var o = this.parent.getToolbarElement().getBoundingClientRect();
    var a = this.parent.getToolbarElement().getBoundingClientRect();
    var l = this.parent.toolbarSettings.position === 'Bottom';
    var h = e.blockRect;
    var c = this.parent.toolbarSettings.enableFloating && this.parent.toolbarSettings.position === 'Top';
    var d = this.parent.toolbarSettings.enableFloating && this.parent.toolbarSettings.position === 'Bottom';
    var u = this.getIFrameSpaceAbove(e, c, o, n);
    var f = this.getIFrameSpaceBelow(e, d, o, n);
    var m = this.tipPointerHeight + this.popupHeight;
    if (this.isElemVisible(e.blockRect, 'top', true, e.iframeRect) && u > m) {
      t.positionY = e.blockRect.top - m;
      this.currentTipPosition = this.currentTipPosition.replace('Top', 'Bottom');
    } else if (this.isElemVisible(e.blockRect, 'bottom', true, e.iframeRect) && f > m) {
      t.positionY = e.blockRect.bottom + this.tipPointerHeight;
      this.currentTipPosition = this.currentTipPosition.replace('Bottom', 'Top');
    } else if (u < m && f < m) {
      var g = -e.iframeRect.top + o.bottom;
      var b = i === this.parent.inputElement ? -e.iframeRect.top : -e.iframeRect.top + n.top;
      l
        ? (t.positionY = b)
        : this.parent.toolbarSettings.enableFloating
          ? a.top < 0
            ? (t.positionY = -e.iframeRect.top)
            : (t.positionY = g)
          : (this.parent.inputElement, e.iframeRect.top < 0 ? (t.positionY = b) : (t.positionY = g));
      this.currentTipPosition = 'None';
    }
    return t;
  };
  s.prototype.getSpaceAbove = function (e, t, i, n) {
    var r;
    var o = e.blockRect;
    var a = e.editPanelDomRect;
    var l = this.getTopCollisionType(e.blockRect, e.editPanelDomRect, t ? i : n);
    if (t)
      switch (l) {
        case 'ParentElement':
        case 'ScrollableContainer':
          r = e.blockRect.top - i.top - i.height;
          break;
        case 'ViewPort':
        case 'Hidden':
          r = e.blockRect.top;
          break;
      }
    else
      switch (l) {
        case 'ParentElement':
          r = e.blockRect.top - e.editPanelDomRect.top;
          break;
        case 'ScrollableContainer':
          r = n.top - e.editPanelDomRect.top;
          break;
        case 'ViewPort':
        case 'Hidden':
          r = e.blockRect.top;
          break;
      }
    return r;
  };
  s.prototype.getSpaceBelow = function (e, t, i, n) {
    var r;
    var o = e.blockRect;
    var a = e.editPanelDomRect;
    var l = this.getBottomCollisionType(e.blockRect, e.editPanelDomRect, t ? i : n);
    if (t)
      switch (l) {
        case 'Hidden':
        case 'ParentElement':
        case 'ScrollableContainer':
          r = e.editPanelDomRect.bottom - e.blockRect.bottom - i.height;
          break;
        case 'ViewPort':
          r = e.blockRect.bottom;
          break;
      }
    else
      switch (l) {
        case 'Hidden':
        case 'ParentElement':
          r = e.editPanelDomRect.bottom - e.blockRect.bottom;
          break;
        case 'ScrollableContainer':
          r = n.bottom - e.blockRect.bottom;
          break;
        case 'ViewPort':
          r = window.innerHeight - e.blockRect.bottom;
          break;
      }
    var h = t ? this.toolbarHeight : 0;
    if (window.innerHeight - e.blockRect.bottom - h < this.popupHeight + this.tipPointerHeight) {
      r = 0;
    }
    return r;
  };
  s.prototype.handleTextVerticalCollision = function (e, t) {
    var i =
      this.parent.scrollParentElements &&
      this.parent.scrollParentElements.length > 0 &&
      this.parent.scrollParentElements[0].nodeName !== '#document'
        ? this.parent.scrollParentElements[0]
        : this.parent.inputElement;
    var n = i.getBoundingClientRect();
    var r = e.blockRect;
    var o = this.parent.getToolbarElement().getBoundingClientRect();
    var a = this.parent.toolbarSettings.enableFloating;
    var l = this.parent.toolbarSettings.enableFloating && this.parent.toolbarSettings.position === 'Top';
    var h = this.parent.toolbarSettings.enableFloating && this.parent.toolbarSettings.position === 'Bottom';
    var c = e.blockRect.top;
    var d = e.blockRect.bottom;
    var u = this.getSpaceAbove(e, l, o, n);
    var f = this.getSpaceBelow(e, h, o, n);
    var m = this.tipPointerHeight + this.popupHeight;
    var g = this.isElemVisible(e.blockRect, 'top', false) && u > m && e.blockRect.top > m;
    var b =
      e.direction === 'Backward' && g
        ? false
        : this.isElemVisible(e.blockRect, 'bottom', false) && f > m && e.blockRect.bottom > m;
    if (!b) {
      if (g) {
        t.positionY = -(this.popupHeight + 10) + (e.rangeRect.top - e.blockRect.top);
        this.currentTipPosition = this.currentTipPosition.replace('Top', 'Bottom');
      }
    }
    return t;
  };
  s.prototype.handleIFrameTextVerticalCollision = function (e, t) {
    var i =
      this.parent.scrollParentElements &&
      this.parent.scrollParentElements.length > 0 &&
      this.parent.scrollParentElements[0].nodeName !== '#document'
        ? this.parent.scrollParentElements[0]
        : this.parent.inputElement;
    var n = i.getBoundingClientRect();
    var r = this.parent.toolbarSettings.enableFloating;
    var o = this.parent.getToolbarElement().getBoundingClientRect();
    var a = this.parent.toolbarSettings.enableFloating && this.parent.toolbarSettings.position === 'Top';
    var l = this.parent.toolbarSettings.enableFloating && this.parent.toolbarSettings.position === 'Bottom';
    var h = this.getIFrameSpaceAbove(e, a, o, n);
    var c = this.getIFrameSpaceBelow(e, l, o, n);
    var d = e.blockRect;
    var u = this.tipPointerHeight + this.popupHeight;
    var f = this.isElemVisible(e.blockRect, 'top', true, e.iframeRect) && h > u;
    var m =
      e.direction === 'Backward' && f ? false : this.isElemVisible(e.blockRect, 'bottom', true, e.iframeRect) && c > u;
    if (!m) {
      if (f) {
        t.positionY = e.rangeRect.top - u;
        this.currentTipPosition = this.currentTipPosition.replace('Top', 'Bottom');
      }
    }
    return t;
  };
  s.prototype.getPreviousStatus = function () {
    return this.previousToolbarStatus;
  };
  s.prototype.getTopCollisionType = function (e, t, i) {
    return e.top < 0 || e.top >= window.innerHeight
      ? 'Hidden'
      : t.top > 0
        ? 'ParentElement'
        : i.top < 0
          ? 'ViewPort'
          : i.top > 0
            ? 'ScrollableContainer'
            : 'ParentElement';
  };
  s.prototype.getBottomCollisionType = function (e, t, i) {
    return e.bottom < 0 || e.bottom >= window.innerHeight
      ? 'Hidden'
      : i.bottom >= window.innerHeight && t.bottom >= window.innerHeight
        ? 'ViewPort'
        : t.bottom <= i.bottom
          ? 'ParentElement'
          : 'ScrollableContainer';
  };
  s.prototype.getIFrameSpaceAbove = function (e, t, i, n) {
    var r;
    var o = e.blockRect;
    var a = e.editPanelDomRect;
    var l = e.editPanelDomRect.top === n.top && e.editPanelDomRect.bottom === e.editPanelDomRect.bottom;
    if (l) {
      n = e.editPanelDomRect;
    }
    var h = this.getIFrameTopCollisionType(e.blockRect, e.editPanelDomRect, t ? i : n, e.iframeRect);
    if (t)
      switch (h) {
        case 'ParentElement':
        case 'ScrollableContainer':
          r = e.iframeRect.top + e.blockRect.top - i.top - i.height;
          break;
        case 'ViewPort':
        case 'Hidden':
          r = e.iframeRect.top + e.blockRect.top - i.height;
          break;
      }
    else
      switch (h) {
        case 'ScrollableContainer':
          e.iframeRect.top + e.blockRect.top > n.top
            ? (r = e.iframeRect.top + e.blockRect.top - n.top)
            : (r = -(n.top - (e.iframeRect.top + e.blockRect.top)));
          break;
        case 'ParentElement':
          r = e.iframeRect.top + e.blockRect.top - (e.iframeRect.top + e.editPanelDomRect.top);
          break;
        case 'ViewPort':
        case 'Hidden':
          i.top < 0 ? (r = e.iframeRect.top + e.blockRect.top) : (r = e.iframeRect.top + e.blockRect.top - i.bottom);
          break;
      }
    return r;
  };
  s.prototype.getIFrameSpaceBelow = function (e, t, i, n) {
    var r;
    var o = e.blockRect;
    var a = e.editPanelDomRect;
    var l = e.editPanelDomRect.top === n.top && e.editPanelDomRect.bottom === e.editPanelDomRect.bottom;
    if (l) {
      n = e.iframeRect;
    }
    var h = this.getIFrameBottomCollisionType(e.blockRect, e.editPanelDomRect, t ? i : n, e.iframeRect);
    if (t)
      switch (h) {
        case 'Hidden':
        case 'ParentElement':
        case 'ScrollableContainer':
          r = e.iframeRect.bottom - (e.iframeRect.top + e.blockRect.bottom);
          break;
        case 'ViewPort':
          r = window.innerHeight - (e.iframeRect.top + e.blockRect.bottom);
          break;
      }
    else
      switch (h) {
        case 'Hidden':
        case 'ParentElement':
        case 'ScrollableContainer':
          !l && h === 'ParentElement'
            ? (r = e.iframeRect.bottom - (e.iframeRect.top + e.blockRect.bottom))
            : (r = n.bottom - (e.iframeRect.top + e.blockRect.bottom));
          break;
        case 'ViewPort':
          r = window.innerHeight - (e.iframeRect.top + e.blockRect.bottom);
          break;
      }
    var c = e.iframeRect.top + e.blockRect.bottom;
    var d = this.popupHeight + this.tipPointerHeight;
    var u = c > window.innerHeight;
    var f = c > e.iframeRect.bottom && c + d > n.bottom;
    if (u || f) {
      r = 0;
    }
    return r;
  };
  s.prototype.getIFrameTopCollisionType = function (e, t, i, n) {
    return n.top + e.top < 0 || n.top + e.top >= window.innerHeight
      ? 'Hidden'
      : n.top + t.top > 0
        ? 'ParentElement'
        : i.top <= 0
          ? 'ViewPort'
          : i.top > 0
            ? 'ScrollableContainer'
            : 'ParentElement';
  };
  s.prototype.getIFrameBottomCollisionType = function (e, t, i, n) {
    return n.top + e.bottom < 0 ||
      n.top + e.bottom >= window.innerHeight ||
      n.top + e.bottom >= n.bottom ||
      n.top + e.bottom >= i.bottom
      ? 'Hidden'
      : i.bottom >= window.innerHeight && n.top + t.bottom >= window.innerHeight
        ? 'ViewPort'
        : n.top + t.bottom <= i.bottom
          ? 'ParentElement'
          : 'ScrollableContainer';
  };
  return s;
})();
var As = (function () {
  function s(e, t) {
    this.debounceTimeout = 1000;
    this.escapeKeyPressed = false;
    this.parent = e;
    this.locator = t;
    this.addEventListener();
    this.isDestroyed = false;
  }
  s.prototype.formatItems = function (e) {
    var t = [];
    e.forEach(function (i) {
      if (typeof i == 'string')
        switch (i.toLocaleLowerCase()) {
          case 'open':
            t.push('openLink');
            break;
          case 'edit':
            t.push('editLink');
            break;
          case 'unlink':
            t.push('removeLink');
            break;
          default:
            t.push(i);
            break;
        }
      else t.push(i);
    });
    return t;
  };
  s.prototype.getQTBarOptions = function (e, t, i, n) {
    return {
      popupType: e,
      toolbarItems: i,
      mode: t,
      renderType: n,
      cssClass: this.parent.getCssClass(),
    };
  };
  s.prototype.createQTBar = function (e, t, i, n) {
    if (i.length < 1) return null;
    var r = new Es(e, this.parent, this.locator);
    r.render(this.getQTBarOptions(e, t, this.formatItems(i), n));
    return r;
  };
  s.prototype.initializeQuickToolbars = function () {
    this.parent.quickToolbarModule = this;
    this.contentRenderer = this.parent.contentModule;
    if (this.parent.inlineMode.enable && this.parent.inlineMode.onSelection && W()) {
      D.add(this.contentRenderer.getDocument(), 'selectionchange', this.selectionChangeHandler, this);
    }
  };
  s.prototype.onMouseDown = function (e) {
    this.parent.isBlur = false;
    this.parent.isRTE = true;
  };
  s.prototype.keyUpQT = function (e) {
    if (e.which === 27) {
      this.hideQuickToolbars();
    }
  };
  s.prototype.renderQuickToolbars = function () {
    if (
      !(this.linkQTBar || this.imageQTBar || this.audioQTBar || this.videoQTBar || this.textQTBar || this.tableQTBar)
    ) {
      if (this.parent.quickToolbarSettings.link && this.parent.quickToolbarSettings.link.length > 0) {
        this.linkQTBar = this.createQTBar('Link', 'Scrollable', this.parent.quickToolbarSettings.link, te.LinkToolbar);
      }
      if (!p(this.parent.quickToolbarSettings.text) && !this.parent.inlineMode.enable) {
        this.textQTBar = this.createQTBar('Text', 'MultiRow', this.parent.quickToolbarSettings.text, te.TextToolbar);
      }
      if (this.parent.quickToolbarSettings.image && this.parent.quickToolbarSettings.image.length > 0) {
        this.imageQTBar = this.createQTBar(
          'Image',
          'MultiRow',
          this.parent.quickToolbarSettings.image,
          te.ImageToolbar,
        );
      }
      if (this.parent.quickToolbarSettings.audio && this.parent.quickToolbarSettings.audio.length > 0) {
        this.audioQTBar = this.createQTBar(
          'Audio',
          'MultiRow',
          this.parent.quickToolbarSettings.audio,
          te.AudioToolbar,
        );
      }
      if (this.parent.quickToolbarSettings.video && this.parent.quickToolbarSettings.video.length > 0) {
        this.videoQTBar = this.createQTBar(
          'Video',
          'MultiRow',
          this.parent.quickToolbarSettings.video,
          te.VideoToolbar,
        );
      }
      if (this.parent.quickToolbarSettings.table && this.parent.quickToolbarSettings.table.length > 0) {
        this.tableQTBar = this.createQTBar(
          'Table',
          'MultiRow',
          this.parent.quickToolbarSettings.table,
          te.TableToolbar,
        );
      }
      if (this.linkQTBar) {
        D.add(this.linkQTBar.element, 'mousedown', this.onMouseDown, this);
        D.add(this.linkQTBar.element, 'keyup', this.keyUpQT, this);
      }
      if (this.imageQTBar) {
        D.add(this.imageQTBar.element, 'mousedown', this.onMouseDown, this);
        D.add(this.imageQTBar.element, 'keyup', this.keyUpQT, this);
      }
      if (this.audioQTBar) {
        D.add(this.audioQTBar.element, 'mousedown', this.onMouseDown, this);
        D.add(this.audioQTBar.element, 'keyup', this.keyUpQT, this);
      }
      if (this.videoQTBar) {
        D.add(this.videoQTBar.element, 'mousedown', this.onMouseDown, this);
        D.add(this.videoQTBar.element, 'keyup', this.keyUpQT, this);
      }
      if (this.textQTBar) {
        D.add(this.textQTBar.element, 'mousedown', this.onMouseDown, this);
        D.add(this.textQTBar.element, 'keyup', this.keyUpQT, this);
      }
      if (this.tableQTBar) {
        D.add(this.tableQTBar.element, 'mousedown', this.onMouseDown, this);
        D.add(this.tableQTBar.element, 'keyup', this.keyUpQT, this);
      }
    }
  };
  s.prototype.renderInlineQuickToolbar = function () {
    if (this.parent.inlineMode.enable && (!M.isDevice || W())) {
      B([this.parent.element], [mi]);
      this.inlineQTBar = this.createQTBar('Inline', 'MultiRow', this.parent.toolbarSettings.items, te.InlineToolbar);
      D.add(this.inlineQTBar.element, 'mousedown', this.onMouseDown, this);
      D.add(this.inlineQTBar.element, 'keyup', this.keyUpQT, this);
    }
  };
  s.prototype.showInlineQTBar = function (e, t, i, n) {
    if (i.nodeName === 'HTML' || i.nodeName === '#document') {
      var r = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());
      i = r.commonAncestorContainer.parentElement;
    }
    if (
      !(
        p(this.parent) ||
        this.parent.readonly ||
        i.tagName.toLowerCase() === 'img' ||
        this.inlineQTBar.element.querySelector('.e-rte-color-content')
      )
    ) {
      this.inlineQTBar.showPopup(i, n);
    }
  };
  s.prototype.hideInlineQTBar = function () {
    if (
      this.inlineQTBar &&
      this.inlineQTBar.element.classList.contains('e-popup-open') &&
      document.body.contains(this.inlineQTBar.element)
    ) {
      this.inlineQTBar.hidePopup();
    }
    this.escapeKeyPressed = false;
  };
  s.prototype.hideQuickToolbars = function () {
    if (
      this.linkQTBar &&
      this.linkQTBar.element &&
      this.linkQTBar.element.classList.contains('e-popup-open') &&
      document.body.contains(this.linkQTBar.element)
    ) {
      this.linkQTBar.hidePopup();
    }
    if (
      !this.escapeKeyPressed &&
      this.textQTBar &&
      this.textQTBar.element &&
      this.textQTBar.element.classList.contains('e-popup-open') &&
      document.body.contains(this.textQTBar.element)
    ) {
      this.textQTBar.hidePopup();
    }
    if (
      !this.escapeKeyPressed &&
      this.imageQTBar &&
      this.imageQTBar.element &&
      this.imageQTBar.element.classList.contains('e-popup-open') &&
      document.body.contains(this.imageQTBar.element)
    ) {
      this.imageQTBar.hidePopup();
    }
    if (
      !this.escapeKeyPressed &&
      this.audioQTBar &&
      this.audioQTBar.element &&
      this.audioQTBar.element.classList.contains('e-popup-open') &&
      document.body.contains(this.audioQTBar.element)
    ) {
      this.audioQTBar.hidePopup();
    }
    if (
      !this.escapeKeyPressed &&
      this.videoQTBar &&
      this.videoQTBar.element &&
      this.videoQTBar.element.classList.contains('e-popup-open') &&
      document.body.contains(this.videoQTBar.element)
    ) {
      this.videoQTBar.hidePopup();
    }
    if (
      !this.escapeKeyPressed &&
      this.tableQTBar &&
      this.tableQTBar.element &&
      this.tableQTBar.element.classList.contains('e-popup-open') &&
      document.body.contains(this.tableQTBar.element)
    ) {
      this.tableQTBar.hidePopup();
    }
    if (!p(this.parent) && this.parent.inlineMode.enable && (!M.isDevice || W())) {
      this.hideInlineQTBar();
    }
    this.escapeKeyPressed = false;
  };
  s.prototype.deBounce = function (e, t, i, n) {
    var r = this;
    clearTimeout(this.deBouncer);
    this.deBouncer = window.setTimeout(function () {
      r.showInlineQTBar(e, t, i, n);
    }, this.debounceTimeout);
  };
  s.prototype.mouseUpHandler = function (e) {
    if (this.parent.inlineMode.enable && (!M.isDevice || W())) {
      var t = e.args.touches ? e.args.changedTouches[0] : e.args;
      var i = this.parent.getRange();
      var n = e.args.target;
      if (p(_('.' + St, document.body))) {
        if (
          W() &&
          e.touchData &&
          e.touchData.prevClientX !== e.touchData.clientX &&
          e.touchData.prevClientY !== e.touchData.clientY
        )
          return;
        this.hideInlineQTBar();
        var r = this.parent.element.getBoundingClientRect().left;
        this.offsetX = this.parent.iframeSettings.enable
          ? window.pageXOffset + this.parent.element.getBoundingClientRect().left + t.clientX
          : t.pageX;
        this.offsetY = lr(t, this.parent.element, this.parent.iframeSettings.enable);
        if (n.nodeName === 'TEXTAREA') this.showInlineQTBar(this.offsetX, this.offsetY, n, e.args);
        else {
          var o = v(n, 'a');
          n = o || n;
          var a = this.parent.getRange().startContainer.parentElement;
          var l = this.parent.getRange().endContainer.parentElement;
          if (
            (p(v(this.parent.getRange().startContainer.parentElement, 'A')) ||
              p(v(this.parent.getRange().endContainer.parentElement, 'A'))) &&
            (!v(n, 'td,th') || !i.collapsed) &&
            (n.tagName !== 'IMG' || this.parent.getRange().startOffset !== this.parent.getRange().endOffset)
          ) {
            var h = i.startOffset === i.endOffset && i.startContainer === i.endContainer;
            if ((this.parent.inlineMode.onSelection && h) || (!this.parent.inlineMode.onSelection && !h)) return;
            this.target = n;
            this.showInlineQTBar(this.offsetX, this.offsetY, n, e.args);
          }
        }
      }
    }
    if (!p(this.textQTBar) && !p(this.parent.quickToolbarSettings.text) && !this.parent.inlineMode.enable) {
      if (!p(e) && !p(e.name) && e.name === 'sourceCodeMouseDown') return;
      var t = e.args.touches ? e.args.changedTouches[0] : e.args;
      var n = e.args.target;
      this.hideQuickToolbars();
      var r = this.parent.element.getBoundingClientRect().left;
      this.offsetX = this.parent.iframeSettings.enable
        ? this.parent.element.ownerDocument.documentElement.scrollLeft +
          this.parent.element.getBoundingClientRect().left +
          t.clientX
        : t.pageX;
      this.offsetY = lr(t, this.parent.element, this.parent.iframeSettings.enable);
      var i = this.parent.getRange();
      if (
        (i.endContainer.parentElement.tagName === i.startContainer.parentElement.tagName &&
          i.startContainer.parentElement.tagName === 'A' &&
          i.endContainer.parentElement.tagName === 'A') ||
        e.args.target.tagName === 'IMG' ||
        e.args.target.tagName === 'VIDEO' ||
        this.isEmbedVidElem(e.args.target) ||
        e.args.target.tagName === 'AUDIO' ||
        (e.args.target.childNodes[0] &&
          e.args.target.childNodes[0].nodeType === 1 &&
          e.args.target.childNodes[0].classList.contains('e-rte-audio')) ||
        this.parent.getRange().startOffset === this.parent.getRange().endOffset ||
        this.hasResizeElement(this.parent.inputElement)
      )
        return;
      this.target = e.args.target;
      this.textQTBar.showPopup(e.args.target, t);
    }
  };
  s.prototype.hasResizeElement = function (e) {
    return !!(e && (e.querySelector('.e-img-resize') || e.querySelector('.e-vid-resize')));
  };
  s.prototype.isEmbedVidElem = function (e) {
    return !!(
      (e && e.nodeType !== 3 && e.nodeName !== 'BR' && e.classList && e.classList.contains(Ra)) ||
      (e && e.nodeName === 'IFRAME')
    );
  };
  s.prototype.keyDownHandler = function (e) {
    var t = e.args.altKey;
    if (this.parent.inlineMode.enable && e.args.metaKey && e.args.keyCode === 65) {
      this.showInlineQTBar(this.offsetX, this.offsetY, e.args.target, e.args);
      return;
    }
    if (!e.args.altKey) {
      if (this.parent.inlineMode.enable && (!M.isDevice || W()) && !p(_('.' + St, document))) {
        this.hideInlineQTBar();
      }
      if (this.textQTBar && !de(this.textQTBar.element, 'e-popup-close')) {
        this.textQTBar.hidePopup();
      }
    }
  };
  s.prototype.inlineQTBarMouseDownHandler = function () {
    if (this.parent.inlineMode.enable && (!M.isDevice || W()) && !p(_('.' + St, document))) {
      this.hideInlineQTBar();
    }
    if (!p(this.parent.quickToolbarSettings.text)) {
      if (
        this.textQTBar &&
        !de(this.textQTBar.element, 'e-popup-close') &&
        document.body.contains(this.textQTBar.element)
      ) {
        this.textQTBar.hidePopup();
      }
    }
  };
  s.prototype.keyUpHandler = function (e) {
    var t = this;
    var i = e.args;
    if (this.parent.inlineMode.enable && !M.isDevice) {
      if (this.parent.inlineMode.onSelection) {
        if (
          this.parent.getSelection().length > 0 &&
          ((e.args.ctrlKey && e.args.keyCode === 65) ||
            (e.args.shiftKey &&
              (e.args.keyCode === 33 ||
                e.args.keyCode === 34 ||
                e.args.keyCode === 35 ||
                e.args.keyCode === 36 ||
                e.args.keyCode === 37 ||
                e.args.keyCode === 38 ||
                e.args.keyCode === 39 ||
                e.args.keyCode === 40)))
        ) {
          if (this.showInlineQTBarTimeOut) {
            clearTimeout(this.showInlineQTBarTimeOut);
            this.showInlineQTBarTimeOut = null;
          }
          var n =
            this.parent.element && this.parent.element.dataset && this.parent.element.dataset.rteUnitTesting === 'true';
          n
            ? this.showInlineQTBar(this.offsetX, this.offsetY, e.args.target, e.args)
            : (this.showInlineQTBarTimeOut = window.setTimeout(function () {
                t.showInlineQTBar(t.offsetX, t.offsetY, e.args.target, e.args);
              }, 600));
        }
        return;
      }
      this.deBounce(this.offsetX, this.offsetY, e.args.target, e.args);
    }
    if (
      this.parent.quickToolbarSettings.text &&
      !M.isDevice &&
      ((e.args.ctrlKey && e.args.keyCode === 65) ||
        (e.args.shiftKey &&
          (e.args.keyCode === 33 ||
            e.args.keyCode === 34 ||
            e.args.keyCode === 35 ||
            e.args.keyCode === 36 ||
            e.args.keyCode === 37 ||
            e.args.keyCode === 38 ||
            e.args.keyCode === 39 ||
            e.args.keyCode === 40)))
    ) {
      this.textQTBar.showPopup(e.args.target, e.args);
    }
  };
  s.prototype.selectionChangeHandler = function (e) {
    var t = this;
    clearTimeout(this.deBouncer);
    this.deBouncer = window.setTimeout(function () {
      t.onSelectionChange(e);
    }, this.debounceTimeout);
  };
  s.prototype.onSelectionChange = function (e) {
    if (p(_('.' + St, document.body))) {
      var t = this.contentRenderer.getDocument().getSelection();
      if (!t.isCollapsed) {
        this.mouseUpHandler({ args: e });
      }
    }
  };
  s.prototype.getInlineBaseToolbar = function () {
    return this.inlineQTBar && this.inlineQTBar.quickTBarObj;
  };
  s.prototype.destroy = function () {
    if (!this.isDestroyed) {
      if (this.linkQTBar && !this.linkQTBar.isDestroyed) {
        D.remove(this.linkQTBar.element, 'mousedown', this.onMouseDown);
        D.remove(this.linkQTBar.element, 'keyup', this.keyUpQT);
        this.linkQTBar.destroy();
      }
      if (this.textQTBar && !this.textQTBar.isDestroyed) {
        D.remove(this.textQTBar.element, 'mousedown', this.onMouseDown);
        D.remove(this.textQTBar.element, 'keyup', this.keyUpQT);
        this.textQTBar.destroy();
      }
      if (this.imageQTBar && !this.imageQTBar.isDestroyed) {
        D.remove(this.imageQTBar.element, 'mousedown', this.onMouseDown);
        D.remove(this.imageQTBar.element, 'keyup', this.keyUpQT);
        this.imageQTBar.destroy();
      }
      if (this.audioQTBar && !this.audioQTBar.isDestroyed) {
        D.remove(this.audioQTBar.element, 'mousedown', this.onMouseDown);
        D.remove(this.audioQTBar.element, 'keyup', this.keyUpQT);
        this.audioQTBar.destroy();
      }
      if (this.videoQTBar && !this.videoQTBar.isDestroyed) {
        D.remove(this.videoQTBar.element, 'mousedown', this.onMouseDown);
        D.remove(this.videoQTBar.element, 'keyup', this.keyUpQT);
        this.videoQTBar.destroy();
      }
      if (this.tableQTBar && !this.tableQTBar.isDestroyed) {
        D.remove(this.tableQTBar.element, 'mousedown', this.onMouseDown);
        D.remove(this.tableQTBar.element, 'keyup', this.keyUpQT);
        this.tableQTBar.destroy();
      }
      if (this.inlineQTBar && !this.inlineQTBar.isDestroyed) {
        D.remove(this.inlineQTBar.element, 'mousedown', this.onMouseDown);
        D.remove(this.inlineQTBar.element, 'keyup', this.keyUpQT);
        if (W()) {
          D.remove(document, 'selectionchange', this.selectionChangeHandler);
        }
        this.inlineQTBar.destroy();
      }
      this.removeEventListener();
      this.isDestroyed = true;
    }
  };
  s.prototype.wireInlineQTBarEvents = function () {
    this.parent.on(hr, this.mouseUpHandler, this);
    this.parent.on(Te, this.inlineQTBarMouseDownHandler, this);
    this.parent.on(Ie, this.keyDownHandler, this);
    this.parent.on(nt, this.keyUpHandler, this);
    this.parent.on(Zt, this.mouseUpHandler, this);
    this.parent.on(sn, this.renderInlineQuickToolbar, this);
  };
  s.prototype.unWireInlineQTBarEvents = function () {
    this.parent.off(hr, this.mouseUpHandler);
    this.parent.off(Te, this.inlineQTBarMouseDownHandler);
    this.parent.off(Ie, this.keyDownHandler);
    this.parent.off(nt, this.keyUpHandler);
    this.parent.off(Zt, this.mouseUpHandler);
    this.parent.off(sn, this.renderInlineQuickToolbar);
  };
  s.prototype.toolbarUpdated = function (e) {
    if (this.linkQTBar && !de(this.linkQTBar.element, 'e-popup-close')) {
      this.linkQTBar.hidePopup();
    }
    if (!this.escapeKeyPressed && this.imageQTBar && !de(this.imageQTBar.element, 'e-popup-close')) {
      this.imageQTBar.hidePopup();
    }
    if (!this.escapeKeyPressed && this.audioQTBar && !de(this.audioQTBar.element, 'e-popup-close')) {
      this.audioQTBar.hidePopup();
    }
    if (!this.escapeKeyPressed && this.videoQTBar && !de(this.videoQTBar.element, 'e-popup-close')) {
      this.videoQTBar.hidePopup();
    }
    if (!this.escapeKeyPressed && this.tableQTBar && !de(this.tableQTBar.element, 'e-popup-close')) {
      this.tableQTBar.hidePopup();
    }
    this.escapeKeyPressed = false;
  };
  s.prototype.addEventListener = function () {
    if (!this.parent.isDestroyed) {
      this.parent.on(Le, this.initializeQuickToolbars, this);
      this.parent.on(Te, this.renderQuickToolbars, this);
      this.parent.on(je, this.toolbarUpdated, this);
      this.parent.on(tn, this.renderQuickToolbars, this);
      this.wireInlineQTBarEvents();
      this.parent.on(pe, this.onPropertyChanged, this);
      this.parent.quickToolbarSettings.actionOnScroll === 'hide'
        ? (this.parent.on(Qe, this.hideQuickToolbars, this), this.parent.on(We, this.hideQuickToolbars, this))
        : (this.parent.on(Qe, this.onScroll, this), this.parent.on(We, this.onScroll, this));
      this.parent.on($t, this.hideQuickToolbars, this);
      this.parent.on(Ye, this.onIframeMouseDown, this);
      this.parent.on(ee, this.destroy, this);
      this.parent.on(Ie, this.onKeyDown, this);
      this.parent.on(Je, this.setRtl, this);
      this.parent.on(he, this.setCssClass, this);
      this.parent.on(pr, this.hideQuickToolbars, this);
      this.parent.on(dn, this.renderQuickToolbars, this);
      this.parent.on(Xi, this.preventQuickToolbarClose, this);
      this.parent.on(Ut, this.onWindowResize, this);
      this.parent.on(cr, this.mouseUpHandler, this);
    }
  };
  s.prototype.preventQuickToolbarClose = function (e) {
    var t = this.parent.getID();
    var i = [
      t + '_quick_Display-popup',
      t + '_quick_Align-popup',
      t + '_quick_VideoLayoutOption-popup',
      t + '_quick_VideoAlign-popup',
      t + '_quick_TableRows-popup',
      t + '_quick_TableColumns-popup',
      t + '_quick_TableCell-popup',
      t + '_quick_TableCellVerticalAlign-popup',
      t + '_quick_Styles-popup',
      t + '_quick_Alignments-popup',
      t + '_quick_BackgroundColor-popup',
      t + '_quick_AudioLayoutOption-popup',
      t + '_quick_FontSize-popup',
      t + '_quick_FontName-popup',
      t + '_quick_FontColor-popup',
      t + '_quick_BackgroundColor-popup',
      t + '_quick_Formats-popup',
      t + '_quick_Alignments-popup',
      t + '_quick_NumberFormatList-popup',
      t + '_quick_BulletFormatList-popup',
    ];
    if (!p(e.element) && !p(e.element.parentElement) && i.indexOf(e.element.parentElement.id) > -1) {
      this.escapeKeyPressed = true;
    }
  };
  s.prototype.onKeyDown = function (e) {
    var t = e.args;
    if (e.args.which === 8 || e.args.which === 46) {
      if (this.imageQTBar && !de(this.imageQTBar.element, 'e-popup-close')) {
        this.imageQTBar.hidePopup();
      }
      if (this.audioQTBar && !de(this.audioQTBar.element, 'e-popup-close')) {
        this.audioQTBar.hidePopup();
      }
      if (this.videoQTBar && !de(this.videoQTBar.element, 'e-popup-close')) {
        this.videoQTBar.hidePopup();
      }
      if (this.tableQTBar && !de(this.tableQTBar.element, 'e-popup-close')) {
        this.tableQTBar.hidePopup();
      }
      if (this.linkQTBar && !de(this.linkQTBar.element, 'e-popup-close')) {
        this.linkQTBar.hidePopup();
      }
      if (this.textQTBar && !de(this.textQTBar.element, 'e-popup-close')) {
        this.textQTBar.hidePopup();
      }
    }
  };
  s.prototype.onIframeMouseDown = function () {
    this.hideQuickToolbars();
    this.hideInlineQTBar();
  };
  s.prototype.updateCss = function (e, t) {
    if (e && t.cssClass) {
      p(t.oldCssClass && e.quickTBarObj.toolbarObj.cssClass !== t.cssClass)
        ? e.quickTBarObj.toolbarObj.setProperties({
            cssClass: (e.quickTBarObj.toolbarObj.cssClass + ' ' + t.cssClass).trim(),
          })
        : e.quickTBarObj.toolbarObj.setProperties({
            cssClass: (e.quickTBarObj.toolbarObj.cssClass.replace(t.oldCssClass, '').trim() + ' ' + t.cssClass).trim(),
          });
    }
  };
  s.prototype.setCssClass = function (e) {
    for (
      var t = [this.inlineQTBar, this.imageQTBar, this.linkQTBar, this.textQTBar, this.tableQTBar], i = 0;
      i < t.length;
      i++
    )
      this.updateCss(t[i], e);
  };
  s.prototype.setRtl = function (e) {
    if (this.inlineQTBar) {
      this.inlineQTBar.quickTBarObj.toolbarObj.setProperties({ enableRtl: e.enableRtl });
    }
    if (this.imageQTBar) {
      this.imageQTBar.quickTBarObj.toolbarObj.setProperties({ enableRtl: e.enableRtl });
    }
    if (this.audioQTBar) {
      this.audioQTBar.quickTBarObj.toolbarObj.setProperties({ enableRtl: e.enableRtl });
    }
    if (this.videoQTBar) {
      this.videoQTBar.quickTBarObj.toolbarObj.setProperties({ enableRtl: e.enableRtl });
    }
    if (this.linkQTBar) {
      this.linkQTBar.quickTBarObj.toolbarObj.setProperties({ enableRtl: e.enableRtl });
    }
    if (this.textQTBar) {
      this.textQTBar.quickTBarObj.toolbarObj.setProperties({ enableRtl: e.enableRtl });
    }
  };
  s.prototype.removeEventListener = function () {
    if (this.deBouncer) {
      clearTimeout(this.deBouncer);
      this.deBouncer = null;
    }
    this.parent.off(Le, this.initializeQuickToolbars);
    this.parent.off(Te, this.renderQuickToolbars);
    this.parent.off(je, this.toolbarUpdated);
    this.parent.off(tn, this.renderQuickToolbars);
    this.unWireInlineQTBarEvents();
    this.parent.off(pe, this.onPropertyChanged);
    this.parent.quickToolbarSettings.actionOnScroll === 'hide'
      ? (this.parent.off(Qe, this.hideQuickToolbars), this.parent.off(We, this.hideQuickToolbars))
      : (this.parent.off(Qe, this.onScroll), this.parent.off(We, this.onScroll));
    this.parent.off($t, this.hideQuickToolbars);
    this.parent.off(ee, this.destroy);
    this.parent.off(Ye, this.onIframeMouseDown);
    this.parent.off(Ie, this.onKeyDown);
    this.parent.off(Je, this.setRtl);
    this.parent.off(he, this.setCssClass);
    this.parent.off(pr, this.hideQuickToolbars);
    this.parent.off(dn, this.renderQuickToolbars);
    this.parent.off(Xi, this.preventQuickToolbarClose);
    this.parent.off(Ut, this.onWindowResize);
    this.parent.off(cr, this.mouseUpHandler);
  };
  s.prototype.onPropertyChanged = function (e) {
    if (!p(e.newProp.quickToolbarSettings))
      for (var t = 0, i = Object.keys(e.newProp.quickToolbarSettings); t < i.length; t++) {
        var n = i[t];
        switch (i[t]) {
          case 'actionOnScroll':
            e.newProp.quickToolbarSettings.actionOnScroll === 'none'
              ? (this.parent.on(Qe, this.onScroll),
                this.parent.on(We, this.onScroll),
                this.parent.off(Qe, this.hideQuickToolbars),
                this.parent.off(We, this.hideQuickToolbars))
              : (this.parent.on(Qe, this.hideQuickToolbars, this),
                this.parent.on(We, this.hideQuickToolbars, this),
                this.parent.off(Qe, this.onScroll),
                this.parent.off(We, this.onScroll));
            break;
        }
      }
    if (e.module === this.getModuleName()) {
      if (this.inlineQTBar) {
        x([this.parent.element], [mi]);
        this.unWireInlineQTBarEvents();
        this.hideInlineQTBar();
      }
      if (this.parent.inlineMode.enable && (!M.isDevice || W())) {
        B([this.parent.element], [mi]);
        this.wireInlineQTBarEvents();
      }
    }
  };
  s.prototype.getModuleName = function () {
    return 'quickToolbar';
  };
  s.prototype.getQuickToolbarInstance = function () {
    return [
      this.linkQTBar,
      this.imageQTBar,
      this.audioQTBar,
      this.videoQTBar,
      this.tableQTBar,
      this.textQTBar,
      this.inlineQTBar,
    ];
  };
  s.prototype.onScroll = function (e) {
    this.refreshQuickToolbarPopup(e);
  };
  s.prototype.refreshQuickToolbarPopup = function (e) {
    for (var t = this.getQuickToolbarInstance(), i = 0, n = t; i < n.length; i++) {
      var r = n[i];
      if (n[i] && n[i].isRendered && n[i].element && n[i].element.classList.contains('e-popup-open')) {
        n[i].hidePopup();
        var o = n[i].previousTarget;
        n[i].showPopup(n[i].previousTarget, e);
        if (
          this.parent.quickToolbarSettings.text ||
          (this.parent.quickToolbarModule.inlineQTBar && this.parent.quickToolbarModule.inlineQTBar.isRendered)
        ) {
          var a = n[i].getPreviousStatus();
          if (a) {
            n[i].updateStatus(a);
          }
        }
      }
    }
  };
  s.prototype.onWindowResize = function (e) {
    if (!p(e.args)) {
      this.refreshQuickToolbarPopup(e.args);
    }
  };
  return s;
})();
var xs = (function () {
  function s(e, t) {
    this.parent = e;
    this.locator = t;
    this.renderFactory = this.locator.getService('rendererFactory');
    this.addEventListener();
    this.isDestroyed = false;
  }
  s.prototype.initializeInstance = function () {
    this.contentRenderer = this.renderFactory.getRenderer(te.Content);
    this.editPanel = this.contentRenderer.getEditPanel();
    this.addEventListener();
  };
  s.prototype.renderCount = function () {
    this.initializeInstance();
    this.element = this.parent.createElement('span', { className: dr });
    this.parent.rootContainer.appendChild(this.element);
    this.parent.rootContainer.classList.add('e-count-enabled');
    if (this.parent.iframeSettings.enable) {
      this.parent.inputElement.classList.add('e-count-enabled');
    }
    this.appendCount();
    if (this.parent.maxLength !== -1) {
      this.charCountBackground(this.htmlLength);
    }
  };
  s.prototype.appendCount = function () {
    var e =
      this.parent.editorMode === 'Markdown'
        ? this.editPanel.value
        : this.parent.getText().replace(/(\r\n|\n|\r|\t)/gm, '');
    this.parent.editorMode !== 'Markdown' && e.indexOf('\u200B') !== -1
      ? (this.htmlLength = e.replace(/\u200B/g, '').length)
      : (this.htmlLength = e.length);
    var t = this.parent.maxLength === -1 ? this.htmlLength : this.htmlLength + ' / ' + this.parent.maxLength;
    this.element.innerHTML = t;
  };
  s.prototype.charCountBackground = function (e) {
    var t = (e / this.parent.maxLength) * 100;
    t < 85
      ? (this.element.classList.remove(gi), this.element.classList.remove(vi))
      : t > 85 && t <= 90
        ? (this.element.classList.remove(vi), this.element.classList.add(gi))
        : t > 90 && (this.element.classList.remove(gi), this.element.classList.add(vi));
  };
  s.prototype.refresh = function () {
    if (!p(this.editPanel)) {
      this.appendCount();
      if (this.parent.maxLength !== -1) {
        this.charCountBackground(this.htmlLength);
      }
    }
  };
  s.prototype.destroy = function () {
    if (!this.isDestroyed) {
      if (this.parent && this.parent.rootContainer && this.parent.rootContainer.classList.contains('e-count-enabled')) {
        this.parent.rootContainer.classList.remove('e-count-enabled');
      }
      if (this.parent.iframeSettings.enable && !p(this.parent.inputElement)) {
        this.parent.inputElement.classList.remove('e-count-enabled');
      }
      if (this.element && !p(this.parent.element.querySelector('.' + dr))) {
        y(this.element);
      }
      this.removeEventListener();
      if (this.editPanel) {
        this.editPanel = null;
      }
      if (this.element) {
        y(this.element);
        this.element = null;
      }
      this.isDestroyed = true;
    }
  };
  s.prototype.toggle = function (e) {
    this.element.style.display = e.member === 'viewSource' ? 'none' : 'block';
  };
  s.prototype.addEventListener = function () {
    this.parent.on(Le, this.renderCount, this);
    this.parent.on(nt, this.refresh, this);
    this.parent.on(ur, this.refresh, this);
    this.parent.on(Jt, this.refresh, this);
    this.parent.on(Te, this.refresh, this);
    this.parent.on(ee, this.destroy, this);
    this.parent.on(un, this.toggle, this);
    this.parent.on(fn, this.toggle, this);
  };
  s.prototype.removeEventListener = function () {
    this.parent.off(Le, this.renderCount);
    this.parent.off(nt, this.refresh);
    this.parent.off(Jt, this.refresh);
    this.parent.off(ur, this.refresh);
    this.parent.off(Te, this.refresh);
    this.parent.off(ee, this.destroy);
    this.parent.off(un, this.toggle);
    this.parent.off(fn, this.toggle);
  };
  s.prototype.getModuleName = function () {
    return 'count';
  };
  return s;
})();
var Ns = (function () {
  function s() {}
  s.prototype.process = function (e, t, i, n) {
    var r = this;
    var o = e.contentModule.getDocument().getSelection();
    var a = o.rangeCount > 0 ? o.getRangeAt(o.rangeCount - 1) : null;
    var l;
    var h;
    if (!p(n) && !p(n.selection)) {
      h = n.selection.range;
    }
    var c = !p(n) && !p(n.cssClass) && n.cssClass !== 'e-video-inline';
    if (
      e.editorMode === 'HTML' &&
      !p(t) &&
      !c &&
      (p(t.name) || (!p(t.name) && t.name !== 'showDialog' && !p(t.item.command)))
    ) {
      h
        ? (l = this.editorManager.nodeSelection.save(h, e.contentModule.getDocument()))
        : (l = this.editorManager.nodeSelection.save(a, e.contentModule.getDocument()));
    }
    if (
      !(
        !p(t) &&
        t.item.command &&
        t.item.command !== 'Table' &&
        t.item.command !== 'Actions' &&
        t.item.command !== 'Links' &&
        t.item.command !== 'Images' &&
        t.item.command !== 'Files' &&
        t.item.command !== 'Audios' &&
        t.item.command !== 'Videos' &&
        t.item.command !== 'EmojiPicker' &&
        t.item.command !== 'CodeBlock' &&
        a &&
        !(
          e.contentModule.getEditPanel().contains(this.getAncestorNode(a.commonAncestorContainer)) ||
          e.contentModule.getEditPanel() === a.commonAncestorContainer ||
          e.contentModule.getPanel() === a.commonAncestorContainer
        )
      )
    ) {
      if (!p(t) && e.maxLength !== -1 && !p(t.item.command)) {
        var d = 0;
        if (t.item.command === 'Links') {
          d = n.text.length === 0 ? n.url.length : n.text.length;
        }
        if (
          t.item.command === 'Images' ||
          t.item.command === 'Videos' ||
          t.item.command === 'Table' ||
          t.item.command === 'Files'
        ) {
          d = 1;
        }
        var u = e
          .getText()
          .trim()
          .replace(/(\r\n|\n|\r|\t)/gm, '')
          .replace(/\u200B/g, '').length;
        var f = e.getSelection().length;
        var m =
          e
            .getText()
            .trim()
            .replace(/(\r\n|\n|\r|\t)/gm, '')
            .replace(/\u200B/g, '').length -
          e.getSelection().length +
          d;
        if (!(e.maxLength === -1 || m <= e.maxLength)) return;
      }
      if (p(t)) {
        var g = i.action;
        t = {};
        var b = {
          originalEvent: i,
          cancel: false,
          requestType: i.action || i.key + 'Key',
          itemCollection: n,
        };
        ut(t, t, b, true);
        if (i.action !== 'tab' && i.action !== 'enter' && i.action !== 'space' && i.action !== 'escape') {
          if (e.editorMode === 'Markdown' && i.action === 'insert-table') {
            n = {
              headingText: e.localeObj.getConstant('TableHeadingText'),
              colText: e.localeObj.getConstant('TableColText'),
            };
          }
          var C = a ? a.commonAncestorContainer : null;
          if (
            (i.action !== 'backspace' && i.action !== 'delete') ||
            (C && C.nodeType === Node.ELEMENT_NODE && C.querySelectorAll('img, audio, video').length > 0)
          ) {
            e.trigger(ze, t, function (w) {
              if (w.cancel && (i.action === 'paste' || i.action === 'cut' || i.action === 'copy')) {
                i.preventDefault();
              }
            });
          }
        }
        if (!t.cancel) {
          var N = p(e.tableModule)
            ? true
            : e.tableModule
              ? e.tableModule.tableObj && e.tableModule.tableObj.ensureInsideTableList
              : false;
          if ((i.which === 9 && N) || i.which !== 9) {
            if (i.which === 13 && e.editorMode === 'HTML') {
              n = { enterAction: e.enterKey };
            }
            this.editorManager.observer.notify(i.type === 'keydown' ? Ri : ct, {
              event: i,
              callBack: this.onSuccess.bind(this, e),
              value: n,
              enterAction: e.enterKey,
              enableTabKey: e.enableTabKey,
            });
          }
        }
      } else if (
        !p(t) &&
        t.item.command &&
        t.item.subCommand &&
        ((t.item.command !== t.item.subCommand &&
          t.item.command !== 'Font' &&
          t.item.command !== 'Export' &&
          t.item.subCommand !== 'TableBackgroundColor' &&
          t.item.subCommand !== 'BorderColor') ||
          ((t.item.subCommand === 'FontName' || t.item.subCommand === 'FontSize') && t.name === 'dropDownSelect') ||
          ((t.item.subCommand === 'BackgroundColor' || t.item.subCommand === 'FontColor') &&
            (t.name === 'colorPickerChanged' || t.name === 'tableColorPickerChanged')) ||
          t.item.subCommand === 'FormatPainter' ||
          t.item.subCommand === 'EmojiPicker' ||
          t.item.subCommand === 'CodeBlock' ||
          t.item.subCommand === 'Checklist')
      ) {
        ut(
          t,
          t,
          {
            requestType: t.item.subCommand,
            cancel: false,
            itemCollection: n,
            selectType: t.name,
          },
          true,
        );
        e.trigger(ze, t, function (w) {
          if (!w.cancel) {
            var T = !p(w.requestType) && w.requestType === 'FormatPainter' && w.name === 'format-copy';
            var S = !p(w.requestType) && w.requestType === 'FormatPainter' && w.name === 'format-paste';
            if (
              (r.getUndoRedoStack().length === 0 && w.item.command !== 'Links' && w.item.command !== 'Images' && !T) ||
              S
            ) {
              r.saveData();
            }
            e.isBlur = false;
            var O =
              !p(i) &&
              !p(i.target) &&
              (!p(v(i.target, '.e-rte-elements.e-dropdown-popup.e-rte-dropdown-popup.e-quick-dropdown.e-popup-open')) ||
                !p(v(i.target, '.e-rte-elements.e-rte-quick-popup.e-popup-open')));
            if (
              p(l) ||
              (!O &&
                (p(v(l.range.startContainer.parentElement, '.e-img-caption')) ||
                  v(l.range.startContainer.parentElement, '.e-img-caption').getAttribute('contenteditable') !==
                    'false') &&
                M.userAgent.indexOf('Firefox') === -1)
            ) {
              e.contentModule.getEditPanel().focus({ preventScroll: true });
            }
            if (
              e.editorMode === 'HTML' &&
              !c &&
              (p(t.selectType) || (!p(t.selectType) && t.selectType !== 'showDialog'))
            ) {
              l.restore();
            }
            var L = w.item.subCommand.toLocaleLowerCase();
            if (L === 'image' || L === 'file' || L === 'replace') {
              n = w.itemCollection;
            }
            L === 'paste' || L === 'cut' || L === 'copy'
              ? e.clipboardAction(L, i)
              : (r.editorManager.observer.notify(Zi, { subCommand: w.item.subCommand }),
                r.editorManager.execCommand(
                  w.item.command,
                  w.item.subCommand,
                  i,
                  r.onSuccess.bind(r, e),
                  w.item.value,
                  w.item.subCommand === 'Pre' && w.selectType === 'dropDownSelect' ? { name: w.selectType } : n,
                  '#' + e.getID() + ' iframe',
                  e.enterKey,
                ));
          }
        });
      }
      if ((p(i) || (i && i.action !== 'copy')) && !(i && i.shiftKey && i.key === 'Tab')) {
        this.enableUndo(e);
      }
    }
  };
  s.prototype.getAncestorNode = function (e) {
    e = e.nodeType === 3 ? e.parentNode : e;
    return e;
  };
  s.prototype.onKeyHandler = function (e, t) {
    var i = this;
    this.editorManager.observer.notify(ct, {
      event: t,
      callBack: function () {
        e.notify(fr, {});
        i.enableUndo(e);
      },
      enterAction: e.enterKey,
    });
  };
  s.prototype.onSuccess = function (e, t) {
    var i = this;
    e.notify(fr, {});
    if (t && (p(t.event) || t.event.action !== 'copy')) {
      t.requestType === 'Paste' ? (e.notify(mr, t), this.enableUndo(e)) : (this.enableUndo(e), e.notify(mr, t));
    }
    var n = e.contentModule.getDocument().getSelection();
    var r = n.rangeCount > 0 ? n.getRangeAt(n.rangeCount - 1) : null;
    var o = r ? r.commonAncestorContainer : null;
    t.requestType !== 'delete' ||
    (r && o.nodeType === Node.ELEMENT_NODE && o.querySelectorAll('img, audio, video').length > 0)
      ? e.trigger(Ge, t, function (a) {
          i.actionCompleteCallBack(e, a);
        })
      : this.actionCompleteCallBack(e, t);
  };
  s.prototype.actionCompleteCallBack = function (e, t) {
    e.setPlaceHolder();
    if (
      (t.requestType === 'Images' ||
        t.requestType === 'Replace' ||
        t.requestType === 'Links' ||
        t.requestType === 'Audios' ||
        t.requestType === 'Videos') &&
      e.editorMode === 'HTML'
    ) {
      var i = t;
      if (t.requestType === 'Links' && t.event && t.event.type === 'keydown' && t.event.keyCode === 32) return;
      e.notify(Ji, {
        args: t.event,
        type: t.requestType,
        isNotify: true,
        elements: t.elements,
      });
    }
    if (t.requestType === 'VideosPlayPause') {
      e.notify('editAreaClick', { args: event });
    }
    e.autoResize();
  };
  s.prototype.saveData = function (e) {
    this.editorManager.undoRedoManager.saveData(e);
  };
  s.prototype.getUndoStatus = function () {
    return this.editorManager.undoRedoManager.getUndoStatus();
  };
  s.prototype.getUndoRedoStack = function () {
    return this.editorManager.undoRedoManager.undoRedoStack;
  };
  s.prototype.enableUndo = function (e) {
    var t = this.getUndoStatus();
    e.inlineMode.enable && (!M.isDevice || W())
      ? mt(e.quickToolbarModule.inlineQTBar.quickTBarObj, t)
      : e.toolbarModule && e.toolbarModule.baseToolbar && mt(e.toolbarModule.baseToolbar, t);
  };
  s.prototype.beforeSlashMenuApply = function () {
    this.editorManager.beforeSlashMenuApplyFormat();
  };
  s.prototype.getCurrentStackIndex = function () {
    return this.editorManager.undoRedoManager.getCurrentStackIndex();
  };
  s.prototype.clearUndoRedoStack = function () {
    this.editorManager.undoRedoManager.clear();
  };
  return s;
})();
var ks = (function () {
  var s = function (e, t) {
    s =
      Object.setPrototypeOf ||
      ({ __proto__: [] } instanceof Array &&
        function (i, n) {
          i.__proto__ = n;
        }) ||
      function (i, n) {
        for (var r in n)
          if (n.hasOwnProperty(r)) {
            i[r] = n[r];
          }
      };
    return s(e, t);
  };
  return function (e, t) {
    s(e, t);
    function i() {
      this.constructor = e;
    }
    e.prototype = t === null ? Object.create(t) : ((i.prototype = t.prototype), new i());
  };
})();
var ws = (function (s) {
  ks(e, s);
  function e(t) {
    var i = s() || this;
    i.initialize();
    ut(i, i, t, true);
    if (i.currentDocument && i.element) {
      i.updateFormatter(i.element, i.currentDocument, t.options, t.formatPainterSettings);
    }
    return i;
  }
  e.prototype.initialize = function () {
    this.keyConfig = Aa;
  };
  e.prototype.updateFormatter = function (t, i, n, r) {
    if (t && i) {
      this.editorManager = new ds({
        document: i,
        editableElement: t,
        options: n,
        formatPainterSettings: r,
      });
    }
  };
  return e;
})(Ns);
var Dr = (function () {
  function s(e) {
    this.debounceDelay = 100;
    this.parent = e;
    this.toolbarStatus = this.prevToolbarStatus = Rr();
    this.debounceDelay = this.debounceDelay !== void 0 ? this.debounceDelay : 100;
    this.addEventListener();
  }
  s.prototype.addEventListener = function () {
    this.parent.on(gr, this.onRefreshHandler, this);
    this.parent.on(ee, this.removeEventListener, this);
  };
  s.prototype.removeEventListener = function () {
    this.toolbarStatus = null;
    this.prevToolbarStatus = null;
    this.debounceTimer = null;
    this.parent.off(gr, this.onRefreshHandler);
    this.parent.off(ee, this.removeEventListener);
  };
  s.prototype.onRefreshHandler = function (e) {
    var t = this;
    if (!this.parent.readonly) {
      var i = !!(e.args && e.args.isKeyboardEvent);
      i &&
      !(this.parent.element && this.parent.element.dataset && this.parent.element.dataset.rteUnitTesting === 'true')
        ? (clearTimeout(this.debounceTimer),
          (this.debounceTimer = window.setTimeout(function () {
            t.getToolbarStatus(e);
          }, this.debounceDelay)))
        : (clearTimeout(this.debounceTimer), this.getToolbarStatus(e));
    }
  };
  s.prototype.getToolbarStatus = function (e) {
    var t = [];
    var i = [];
    var n = [];
    this.parent.fontSize.items.forEach(function (o) {
      t.push(o.value);
    });
    this.parent.fontFamily.items.forEach(function (o) {
      i.push(o.value);
    });
    this.parent.format.types.forEach(function (o) {
      n.push(o.value.toLocaleLowerCase());
    });
    this.toolbarStatus = Gr.get(
      this.parent.contentModule.getDocument(),
      this.parent.contentModule.getEditPanel(),
      n,
      t,
      i,
      e.documentNode,
    );
    var r = JSON.stringify(this.toolbarStatus);
    this.parent.notify(je, this.toolbarStatus);
    if (JSON.stringify(this.prevToolbarStatus) !== r) {
      this.parent.notify(xa, {
        html: JSON.parse(r),
        markdown: null,
      });
      this.prevToolbarStatus = JSON.parse(r);
    }
  };
  return s;
})();
var Ds = (function () {
  function s(e) {
    this.parent = e;
    this.addEventListener();
  }
  s.prototype.addEventListener = function () {
    this.parent.on(mn, this.enableXhtmlValidation, this);
    this.parent.on(ee, this.removeEventListener, this);
  };
  s.prototype.removeEventListener = function () {
    this.parent.off(mn, this.enableXhtmlValidation);
    this.parent.off(ee, this.removeEventListener);
  };
  s.prototype.enableXhtmlValidation = function () {
    if (this.parent.enableXhtml) {
      p(this.parent.inputElement)
        ? (this.currentElement = this.parent.element)
        : (this.currentElement = this.parent.inputElement);
      this.clean(this.currentElement);
      this.ImageTags();
      this.removeTags();
      this.RemoveUnsupported();
      this.currentElement.innerHTML = this.selfEncloseValidation(
        this.currentElement.innerHTML,
        this.currentElement.innerText ===
          `
`
          ? this.currentElement.innerText.length
          : this.currentElement.innerText.trim().length,
      );
      this.parent.setProperties({ value: this.currentElement.innerHTML }, true);
    }
  };
  s.prototype.selfEncloseValidation = function (e, t) {
    if (t === 0 && e.indexOf('table') < 0 && e.indexOf('img') < 0 && e.includes('&nbsp;')) {
      var i = e.split('&nbsp;');
      i[i.length - 1] = '&#8203;' + i[i.length - 1];
      e = i.join('');
    }
    e = e.replace(/<br>/g, '<br/>').replace(/<hr>/g, '<hr/>').replace(/ /g, ' ');
    for (
      var n,
        r = [],
        o = [],
        a = [
          /<img(.*?)>/gi,
          /<area(.*?)>/gi,
          /<base(.*?)>/gi,
          /<col (.*?)>/gi,
          /<embed(.*?)>/gi,
          /<input(.*?)>/gi,
          /<link(.*?)>/gi,
          /<meta(.*?)>/gi,
          /<param(.*?)>/gi,
          /<source(.*?)>/gi,
          /<track(.*?)>/gi,
          /<wbr(.*?)>/gi,
        ],
        l = 0;
      l < a.length;
      l++
    ) {
      for (n = a[l].exec(e); n !== null; ) {
        r.push(n[0].toString());
        n = a[l].exec(e);
      }
      o = r.slice(0);
      for (var h = 0; h < r.length; h++)
        if (r[h].indexOf('/') === -1 || r[h].lastIndexOf('/') !== r[h].length - 2) {
          r[h] = r[h].substr(0, r[h].length - 1) + ' /' + r[h].substr(r[h].length - 1, r[h].length);
        }
      for (var c = 0; c <= r.length - 1; c++) e = e.replace(o[c], r[c]);
    }
    return e;
  };
  s.prototype.clean = function (e) {
    for (var t = 0; t < e.childNodes.length; t++) {
      var i = e.childNodes[t];
      e.childNodes[t].nodeType === 8 || e.childNodes[t].nodeName === 'V:IMAGE'
        ? (e.removeChild(e.childNodes[t]), t--)
        : e.childNodes[t].nodeType === 1 && this.clean(e.childNodes[t]);
    }
    return this.currentElement.innerHTML;
  };
  s.prototype.ImageTags = function () {
    for (var e = this.currentElement.querySelectorAll('IMG'), t = e.length - 1; t >= 0; t--)
      if (!e[t].hasAttribute('alt')) {
        var i = e[t];
        e[t].setAttribute('alt', '');
      }
  };
  s.prototype.removeTags = function () {
    for (
      var e = [
          ['br', 'ul'],
          ['br', 'ol'],
          ['table', 'span'],
          ['div', 'span'],
          ['p', 'span'],
        ],
        t = 0;
      t < e.length;
      t++
    )
      this.RemoveElementNode(e[t][0], e[t][1]);
  };
  s.prototype.RemoveElementNode = function (e, t) {
    for (var i = this.currentElement.querySelectorAll(t), n = 0; n < i.length; n++)
      for (var r = i[n].querySelectorAll(e), o = r.length; o > 0; o--) y(r[o - 1]);
  };
  s.prototype.RemoveUnsupported = function () {
    for (var e = this.currentElement.querySelectorAll('u'), t = e.length - 1; t >= 0; t--) {
      var i = this.parent.createElement('span');
      i.style.textDecoration = 'underline';
      i.innerHTML = e[t].innerHTML;
      e[t].parentNode.insertBefore(i, e[t]);
      y(e[t]);
    }
    for (var n = this.currentElement.querySelectorAll('strong'), t = n.length - 1; t >= 0; t--) {
      var r = this.parent.createElement('b');
      r.innerHTML = n[t].innerHTML;
      n[t].parentNode.insertBefore(r, n[t]);
      y(n[t]);
    }
    for (
      var o = [
          'language',
          'role',
          'target',
          'contenteditable',
          'cellspacing',
          'cellpadding',
          'border',
          'valign',
          'colspan',
        ],
        t = 0;
      t <= o.length;
      t++
    )
      this.RemoveAttributeByName(o[t]);
  };
  s.prototype.RemoveAttributeByName = function (e) {
    if (this.currentElement.firstChild !== null && this.currentElement.firstChild.nodeType !== 3)
      for (var t = 0; t < this.currentElement.childNodes.length; t++) {
        var i = this.currentElement.childNodes[t];
        if (
          this.currentElement.childNodes[t].nodeType !== 3 &&
          this.currentElement.childNodes[t].nodeName !== 'TABLE' &&
          this.currentElement.childNodes[t].nodeName !== 'TBODY' &&
          this.currentElement.childNodes[t].nodeName !== 'THEAD' &&
          this.currentElement.childNodes[t].nodeName !== 'TH' &&
          this.currentElement.childNodes[t].nodeName !== 'TR' &&
          this.currentElement.childNodes[t].nodeName !== 'TD' &&
          (this.currentElement.childNodes[t].hasAttribute(e) && this.currentElement.childNodes[t].removeAttribute(e),
          this.currentElement.childNodes[t].hasChildNodes())
        )
          for (var n = 0; n < this.currentElement.childNodes[t].childNodes.length; n++) {
            var r = this.currentElement.childNodes[t].childNodes[n];
            if (
              this.currentElement.childNodes[t].childNodes[n].nodeType !== 3 &&
              this.currentElement.childNodes[t].childNodes[n].nodeName !== 'TABLE' &&
              this.currentElement.childNodes[t].childNodes[n].nodeName !== 'TBODY' &&
              this.currentElement.childNodes[t].childNodes[n].nodeName !== 'THEAD' &&
              this.currentElement.childNodes[t].childNodes[n].nodeName !== 'TH' &&
              this.currentElement.childNodes[t].childNodes[n].nodeName !== 'TR' &&
              this.currentElement.childNodes[t].childNodes[n].nodeName !== 'TD' &&
              this.currentElement.childNodes[t].childNodes[n].hasAttribute(e) &&
              !this.currentElement.childNodes[t].childNodes[n].classList.contains('e-mention-chip')
            ) {
              this.currentElement.childNodes[t].childNodes[n].removeAttribute(e);
            }
            if (this.currentElement.childNodes[t].childNodes[n].hasChildNodes())
              for (var o = 0; o < this.currentElement.childNodes[t].childNodes[n].childNodes.length; o++)
                if (
                  this.currentElement.childNodes[t].childNodes[n].childNodes[o].nodeType !== 3 &&
                  this.currentElement.childNodes[t].childNodes[n].childNodes[o].nodeName !== 'TABLE' &&
                  this.currentElement.childNodes[t].childNodes[n].childNodes[o].nodeName !== 'TBODY' &&
                  this.currentElement.childNodes[t].childNodes[n].childNodes[o].nodeName !== 'THEAD' &&
                  this.currentElement.childNodes[t].childNodes[n].childNodes[o].nodeName !== 'TH' &&
                  this.currentElement.childNodes[t].childNodes[n].childNodes[o].nodeName !== 'TR' &&
                  this.currentElement.childNodes[t].childNodes[n].childNodes[o].nodeName !== 'TD' &&
                  this.currentElement.childNodes[t].childNodes[n].childNodes[o].hasAttribute(e)
                ) {
                  this.currentElement.childNodes[t].childNodes[n].childNodes[o].removeAttribute(e);
                }
          }
      }
  };
  return s;
})();
var Is = (function () {
  function s(e, t) {
    this.rangeCollection = [];
    this.isImageDelete = false;
    this.isMention = false;
    this.parent = e;
    this.locator = t;
    this.renderFactory = this.locator.getService('rendererFactory');
    this.xhtmlValidation = new Ds(e);
    this.addEventListener();
    this.isDestroyed = false;
    this.isCopyAll = false;
    this.isSlashMenuOpen = false;
    this.isPreviousNodeBrAfterBackSpace = false;
  }
  s.prototype.destroy = function () {
    if (!this.isDestroyed) {
      if (this.clickTimeout) {
        clearTimeout(this.clickTimeout);
        this.clickTimeout = null;
      }
      this.removeEventListener();
      this.locator = null;
      this.contentRenderer = null;
      this.renderFactory = null;
      this.toolbarUpdate = null;
      this.nodeSelectionObj = null;
      this.isCopyAll = null;
      this.isSlashMenuOpen = null;
      if (this.rangeCollection.length > 0) {
        this.rangeCollection = [];
      }
      if (this.rangeElement) {
        this.rangeElement = null;
      }
      if (this.oldRangeElement) {
        this.oldRangeElement = null;
      }
      if (this.deleteRangeElement) {
        this.deleteRangeElement = null;
      }
      if (this.deleteOldRangeElement) {
        this.deleteOldRangeElement = null;
      }
      if (this.saveSelection) {
        this.saveSelection = null;
      }
      if (this.xhtmlValidation) {
        this.xhtmlValidation = null;
      }
      this.isDestroyed = true;
    }
  };
  s.prototype.sanitizeHelper = function (e) {
    e = Ia(e, this.parent);
    return e;
  };
  s.prototype.addEventListener = function () {
    if (!this.parent.isDestroyed) {
      this.nodeSelectionObj = new Se(this.parent.inputElement);
      this.parent.on(vr, this.instantiateRenderer, this);
      this.parent.on(an, this.onToolbarClick, this);
      this.parent.on(Pa, this.onSlashMenuOpen, this);
      this.parent.on(Ie, this.onKeyDown, this);
      this.parent.on(nt, this.onKeyUp, this);
      this.parent.on(Le, this.render, this);
      this.parent.on(pe, this.onPropertyChanged, this);
      this.parent.on(ee, this.destroy, this);
      this.parent.on(br, this.selectAll, this);
      this.parent.on(en, this.selectRange, this);
      this.parent.on(Cr, this.getSelectedHtml, this);
      this.parent.on(Fe, this.onSelectionSave, this);
      this.parent.on(Me, this.onSelectionRestore, this);
      this.parent.on(yr, this.updateReadOnly, this);
      this.parent.on(Vt, this.onPaste, this);
      this.parent.on(Tr, this.isTableClassAdded, this);
      this.parent.on(Ha, this.onHandleFontsizeChange, this);
    }
  };
  s.prototype.onSlashMenuOpen = function () {
    this.isSlashMenuOpen = true;
  };
  s.prototype.updateReadOnly = function () {
    this.parent.readonly
      ? (Ti(this.parent.contentModule.getEditPanel(), { contenteditable: 'false' }), B([this.parent.element], Sr))
      : (Ti(this.parent.contentModule.getEditPanel(), { contenteditable: 'true' }), x([this.parent.element], Sr));
  };
  s.prototype.onSelectionSave = function () {
    var e = this.contentRenderer.getDocument();
    var t = this.nodeSelectionObj.getRange(e);
    this.saveSelection = this.nodeSelectionObj.save(t, e);
  };
  s.prototype.onSelectionRestore = function (e) {
    this.parent.isBlur = false;
    this.contentRenderer.getEditPanel().focus({ preventScroll: true });
    if ((p(e.items) || e.items) && !p(this.saveSelection)) {
      this.saveSelection.restore();
    }
  };
  s.prototype.isTableClassAdded = function () {
    for (var e = this.parent.inputElement.querySelectorAll('table'), t = 0; t < e.length; t++)
      if (
        !e[t].classList.contains('e-rte-table') &&
        !e[t].classList.contains('e-rte-paste-table') &&
        !e[t].classList.contains('e-rte-custom-table')
      ) {
        e[t].classList.add('e-rte-table');
      }
  };
  s.prototype.onHandleFontsizeChange = function (e) {
    var t = e.args;
    var i = { name: 'dropDownSelect' };
    i.item = {
      command: 'Font',
      subCommand: 'FontSize',
    };
    var n = this.parent.fontSize.items;
    var r;
    if (
      this.parent.toolbarModule &&
      this.parent.toolbarModule.dropDownModule &&
      this.parent.toolbarModule.dropDownModule.fontSizeDropDown &&
      !p(this.parent.toolbarModule.dropDownModule.fontSizeDropDown.activeElem[0].textContent) &&
      this.parent.toolbarModule.dropDownModule.fontSizeDropDown.activeElem[0].textContent !== ''
    )
      r = this.parent.toolbarModule.dropDownModule.fontSizeDropDown.activeElem[0].textContent;
    else {
      var o = void 0;
      var a = this.parent.contentModule.getDocument().getSelection();
      a && a.focusNode && a.focusNode.parentElement
        ? (o = document.defaultView.getComputedStyle(a.focusNode.parentElement, null).getPropertyValue('font-size'))
        : (o = this.parent.fontSize.width);
      o = p(o) ? this.parent.fontSize.width : o;
      var l = o.match(/^([\d.]+)(\D+)$/);
      var h = parseInt(l[1], 10);
      var c = l[2];
      var d = this.parent.fontSize.items[1].value.match(/^([\d.]+)(\D+)$/);
      if (d[2] === l[2]) {
        var u = this.parent.fontSize.items.findIndex(function (N) {
          var w = N.value;
          return parseInt(N.value, 10) >= h;
        });
        r = this.parent.fontSize.items[u].text;
      } else {
        var f = this.convertFontSize(h, l[2], d[2]);
        var u = this.parent.fontSize.items.findIndex(function (w) {
          var T = w.value;
          return parseInt(w.value, 10) >= f;
        });
        r = this.parent.fontSize.items[u].text;
      }
    }
    var m = this.parent.fontSize.items.findIndex(function (N) {
      return N.text === (r === 'Font Size' ? 'Default' : r);
    });
    if (e.args.action === 'increase-fontsize' && m !== -1)
      if (m >= this.parent.fontSize.items.length - 1) {
        var g = this.parent.fontSize.items[m].value.match(/^([\d.]+)(\D+)$/);
        if (g) {
          var b = parseInt(g[1], 10);
          var c = g[2];
          var C = b % 10 === 0 ? Math.ceil((b + 1) / 10) * 10 : Math.ceil(b / 10) * 10;
          i.item.value = C.toLocaleString() + g[2];
          i.item.text = C.toLocaleString() + ' ' + g[2];
        }
        this.parent.fontSize.items.push(i.item);
      } else {
        i.item.value = this.parent.fontSize.items[m + 1].value;
        i.item.text = this.parent.fontSize.items[m + 1].text;
      }
    else
      e.args.action === 'decrease-fontsize' && m !== -1 && m > 0
        ? (({
            command: 'Font',
            subCommand: 'FontSize',
          }.value = this.parent.fontSize.items[m - 1].value),
          ({
            command: 'Font',
            subCommand: 'FontSize',
          }.text = this.parent.fontSize.items[m - 1].text))
        : m >= 0 &&
          m < this.parent.fontSize.items.length &&
          this.parent.fontSize.items[m] &&
          (({
            command: 'Font',
            subCommand: 'FontSize',
          }.value = this.parent.fontSize.items[m].value),
          ({
            command: 'Font',
            subCommand: 'FontSize',
          }.text = this.parent.fontSize.items[m].text));
    this.parent.formatter.process(this.parent, i, e.args);
  };
  s.prototype.convertFontSize = function (e, t, i) {
    if (Er.indexOf(t) !== -1 || Er.indexOf(i) !== -1) {
      t = 'px';
    }
    var n = e * qa[t][i];
    return n;
  };
  s.prototype.onKeyUp = function (e) {
    var t = e.args;
    var i = [
      8, 9, 13, 17, 18, 20, 27, 36, 37, 38, 39, 40, 44, 45, 46, 91, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121,
      122, 123,
    ];
    var n = this.parent.getRange();
    var r = new RegExp('\u200B', 'g');
    var o =
      n.startContainer === n.endContainer &&
      n.startOffset === n.endOffset &&
      n.startOffset === 1 &&
      n.startContainer.textContent.length === 1 &&
      n.startContainer.textContent.charCodeAt(0) === 8203 &&
      n.startContainer.textContent.replace(r, '').length === 0;
    var a = false;
    if (
      n.startContainer === n.endContainer &&
      n.startOffset === n.endOffset &&
      n.startContainer !== this.parent.inputElement &&
      n.startOffset !== 0
    ) {
      var l = n.startContainer.nodeType === 3 ? n.startContainer : n.startContainer.childNodes[n.startOffset - 1];
      a =
        e.args.keyCode === 16 &&
        l.textContent.charCodeAt(0) === 8203 &&
        !p(l.previousSibling) &&
        l.previousSibling.contentEditable === 'false';
    }
    if (!this.isCopyAll) {
      var h;
      var c = false;
      if (
        !this.isSlashMenuOpen &&
        i.indexOf(e.args.keyCode) < 0 &&
        !e.args.shiftKey &&
        !e.args.ctrlKey &&
        !e.args.altKey &&
        !o &&
        !a
      ) {
        h = n.startOffset;
        n.startContainer.nodeName === '#text'
          ? n.startContainer.parentElement !== this.parent.inputElement
            ? n.startContainer.parentElement.classList.add('currentStartMark')
            : (c = true)
          : n.startContainer.classList.add('currentStartMark');
        if (n.startContainer.textContent.charCodeAt(0) === 8203) {
          var d = n.startContainer.textContent.length;
          var u = n.startOffset;
          this.removeZeroWidthSpaces(n.startContainer, r);
          h =
            n.startOffset === 0
              ? n.startOffset
              : n.startOffset - (n.startContainer.textContent.length - n.startContainer.textContent.length);
          this.parent.formatter.editorManager.nodeSelection.setCursorPoint(
            this.parent.contentModule.getDocument(),
            n.startContainer,
            h,
          );
        }
        var f = this.parent.inputElement.innerHTML.length;
        var m = this.parent.inputElement.innerHTML.replace(r, '').length;
        var g = n.startContainer;
        if (
          this.parent.inputElement.innerHTML.length > this.parent.inputElement.innerHTML.replace(r, '').length &&
          !c
        ) {
          if (g.textContent.trim().length !== 0 && g.previousSibling) {
            var b = document.createElement('span');
            b.className = 'tempSpan';
            n.insertNode(b);
          }
          for (var C = this.parent.inputElement.firstChild; !p(C); ) {
            if (C.nodeName === '#text') {
              C = C.nextElementSibling;
              continue;
            }
            if (C.textContent.replace(r, '').trim().length > 0 && C.textContent.includes('\u200B')) {
              this.removeZeroWidthSpaces(C, r);
            }
            C = C.nextElementSibling;
          }
          var N = this.parent.inputElement.querySelector('.tempSpan');
          if (N && N.previousSibling && g.textContent.trim().length !== 0) {
            g = N.previousSibling;
            h = N.previousSibling.textContent.length;
            var w = N.parentNode;
            N.parentNode.removeChild(N);
            N = null;
          }
          var T = this.parent.inputElement.querySelector('.currentStartMark');
          var S = T ? T.childNodes : [];
          if (S.length > 1) {
            for (var O = 0; O < S.length; O++) {
              if (S[O].nodeName === '#text' && S[O].textContent.length === 0) {
                y(S[O]);
                O--;
              }
              if (!p(S[O]) && g.textContent.replace(r, '') === S[O].textContent) {
                var L = h <= g.textContent.indexOf('\u200B');
                h =
                  g.textContent.length > 1
                    ? g.textContent === S[O].textContent || L
                      ? h
                      : h - (g.textContent.length - g.textContent.replace(r, '').length)
                    : g.textContent.length;
                g = S[O];
              }
            }
          } else if (S.length === 1 && g.textContent.replace(r, '') === S[0].textContent) {
            g = S[0];
          }
          this.parent.formatter.editorManager.nodeSelection.setCursorPoint(
            this.parent.contentModule.getDocument(),
            g,
            h,
          );
        }
        var A = this.parent.inputElement.querySelector('.currentStartMark');
        if (!p(A)) {
          A.classList.remove('currentStartMark');
          if (A.getAttribute('class').trim() === '') {
            A.removeAttribute('class');
          }
        }
        if (
          !p(n.startContainer.previousSibling) &&
          !p(n.startContainer.previousSibling.parentElement) &&
          n.startContainer.parentElement === n.startContainer.previousSibling.parentElement &&
          n.startContainer.previousSibling.textContent.charCodeAt(0) === 8203 &&
          n.startContainer.previousSibling.textContent.length <= 1
        ) {
          n.startContainer.previousSibling.textContent = n.startContainer.previousSibling.textContent.replace(r, '');
        }
        if (n.endContainer.textContent.charCodeAt(n.endOffset) === 8203) {
          h = n.startOffset;
          n.endContainer.textContent = n.endContainer.textContent.replace(r, '');
          this.parent.formatter.editorManager.nodeSelection.setCursorPoint(
            this.parent.contentModule.getDocument(),
            n.startContainer,
            h,
          );
        }
      }
      this.isSlashMenuOpen = false;
    }
  };
  s.prototype.removeZeroWidthSpaces = function (e, t) {
    var i = this;
    if (e.nodeType === Node.TEXT_NODE) {
      if (e.textContent !== null) {
        e.textContent = e.textContent.replace(t, '');
      }
      return;
    }
    e.childNodes.forEach(function (n) {
      i.removeZeroWidthSpaces(n, t);
    });
  };
  s.prototype.onKeyDown = function (e) {
    var t = this;
    e.args.ctrlKey && e.args.keyCode === 65 ? (this.isCopyAll = true) : (this.isCopyAll = false);
    var i;
    var n = e.args;
    if (
      this.parent.inputElement.querySelectorAll('.e-cell-select:not(table)').length > 1 &&
      (e.args.keyCode === 8 || e.args.keyCode === 32 || e.args.keyCode === 13 || e.args.keyCode === 46)
    ) {
      this.tableSelectionKeyAction(e);
      this.parent.autoResize();
      return;
    }
    if (M.info.name === 'chrome') {
      i = this.parent.getRange();
      this.backSpaceCleanup(e, i);
      this.deleteCleanup(e, i);
    }
    var r = false;
    if (!p(this.parent.codeBlockModule)) {
      i = this.parent.getRange();
      r = this.parent.formatter.editorManager.codeBlockObj.isSelectionWithinCodeBlock(
        i,
        i.startContainer,
        i.endContainer,
      );
    }
    if (e.args.keyCode === 9 && this.parent.enableTabKey && !r) {
      this.parent.formatter.saveData(e);
      if (!p(e.args.target) && p(v(e.args.target, '.e-rte-toolbar'))) {
        var o = this.nodeSelectionObj.getRange(this.contentRenderer.getDocument());
        var a = this.nodeSelectionObj.getParentNodeCollection(o);
        if (!(a[0].nodeName === 'LI' || v(a[0], 'li') || v(a[0], 'table'))) {
          e.args.preventDefault();
          var l = this.contentRenderer.getDocument().getSelection().getRangeAt(0);
          var h = this.parent.formatter.editorManager.domNode.blockNodes();
          if (this.parent.enterKey === 'BR')
            if (l.startOffset !== l.endOffset && l.startOffset === 0) {
              var c = this.nodeSelectionObj.save(o, this.contentRenderer.getDocument());
              this.parent.formatter.editorManager.domNode.setMarker(c);
              h = this.parent.formatter.editorManager.domNode.blockNodes();
              this.parent.formatter.editorManager.domNode.convertToBlockNodes(h, false);
              this.marginTabAdd(e.args.shiftKey, h);
              c = this.parent.formatter.editorManager.domNode.saveMarker(c);
              c.restore();
            } else {
              Pe.Insert(this.contentRenderer.getDocument(), '&nbsp;&nbsp;&nbsp;&nbsp;', this.parent.element);
              this.rangeCollection.push(this.nodeSelectionObj.getRange(this.contentRenderer.getDocument()));
            }
          else
            l.startOffset !== l.endOffset && l.startOffset === 0
              ? this.marginTabAdd(e.args.shiftKey, h)
              : (Pe.Insert(this.contentRenderer.getDocument(), '&nbsp;&nbsp;&nbsp;&nbsp;', this.parent.element),
                this.rangeCollection.push(this.nodeSelectionObj.getRange(this.contentRenderer.getDocument())));
        }
      }
      this.parent.formatter.saveData(e);
    }
    var d = /[^\w\s\\/\\.\\:@-]/g;
    if (
      (e.args.action === 'space' || e.args.action === 'enter' || e.args.keyCode === 13 || d.test(e.args.key)) &&
      (this.spaceLink(e.args), this.parent.editorMode === 'HTML' && !this.parent.readonly)
    ) {
      var u = this.parent
        .getText()
        .trim()
        .replace(/(\r\n|\n|\r|\t)/gm, '')
        .replace(/\u200B/g, '').length;
      var f = this.parent.getSelection().length;
      var m =
        this.parent
          .getText()
          .trim()
          .replace(/(\r\n|\n|\r|\t)/gm, '')
          .replace(/\u200B/g, '').length -
        this.parent.getSelection().length +
        1;
      if (!(this.parent.maxLength === -1 || m <= this.parent.maxLength) && e.args.keyCode === 13) {
        e.args.preventDefault();
        return;
      } else {
        this.parent.notify(Fa, { args: e.args });
        kt(this.parent.contentModule.getDocument(), this.parent.inputElement);
      }
    }
    if (e.args.action === 'space') {
      var g = this.parent.getRange();
      var b = g.startContainer.textContent.slice(0, g.startOffset);
      var C = this.isOrderedList(b);
      var N = this.isUnOrderedList(b);
      var w = false;
      if ((C || N) && ((w = this.hasMultipleTextNode(g)), w && !this.isMention)) {
        var T = g.startContainer;
        T = this.parent.formatter.editorManager.domNode.getImmediateBlockNode(T);
        if (T.childNodes.length > 0 && !T.innerHTML.includes('<br>')) {
          w = false;
        }
      }
      if (!w && ((C && !N) || (N && !C))) {
        var S = {
          callBack: null,
          event: e.args,
          name: 'keydown-handler',
          enterKey: this.parent.enterKey,
          shiftEnterKey: this.parent.shiftEnterKey,
        };
        var O = {
          cancel: false,
          item: {
            command: 'Lists',
            subCommand: C ? 'OL' : 'UL',
          },
          name: 'actionBegin',
          originalEvent: e.args,
          requestType: C ? 'OL' : 'UL',
        };
        this.parent.trigger(ze, O, function (L) {
          if (!L.cancel) {
            t.parent.formatter.editorManager.observer.notify(Ai, S);
            t.parent.trigger(Ge, {
              editorMode: t.parent.editorMode,
              elements: t.parent.formatter.editorManager.domNode.blockNodes(),
              event: e.args,
              name: Ge,
              range: t.parent.getRange(),
              requestType: C ? 'OL' : 'UL',
            });
          }
        });
      }
    }
    if (
      M.info.name === 'chrome' &&
      ((!p(this.rangeElement) && !p(this.oldRangeElement)) ||
        (!p(this.deleteRangeElement) && !p(this.deleteOldRangeElement))) &&
      i.startContainer.parentElement.tagName !== 'TD' &&
      i.startContainer.parentElement.tagName !== 'TH'
    ) {
      this.rangeElement = null;
      this.oldRangeElement = null;
      this.deleteRangeElement = null;
      this.deleteOldRangeElement = null;
      if (!this.isImageDelete) {
        e.args.preventDefault();
      }
      e.args.preventDefault();
    }
    this.parent.autoResize();
  };
  s.prototype.isOrderedList = function (e) {
    e = e.replace(/\u200B/g, '');
    var t = [/^[1]+[.]+$/, /^[i]+[.]+$/, /^[a]+[.]+$/];
    if (!p(e)) {
      for (var i = 0; i < t.length; i++) if (t[i].test(e)) return true;
    }
    return false;
  };
  s.prototype.isUnOrderedList = function (e) {
    e = e.replace(/\u200B/g, '');
    var t = [/^[*]$/, /^[-]$/];
    if (!p(e)) {
      for (var i = 0; i < t.length; i++) if (t[i].test(e)) return true;
    }
    return false;
  };
  s.prototype.hasMultipleTextNode = function (e) {
    this.isMention = false;
    if (e && e.startContainer && e.startContainer.parentNode) {
      var t = e.startContainer.parentNode;
      if (
        e.startContainer.previousElementSibling &&
        e.startContainer.previousElementSibling.classList.contains('e-mention-chip') &&
        !e.startContainer.previousElementSibling.isContentEditable
      ) {
        this.isMention = true;
        return true;
      }
      if (this.parent.enterKey === 'BR' || v(e.startContainer.parentNode, 'table')) return false;
      for (var i = e.startContainer.parentNode.childNodes, n = [], r = 0; r < i.length; r++) {
        var o = i[r];
        if (i[r] && i[r].nodeType === Node.TEXT_NODE && (n.push(i[r]), n.length > 1)) return true;
      }
    }
    return false;
  };
  s.prototype.isCursorAtBlockStart = function (e) {
    if (e.startOffset !== 0 || e.endOffset !== 0) return false;
    var t = e.startContainer;
    var i = e.startContainer.nodeType === Node.TEXT_NODE ? e.startContainer.parentElement : e.startContainer;
    if (i.tagName === 'TD' || i.tagName === 'TH') return false;
    var n = this.parent.formatter.editorManager.domNode.getImmediateBlockNode(i);
    if (e.startContainer === n && e.startOffset === 0) return true;
    for (var r = i, o = false; r && r !== n; ) {
      for (var a = r.previousSibling; a; ) {
        if (a.nodeType === Node.TEXT_NODE && (!a.textContent || !a.textContent.trim())) {
          a = a.previousSibling;
          continue;
        }
        o = true;
        break;
      }
      if (o) break;
      r = r.parentNode;
    }
    return !o;
  };
  s.prototype.backSpaceCleanup = function (e, t) {
    var i = false;
    var n = true;
    if (!p(t.startContainer.previousSibling) && t.startContainer.previousSibling.nodeName === 'SPAN') {
      n = t.startContainer.previousSibling.contentEditable !== 'false';
    }
    var r = t.startContainer.nodeName === '#text' ? t.startContainer.parentElement : t.startContainer;
    var o = v(t.startContainer.nodeName === '#text' ? t.startContainer.parentElement : t.startContainer, 'li')
      ? r.nodeName !== 'li' && p(r.previousSibling)
      : true;
    var a = this.isCursorAtBlockStart(t);
    if (
      e.args.code === 'Backspace' &&
      e.args.keyCode === 8 &&
      a &&
      t.startContainer.textContent !== ' ' &&
      t.startContainer.nodeValue !== '\xA0' &&
      this.parent.getSelection().length === 0 &&
      t.startContainer.textContent.length > 0 &&
      n &&
      o
    ) {
      if (
        (!this.parent.formatter.editorManager.domNode.isBlockNode(r) &&
          !p(r.previousSibling) &&
          r.previousSibling.nodeName === 'BR') ||
        (!p(t.startContainer.previousSibling) && t.startContainer.previousSibling.nodeName === 'BR')
      )
        return;
      if (!p(this.parent.codeBlockModule)) {
        var l = this.parent.formatter.editorManager.domNode.getImmediateBlockNode(t.startContainer);
        var h = l !== this.parent.inputElement ? l : t.startContainer;
        var c = this.parent.formatter.editorManager.nodeSelection.findFirstContentNode(h);
        var d =
          c &&
          c.node === (t.startContainer.nodeName === 'CODE' ? t.startContainer.firstChild : t.startContainer) &&
          t.startOffset === 0;
        var u = this.parent.formatter.editorManager.codeBlockObj.findParentOrPreviousSiblingCodeBlock(t);
        var f = this.parent.formatter.editorManager.codeBlockObj.isValidCodeBlockStructure(h);
        if ((!p(u) && d) || (!p(f) && d)) return;
      }
      this.rangeElement = this.getRootBlockNode(t.startContainer);
      if (this.rangeElement.tagName === 'OL' || this.rangeElement.tagName === 'UL') {
        var m = this.getRangeLiNode(t.startContainer);
        if (
          m.previousElementSibling &&
          this.parent.inputElement.contains(m.previousElementSibling) &&
          m.previousElementSibling.childElementCount > 0
        ) {
          this.oldRangeElement =
            m.previousElementSibling.lastElementChild.nodeName === 'BR'
              ? m.previousElementSibling
              : m.previousElementSibling.lastChild;
          !p(m.lastElementChild) &&
          m.lastElementChild.nodeName !== 'BR' &&
          p(m.lastElementChild.previousSibling) &&
          m.lastChild.nodeName !== '#text'
            ? ((this.rangeElement = m.lastElementChild), (i = true))
            : (this.rangeElement = m);
        }
      } else {
        if (
          this.rangeElement === this.parent.inputElement ||
          this.rangeElement.tagName === 'TABLE' ||
          (!p(this.rangeElement.previousElementSibling) && this.rangeElement.previousElementSibling.tagName === 'TABLE')
        )
          return;
        this.oldRangeElement = this.rangeElement.previousElementSibling;
      }
      var g = this.parent.formatter.editorManager.domNode.blockNodes();
      if (!p(g[0]) && t.collapsed && t.startOffset === 0 && t.endOffset === 0 && g[0].style.marginLeft !== '') {
        g[0].style.marginLeft =
          parseInt(g[0].style.marginLeft, 10) <= 20 ? '' : parseInt(g[0].style.marginLeft, 10) - 20 + 'px';
      }
      var b = g[0].previousSibling ? g[0].previousSibling : this.findPreviousElementSibling(g[0]);
      if (p(this.oldRangeElement) && p(g[0].previousSibling)) return;
      if (b) {
        var C = b;
        var N = g[0];
        if (b.textContent.trim()) {
          this.removeLastBr(b);
          var w = this.parent.formatter.editorManager.nodeSelection.findLastTextPosition(b);
          var T = w.offset;
          var S = w.node;
          var O = Array.from(g[0].childNodes);
          var L = this.nodeSelectionObj.save(t, this.contentRenderer.getDocument());
          if (this.isPreviousNodeBrAfterBackSpace) {
            this.parent.formatter.editorManager.domNode.setMarker(L);
          }
          for (
            var A = this.parent.formatter.editorManager.domNode.getImmediateBlockNode(w.node), k = 0;
            k < O.length;
            k++
          )
            A.appendChild(O[k].cloneNode(true));
          this.isPreviousNodeBrAfterBackSpace
            ? ((L = this.parent.formatter.editorManager.domNode.saveMarker(L)), L.restore())
            : this.parent.formatter.editorManager.nodeSelection.setCursorPoint(
                this.parent.contentModule.getDocument(),
                w.node,
                w.offset,
              );
          g[0].parentNode.removeChild(g[0]);
          e.args.preventDefault();
        } else b.parentNode.removeChild(b);
      } else {
        if (this.oldRangeElement.tagName === 'OL' || this.oldRangeElement.tagName === 'UL') {
          this.oldRangeElement = this.oldRangeElement.lastElementChild.lastElementChild
            ? this.oldRangeElement.lastElementChild.lastElementChild
            : this.oldRangeElement.lastElementChild;
        }
        for (
          var P = this.oldRangeElement.lastChild ? this.oldRangeElement.lastChild : this.oldRangeElement;
          P.nodeType !== 3 && P.nodeName !== '#text' && P.nodeName !== 'BR' && !p(P.lastChild);

        )
          P = P.lastChild;
        P.nodeName === 'IMG'
          ? this.parent.formatter.editorManager.nodeSelection.setCursorPoint(
              this.parent.contentModule.getDocument(),
              P.parentElement,
              P.parentElement.childNodes.length,
            )
          : this.parent.formatter.editorManager.nodeSelection.setCursorPoint(
              this.parent.contentModule.getDocument(),
              P,
              P.textContent.length,
            );
        var I = false;
        if (
          this.oldRangeElement &&
          this.oldRangeElement.nodeName !== '#text' &&
          this.oldRangeElement.querySelectorAll('BR').length === 1
        ) {
          var H = this.oldRangeElement.querySelector('BR');
          if (H && p(H.nextSibling)) {
            var U = H.parentNode;
            var Q = this.oldRangeElement.innerHTML;
            this.parent.formatter.saveData(this.oldRangeElement.innerHTML);
            y(H);
            if (H.parentNode && H.parentNode.childNodes.length === 0) {
              y(H.parentNode);
              I = true;
            }
          }
        }
        if (!p(this.rangeElement) && this.oldRangeElement !== this.rangeElement && !I) {
          for (; this.rangeElement.firstChild; )
            this.oldRangeElement.nodeName === '#text'
              ? this.oldRangeElement.parentElement.appendChild(this.rangeElement.childNodes[0])
              : this.oldRangeElement.appendChild(this.rangeElement.childNodes[0]);
          i ? y(this.rangeElement.parentElement) : y(this.rangeElement);
          this.oldRangeElement.normalize();
        }
      }
    }
    if (e.args.code === 'Backspace' && e.args.keyCode === 8 && t.startContainer.nodeType !== Node.TEXT_NODE) {
      var K =
        !p(t.startContainer.childNodes[t.startOffset - 1]) &&
        !p(t.startContainer.childNodes[t.startOffset - 1].isContentEditable) &&
        !t.startContainer.childNodes[t.startOffset - 1].isContentEditable
          ? t.startContainer.childNodes[t.startOffset - 1]
          : null;
      var Z = t.startOffset > 1 ? t.startOffset - 1 : 0;
      if (K) {
        K.remove();
        e.args.preventDefault();
      } else if (
        (r && r.textContent.trim() === '') ||
        (t.startContainer.childNodes[Z] && t.startContainer.childNodes[Z].textContent.trim() === '')
      ) {
        var G = r && r.textContent.trim() === '' ? r : t.startContainer.childNodes[Z];
        if (ja(G) && G.previousSibling && G.previousSibling.textContent.trim() === '') {
          this.parent.formatter.editorManager.nodeSelection.setCursorPoint(
            this.parent.contentModule.getDocument(),
            G.previousSibling,
            0,
          );
          y(G);
          e.args.preventDefault();
        }
      }
    }
  };
  s.prototype.findPreviousElementSibling = function (e) {
    for (var t = e; t; ) {
      var i = t.previousElementSibling;
      if (t.previousElementSibling) return t.previousElementSibling;
      t = t.parentElement;
      if (t && t === this.parent.inputElement) return null;
    }
    return null;
  };
  s.prototype.getLastNode = function (e) {
    for (; e && e.lastChild; ) e = e.lastChild;
    for (; e && e.nodeType === Node.TEXT_NODE && !e.nodeValue.trim(); ) e = e.previousSibling;
    return e;
  };
  s.prototype.removeLastBr = function (e) {
    var t = this.getLastNode(e);
    if (t && t.nodeName === 'BR' && t.parentNode) {
      this.isPreviousNodeBrAfterBackSpace = !p(t.previousSibling) && t.previousSibling.nodeName === 'BR';
      t.parentNode.removeChild(t);
    }
  };
  s.prototype.deleteCleanup = function (e, t) {
    var i = false;
    var n;
    var r;
    if (!p(this.parent.codeBlockModule)) {
      var o = this.parent.formatter.editorManager.codeBlockObj.getCodeBlockPosition(t);
      if (
        e.args.code === 'Delete' &&
        (!p(this.parent.formatter.editorManager.codeBlockObj.isValidCodeBlockStructure(t.startContainer)) ||
          (!p(o.nextSiblingCodeBlockElement) && o.cursorAtLastPosition))
      )
        return;
    }
    if (
      e.args.code === 'Delete' &&
      e.args.keyCode === 46 &&
      this.parent.contentModule
        .getText()
        .trim()
        .replace(/(\r\n|\n|\r|\t)/gm, '')
        .replace(/\u200B/g, '').length !== 0 &&
      this.parent.getSelection().length === 0 &&
      t.startContainer.parentElement.tagName !== 'TD' &&
      t.startContainer.parentElement.tagName !== 'TH'
    ) {
      this.deleteRangeElement = r = this.getRootBlockNode(t.startContainer);
      if (this.deleteRangeElement.tagName === 'OL' || this.deleteRangeElement.tagName === 'UL') {
        n = this.getRangeLiNode(t.startContainer);
        n.nextElementSibling && n.nextElementSibling.childElementCount > 0 && !n.nextElementSibling.querySelector('BR')
          ? p(n.lastElementChild)
            ? (this.deleteRangeElement = n)
            : ((this.deleteRangeElement = n.lastElementChild), (i = true))
          : (this.deleteRangeElement = this.getRangeElement(n));
      } else if (
        this.deleteRangeElement.nodeType === 3 ||
        this.deleteRangeElement.tagName === 'TABLE' ||
        (!p(this.deleteRangeElement.nextElementSibling) &&
          this.deleteRangeElement.nextElementSibling.tagName === 'TABLE')
      )
        return;
      var a = false;
      if (
        this.deleteRangeElement.querySelectorAll('img').length > 0 &&
        this.deleteRangeElement.textContent.trim() === ''
      ) {
        a = true;
      }
      if (
        this.getCaretIndex(t, this.deleteRangeElement) === this.deleteRangeElement.textContent.length &&
        !a &&
        this.deleteRangeElement.tagName !== 'HR'
      ) {
        if (this.deleteRangeElement.lastElementChild && this.deleteRangeElement.lastElementChild.tagName === 'HR') {
          this.deleteRangeElement = null;
          return;
        }
        if (p(n)) this.deleteOldRangeElement = this.deleteRangeElement.nextElementSibling;
        else {
          var l = this.findNextHierarchySibling(n);
          l
            ? (this.deleteOldRangeElement = this.getRangeElement(l))
            : (this.deleteOldRangeElement = r.nextElementSibling);
        }
        if (p(this.deleteOldRangeElement)) return;
        t.startOffset === 0 && t.endOffset === 1 && this.deleteRangeElement.childNodes[0].nodeName === 'IMG'
          ? (this.parent.formatter.editorManager.nodeSelection.setSelectionText(
              this.parent.contentModule.getDocument(),
              this.deleteRangeElement,
              this.deleteRangeElement,
              0,
              1,
            ),
            (this.isImageDelete = true))
          : (this.parent.formatter.editorManager.nodeSelection.setCursorPoint(
              this.parent.contentModule.getDocument(),
              this.deleteRangeElement,
              this.deleteRangeElement.childNodes.length,
            ),
            (this.isImageDelete = false));
        var h = this.deleteRangeElement.querySelector('BR');
        var c = this.deleteRangeElement.lastChild;
        var d = void 0;
        if (this.deleteRangeElement.lastChild) {
          d = this.deleteRangeElement.lastChild.parentNode;
        }
        if (h && h.classList.contains('e-rte-image-remove-focus')) {
          x([h], ['e-rte-image-focus']);
          return;
        } else if (h && this.deleteRangeElement.lastChild && this.deleteRangeElement.lastChild.nodeName === 'BR') {
          y(this.deleteRangeElement.lastChild);
          if (!p(d) && d.childNodes.length === 0) {
            y(d);
          }
          if (
            !p(this.deleteRangeElement) &&
            this.deleteOldRangeElement.tagName &&
            (this.deleteOldRangeElement.tagName === 'OL' || this.deleteOldRangeElement.tagName === 'UL') &&
            this.deleteOldRangeElement !== this.deleteRangeElement &&
            !this.parent.contentModule.getEditPanel().contains(this.deleteRangeElement)
          ) {
            var u = this.deleteOldRangeElement.querySelector('li');
            if (u) {
              for (var f = u; f && f.firstChild && f.firstChild.nodeType !== Node.TEXT_NODE; ) f = f.firstChild;
              f && f.firstChild && f.firstChild.nodeType === Node.TEXT_NODE
                ? this.parent.formatter.editorManager.nodeSelection.setCursorPoint(
                    this.parent.contentModule.getDocument(),
                    f.firstChild,
                    0,
                  )
                : this.parent.formatter.editorManager.nodeSelection.setCursorPoint(
                    this.parent.contentModule.getDocument(),
                    u,
                    0,
                  );
            } else
              this.parent.formatter.editorManager.nodeSelection.setSelectionText(
                this.parent.contentModule.getDocument(),
                this.deleteOldRangeElement,
                this.deleteOldRangeElement,
                0,
                0,
              );
          }
          e.args.preventDefault();
        }
        if (
          !p(this.deleteRangeElement) &&
          this.deleteOldRangeElement.tagName !== 'OL' &&
          this.deleteOldRangeElement.tagName !== 'UL' &&
          this.deleteOldRangeElement !== this.deleteRangeElement &&
          this.parent.contentModule.getEditPanel().contains(this.deleteRangeElement)
        ) {
          for (; this.deleteOldRangeElement.firstChild; )
            this.deleteRangeElement.appendChild(this.deleteOldRangeElement.childNodes[0]);
          i ? y(this.deleteOldRangeElement.parentElement) : y(this.deleteOldRangeElement);
          this.deleteRangeElement.normalize();
        } else {
          this.deleteRangeElement = null;
          this.deleteOldRangeElement = null;
        }
      } else this.deleteRangeElement = null;
    }
  };
  s.prototype.findNextHierarchySibling = function (e) {
    if (e.nodeName === 'LI') {
      if (e.nextElementSibling) return e.nextElementSibling;
      var t = e.parentElement;
      if (e.parentElement.nextElementSibling && e.parentElement.nextElementSibling.nodeName === 'LI')
        return e.parentElement.nextElementSibling;
      if (e.parentElement.tagName === 'UL' || e.parentElement.tagName === 'OL') {
        var i = e.parentElement.parentElement;
        if (e.parentElement.parentElement && e.parentElement.parentElement.nextElementSibling)
          return e.parentElement.parentElement.nextElementSibling;
        if (e.parentElement.parentElement && e.parentElement.parentElement.nodeName === 'LI')
          return this.findNextHierarchySibling(e.parentElement.parentElement);
      }
      return null;
    } else return e.nextElementSibling;
  };
  s.prototype.getCaretIndex = function (e, t) {
    var i = 0;
    if (this.parent.contentModule.getDocument().getSelection().rangeCount !== 0) {
      var n = e.cloneRange();
      n.selectNodeContents(t);
      n.setEnd(e.endContainer, e.endOffset);
      i = n.toString().length;
    }
    return i;
  };
  s.prototype.getRangeElement = function (e) {
    var t;
    e.childNodes.length <= 1
      ? (t = e.lastElementChild
          ? e.lastElementChild.tagName === 'BR'
            ? e.lastElementChild.previousElementSibling
              ? e.lastElementChild.previousElementSibling
              : e
            : e.lastElementChild
          : e)
      : (t = e);
    return t;
  };
  s.prototype.getRootBlockNode = function (e) {
    for (; e && this.parent && this.parent.inputElement !== e && e.parentElement !== this.parent.inputElement; e = e)
      e = e.parentElement;
    return e;
  };
  s.prototype.getRangeLiNode = function (e) {
    for (var t = e.parentElement; t !== this.parent.inputElement && !(t.nodeType === 1 && t.tagName === 'LI'); )
      t = t.parentElement;
    return t;
  };
  s.prototype.onPaste = function (e) {
    var t = new RegExp(/([^\S]|^)(((https?\:\/\/)|(www\.))(\S+))/gi);
    if (e.text.match(t)) {
      if (e.isWordPaste) return;
      e.args.preventDefault();
      var i = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());
      this.parent.formatter.editorManager.nodeSelection.save(i, this.parent.contentModule.getDocument());
      for (
        var n = new RegExp(/([^\S]|^)(((https?\:\/\/)))/gi),
          r = new RegExp(/([^\S]|^)(((www\.))(\S+))/gi),
          o = e.text.split(`
`),
          a = '',
          l = 0;
        l < o.length;
        l++
      )
        if (o[l].trim() === '') a += za(this.parent);
        else {
          for (var h = '', c = true, d = o[l].split(' '), u = 0; u < d.length; u++)
            d[u].trim() === '' ? (h += c ? '&nbsp;' : ' ') : ((c = false), (h += d[u] + ' '));
          l === 0 ? (a += '<span>' + h.trim() + '</span>') : (a += '<p>' + h.trim() + '</p>');
        }
      var f = this.parent.createElement('div');
      f.setAttribute('class', 'pasteContent');
      f.style.display = 'inline';
      f.innerHTML = a.replace('&para', '&amp;para');
      for (var m = f.querySelectorAll('span, p'), l = 0; l < m.length; l++) {
        for (var g = m[l].innerHTML.split(' '), b = '', u = 0; u < g.length; u++)
          g[u].match(n) || g[u].match(r)
            ? (b +=
                '<a class="e-rte-anchor" href="' +
                g[u] +
                '" title="' +
                g[u] +
                '" target="_blank" aria-label="' +
                this.parent.serviceLocator.getService('rteLocale').getConstant('linkAriaLabel') +
                '">' +
                g[u] +
                ' </a>')
            : (b += g[u] + ' ');
        m[l].innerHTML = b.trim();
      }
      var C = f.childNodes[0];
      if (
        !p(f.childNodes[0]) &&
        !p(f.childNodes[0].childNodes[0]) &&
        f.childNodes[0].nodeName === 'SPAN' &&
        f.childNodes[0].childNodes[0].nodeName === 'A'
      ) {
        f.innerHTML = f.innerHTML.replace('<span>', '').replace('</span>', '');
      }
      p(this.parent.pasteCleanupModule)
        ? this.parent.formatter.editorManager.execCommand('insertHTML', null, null, null, f)
        : e.callBack(f.innerHTML);
    }
  };
  s.prototype.spaceLink = function (e) {
    var t = this.nodeSelectionObj.getRange(this.contentRenderer.getDocument());
    if (t.startContainer.nodeType === Node.TEXT_NODE) {
      var i = this.nodeSelectionObj.getParentNodeCollection(t);
      var n = t.startContainer.textContent.substr(0, t.endOffset);
      var r = n.split(' ');
      var o = r[r.length - 1];
      var a = t.startOffset - (n.length - r[r.length - 1].length);
      o = o.slice(0, a);
      var l = new RegExp(/([^\S]|^)(((https?\:\/\/)|(www\.))(\S+))/gi);
      if (i[0] && i[0].nodeName !== 'A' && o.match(l)) {
        var h = this.nodeSelectionObj.save(t, this.parent.contentModule.getDocument());
        var c = o.indexOf('http') > -1 ? o : 'http://' + o;
        var d = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(t);
        var u = {
          url: c,
          selection: h,
          selectParent: d,
          text: o,
          title: '',
          target: '_blank',
        };
        this.parent.formatter.process(
          this.parent,
          {
            item: {
              command: 'Links',
              subCommand: 'CreateLink',
            },
          },
          e,
          u,
        );
      }
    }
  };
  s.prototype.onToolbarClick = function (e) {
    var t = this;
    var i;
    var n;
    var r;
    var o = e.item;
    var a = v(e.originalEvent.target, '.e-rte-quick-popup');
    var l = e.originalEvent.target;
    this.parent.notify(_t, { target: e.originalEvent.target });
    if (e.item.command !== 'FormatPainter') {
      var h =
        !p(a) && a.classList.contains('e-rte-quick-popup') && a.querySelectorAll('.e-text-quicktoolbar').length === 1;
      if (a && !a.classList.contains('e-rte-inline-popup') && !h) {
        if (
          !(
            e.item.subCommand === 'SourceCode' ||
            e.item.subCommand === 'Preview' ||
            e.item.subCommand === 'FontColor' ||
            e.item.subCommand === 'BackgroundColor'
          )
        ) {
          if (W() && e.item.command === 'Images') {
            this.nodeSelectionObj.restore();
          }
          var c = this.nodeSelectionObj.getRange(this.parent.contentModule.getDocument());
          i = this.nodeSelectionObj.save(c, this.parent.contentModule.getDocument());
          n = this.nodeSelectionObj.getNodeCollection(c);
          r = this.nodeSelectionObj.getParentNodeCollection(c);
        }
        if (e.item.command === 'Images') {
          this.parent.notify($i, {
            member: 'image',
            args: e,
            selectNode: n,
            selection: i,
            selectParent: r,
          });
        }
        if (e.item.command === 'Audios') {
          this.parent.notify(_a, {
            member: 'audio',
            args: e,
            selectNode: n,
            selection: i,
            selectParent: r,
          });
        }
        if (e.item.command === 'Videos') {
          this.parent.notify(Ua, {
            member: 'video',
            args: e,
            selectNode: n,
            selection: i,
            selectParent: r,
          });
        }
        if (e.item.command === 'Links') {
          this.parent.notify(Qa, {
            member: 'link',
            args: e,
            selectNode: n,
            selection: i,
            selectParent: r,
          });
        }
        if (e.item.command === 'Table') {
          this.parent.notify(rn, {
            member: 'table',
            args: e,
            selectNode: n,
            selection: i,
            selectParent: r,
          });
        }
      } else {
        var d = document.getElementById(this.parent.getID() + '_rtelink');
        var u = document.getElementById(this.parent.getID() + '_image');
        if (
          !(
            e.item.subCommand === 'SourceCode' ||
            e.item.subCommand === 'Preview' ||
            e.item.subCommand === 'FontColor' ||
            e.item.subCommand === 'BackgroundColor' ||
            e.item.subCommand === 'NumberFormatList' ||
            e.item.subCommand === 'BulletFormatList'
          )
        ) {
          var c = this.nodeSelectionObj.getRange(this.parent.contentModule.getDocument());
          if (p(d) && p(u)) {
            i = this.nodeSelectionObj.save(c, this.parent.contentModule.getDocument());
          }
          n = this.nodeSelectionObj.getNodeCollection(c);
          r = this.nodeSelectionObj.getParentNodeCollection(c);
        }
        switch (e.item.subCommand) {
          case 'Maximize':
            this.parent.notify(pn, { args: e });
            break;
          case 'Minimize':
            this.parent.notify(cn, { args: e });
            break;
          case 'CreateLink':
            this.parent.notify(Ja, {
              member: 'link',
              args: e,
              selectNode: n,
              selection: i,
              selectParent: r,
            });
            break;
          case 'RemoveLink':
            this.parent.notify(Ya, {
              member: 'link',
              args: e,
              selectNode: n,
              selection: i,
              selectParent: r,
            });
            break;
          case 'Print':
            this.parent.print();
            break;
          case 'Image':
            this.parent.notify(Pt, {
              member: 'image',
              args: e,
              selectNode: n,
              selection: i,
              selectParent: r,
            });
            break;
          case 'Audio':
            this.parent.notify(Xa, {
              member: 'audio',
              args: e,
              selectNode: n,
              selection: i,
              selectParent: r,
            });
            break;
          case 'Video':
            this.parent.notify(Ga, {
              member: 'video',
              args: e,
              selectNode: n,
              selection: i,
              selectParent: r,
            });
            break;
          case 'CreateTable':
            this.parent.notify(nn, {
              member: 'table',
              args: e,
              selection: i,
            });
            break;
          case 'SourceCode':
            this.parent.notify(un, {
              member: 'viewSource',
              args: e,
            });
            break;
          case 'Preview':
            this.parent.notify(fn, {
              member: 'updateSource',
              args: e,
            });
            break;
          case 'FontColor':
          case 'BackgroundColor':
            break;
          case 'File':
            this.parent.notify(Pr, {
              member: 'fileManager',
              args: e,
              selectNode: n,
              selection: i,
              selectParent: r,
            });
            break;
          case 'EmojiPicker':
            this.parent.notify(Ka, {
              member: 'emojiPicker',
              args: e,
            });
            break;
          case 'ImportWord':
            this.parent.notify(Va, {});
            break;
          case 'ExportWord':
            this.parent.notify(Lr, {
              member: 'ExportWord',
              args: e,
            });
            break;
          case 'CodeBlock':
            this.parent.notify(Wa, {
              member: 'codeBlock',
              args: e,
            });
            break;
          case 'ExportPdf':
            this.parent.notify(Lr, {
              member: 'ExportPdf',
              args: e,
            });
            break;
          default:
            this.parent.formatter.process(this.parent, e, e.originalEvent, null);
            break;
        }
        if (
          !p(this.parent.quickToolbarModule) &&
          ((p(this.parent.quickToolbarModule.imageQTBar) && e.item.subCommand === 'Image') ||
            (p(this.parent.quickToolbarModule.audioQTBar) && e.item.subCommand === 'Audio') ||
            (p(this.parent.quickToolbarModule.videoQTBar) && e.item.subCommand === 'Video') ||
            (p(this.parent.quickToolbarModule.linkQTBar) && e.item.subCommand === 'CreateLink'))
        ) {
          this.parent.notify(dn, {});
        }
      }
    } else
      e.originalEvent.detail === 1
        ? (clearTimeout(this.clickTimeout),
          (this.clickTimeout = setTimeout(function () {
            t.parent.notify($a, {
              member: 'formatPainter',
              args: e,
            });
          }, 200)))
        : (clearTimeout(this.clickTimeout),
          this.parent.notify(Za, {
            member: 'formatPainter',
            args: e,
          }));
  };
  s.prototype.instantiateRenderer = function () {
    this.parent.iframeSettings.enable
      ? this.renderFactory.addRenderer(te.Content, new Ts(this.parent))
      : this.renderFactory.addRenderer(te.Content, new Vr(this.parent));
  };
  s.prototype.removeEventListener = function () {
    this.parent.off(Le, this.render);
    this.parent.off(pe, this.onPropertyChanged);
    this.parent.off(an, this.onToolbarClick);
    this.parent.off(ee, this.destroy);
    this.parent.off(Ie, this.onKeyDown);
    this.parent.off(vr, this.instantiateRenderer);
    this.parent.off(br, this.selectAll);
    this.parent.off(en, this.selectRange);
    this.parent.off(Cr, this.getSelectedHtml);
    this.parent.off(Fe, this.onSelectionSave);
    this.parent.off(Me, this.onSelectionRestore);
    this.parent.off(yr, this.updateReadOnly);
    this.parent.off(Vt, this.onPaste);
    this.parent.off(Tr, this.isTableClassAdded);
  };
  s.prototype.render = function () {
    this.contentRenderer = this.renderFactory.getRenderer(te.Content);
    var e = this.contentRenderer.getEditPanel();
    var t = {
      undoRedoSteps: this.parent.undoRedoSteps,
      undoRedoTimer: this.parent.undoRedoTimer,
    };
    if (p(this.parent.formatter)) {
      var i = new ws({
        currentDocument: this.contentRenderer.getDocument(),
        element: e,
        options: t,
        formatPainterSettings: this.parent.formatPainterSettings,
      });
      this.parent.setProperties({ formatter: i }, true);
    } else
      this.parent.formatter.updateFormatter(
        e,
        this.contentRenderer.getDocument(),
        t,
        this.parent.formatPainterSettings,
      );
    if (this.parent.enableXhtml) {
      this.parent.notify(mn, {});
    }
    if (this.parent.toolbarSettings.enable) {
      this.toolbarUpdate = new Dr(this.parent);
    }
    if (this.parent.inlineMode.enable) {
      if (!p(this.parent.fontFamily.default)) {
        e.style.fontFamily = this.parent.fontFamily.default;
      }
      if (!p(this.parent.fontSize.default)) {
        e.style.fontSize = this.parent.fontSize.default;
      }
    }
    this.parent.notify(rt, {});
  };
  s.prototype.onPropertyChanged = function (e) {
    if (!p(e) && !p(e.newProp.toolbarSettings) && !p(e.newProp.toolbarSettings.enable)) {
      this.toolbarUpdate = new Dr(this.parent);
    }
    if (!p(e.newProp.formatter)) {
      var t = this.contentRenderer.getEditPanel();
      var i = {
        undoRedoSteps: this.parent.undoRedoSteps,
        undoRedoTimer: this.parent.undoRedoTimer,
      };
      this.parent.formatter.updateFormatter(t, this.contentRenderer.getDocument(), i);
    }
  };
  s.prototype.getModuleName = function () {
    return 'htmlEditor';
  };
  s.prototype.selectAll = function () {
    var e = es(this.parent.contentModule.getDocument(), this.parent.contentModule.getEditPanel());
    if (e.length > 0) {
      this.parent.formatter.editorManager.nodeSelection.setSelectionText(
        this.parent.contentModule.getDocument(),
        e[0],
        e[e.length - 1],
        0,
        e[e.length - 1].textContent.length,
      );
    }
  };
  s.prototype.selectRange = function (e) {
    this.parent.formatter.editorManager.nodeSelection.setRange(this.parent.contentModule.getDocument(), e.range);
  };
  s.prototype.getSelectedHtml = function (e) {
    e.callBack(
      this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()).toString(),
    );
  };
  s.prototype.tableSelectionKeyAction = function (e) {
    for (var t = e.args, i = this.parent.inputElement.querySelectorAll('.e-cell-select'), n = 0; n < i.length; n++) {
      var r = i[n];
      Y([r], [ne, _r, zr]);
      n === 0
        ? (t.keyCode === 32 ? (r.innerHTML = '&#8203;<br>') : (r.innerHTML = '<br>'),
          this.nodeSelectionObj.setCursorPoint(this.parent.contentModule.getDocument(), r.firstChild, 0))
        : (r.innerHTML = '<br>');
    }
  };
  s.prototype.marginTabAdd = function (e, t) {
    for (var i = 0; i < t.length; i++) {
      var n = t[i];
      if (!t[i].closest('li'))
        if (t[i].style.marginLeft) {
          var r = parseInt(t[i].style.marginLeft, 10);
          e ? (r -= 20) : (r += 20);
          t[i].style.marginLeft = r.toString() + 'px';
          if (t[i].style.marginLeft === '0px') {
            t[i].removeAttribute('style');
          }
        } else if (!e) {
          t[i].style.marginLeft = '20px';
        }
    }
  };
  return s;
})();
export { xs as C, Mt as D, Ns as F, Is as H, Ms as I, gt as N, As as Q, Nr as S, Rs as T, Bs as a, Pe as b, V as c };
